
<div class="form-horizontal col-sm-12">
    <div style="display: flex;">
        <div id="markGrid"></div>
    </div>
</div>



<script>
    $(document).ready(function () {

        var markGridDataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    url: '@Url.Action("GetMarkCatalog", "Modeling")',
                    contentType: 'application/json; charset=utf-8',
                    data: { generalModelId: '@ViewBag.GeneralModelId', factorId: '@ViewBag.FactorId' },
                    dataType: 'json'
                },
                create: {
                    url: '@Url.Action("CreateMark", "Modeling")',                         
                    type: 'POST',
                    dataType: 'json'
                },
                update: {
                    url: '@Url.Action("UpdateMark", "Modeling")',                    
                    type: 'POST',
                    dataType: 'json'
                },
                destroy: {
                    url: '@Url.Action("DeleteMark", "Modeling")',                        
                    type: 'POST',
                    dataType: 'json'
                }
            },
            requestStart: function(e) {
                if (e.type == "read") {
                    kendo.ui.progress($('body'), true);
                }
            },
            requestEnd: function (e) {
                if (e.type == "read") {
                    kendo.ui.progress($('body'), false);
                }
            },
            error: function (e) {
                Common.ShowError(e.xhr.responseText);
            },
            schema: {
                model: {
                    id: "Id",
                    fields: {
                        Id: { editable: false, nullable: true },
                        GeneralModelId: { editable: false},
                        Value: { validation: { required: true } },
                        Metka: { type: "number", nullable: true  }
                    }
                }
            },
            change: function (e) {
                //если добавляем новое значение в грид, а к нему уже была применена фильтрация
                //чтобы отобразить новую пустую строчку, нужна дополнительная фильтрация
                if (e.action == "add") {
                    var filter = this.filter();
                    if (filter) {
                        var noValueFilter = { field: "ValueFactor", operator: "eq", value: "" };
                        var newFilter = {
                            logic: "or",
                            filters: [noValueFilter, filter]
                        };
                        this.filter(newFilter);
                    }
                }
            },
            pageSize: 10
        });

        $('#markGrid').kendoGrid({
            dataSource: markGridDataSource,
            columns: [
                {
                    field: 'Value',
                    title: 'Значение',
                    headerAttributes: { style: "text-align: center;" }
                },
                {
                    field: 'Metka',
                    title: 'Метка',
                    headerAttributes: { style: "text-align: center;" },
                    //по умолчанию точность новой метки - 2 знака после запятой, 
                    //переопределяем это
                    editor: function (container, options) {
                        $('<input name="' + options.field + '"/>')
                            .appendTo(container)
                            .kendoNumericTextBox({
                                format: "{0:n14}",
                                decimals: 14,
                                step: 0.1
                            });
                    }
                },
                { command: ["edit", "destroy"], title: "&nbsp;", width: "250px" }
            ],
            toolbar: ["create"],
            scrollable: true,
            pageable: true,
            editable: "inline",
            filterable: {
                extra: false,
                operators: {
                    string: {
                        startswith: "Начинается с",
                        eq: "Равно",
                        neq: "Не равно"
                    },
                    number: {
                        eq: "Равно",
                        gte: "Больше",
                        lte: "Меньше"
                    }
                }
            },
            beforeEdit: function (e) {
                if (e.model.isNew()) {
                    e.model.GeneralModelId = '@ViewBag.GeneralModelId';
                    e.model.FactorId = '@ViewBag.FactorId';
                }
            }
        });
    });

</script>

