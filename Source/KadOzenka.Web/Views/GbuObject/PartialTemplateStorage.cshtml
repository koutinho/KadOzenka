@model KadOzenka.Web.Models.GbuObject.TemplateStorageViewModel

<div>
	<button style="float: left" id="showSelectedTemplate" class="k-button" type="button">Загрузить шаблон</button>
	<button style="float: left; margin-left: 4px;" id="showSaveForm" class="k-button" type="button">Сохранить шаблон</button>
	<div class="template-name-wrapper"  style="display: none;">
		<div style="display: flex; padding-left: 4px;">
			@Html.Kendo().TextBox().Name("templateName").Value("").HtmlAttributes(new { placeholder = "Введите имя шаблона", autocomplete = "off" })
			<button style="float: left; margin-left: 4px;" id="save" class="k-button" type="button"><i class="fas fa-check"></i></button>
		</div>
	</div>
	<div class="template-select-wrapper"  style="display: none;">
		<div style="display: flex; padding-left: 4px;">
			@(Html.Kendo().DropDownList()
				.Name("selectedTemplate")
				.DataTextField("Text")
				.DataValueField("Value")
				.DataSource(source => {
					                      source.Read(read =>
					                      {
						                      read.Action(Model.ActionName, Model.ControllerName);
					                      }); 
				})
				.OptionLabel(null))
			<button style="float: left; margin-left: 4px;" id="select" class="k-button" type="button"><i class="fas fa-check"></i></button>
		</div>
	</div>
</div>

<script type="text/javascript">
	var templateStorage = templateStorage ||
	(function($) {
		var obj = {
			actionNameUrlSaveTemplate: "",
			controllerNameUrlSaveTemplate: "",
			actionNameUrlSelectedTemplate: "",
			controllerNameUrlSelectedTemplate: "",
			currentFormType: 0,
			init: function (typeForm, actionNameUrlSaveTemplate, controllerNameUrlSaveTemplate, actionNameUrlSelectedTemplate, controllerNameUrlSelectedTemplate) {
				this.currentFormType = typeForm;
				this.actionNameUrlSaveTemplate = actionNameUrlSaveTemplate;
				this.controllerNameUrlSaveTemplate = controllerNameUrlSaveTemplate;
				this.subscribers();
			},
			subscribers: function () {
				var self = this;
				$('#showSaveForm').on('click',
					function () {
						$('.template-name-wrapper').show(500);
						$('.template-select-wrapper').hide(500);
					});

				$('#showSelectedTemplate').on('click', function() {
					$('.template-select-wrapper').show(500);
					$('.template-name-wrapper').hide(500);
				});


				$('#templateName').keydown(function () {
					$(this).removeClass('error');
				});
				$('#save').on('click',
					function () {
						if ($('#templateName').val() === "") {
							Common.ShowError("Имя шаблона обязательно для заполнения");
							$('#templateName').addClass('error');
							return;
						}
						$('.template-name-wrapper').hide(500);

						var form = $('form');
						var formObject = Common.Functions.FormToObject(form);
						formObject['ValuesFilter'] = $("#valuesFilter").data('kendoMultiSelect').value();
						kendo.ui.progress($('body'), true);

						var url = "/"+ self.controllerNameUrlSaveTemplate + "/" + self.actionNameUrlSaveTemplate + "?nameTemplate=" + $('#templateName').val();

						$.post(url, formObject).done(function (response) {
							kendo.ui.progress($('body'), false);
							if (response.Error) {
								kendo.ui.progress($('body'), false);
								Common.ShowError(response.Error);
								return;
							}
							if (response.success) {
								kendo.ui.progress($('body'), false);
								Common.ShowMessage("Выполнено");
								$('#templateName').val("");
								$('#selectedTemplate').data("kendoDropDownList").dataSource.read();
								$('#selectedTemplate').data("kendoDropDownList").refresh();
							}
						});
					});

				$('#select').on('click',
					function() {
						var url = "";
						$.get(url).done(function(response) {

						});
					});
			}
		}
		return obj;
	})($);
</script>