@using Core.Shared.Extensions;
@model List<KadOzenka.Web.Models.GbuObject.ObjectAttributes.RegisterDto>

@{
    int registerCounter = 0;
}
@if (Model.Count == 0)
{
    <div>
        <p class="text">Не найдено атрибутов по заданной Дате актуализации</p>
    </div>
}
else
{
    <div id="registersTabstrip">
        <ul>
            @{
                foreach (var m in Model)
                {
                    var textTab = m.Name;
                    <li class="@(registerCounter == 0 ? "k-state-active" : "")">@(textTab)</li>
                    registerCounter++;
                }
                registerCounter = 0;
            }
        </ul>
        @{
            foreach (var m in Model)
            {
                <div style="min-height: 710px">
                    @Html.HiddenFor(r => r[registerCounter].Id)
                    <div class="form-horizontal col-sm-12">
                        <div class="form-group"></div>
                        @{
                            var attrCounter = 0;
                            foreach (var mRegisterAttribute in m.RegisterAttributes)
                            {

                                if (attrCounter % 2 == 0)
                                {
                                    @Html.Raw("<div class='form-group'>");
                                    <div class="col-sm-2">
                                        @Html.CustomLabel(mRegisterAttribute.Name)
                                    </div>
                                    <div class="col-sm-4">
                                        @{
                                            if (mRegisterAttribute.IsString)
                                            {
                                                <div class="col-sm-10">
                                                    @{
                                                        @Html.KendoTextBoxFor(r => r[registerCounter].RegisterAttributes[attrCounter].StringValue, isReadonly: true)
                                                    }
                                                </div>
                                                <div class="col-sm-2">
                                                    <span class="attrHistory" data-History-url="@(mRegisterAttribute.AttributeHistoryUrl)" data-Register-id="@(m.Id)" data-Attribute-id="@(mRegisterAttribute.Id)">
                                                        <img id="@(mRegisterAttribute.Id)historyImg" src="/images/Icons/24x24_Help.png" class="attrHistoryImg" />
                                                    </span>
                                                </div>
                                            }
                                            else if (mRegisterAttribute.IsNumber)
                                            {
                                                <div class="col-sm-10">
                                                    @Html.KendoTextBoxFor(r => r[registerCounter].RegisterAttributes[attrCounter].NumValue, isReadonly: true)
                                                </div>
                                                <div class="col-sm-2">
                                                    <span class="attrHistory" data-History-url="@(mRegisterAttribute.AttributeHistoryUrl)" data-Register-id="@(m.Id)" data-Attribute-id="@(mRegisterAttribute.Id)">
                                                        <img id="@(mRegisterAttribute.Id)historyImg" src="/images/Icons/24x24_Help.png" class="attrHistoryImg" />
                                                    </span>
                                                </div>
                                            }
                                            else if (mRegisterAttribute.IsDate)
                                            {
                                                <div class="col-sm-8">
                                                    @Html.KendoDatePickerFor(r => r[registerCounter].RegisterAttributes[attrCounter].DateValue, isReadonly: true)
                                                </div>
                                                <div class="col-sm-2">
                                                    <span class="attrHistory" data-History-url="@(mRegisterAttribute.AttributeHistoryUrl)" data-Register-id="@(m.Id)" data-Attribute-id="@(mRegisterAttribute.Id)">
                                                        <img id="@(mRegisterAttribute.Id)historyImg" src="/images/Icons/24x24_Help.png" class="attrHistoryImg" />
                                                    </span>
                                                </div>
                                            }
                                        }
                                    </div>
                                }
                                else
                                {
                                    <div class="col-sm-2">
                                        @Html.CustomLabel(mRegisterAttribute.Name)
                                    </div>
                                    <div class="col-sm-4">
                                        @{
                                            if (mRegisterAttribute.IsString)
                                            {
                                                <div class="col-sm-10">
                                                    @{
                                                        @Html.KendoTextBoxFor(r => r[registerCounter].RegisterAttributes[attrCounter].StringValue, isReadonly: true)
                                                    }
                                                </div>
                                                <div class="col-sm-2">
                                                    <span class="attrHistory" data-History-url="@(mRegisterAttribute.AttributeHistoryUrl)" data-Register-id="@(m.Id)" data-Attribute-id="@(mRegisterAttribute.Id)">
                                                        <img id="@(mRegisterAttribute.Id)historyImg" src="/images/Icons/24x24_Help.png" class="attrHistoryImg" />
                                                    </span>
                                                </div>
                                            }
                                            else if (mRegisterAttribute.IsNumber)
                                            {
                                                <div class="col-sm-10">
                                                    @Html.KendoTextBoxFor(r => r[registerCounter].RegisterAttributes[attrCounter].NumValue, isReadonly: true)
                                                </div>
                                                <div class="col-sm-2">
                                                    <span class="attrHistory" data-History-url="@(mRegisterAttribute.AttributeHistoryUrl)" data-Register-id="@(m.Id)" data-Attribute-id="@(mRegisterAttribute.Id)">
                                                        <img id="@(mRegisterAttribute.Id)historyImg" src="/images/Icons/24x24_Help.png" class="attrHistoryImg" />
                                                    </span>
                                                </div>
                                            }
                                            else if (mRegisterAttribute.IsDate)
                                            {
                                                <div class="col-sm-8">
                                                    @Html.KendoDatePickerFor(r => r[registerCounter].RegisterAttributes[attrCounter].DateValue, isReadonly: true)
                                                </div>
                                                <div class="col-sm-2">
                                                    <span class="attrHistory" data-History-url="@(mRegisterAttribute.AttributeHistoryUrl)" data-Register-id="@(m.Id)" data-Attribute-id="@(mRegisterAttribute.Id)">
                                                        <img id="@(mRegisterAttribute.Id)historyImg" src="/images/Icons/24x24_Help.png" class="attrHistoryImg" />
                                                    </span>
                                                </div>
                                            }
                                        }
                                    </div>
                                    @Html.Raw("</div>");
                                }

                                if (attrCounter % 2 == 0 && attrCounter == m.RegisterAttributes.Count - 1)
                                {
                                    @Html.Raw("</div>");
                                }
                                attrCounter++;
                            }
                        }
                    </div>
                </div>
                registerCounter++;
            }
        }
    </div>
}

<style>
    .conclusion-link-content .k-content {
        padding: 10px !important;
    }

    .text {
        padding: 1em;
        text-align: center;
        font-family: 'Roboto';
        font-style: normal;
        font-size: 1.2em;
    }

    .attrHistoryImg {
        margin-top: .4em;
    }

    .attrHistory {
    }
</style>


    <script type="text/javascript">
        $(document).ready(function() {
            $("#registersTabstrip").kendoTabStrip();

            $("span[class*='attrHistory'").each(function () {
                var historyUrl = $(this).attr('data-History-url');
                $(this).kendoTooltip({
                    autoHide: false,
                    iframe: true,
                    content: {
                        url: historyUrl
                    },
                    show: onShow,
                    requestStart: function () {
                        kendo.ui.progress($("div[class*='k-tooltip'"), true);
                    },
                    contentLoad: function () {
                        kendo.ui.progress($("div[class*='k-tooltip'"), false);
                    },
                    width: 800,
                    height: 400
                });
            });
        });

        function onShow(e) {
            var registerId = $(e.sender.element).attr('data-Register-id');
            var attrId = $(e.sender.element).attr('data-Attribute-id');
            $("span[class*='attrHistory'").each(function () {
                var currentRegisterId = $(this).attr('data-Register-id');
                var currentAttributeId = $(this).attr('data-Attribute-id');
                if (currentRegisterId !== registerId || (currentRegisterId === registerId && currentAttributeId !== attrId)) {
                    var toolTip = $(this).data("kendoTooltip");
                    toolTip.hide();
                }
            });
        }
    </script>

