(("undefined"!==typeof self?self:this)["webpackJsonpszc"]=("undefined"!==typeof self?self:this)["webpackJsonpszc"]||[]).push([[9],{0:function(e,t){},"0061":function(e,t,n){},"00c1":function(e,t,n){"use strict";var i=n("e021"),o=n.n(i);o.a},"0187":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-add-wms"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Как базовая карта")]),n("div",{staticClass:"dx-field-value"},[n("DxCheckBox",{on:{valueChanged:e.emitChanges},model:{value:e.layersOptions.baseMap,callback:function(t){e.$set(e.layersOptions,"baseMap",t)},expression:"layersOptions.baseMap"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("URL-адрес")]),n("div",{staticClass:"dx-field-value dx-field-value_custom"},[n("DxTextBox",{staticClass:"gis-add-wms__url",attrs:{valueChangeEvent:"input"},on:{valueChanged:e.emitChanges},model:{value:e.url,callback:function(t){e.url=t},expression:"url"}}),n("DxButton",{attrs:{text:"Получить",type:"default",disabled:!e.url||e.loading,template:e.loading?"loadIndicatorContent":"content",width:"76"},on:{click:e.getWms},scopedSlots:e._u([{key:"loadIndicatorContent",fn:function(){return[n("div",[n("dx-load-indicator",{staticClass:"gis-add-wms__load-indicator",attrs:{visible:!0}})],1)]},proxy:!0}])})],1)]),n("DxButton",{attrs:{type:"default",text:"Логин/пароль для доступа к сервису",stylingMode:"text"},on:{click:function(t){e.authorizationFormVisible=!e.authorizationFormVisible}}}),e.authorizationFormVisible?n("GisLoginForm",{attrs:{login:this.login,password:this.password},on:{authorizationDataChange:e.authorizationDataChange}}):e._e(),0!==e.layers.length?n("div",{staticClass:"gis-add-wms__layers-settings"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"}),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-add-wms__list"},[n("DxTreeView",{ref:"listComponent",attrs:{keyExpr:null,searchEnabled:!0,searchExpr:["Title","Name"],dataSource:e.layers,displayExpr:"text",itemsExpr:"Layer",selectionMode:"multiple",selectNodesRecursive:!0,showCheckBoxesMode:"normal"},on:{itemCollapsed:e.calcHeight,itemExpanded:e.calcHeight,contentReady:e.calcHeight,itemClick:e.onListItemClick,selectionChanged:e.selectLayer}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Формат")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.formatDataSource,displayExpr:"text",valueExpr:"value"},on:{opened:e.selectBoxOpened,valueChanged:e.emitChanges},model:{value:e.layersOptions.format,callback:function(t){e.$set(e.layersOptions,"format",t)},expression:"layersOptions.format"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Стили")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{on:{valueChanged:e.emitChanges},model:{value:e.layersOptions.styles,callback:function(t){e.$set(e.layersOptions,"styles",t)},expression:"layersOptions.styles"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Версия")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.versionDataSource,displayExpr:"text",valueExpr:"value"},on:{opened:e.selectBoxOpened,valueChanged:e.emitChanges},model:{value:e.layersOptions.version,callback:function(t){e.$set(e.layersOptions,"version",t)},expression:"layersOptions.version"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Размер тайла")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{on:{valueChanged:e.emitChanges},model:{value:e.layersOptions.tileSize,callback:function(t){e.$set(e.layersOptions,"tileSize",t)},expression:"layersOptions.tileSize"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Прозрачность")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.transparentDataSource,displayExpr:"text",valueExpr:"value"},on:{opened:e.selectBoxOpened,valueChanged:e.emitChanges},model:{value:e.layersOptions.transparent,callback:function(t){e.$set(e.layersOptions,"transparent",t)},expression:"layersOptions.transparent"}})],1)])]):e._e()],1)},o=[],a=(n("8e6e"),n("6762"),n("2fdb"),n("6b54"),n("cadf"),n("456d"),n("ac6a"),n("28a5"),n("ade3")),s=n("5c46"),r=n("d400"),l=n("7511"),c=n("e614"),d=n.n(c),u=n("6191"),p=n.n(u),f=n("2824"),h=n.n(f),m=n("049d"),g=n.n(m),y=n("7ea3"),v=n.n(y),b=n("ee80"),_=n.n(b);function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O={baseMap:!1,bbox:"{bbox-epsg-3857}",format:"image/png",styles:"",version:"1.1.1",tileSize:256,subdomains:"",transparent:!0,layers:"",bounds:null,titles:[]},I={name:"GisAddWMS",mixins:[s["a"],r["a"]],components:{GisLoginForm:l["a"],DxTextBox:d.a,DxButton:p.a,DxTreeView:h.a,DxSelectBox:g.a,DxNumberBox:v.a,DxCheckBox:_.a},props:{options:Object},data:function(){return{layersOptions:x({},O),formatDataSource:[{value:"image/png",text:"PNG"},{value:"image/png8",text:"PNG8"},{value:"image/jpeg",text:"JPEG"},{value:"image/vnd.jpeg-png",text:"JPEG-PNG"}],versionDataSource:[{value:"1.0.0",text:"1.0.0"},{value:"1.1.0",text:"1.1.0"},{value:"1.1.1",text:"1.1.1"},{value:"1.3.0",text:"1.3.0"}],transparentDataSource:[{value:!0,text:"Да"},{value:!1,text:"Нет"}],layersTitles:[]}},computed:{selectedLayers:{get:function(){return this.layersOptions.layers.split(",")},set:function(e){this.layersOptions.layers=e.join(",")}}},watch:{options:{handler:function(){var e=this,t=this.options||{};if(this.layersOptions={},Object.keys(O).forEach((function(n){e.layersOptions[n]=void 0!==t[n]?t[n]:O[n]})),t.token){var n=atob(t.token).split(":");this.login=n[0],this.password=n[1]}t.url&&(this.url=t.url,this.getCapabilities("service=WMS&request=GetCapabilities")),this.emitChanges()},immediate:!0}},methods:{calcHeight:function(e){var t=e.element.querySelector(".dx-treeview-node-container"),n=t.offsetHeight>370?400:t.offsetHeight+30;e.component.option("height",n)},onListItemClick:function(e){this.getExtents(e.itemData.id);var t=e.element.querySelector(".item-extent");t&&t.classList.remove("item-extent"),e.itemElement.classList.add("item-extent")},selectLayer:function(e){var t=e.component.instance().getSelectedNodes().filter((function(e){return!e.children.length})),n=t.map((function(e){return e.itemData.Name[0]}));this.selectedLayers=n,this.layersOptions.titles=t.map((function(e){return e.itemData.text})),this.layersOptions.bounds=this.getBounds(n),this.emitLayerOptionsTree(e),this.emitChanges()},emitLayerOptionsTree:function(e){var t=this,n=[];e.component.getNodes().forEach((function(e){t.prepareLayerTree(e,n)})),this.$emit("layerOptionsTreeChange",n)},prepareLayerTree:function(e,t){var n=this;if(e.children&&e.children.length>0){var i={options:{text:e.itemData.text,iconCss:"core core-092-folder",iconColor:"#ecc849",visible:!1,expanded:!1,allowDropInside:!0,allowFolderEdit:!0},group:!0,items:[]};e.children.forEach((function(e){n.prepareLayerTree(e,i.items)})),i.items.length>0&&t.push(i)}else if(e.selected){var o={options:x(x({},this.layersOptions),{},{bounds:this.getBounds([e.itemData.Name[0]]),layers:e.itemData.Name[0],titles:e.itemData.text,text:e.itemData.text,url:this.url,wmsUrl:this.url,type:"wms",visible:!1,token:this.login&&this.password?btoa("".concat(this.login,":").concat(this.password)):null}),group:!1};t.push(o)}},getWms:function(){this.setDefaultOptions(),this.getCapabilities("service=WMS&request=GetCapabilities")},parseXML:function(e){var t=this,i=n("083c").parseString;i(e,(function(e,n){t.layers=n.WMS_Capabilities.Capability[0].Layer,t.formatLayers(t.layers)}))},setDefaultOptions:function(){this.layersOptions=x({},O)},emitChanges:function(){var e=x(x({},this.layersOptions),{},{url:this.url,wmsUrl:this.url});this.login&&this.password&&(e.token=btoa("".concat(this.login,":").concat(this.password))),this.$emit("change",e)},formatLayers:function(e){var t=this;e.forEach((function(e,n){e.text=e.Title[0]||"Nameless",e.id=(e.Name&&e.Name[0]?e.Name[0]:e.Title[0])||n.toString();var i=t.selectedLayers.includes(e.id);e.selected=i,e.expanded=i,t.setExtent(e),e.Layer&&t.formatLayers(e.Layer)}))},setExtent:function(e){if(e.EX_GeographicBoundingBox){var t=e.EX_GeographicBoundingBox[0],n=[[t.eastBoundLongitude[0],t.northBoundLatitude[0]],[t.westBoundLongitude[0],t.southBoundLatitude[0]]];this.extents[e.id]=this.formatExtent(n)}}}},S=I,L=(n("3298"),n("2877")),D=Object(L["a"])(S,i,o,!1,null,null,null);t["a"]=D.exports},"01f0":function(e,t,n){"use strict";var i=n("1b83"),o=n.n(i);o.a},"03f4":function(e,t,n){"use strict";var i=n("d989"),o=n.n(i);o.a},"0405":function(e,t,n){},"0411":function(e,t,n){"use strict";var i=n("abf5"),o=n.n(i);o.a},"04be":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-style-item",class:{"gis-style-item_closed":!e.opened}},[n("div",{staticClass:"gis-style-item__header"},[n("div",{staticClass:"gis-style-item__icon",on:{click:e.toggleItem}},[n("i",{staticClass:"core",class:e.opened?"core-116-arrow-down":"core-117-arrow-right"})]),n("div",{staticClass:"gis-style-item__title"},[e._v(e._s(e.title))]),e.deleteButton?n("div",{staticClass:"gis-style-item__icon",on:{click:function(t){return e.$emit("delete")}}},[n("i",{staticClass:"core core-023-delete"})]):e._e()]),n("div",{staticClass:"gis-style-item__content"},[n(e.component,e._b({tag:"component",attrs:{popupContainer:e.popupContainer},on:{changed:function(t){return e.$emit("changed",t)},addImage:function(t){return e.$emit("addImage",t)},deleteImage:function(t){return e.$emit("deleteImage")}}},"component",e.componentOptions,!1))],1)])},o=[],a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-geojson-options-form"},[n("div",{staticClass:"dx-field"},[e._m(0),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{model:{value:e.fields.caption,callback:function(t){e.$set(e.fields,"caption",t)},expression:"fields.caption"}},[n("DxValidator",e._b({attrs:{validationRules:e.validatorNameRules}},"DxValidator",e.validatorOptions,!1))],1)],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Масштабы"}},[e._v("\n      Масштабы\n    ")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-geojson-options-form__slider-wrapper"},[n("div",{staticClass:"gis-geojson-options-form__range-slider"},[n("span",[e._v(e._s(e.fields.minzoom||0))]),n("DxRangeSlider",{staticClass:"gis-geojson-options-form__slider",attrs:{min:0,max:24,start:e.fields.minzoom||0,end:e.fields.maxzoom||24},on:{valueChanged:e.zoomChanged}}),n("span",[e._v(e._s(e.fields.maxzoom||24))])],1)])])]),"vector"===e.layerType?n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Исходный слой")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{placeholder:"Исходный слой"},on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields["source-layer"],callback:function(t){e.$set(e.fields,"source-layer",t)},expression:"fields['source-layer']"}})],1)]):e._e(),e.filterFields&&e.filterFields.length?n("div",{staticClass:"gis-geojson-options-form__filter-panel"},[n("div",{staticClass:"gis-geojson-options-form__filter-panel-label"},[e._v("Фильтр")]),n("div",{staticClass:"gis-geojson-options-form__filter-panel-builder"},[n("DxFilterBuilder",{attrs:{width:"100%",value:e.fields.filter,fields:e.sortedFields},on:{valueChanged:e.filterChange},scopedSlots:e._u([{key:"lookupEditor",fn:function(t){var i=t.data;return[n("DxLookup",e._b({attrs:{value:i.value,width:265},on:{valueChanged:function(t){return e.handlerLookupValueChanged(i,t)}}},"DxLookup",i.field.editorOptions,!1))]}}],null,!1,103354959)})],1)]):e._e()])},s=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"dx-field-label",attrs:{title:"Заголовок"}},[e._v("\n      Заголовок "),n("span",{staticClass:"gis-geojson-options-form__required"},[e._v("*")])])}],r=n("e614"),l=n.n(r),c=n("9435"),d=n.n(c),u=n("13f5"),p=n.n(u),f=n("0db8"),h=n.n(f),m=n("07e0"),g=n.n(m),y=n("bc2f"),v={name:"GisGeoJsonOptionsForm",components:{DxTextBox:l.a,DxRangeSlider:d.a,DxFilterBuilder:p.a,DxValidator:h.a,DxLookup:g.a},props:{fields:Object,filterFields:Array,layerType:String,id:String,isOpen:Boolean},data:function(){return{timeoutId:null,validatorOptions:{validationGroup:"ruleOptions"},validatorNameRules:[{type:"required",message:"Поле обязательно для заполнения",id:this.id}]}},computed:{sortedFields:function(){return Object(y["d"])(this.filterFields)}},methods:{zoomChanged:function(e){var t=this;this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.timeoutId=setTimeout((function(){t.fields.minzoom=e.start,t.fields.maxzoom=e.end}),500)},filterChange:function(e){this.isOpen&&(this.fields.filter=e.value)},handlerLookupValueChanged:function(e,t){e.setValue(t.value)}}},b=v,_=(n("30b8"),n("2877")),C=Object(_["a"])(b,a,s,!1,null,null,null),x=C.exports,O=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-line-style-form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Цвет")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-line-style-form__color-box",on:{opened:e.selectBoxOpened},model:{value:e.fields.paint["line-color"],callback:function(t){e.$set(e.fields.paint,"line-color",t)},expression:"fields.paint['line-color']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Толщина, px")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-line-style-form__number-box",attrs:{min:0},model:{value:e.fields.paint["line-width"],callback:function(t){e.$set(e.fields.paint,"line-width",t)},expression:"fields.paint['line-width']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Стиль")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{value:e.lineStyle,dataSource:e.LINE_STYLES,valueExpr:"value",displayExpr:"text"},on:{opened:e.selectBoxOpened,valueChanged:e.lineStyleChanged}})],1)]),"dashed"===e.lineStyle?n("div",{staticClass:"gis-line-style-form__line-style"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Шаг, px")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-line-style-form__number-box",attrs:{min:0},model:{value:e.fields.paint["line-dasharray"][0],callback:function(t){e.$set(e.fields.paint["line-dasharray"],0,t)},expression:"fields.paint['line-dasharray'][0]"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Разрыв, px")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-line-style-form__number-box",attrs:{min:0},model:{value:e.fields.paint["line-dasharray"][1],callback:function(t){e.$set(e.fields.paint["line-dasharray"],1,t)},expression:"fields.paint['line-dasharray'][1]"}})],1)])]):e._e(),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Непрозрачность")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-line-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.opacityOptions},on:{valueChanged:e.opacityChanged}})],1)])]),n("div",{staticClass:"gis-line-style-form__line-translate"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Смещение, px")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-line-style-form__number-box",attrs:{placeholder:"X"},model:{value:e.fields.paint["line-translate"][0],callback:function(t){e.$set(e.fields.paint["line-translate"],0,t)},expression:"fields.paint['line-translate'][0]"}}),n("DxNumberBox",{staticClass:"gis-line-style-form__number-box",attrs:{placeholder:"Y"},model:{value:e.fields.paint["line-translate"][1],callback:function(t){e.$set(e.fields.paint["line-translate"],1,t)},expression:"fields.paint['line-translate'][1]"}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Тип геометрии")]),n("div",{staticClass:"dx-field-value"},[n("DxTagBox",{attrs:{dataSource:e.geomTypes,displayExpr:"text",valueExpr:"value"},on:{opened:e.selectBoxOpened},model:{value:e.fields.geometry,callback:function(t){e.$set(e.fields,"geometry",t)},expression:"fields.geometry"}})],1)])])},I=[],S=n("5c46"),L=n("9576"),D=n.n(L),P=n("7ea3"),E=n.n(P),w=n("049d"),T=n.n(w),j=n("cb2e"),k=n("c0c5"),F=n.n(k),B=n("6ad3"),M={name:"GisLineStyleForm",mixins:[S["a"]],components:{DxColorBox:D.a,DxNumberBox:E.a,DxSelectBox:T.a,Slider:j["a"],DxTagBox:F.a},props:{fields:Object,geomTypes:Array},data:function(){return{LINE_STYLES:B["h"]}},computed:{lineStyle:function(){return this.fields.paint["line-dasharray"]?"dashed":"solid"},opacityOptions:function(){return{value:Math.round(100*(null===this.fields.paint["line-opacity"]?1:this.fields.paint["line-opacity"])),unit:"%"}}},methods:{lineStyleChanged:function(e){switch(e.value){case"solid":this.fields.paint["line-dasharray"]=null;break;case"dashed":this.fields.paint["line-dasharray"]=[2,3]}},opacityChanged:function(e){var t=e.value,n=e.onInitialized;n||(this.fields.paint["line-opacity"]=t/100)}},watch:{fields:{handler:function(){this.fields.paint["line-translate"]||(this.fields.paint["line-translate"]=[0,0])},immediate:!0}}},A=M,R=(n("db83"),Object(_["a"])(A,O,I,!1,null,null,null)),V=R.exports,G=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-polygon-style-form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Цвет заливки")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-polygon-style-form__color-box",on:{opened:e.selectBoxOpened},model:{value:e.fields.paint["fill-color"],callback:function(t){e.$set(e.fields.paint,"fill-color",t)},expression:"fields.paint['fill-color']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Паттерн")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{value:e.fields.paint["fill-pattern"],showClearButton:!0,placeholder:"Название изображения",buttons:e.imageFieldButtons},on:{valueChanged:e.onImageChange}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Непрозрачность заливки")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-polygon-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.fillOpacityOptions},on:{valueChanged:function(t){return e.opacityChanged(Object.assign({},{field:"fill-opacity"},t))}}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Цвет обводки")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-polygon-style-form__color-box",on:{opened:e.selectBoxOpened},model:{value:e.fields.paint["line-color"],callback:function(t){e.$set(e.fields.paint,"line-color",t)},expression:"fields.paint['line-color']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Толщина обводки, px")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-polygon-style-form__number-box",attrs:{min:0},model:{value:e.fields.paint["line-width"],callback:function(t){e.$set(e.fields.paint,"line-width",t)},expression:"fields.paint['line-width']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Стиль обводки")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{value:e.lineStyle,dataSource:e.LINE_STYLES,valueExpr:"value",displayExpr:"text"},on:{opened:e.selectBoxOpened,valueChanged:e.lineStyleChanged}})],1)]),"dashed"===e.lineStyle?n("div",{staticClass:"gis-polygon-style-form__line-style"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Шаг, px")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-polygon-style-form__number-box",attrs:{min:0},model:{value:e.fields.paint["line-dasharray"][0],callback:function(t){e.$set(e.fields.paint["line-dasharray"],0,t)},expression:"fields.paint['line-dasharray'][0]"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Разрыв, px")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-polygon-style-form__number-box",attrs:{min:0},model:{value:e.fields.paint["line-dasharray"][1],callback:function(t){e.$set(e.fields.paint["line-dasharray"],1,t)},expression:"fields.paint['line-dasharray'][1]"}})],1)])]):e._e(),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Непрозрачность обводки")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-polygon-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.strokeOpacityOptions},on:{valueChanged:function(t){return e.opacityChanged(Object.assign({},{field:"line-opacity"},t))}}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Тип геометрии")]),n("div",{staticClass:"dx-field-value"},[n("DxTagBox",{attrs:{dataSource:e.geomTypes,displayExpr:"text",valueExpr:"value"},on:{opened:e.selectBoxOpened},model:{value:e.fields.geometry,callback:function(t){e.$set(e.fields,"geometry",t)},expression:"fields.geometry"}})],1)]),n("GisImageListPopup",{attrs:{visible:e.imageReestrVisible,popupContainer:e.popupContainer},on:{shown:function(t){e.imageReestrVisible=!0},hidden:function(t){e.imageReestrVisible=!1},apply:e.insertImage}})],1)},$=[],N=(n("7f7f"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"gis-image-list-popup",attrs:{animation:null,visible:e.visible,shading:!1,resizeEnabled:!0,title:"Выбрать изображение",position:e.popupPosition,width:547,height:520,container:e.popupContainer,comtentTemplate:"content"},on:{showing:e.getData,shown:e.onShown,hidden:function(t){return e.$emit("hidden")}},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:"Выбрать изображение",showCloseButton:!0},on:{closeClick:function(t){return e.$emit("hidden")}}})]},proxy:!0},{key:"content",fn:function(){return[n("div",{staticClass:"gis-image-list-popup__content"},[n("div",{staticClass:"gis-image-list-popup__toolbar"},[n("SearchBox",{ref:"searchBox",attrs:{dataList:e.dataSource,searchExpr:["name"]},on:{searching:function(t){e.dataBySearch=t}}})],1),n("div",{staticClass:"gis-image-list-popup__list"},[n("DxScrollView",[e.dataBySearch.length?n("div",{staticClass:"gis-image-list-popup__list-inner"},e._l(e.dataBySearch,(function(t){return n("div",{staticClass:"gis-image-list-popup__item",class:{"gis-image-list-popup__item_selected":e.selectedItem&&e.selectedItem.id===t.id},attrs:{title:t.name},on:{click:function(n){e.selectedItem=t},dblclick:e.apply}},[n("div",{staticClass:"gis-image-list-popup__title"},[e._v("\n                "+e._s(t.name)+"\n              ")]),n("div",{staticClass:"gis-image-list-popup__img",style:{backgroundImage:"url("+t.url+"&_config_dataset=PAGES.DSPAGE)"}})])})),0):n("div",{staticClass:"gis-image-list-popup__no-data"},[e._v("\n            Нет данных для отображения\n          ")])])],1),n("DxLoadPanel",e._b({},"DxLoadPanel",e.loadIndicatorOptions,!1))],1)]},proxy:!0}])})}),U=[],z=n("d736"),H=n.n(z),W=n("25aa"),K=n("5a1f"),q=n.n(K),J=n("1bf9"),Z=n("5bba"),Y=n.n(Z),X=n("bf8c"),Q={name:"GisImageListPopup",components:{DxPopup:H.a,PopupTitleTemplate:W["a"],DxScrollView:q.a,SearchBox:J["a"],DxLoadPanel:Y.a},props:{visible:Boolean,popupContainer:null},data:function(){return{loadIndicatorOptions:{visible:!1,container:".gis-image-list-popup__content",position:{at:"center",my:"center",of:".gis-image-list-popup__content"}},dataSource:[],dataBySearch:[],selectedItem:null}},computed:{popupPosition:function(){return{at:"top",my:"top",offset:"0, 36",of:this.popupContainer}}},methods:{getData:function(){var e=this;return this.$refs.searchBox&&this.$refs.searchBox.cleanSearch(),this.loadIndicatorOptions.visible=!0,Object(X["c"])("getData",{_config_dataset:"PAGES.DSPAGE",guid_link:"C16095F3-4F9D-4523-B79D-6DCD808FB23F"}).then((function(t){e.dataBySearch=t,e.dataSource=t,e.loadIndicatorOptions.visible=!1}))},onShown:function(){this.$emit("shown")},apply:function(){this.$emit("apply",this.selectedItem)}}},ee=Q,te=(n("3fe4"),Object(_["a"])(ee,N,U,!1,null,null,null)),ne=te.exports,ie={name:"GisPolygonStyleForm",mixins:[S["a"]],components:{DxColorBox:D.a,DxTextBox:l.a,Slider:j["a"],GisImageListPopup:ne,DxTagBox:F.a},props:{fields:Object,geomTypes:Array},data:function(){var e=this;return{imageReestrVisible:!1,imageFieldButtons:["clear",{location:"after",name:"imageReestr",options:{text:"...",onClick:function(){e.imageReestrVisible=!0}}}],LINE_STYLES:B["h"]}},computed:{lineStyle:function(){return this.fields.paint["line-dasharray"]?"dashed":"solid"},fillOpacityOptions:function(){return{value:Math.round(100*(null===this.fields.paint["fill-opacity"]?1:this.fields.paint["fill-opacity"])),unit:"%"}},strokeOpacityOptions:function(){return{value:Math.round(100*(null===this.fields.paint["line-opacity"]?1:this.fields.paint["line-opacity"])),unit:"%"}}},methods:{opacityChanged:function(e){var t=e.value,n=e.onInitialized,i=e.field;n||(this.fields.paint[i]=t/100)},lineStyleChanged:function(e){switch(e.value){case"solid":this.fields.paint["line-dasharray"]=null;break;case"dashed":this.fields.paint["line-dasharray"]=[2,3]}},insertImage:function(e){this.imageReestrVisible=!1,this.fields.paint["fill-pattern"]=e.name,this.$emit("addImage",e)},onImageChange:function(e){var t=e.value;""===t?(this.fields.paint["fill-pattern"]=null,this.$emit("deleteImage")):this.fields.paint["fill-pattern"]=t}}},oe=ie,ae=(n("f892"),Object(_["a"])(oe,G,$,!1,null,null,null)),se=ae.exports,re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-circle-style-form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Радиус, px")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-circle-style-form__number-box",attrs:{min:0},model:{value:e.fields.paint["circle-radius"],callback:function(t){e.$set(e.fields.paint,"circle-radius",t)},expression:"fields.paint['circle-radius']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Цвет заливки")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-circle-style-form__color-box",on:{opened:e.selectBoxOpened},model:{value:e.fields.paint["circle-color"],callback:function(t){e.$set(e.fields.paint,"circle-color",t)},expression:"fields.paint['circle-color']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Непрозрачность")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-circle-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.fillOpacityOptions},on:{valueChanged:function(t){return e.opacityChanged(t,"circle-opacity")}}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Цвет обводки")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-circle-style-form__color-box",on:{opened:e.selectBoxOpened},model:{value:e.fields.paint["circle-stroke-color"],callback:function(t){e.$set(e.fields.paint,"circle-stroke-color",t)},expression:"fields.paint['circle-stroke-color']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Толщина обводки, px")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-circle-style-form__number-box",attrs:{min:0},model:{value:e.fields.paint["circle-stroke-width"],callback:function(t){e.$set(e.fields.paint,"circle-stroke-width",t)},expression:"fields.paint['circle-stroke-width']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Непрозрачность обводки")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-circle-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.strokeOpacityOptions},on:{valueChanged:function(t){return e.opacityChanged(t,"circle-stroke-opacity")}}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Тип геометрии")]),n("div",{staticClass:"dx-field-value"},[n("DxTagBox",{attrs:{dataSource:e.geomTypes,displayExpr:"text",valueExpr:"value"},on:{opened:e.selectBoxOpened},model:{value:e.fields.geometry,callback:function(t){e.$set(e.fields,"geometry",t)},expression:"fields.geometry"}})],1)])])},le=[],ce={name:"GisCircleStyleForm",mixins:[S["a"]],components:{DxNumberBox:E.a,DxColorBox:D.a,Slider:j["a"],DxTagBox:F.a},props:{fields:Object,geomTypes:Array},computed:{fillOpacityOptions:function(){return{value:Math.round(100*(null===this.fields.paint["circle-opacity"]?1:this.fields.paint["circle-opacity"])),unit:"%"}},strokeOpacityOptions:function(){return{value:Math.round(100*(null===this.fields.paint["circle-stroke-opacity"]?1:this.fields.paint["circle-stroke-opacity"])),unit:"%"}}},methods:{opacityChanged:function(e,t){var n=e.value,i=e.onInitialized;i||(this.fields.paint[t]=n/100)}}},de=ce,ue=(n("2d14"),Object(_["a"])(de,re,le,!1,null,null,null)),pe=ue.exports,fe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-image-style-form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Изображение")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{value:e.fields.layout["icon-image"],placeholder:"Название изображения",buttons:e.imageFieldButtons},on:{change:e.onImageChange}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Размер, %")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-image-style-form__number-box",attrs:{value:Math.round(100*e.fields.layout["icon-size"]),min:0},on:{valueChanged:e.sizeChanged}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Тип геометрии")]),n("div",{staticClass:"dx-field-value"},[n("DxTagBox",{attrs:{dataSource:e.geomTypes,displayExpr:"text",valueExpr:"value"},on:{opened:e.selectBoxOpened},model:{value:e.fields.geometry,callback:function(t){e.$set(e.fields,"geometry",t)},expression:"fields.geometry"}})],1)]),n("GisImageListPopup",{attrs:{visible:e.imageReestrVisible,popupContainer:e.popupContainer},on:{shown:function(t){e.imageReestrVisible=!0},hidden:function(t){e.imageReestrVisible=!1},apply:e.insertImage}})],1)},he=[],me={name:"GisImageStyleForm",mixins:[S["a"]],components:{DxNumberBox:E.a,DxTextBox:l.a,GisImageListPopup:ne,DxTagBox:F.a},props:{fields:Object,geomTypes:Array,popupContainer:null},data:function(){var e=this;return{imageReestrVisible:!1,imageFieldButtons:[{location:"after",name:"imageReestr",options:{text:"...",onClick:function(){e.imageReestrVisible=!0}}}]}},methods:{sizeChanged:function(e){this.fields.layout["icon-size"]=e.value/100},insertImage:function(e){this.imageReestrVisible=!1,this.fields.layout["icon-image"]=e.name,this.$emit("addImage",e)},onImageChange:function(e){var t=e.component.instance().option("value");""===t?(this.fields.layout["icon-image"]=null,this.$emit("deleteImage")):e.component.instance().option("value",this.fields.layout["icon-image"])}}},ge=me,ye=(n("078a"),Object(_["a"])(ge,fe,he,!1,null,null,null)),ve=ye.exports,be=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-text-style-form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Текст")]),n("div",{staticClass:"dx-field-value"},[n("DxTextArea",{attrs:{valueChangeEvent:"keyup"},on:{valueChanged:e.onTextSourceChanged},model:{value:e.textSource,callback:function(t){e.textSource=t},expression:"textSource"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Атрибут")]),n("div",{staticClass:"dx-field-value"},[n("DxLookup",e._b({staticClass:"gis-text-style-form__field-lookup",attrs:{items:e.sortedDataFields,displayExpr:e.displayValue,searchExpr:["caption","name"],showClearButton:!1},on:{opened:e.selectBoxOpened,itemClick:e.onAttributeClick}},"DxLookup",e.fieldLookupOptions,!1))],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Цвет")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-text-style-form__color-box",on:{opened:e.selectBoxOpened},model:{value:e.fields.paint["text-color"],callback:function(t){e.$set(e.fields.paint,"text-color",t)},expression:"fields.paint['text-color']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Цвет фона")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-text-style-form__color-box",on:{opened:e.selectBoxOpened},model:{value:e.fields.paint["text-halo-color"],callback:function(t){e.$set(e.fields.paint,"text-halo-color",t)},expression:"fields.paint['text-halo-color']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Размер фона")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-text-style-form__number-box",attrs:{mode:"number",min:0},on:{valueChanged:e.onHaloWidthChange},model:{value:e.fields.paint["text-halo-width"],callback:function(t){e.$set(e.fields.paint,"text-halo-width",t)},expression:"fields.paint['text-halo-width']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Размер, px")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-text-style-form__number-box",attrs:{min:0},model:{value:e.fields.layout["text-size"],callback:function(t){e.$set(e.fields.layout,"text-size",t)},expression:"fields.layout['text-size']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Непрозрачность")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-text-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.opacityOptions},on:{valueChanged:e.opacityChanged}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Выравнивание")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.JUSTIFY,valueExpr:"value",displayExpr:"text"},on:{opened:e.selectBoxOpened},model:{value:e.fields.layout["text-justify"],callback:function(t){e.$set(e.fields.layout,"text-justify",t)},expression:"fields.layout['text-justify']"}})],1)]),n("div",{staticClass:"gis-text-style-form__text-translate"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Смещение по X")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-text-style-form__number-box",attrs:{value:e.offsetX,placeholder:"X"},on:{valueChanged:e.onChangeOffsetX}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Смещение по Y")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-text-style-form__number-box",attrs:{value:e.offsetY,placeholder:"Y"},on:{valueChanged:e.onChangeOffsetY}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Тип геометрии")]),n("div",{staticClass:"dx-field-value"},[n("DxTagBox",{attrs:{dataSource:e.geomTypes,displayExpr:"text",valueExpr:"value"},on:{opened:e.selectBoxOpened},model:{value:e.fields.geometry,callback:function(t){e.$set(e.fields,"geometry",t)},expression:"fields.geometry"}})],1)])])},_e=[],Ce=(n("ac6a"),n("ac4d"),n("8a81"),n("5df3"),n("1c4c"),n("6b54"),n("2909")),xe=(n("55dd"),n("7514"),n("6762"),n("2fdb"),n("b8f5")),Oe=n.n(xe);function Ie(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Se(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function Se(e,t){if(e){if("string"===typeof e)return Le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Le(e,t):void 0}}function Le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var De={name:"GisTextStyleForm",mixins:[S["a"]],components:{DxColorBox:D.a,DxNumberBox:E.a,DxTextArea:Oe.a,DxSelectBox:T.a,DxLookup:g.a,Slider:j["a"],DxTagBox:F.a},props:{fields:Object,dataFields:Array,geomTypes:Array},data:function(){return{textSource:"",PLACEMENTS:B["k"],JUSTIFY:B["g"],selectedProperties:[],fieldLookupOptions:{onContentReady:function(e){var t=e.component._popup;t.option("showTitle",!1),t.option("maxHeight",300),t._$content.css("top",0)}}}},watch:{fields:{handler:function(){this.fields.layout["text-offset"]||(this.fields.layout["text-offset"]=[0,0])},immediate:!0}},created:function(){var e,t=this.fields.layout["text-field"]||[],n=Ie(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;"concat"!==i&&"get"!==i&&(Array.isArray(i)?this.textSource+="[".concat(i[1],"]"):this.textSource+="[".concat(i,"]"))}}catch(o){n.e(o)}finally{n.f()}},computed:{placementsAvailable:function(){var e=this;return this.PLACEMENTS.filter((function(t){return!t.value.includes("line")||e.geomTypes.find((function(e){return"Line"===e.value}))}))},sortedDataFields:function(){var e=this;return this.dataFields?Object(Ce["a"])(this.dataFields).sort((function(t,n){return t.caption&&n.caption?e.sortValue(t.caption,n.caption):t.caption&&!n.caption?-1:!t.caption&&n.caption?1:e.sortValue(t.name,n.name)})):[]},offsetX:function(){return this.fields.layout["text-offset"][0]*this.fields.layout["text-size"]},offsetY:function(){return this.fields.layout["text-offset"][1]*this.fields.layout["text-size"]},opacityOptions:function(){return{value:Math.round(100*(null===this.fields.paint["text-opacity"]?1:this.fields.paint["text-opacity"])),unit:"%"}}},methods:{onChangeOffsetX:function(e){var t=this.fields.layout["text-size"]||12;this.fields.layout["text-offset"][0]=e.value/t},onChangeOffsetY:function(e){var t=this.fields.layout["text-size"]||12;this.fields.layout["text-offset"][1]=e.value/t},onHaloWidthChange:function(){this.fields.paint["text-halo-blur"]=this.fields.paint["text-halo-width"]},sortValue:function(e,t){return e>t?1:e<t?-1:0},displayValue:function(e){if(e)return e.caption||e.name},opacityChanged:function(e){var t=e.value,n=e.onInitialized;n||(this.fields.paint["text-opacity"]=t/100)},onAttributeClick:function(e){this.textSource+="[".concat(e.itemData.dataField,"]")},onTextSourceChanged:function(){var e,t=[],n=/\[(.+?)\]/g,i=Object(Ce["a"])(this.textSource.matchAll(n)),o=0,a=null;if(i){var s,r=Ie(i);try{for(r.s();!(s=r.n()).done;){var l=s.value;a=this.textSource.substring(o,l.index),a&&t.push(a),t.push(["get",l[1]]),o=l.index+l[0].length}}catch(c){r.e(c)}finally{r.f()}}a=this.textSource.substring(o,this.textSource.length),a&&t.push(a),1===t.length?e=t[0]:t.length>1&&(e=["concat"],t.forEach((function(t){e.push(t)}))),this.fields.layout["text-field"]=e}}},Pe=De,Ee=(n("2cdb"),Object(_["a"])(Pe,be,_e,!1,null,null,null)),we=Ee.exports,Te=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-chart-style-form"},[n("DxDataGrid",{attrs:{height:"100%",showRowLines:!1,showColumnLines:!1,showBorders:!1,dataSource:e.fields.layout["chart-attrs"]},scopedSlots:e._u([{key:"colorCellTemplate",fn:function(t){var i=t.data;return[e.fields.layout["chart-attrs"][i.rowIndex]?n("DxColorBox",{staticClass:"gis-chart-style-form__color-box",on:{opened:e.selectBoxOpened},model:{value:e.fields.layout["chart-attrs"][i.rowIndex].color,callback:function(t){e.$set(e.fields.layout["chart-attrs"][i.rowIndex],"color",t)},expression:"fields.layout['chart-attrs'][data.rowIndex].color"}}):e._e()]}},{key:"buttonCellTemplate",fn:function(t){var i=t.data;return[n("div",{staticClass:"gis-chart-style-form__button-icon",on:{click:function(t){return e.onRemoveAttribute(i.rowIndex)}}},[n("i",{staticClass:"core core-023-delete"})])]}}])},[n("DxColumn",{attrs:{caption:"Атрибут",dataField:"name",calculateDisplayValue:e.attributeCaption}}),n("DxColumn",{attrs:{caption:"Цвет",cellTemplate:"colorCellTemplate"}}),n("DxColumn",{attrs:{width:"auto",cellTemplate:"buttonCellTemplate"}})],1),n("div",{staticClass:"gis-chart-style-form__icon-text",attrs:{title:"Добавить атрибут"},on:{click:function(t){e.attrListVisible=!0}}},[n("i",{staticClass:"core core-109-add"}),n("span",[e._v(" Добавить атрибут")])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Тип диаграммы")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.CHART_TYPES,valueExpr:"value",displayExpr:"text"},on:{opened:e.selectBoxOpened},model:{value:e.fields.layout["chart-type"],callback:function(t){e.$set(e.fields.layout,"chart-type",t)},expression:"fields.layout['chart-type']"}})],1)]),"pie"===e.fields.layout["chart-type"]?n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Угол начала")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.PIECHART_CORNERS,valueExpr:"value",displayExpr:"text"},on:{opened:e.selectBoxOpened},model:{value:e.fields.layout["piechart-corner"],callback:function(t){e.$set(e.fields.layout,"piechart-corner",t)},expression:"fields.layout['piechart-corner']"}})],1)]):e._e(),"pie"===e.fields.layout["chart-type"]?n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Направление")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.PIECHART_DIRECTIONS,valueExpr:"value",displayExpr:"text"},on:{opened:e.selectBoxOpened},model:{value:e.fields.layout["piechart-direction"],callback:function(t){e.$set(e.fields.layout,"piechart-direction",t)},expression:"fields.layout['piechart-direction']"}})],1)]):e._e(),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Непрозрачность заливки")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-chart-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.fillOpacityOptions},on:{valueChanged:e.fillOpacityChanged}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Стиль обводки")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.BORDER_STYLES,valueExpr:"value",displayExpr:"text"},on:{opened:e.selectBoxOpened},model:{value:e.fields.paint["border-style"],callback:function(t){e.$set(e.fields.paint,"border-style",t)},expression:"fields.paint['border-style']"}})],1)]),e.hasBorder?n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Цвет обводки")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-chart-style-form__color-box",on:{opened:e.selectBoxOpened},model:{value:e.fields.paint["border-color"],callback:function(t){e.$set(e.fields.paint,"border-color",t)},expression:"fields.paint['border-color']"}})],1)]):e._e(),e.hasBorder?n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Толщина обводки, px")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-chart-style-form__number-box",attrs:{min:0},model:{value:e.fields.paint["border-width"],callback:function(t){e.$set(e.fields.paint,"border-width",t)},expression:"fields.paint['border-width']"}})],1)]):e._e(),e.hasBorder?n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Непрозрачность обводки")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-chart-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.borderOpacityOptions},on:{valueChanged:e.borderOpacityChanged}})],1)])]):e._e(),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Размер")]),n("div",{staticClass:"dx-field-value"},[n("DxRadioGroup",{attrs:{items:e.CHART_SIZES,valueExpr:"value",displayExpr:"text",layout:"horizontal"},model:{value:e.fields.layout["chart-size"],callback:function(t){e.$set(e.fields.layout,"chart-size",t)},expression:"fields.layout['chart-size']"}})],1)]),"attr"===e.fields.layout["chart-size"]?n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Выражение")]),n("div",{staticClass:"dx-field-value"},[n("DxTextArea",{staticClass:"gis-chart-style-form__size-expression",attrs:{valueChangeEvent:"keyup"},on:{valueChanged:e.onExpressionChanged},model:{value:e.fields.layout["chart-size-attribute"],callback:function(t){e.$set(e.fields.layout,"chart-size-attribute",t)},expression:"fields.layout['chart-size-attribute']"}})],1)]):e._e(),"attr"===e.fields.layout["chart-size"]?n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Атрибут")]),n("div",{staticClass:"dx-field-value"},[n("DxLookup",e._b({staticClass:"gis-chart-style-form__field-lookup",attrs:{items:e.sortedDataFields,displayExpr:e.displayValue,searchExpr:["caption","dataField","name"],showClearButton:!1},on:{opened:e.selectBoxOpened,itemClick:e.onAttributeClick}},"DxLookup",e.attributeLookupOptions,!1))],1)]):e._e(),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Размер, px")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-chart-style-form__number-box",attrs:{min:15},model:{value:e.fields.layout["chart-size-px"],callback:function(t){e.$set(e.fields.layout,"chart-size-px",t)},expression:"fields.layout['chart-size-px']"}})],1)]),n("GisAttributesListPopup",{attrs:{title:"Атрибуты",visible:e.attrListVisible,dataSource:e.filteredDataFields},on:{hidden:function(t){e.attrListVisible=!1},dblClick:e.onAddAttribute,opened:e.selectBoxOpened}})],1)},je=[],ke=n("09e7"),Fe=ke["a"],Be=(n("6014"),Object(_["a"])(Fe,Te,je,!1,null,null,null)),Me=Be.exports,Ae=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-wms-polygon-style-form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Цвет заливки"}},[e._v("\n      Цвет заливки\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-wms-polygon-style-form__color-box",on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.fill,callback:function(t){e.$set(e.fields,"fill",t)},expression:"fields.fill"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Цвет обводки"}},[e._v("\n      Цвет обводки\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-wms-polygon-style-form__color-box",on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.stroke,callback:function(t){e.$set(e.fields,"stroke",t)},expression:"fields.stroke"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Толщина обводки"}},[e._v("\n      Толщина обводки\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-wms-polygon-style-form__number-box",on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.strokewidth,callback:function(t){e.$set(e.fields,"strokewidth",t)},expression:"fields.strokewidth"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Непрозрачность"}},[e._v("\n      Непрозрачность\n    ")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-wms-polygon-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.opacityOptions},on:{valueChanged:e.opacityChanged}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Маркер"}},[e._v("\n      Маркер\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxLookup",{attrs:{dataSource:e.dataSources.marks,displayExpr:"caption",valueExpr:"id",placeholder:"Название метки",showClearButton:!0},on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.mark_id,callback:function(t){e.$set(e.fields,"mark_id",t)},expression:"fields.mark_id"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Цвет заливки маркера"}},[e._v("\n      Цвет заливки маркера\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-wms-polygon-style-form__color-box",on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.mark_stroke,callback:function(t){e.$set(e.fields,"mark_stroke",t)},expression:"fields.mark_stroke"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Толщина обводки маркера"}},[e._v("\n      Толщина обводки маркера\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-wms-polygon-style-form__number-box",on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.mark_strokewidth,callback:function(t){e.$set(e.fields,"mark_strokewidth",t)},expression:"fields.mark_strokewidth"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Размер маркера"}},[e._v("\n      Размер маркера\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-wms-polygon-style-form__number-box",on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.size,callback:function(t){e.$set(e.fields,"size",t)},expression:"fields.size"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Поворот маркера"}},[e._v("\n      Поворот маркера\n    ")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-wms-polygon-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.rotationOptions},on:{valueChanged:e.rotationChanged}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Путь к изображению"}},[e._v("\n      Путь к изображению\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{placeholder:"Путь"},on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.onlineresource,callback:function(t){e.$set(e.fields,"onlineresource",t)},expression:"fields.onlineresource"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Формат изображения"}},[e._v("\n      Формат изображения\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.dataSources.format,displayExpr:"name",valueExpr:"id",showClearButton:!0},on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.format_id,callback:function(t){e.$set(e.fields,"format_id",t)},expression:"fields.format_id"}})],1)])])},Re=[],Ve={name:"GisPolygonStyleForm",mixins:[S["a"]],components:{DxColorBox:D.a,DxTextBox:l.a,Slider:j["a"],DxLookup:g.a},props:{fields:Object,dataSources:Object},computed:{opacityOptions:function(){return{value:Math.round(100*(this.fields.fillopacity||0===this.fields.fillopacity?this.fields.fillopacity:1)),unit:"%"}},rotationOptions:function(){return{value:+this.fields.rotation||0,min:-180,max:180,unit:"°"}}},methods:{opacityChanged:function(e){var t=e.value,n=e.onInitialized;n||(this.fields.fillopacity=t/100,this.$emit("changed"))},rotationChanged:function(e){var t=e.value,n=e.onInitialized;n||(this.fields.rotation=t.toString(),this.$emit("changed"))}}},Ge=Ve,$e=(n("1b52"),Object(_["a"])(Ge,Ae,Re,!1,null,null,null)),Ne=$e.exports,Ue=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-wms-line-style-form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Цвет"}},[e._v("\n      Цвет\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-wms-line-style-form__color-box",on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.stroke,callback:function(t){e.$set(e.fields,"stroke",t)},expression:"fields.stroke"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Толщина"}},[e._v("\n      Толщина\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-wms-line-style-form__number-box",on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.strokewidth,callback:function(t){e.$set(e.fields,"strokewidth",t)},expression:"fields.strokewidth"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Смещение"}},[e._v("\n      Смещение\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-wms-line-style-form__number-box",on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.perpendicularoffset,callback:function(t){e.$set(e.fields,"perpendicularoffset",t)},expression:"fields.perpendicularoffset"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Поведение на стыках"}},[e._v("\n      Поведение на стыках\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.dataSources.strokeLineCap,displayExpr:"caption",valueExpr:"id",showClearButton:!0},on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.strokelinecap_id,callback:function(t){e.$set(e.fields,"strokelinecap_id",t)},expression:"fields.strokelinecap_id"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Поведение на пересечении"}},[e._v("\n      Поведение на пересечении\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.dataSources.strokeLineJoin,displayExpr:"caption",valueExpr:"id",showClearButton:!0},on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.strokelinejoin_id,callback:function(t){e.$set(e.fields,"strokelinejoin_id",t)},expression:"fields.strokelinejoin_id"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Пунктир"}},[e._v("\n      Пунктир\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{placeholder:"шаг разрыв"},on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.strokedasharray,callback:function(t){e.$set(e.fields,"strokedasharray",t)},expression:"fields.strokedasharray"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Смещение пунктира"}},[e._v("\n      Смещение пунктира\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-wms-line-style-form__number-box",on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.strokedashoffset,callback:function(t){e.$set(e.fields,"strokedashoffset",t)},expression:"fields.strokedashoffset"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Непрозрачность"}},[e._v("\n      Непрозрачность\n    ")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-wms-line-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.opacityOptions},on:{valueChanged:e.opacityChanged}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Маркер"}},[e._v("\n      Маркер\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxLookup",{attrs:{dataSource:e.dataSources.marks,displayExpr:"caption",valueExpr:"id",placeholder:"Название метки",showClearButton:!0},on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.mark_id,callback:function(t){e.$set(e.fields,"mark_id",t)},expression:"fields.mark_id"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Цвет заливки маркера"}},[e._v("\n      Цвет заливки маркера\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-wms-line-style-form__color-box",on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.fill,callback:function(t){e.$set(e.fields,"fill",t)},expression:"fields.fill"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Размер маркера"}},[e._v("\n      Размер маркера\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-wms-line-style-form__number-box",on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.size,callback:function(t){e.$set(e.fields,"size",t)},expression:"fields.size"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Поворот маркера"}},[e._v("\n      Поворот маркера\n    ")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-wms-line-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.rotationOptions},on:{valueChanged:e.rotationChanged}})],1)])])])},ze=[],He={name:"GisLineStyleForm",mixins:[S["a"]],components:{DxColorBox:D.a,DxNumberBox:E.a,DxTextBox:l.a,Slider:j["a"],DxLookup:g.a,DxSelectBox:T.a},props:{fields:Object,dataSources:Object},computed:{opacityOptions:function(){return{value:Math.round(100*(this.fields.strokeopacity||0===this.fields.strokeopacity?this.fields.strokeopacity:1)),unit:"%"}},rotationOptions:function(){return{value:+this.fields.rotation||0,min:-180,max:180,unit:"°"}}},methods:{opacityChanged:function(e){var t=e.value,n=e.onInitialized;n||(this.fields.strokeopacity=t/100,this.$emit("changed"))},rotationChanged:function(e){var t=e.value,n=e.onInitialized;n||(this.fields.rotation=t.toString(),this.$emit("changed"))}}},We=He,Ke=(n("80c1"),Object(_["a"])(We,Ue,ze,!1,null,null,null)),qe=Ke.exports,Je=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-wms-point-style-form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Маркер"}},[e._v("\n      Маркер\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxLookup",{attrs:{dataSource:e.dataSources.marks,displayExpr:"caption",valueExpr:"id",placeholder:"Название метки",showClearButton:!0},on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.mark_id,callback:function(t){e.$set(e.fields,"mark_id",t)},expression:"fields.mark_id"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Цвет заливки"}},[e._v("\n      Цвет заливки\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-wms-point-style-form__color-box",on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.fill,callback:function(t){e.$set(e.fields,"fill",t)},expression:"fields.fill"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Непрозрачность"}},[e._v("\n      Непрозрачность\n    ")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-wms-point-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.opacityOptions},on:{valueChanged:e.opacityChanged}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Цвет обводки"}},[e._v("\n      Цвет обводки\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-wms-point-style-form__color-box",on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.stroke,callback:function(t){e.$set(e.fields,"stroke",t)},expression:"fields.stroke"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Толщина обводки"}},[e._v("\n      Толщина обводки\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-wms-point-style-form__number-box",attrs:{min:0},on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.strokewidth,callback:function(t){e.$set(e.fields,"strokewidth",t)},expression:"fields.strokewidth"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Размер"}},[e._v("\n      Размер\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-wms-point-style-form__number-box",on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.size,callback:function(t){e.$set(e.fields,"size",t)},expression:"fields.size"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Поворот"}},[e._v("\n      Поворот\n    ")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-wms-point-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.rotationOptions},on:{valueChanged:e.rotationChanged}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Путь к изображению"}},[e._v("\n      Путь к изображению\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{placeholder:"Путь"},on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.onlineresource,callback:function(t){e.$set(e.fields,"onlineresource",t)},expression:"fields.onlineresource"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Формат изображения"}},[e._v("\n      Формат изображения\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.dataSources.format,displayExpr:"name",valueExpr:"id",showClearButton:!0},on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.format_id,callback:function(t){e.$set(e.fields,"format_id",t)},expression:"fields.format_id"}})],1)])])},Ze=[],Ye={name:"GisCircleStyleForm",mixins:[S["a"]],components:{DxNumberBox:E.a,DxColorBox:D.a,DxTextBox:l.a,Slider:j["a"]},props:{fields:Object,dataSources:Object},computed:{opacityOptions:function(){return{value:Math.round(100*(this.fields.fillopacity||0===this.fields.fillopacity?this.fields.fillopacity:1)),unit:"%"}},rotationOptions:function(){return{value:+this.fields.rotation||0,min:-180,max:180,unit:"°"}}},methods:{opacityChanged:function(e){var t=e.value,n=e.onInitialized;n||(this.fields.fillopacity=t/100,this.$emit("changed"))},rotationChanged:function(e){var t=e.value,n=e.onInitialized;n||(this.fields.rotation=t.toString(),this.$emit("changed"))}}},Xe=Ye,Qe=(n("3524"),Object(_["a"])(Xe,Je,Ze,!1,null,null,null)),et=Qe.exports,tt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-wms-text-style-form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Поле данных"}},[e._v("\n      Поле данных\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{placeholder:"Поле данных"},model:{value:e.fields.label,callback:function(t){e.$set(e.fields,"label",t)},expression:"fields.label"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Шрифт"}},[e._v("\n      Шрифт\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{placeholder:"Шрифты"},on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.family,callback:function(t){e.$set(e.fields,"family",t)},expression:"fields.family"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Цвет текста"}},[e._v("\n      Цвет текста\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-wms-text-style-form__color-box",on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.fill,callback:function(t){e.$set(e.fields,"fill",t)},expression:"fields.fill"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Размер текста"}},[e._v("\n      Размер\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-wms-text-style-form__number-box",attrs:{min:0},on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.size,callback:function(t){e.$set(e.fields,"size",t)},expression:"fields.size"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Начертание"}},[e._v("\n      Начертание\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.styleItems,valueExpr:"value",displayExpr:"text",showClearButton:!0},on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.style,callback:function(t){e.$set(e.fields,"style",t)},expression:"fields.style"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Жирность"}},[e._v("\n      Жирность\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.weightItems,valueExpr:"value",displayExpr:"text",showClearButton:!0},on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.weight,callback:function(t){e.$set(e.fields,"weight",t)},expression:"fields.weight"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Поворот текста"}},[e._v("\n      Поворот текста\n    ")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-wms-text-style-form__slider-wrapper"},[n("Slider",{attrs:{options:{value:+e.fields.rotation||0,min:-180,max:180,unit:"°"}},on:{valueChanged:e.rotationChanged}})],1)])]),n("div",{staticClass:"gis-wms-text-style-form__translate"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Смещение текста"}},[e._v("\n        Смещение\n      ")]),n("div",{staticClass:"dx-field-value"},[n("div",{directives:[{name:"show",rawName:"v-show",value:"anchorpoint"===e.unit,expression:"unit === 'anchorpoint'"}],staticClass:"gis-wms-text-style-form__number-group"},[n("DxNumberBox",{staticClass:"gis-wms-text-style-form__number-box",attrs:{placeholder:"X"},on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.anchorpointx,callback:function(t){e.$set(e.fields,"anchorpointx",t)},expression:"fields.anchorpointx"}}),n("DxNumberBox",{staticClass:"gis-wms-text-style-form__number-box",attrs:{placeholder:"Y"},on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.anchorpointy,callback:function(t){e.$set(e.fields,"anchorpointy",t)},expression:"fields.anchorpointy"}})],1),n("div",{directives:[{name:"show",rawName:"v-show",value:"displacement"===e.unit,expression:"unit === 'displacement'"}],staticClass:"gis-wms-text-style-form__number-group"},[n("DxNumberBox",{staticClass:"gis-wms-text-style-form__number-box",attrs:{placeholder:"X"},on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.displacementx,callback:function(t){e.$set(e.fields,"displacementx",t)},expression:"fields.displacementx"}}),n("DxNumberBox",{staticClass:"gis-wms-text-style-form__number-box",attrs:{placeholder:"Y"},on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.displacementy,callback:function(t){e.$set(e.fields,"displacementy",t)},expression:"fields.displacementy"}})],1),n("DxRadioGroup",{staticClass:"gis-wms-text-style-form__radio-group",attrs:{dataSource:e.unitItems,valueExpr:"value",displayExpr:"text",layout:"horizontal"},model:{value:e.unit,callback:function(t){e.unit=t},expression:"unit"}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Цвет облака"}},[e._v("\n      Цвет облака\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-wms-text-style-form__color-box",on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.halo_fill,callback:function(t){e.$set(e.fields,"halo_fill",t)},expression:"fields.halo_fill"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Радиус облака"}},[e._v("\n      Радиус облака\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-wms-text-style-form__number-box",attrs:{min:0},on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.halo_radius,callback:function(t){e.$set(e.fields,"halo_radius",t)},expression:"fields.halo_radius"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Максимальная ширина текста"}},[e._v("\n      Максимальная ширина\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-wms-text-style-form__number-box",attrs:{min:0},on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.autowrap,callback:function(t){e.$set(e.fields,"autowrap",t)},expression:"fields.autowrap"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Максимальный сдвиг текста"}},[e._v("\n      Максимальный сдвиг\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-wms-text-style-form__number-box",attrs:{min:0},on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.maxdisplacement,callback:function(t){e.$set(e.fields,"maxdisplacement",t)},expression:"fields.maxdisplacement"}})],1)])])},nt=[],it={name:"GisWmsTextStyleForm",mixins:[S["a"]],components:{DxColorBox:D.a,DxNumberBox:E.a,DxTextBox:l.a,DxSelectBox:T.a,Slider:j["a"]},props:{fields:Object,dataSources:Object},data:function(){return{styleItems:[{value:"normal",text:"Обычное"},{value:"italic",text:"Курсивное"},{value:"oblique",text:"Наклонное"}],weightItems:[{value:"normal",text:"Обычное начертание"},{value:"bold",text:"Полужирное начертание"}],unitItems:[{value:"anchorpoint",text:"%"},{value:"displacement",text:"px"}],unit:"anchorpoint"}},methods:{rotationChanged:function(e){var t=e.value,n=e.onInitialized;n||(this.fields.rotation=t.toString(),this.$emit("changed"))}}},ot=it,at=(n("b68a"),Object(_["a"])(ot,tt,nt,!1,null,null,null)),st=at.exports,rt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-wms-options-form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Наименование"}},[e._v("\n      Наименование\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.name,callback:function(t){e.$set(e.fields,"name",t)},expression:"fields.name"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Заголовок"}},[e._v("\n      Заголовок\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{on:{valueChanged:function(t){return e.$emit("changed")}},model:{value:e.fields.caption,callback:function(t){e.$set(e.fields,"caption",t)},expression:"fields.caption"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Масштабы"}},[e._v("\n      Масштабы\n    ")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-wms-options-form__slider-wrapper"},[n("div",{staticClass:"gis-wms-options-form__range-slider"},[n("span",[e._v(e._s(e.fields.minscaledenominator||0))]),n("DxRangeSlider",{staticClass:"gis-wms-options-form__slider",attrs:{min:0,max:2e5,start:e.fields.minscaledenominator,end:e.fields.maxscaledenominator||2e5},on:{valueChanged:e.zoomChanged}}),n("span",[e._v(e._s(e.fields.maxscaledenominator||2e5))])],1)])])]),e.filter.fields&&e.filter.fields.length?n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Фильтр")]),n("div",{staticClass:"dx-field-value"},[n("DxFilterBuilder",{attrs:{value:e.filter.body,fields:e.filter.fields},on:{contentReady:e.selectBoxOpened,valueChanged:e.filterChange}})],1)]):e._e()])},lt=[],ct={name:"GisWmsOptionsForm",mixins:[S["a"]],components:{DxTextBox:l.a,DxRangeSlider:d.a,DxFilterBuilder:p.a},props:{fields:Object,filter:Object,isOpen:Boolean},data:function(){return{timeoutId:null}},methods:{zoomChanged:function(e){var t=this;this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.timeoutId=setTimeout((function(){t.fields.minscaledenominator=e.start,t.fields.maxscaledenominator=e.end,t.$emit("changed")}),500)},filterChange:function(e){this.isOpen&&(this.filter.body=e.value,this.$emit("changed",{filter:e.value}))}}},dt=ct,ut=(n("9606"),Object(_["a"])(dt,rt,lt,!1,null,null,null)),pt=ut.exports,ft=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-tmp-line-style-form"},[n("div",{staticClass:"gis-tmp-line-style-form__workspace"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Цвет")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-tmp-line-style-form__color-box",on:{opened:e.selectBoxOpened,valueChanged:e.repaintPreview},model:{value:e.fields.paint["line-color"],callback:function(t){e.$set(e.fields.paint,"line-color",t)},expression:"fields.paint['line-color']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Толщина, px")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-tmp-line-style-form__number-box",on:{valueChanged:e.repaintPreview},model:{value:e.fields.paint["line-width"],callback:function(t){e.$set(e.fields.paint,"line-width",t)},expression:"fields.paint['line-width']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Стиль")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.lineStyleItems,valueExpr:"value",displayExpr:"text"},on:{opened:e.selectBoxOpened,valueChanged:e.lineStyleChanged},model:{value:e.lineStyle,callback:function(t){e.lineStyle=t},expression:"lineStyle"}})],1)]),"dashed"===e.lineStyle?n("div",{staticClass:"gis-tmp-line-style-form__line-style"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Шаг, px")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-tmp-line-style-form__number-box",attrs:{min:0},on:{valueChanged:function(t){return e.dasharrayChange(0,t)}},model:{value:e.fields.paint["line-dasharray"][0],callback:function(t){e.$set(e.fields.paint["line-dasharray"],0,t)},expression:"fields.paint['line-dasharray'][0]"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Разрыв, px")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-tmp-line-style-form__number-box",attrs:{min:0},on:{valueChanged:function(t){return e.dasharrayChange(1,t)}},model:{value:e.fields.paint["line-dasharray"][1],callback:function(t){e.$set(e.fields.paint["line-dasharray"],1,t)},expression:"fields.paint['line-dasharray'][1]"}})],1)])]):e._e(),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Непрозрачность")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-tmp-line-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.opacityOptions},on:{valueChanged:e.opacityChanged}})],1)])]),n("div",{staticClass:"gis-tmp-line-style-form__line-translate"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Смещение, px")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-tmp-line-style-form__number-box",attrs:{placeholder:"X"},on:{valueChanged:e.repaintPreview},model:{value:e.fields.paint["line-translate"][0],callback:function(t){e.$set(e.fields.paint["line-translate"],0,t)},expression:"fields.paint['line-translate'][0]"}}),n("DxNumberBox",{staticClass:"gis-tmp-line-style-form__number-box",attrs:{placeholder:"Y"},on:{valueChanged:e.repaintPreview},model:{value:e.fields.paint["line-translate"][1],callback:function(t){e.$set(e.fields.paint["line-translate"],1,t)},expression:"fields.paint['line-translate'][1]"}})],1)])])]),n("div",{ref:"mapContainer",staticClass:"gis-tmp-line-style-form__preview"})])},ht=[],mt=(n("8e6e"),n("cadf"),n("456d"),n("ade3")),gt=n("e192"),yt=n.n(gt),vt=(n("ac6d"),n("7e8b"));function bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _t(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bt(Object(n),!0).forEach((function(t){Object(mt["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ct={name:"GisTmpLineStyleForm",mixins:[S["a"]],components:{DxColorBox:D.a,DxNumberBox:E.a,DxSelectBox:T.a,Slider:j["a"]},props:{fields:Object},data:function(){return{lineStyle:this.fields.paint["line-dasharray"]?"dashed":"solid",lineStyleItems:[{value:"solid",text:"Сплошная"},{value:"dashed",text:"Прерывистая"}],mapbox:null}},computed:{opacityOptions:function(){return{value:Math.round(100*(void 0===this.fields.paint["line-opacity"]?1:this.fields.paint["line-opacity"])),unit:"%"}}},mounted:function(){this.initMapPreview()},methods:{initMapPreview:function(){var e=this;this.mapbox=new yt.a.Map({container:this.$refs.mapContainer,center:[132.51088,43.59944],zoom:9}),this.mapbox.addSource("preview",{type:"geojson",data:vt["b"]}),setTimeout((function(){e.mapbox.resize()}),500),this.repaintPreview()},repaintPreview:function(){this.mapbox.getLayer("preview")&&this.mapbox.removeLayer("preview"),this.mapbox.addLayer(_t(_t({},this.fields),{},{source:"preview",id:"preview"}))},lineStyleChanged:function(e){switch(e.value){case"solid":delete this.fields.paint["line-dasharray"];break;case"dashed":this.fields.paint["line-dasharray"]=[2,3]}this.repaintPreview()},opacityChanged:function(e){var t=e.value,n=e.onInitialized;n||(this.fields.paint["line-opacity"]=t/100,this.repaintPreview())},dasharrayChange:function(e,t){this.fields.paint["line-dasharray"][e]=t.value,this.repaintPreview()}}},xt=Ct,Ot=(n("0c5e"),Object(_["a"])(xt,ft,ht,!1,null,null,null)),It=Ot.exports,St=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-tmp-point-style-form"},[n("div",{staticClass:"gis-tmp-point-style-form__workspace"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Радиус окружности"}},[e._v("\n        Радиус, px\n      ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-tmp-point-style-form__number-box",attrs:{min:0},on:{valueChanged:e.repaintPreview},model:{value:e.fields.paint["circle-radius"],callback:function(t){e.$set(e.fields.paint,"circle-radius",t)},expression:"fields.paint['circle-radius']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Цвет заливки"}},[e._v("\n        Цвет заливки\n      ")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-tmp-point-style-form__color-box",on:{opened:e.selectBoxOpened,valueChanged:e.repaintPreview},model:{value:e.fields.paint["circle-color"],callback:function(t){e.$set(e.fields.paint,"circle-color",t)},expression:"fields.paint['circle-color']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Непрозрачность заливки"}},[e._v("\n        Непрозрачность\n      ")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-tmp-point-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.fillOpacityOptions},on:{valueChanged:function(t){return e.opacityChanged(t,"circle-opacity")}}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Цвет обводки"}},[e._v("\n        Цвет обводки\n      ")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-tmp-point-style-form__color-box",on:{opened:e.selectBoxOpened,valueChanged:e.repaintPreview},model:{value:e.fields.paint["circle-stroke-color"],callback:function(t){e.$set(e.fields.paint,"circle-stroke-color",t)},expression:"fields.paint['circle-stroke-color']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Толщина обводки"}},[e._v("\n        Толщина обводки, px\n      ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-tmp-point-style-form__number-box",attrs:{min:0},on:{valueChanged:e.repaintPreview},model:{value:e.fields.paint["circle-stroke-width"],callback:function(t){e.$set(e.fields.paint,"circle-stroke-width",t)},expression:"fields.paint['circle-stroke-width']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Непрозрачность обводки"}},[e._v("\n        Непрозрачность обводки\n      ")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-tmp-point-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.strokeOpacityOptions},on:{valueChanged:function(t){return e.opacityChanged(t,"circle-stroke-opacity")}}})],1)])])]),n("div",{ref:"mapContainer",staticClass:"gis-tmp-point-style-form__preview"})])},Lt=[];function Dt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Pt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dt(Object(n),!0).forEach((function(t){Object(mt["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Et={name:"GisTmpPointStyleForm",mixins:[S["a"]],components:{DxNumberBox:E.a,DxColorBox:D.a,Slider:j["a"]},props:{fields:Object},data:function(){return{mapbox:null}},computed:{fillOpacityOptions:function(){return{value:Math.round(100*(void 0===this.fields.paint["circle-opacity"]?1:this.fields.paint["circle-opacity"])),unit:"%"}},strokeOpacityOptions:function(){return{value:Math.round(100*(void 0===this.fields.paint["circle-stroke-opacity"]?1:this.fields.paint["circle-stroke-opacity"])),unit:"%"}}},mounted:function(){this.initMapPreview()},methods:{initMapPreview:function(){var e=this;this.mapbox=new yt.a.Map({container:this.$refs.mapContainer,center:[132.51088,43.59944],zoom:9}),this.mapbox.addSource("preview",{type:"geojson",data:vt["c"]}),setTimeout((function(){e.mapbox.resize()}),500),this.repaintPreview()},repaintPreview:function(){this.mapbox.getLayer("preview")&&this.mapbox.removeLayer("preview"),this.mapbox.addLayer(Pt(Pt({},this.fields),{},{source:"preview",id:"preview"}))},opacityChanged:function(e,t){var n=e.value,i=e.onInitialized;i||(this.fields.paint[t]=n/100,this.repaintPreview())}}},wt=Et,Tt=(n("d599"),Object(_["a"])(wt,St,Lt,!1,null,null,null)),jt=Tt.exports,kt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-tmp-polygon-style-form"},[n("div",{staticClass:"gis-tmp-polygon-style-form__workspace"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Цвет заливки"}},[e._v("\n        Цвет заливки\n      ")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-tmp-polygon-style-form__color-box",on:{opened:e.selectBoxOpened,valueChanged:e.repaintPreview},model:{value:e.fillFields.paint["fill-color"],callback:function(t){e.$set(e.fillFields.paint,"fill-color",t)},expression:"fillFields.paint['fill-color']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Непрозрачность заливки"}},[e._v("\n        Непрозрачность заливки\n      ")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-tmp-polygon-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.fillOpacityOptions},on:{valueChanged:e.fillOpacityChanged}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Цвет обводки"}},[e._v("\n        Цвет обводки\n      ")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-tmp-polygon-style-form__color-box",on:{opened:e.selectBoxOpened,valueChanged:e.repaintPreview},model:{value:e.strokeFields.paint["line-color"],callback:function(t){e.$set(e.strokeFields.paint,"line-color",t)},expression:"strokeFields.paint['line-color']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Толщина обводки"}},[e._v("\n        Толщина обводки, px\n      ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-tmp-polygon-style-form__number-box",on:{valueChanged:e.repaintPreview},model:{value:e.strokeFields.paint["line-width"],callback:function(t){e.$set(e.strokeFields.paint,"line-width",t)},expression:"strokeFields.paint['line-width']"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Стиль обводки"}},[e._v("\n        Стиль обводки\n      ")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.lineStyleItems,valueExpr:"value",displayExpr:"text"},on:{opened:e.selectBoxOpened,valueChanged:e.lineStyleChanged},model:{value:e.lineStyle,callback:function(t){e.lineStyle=t},expression:"lineStyle"}})],1)]),"dashed"===e.lineStyle?n("div",{staticClass:"gis-tmp-polygon-style-form__line-style"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Шаг штриха"}},[e._v("\n          Шаг, px\n        ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-tmp-polygon-style-form__number-box",attrs:{min:0},on:{valueChanged:function(t){return e.dasharrayChange(0,t)}},model:{value:e.strokeFields.paint["line-dasharray"][0],callback:function(t){e.$set(e.strokeFields.paint["line-dasharray"],0,t)},expression:"strokeFields.paint['line-dasharray'][0]"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Разрыв штриха"}},[e._v("\n          Разрыв, px\n        ")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-tmp-polygon-style-form__number-box",attrs:{min:0},on:{valueChanged:function(t){return e.dasharrayChange(1,t)}},model:{value:e.strokeFields.paint["line-dasharray"][1],callback:function(t){e.$set(e.strokeFields.paint["line-dasharray"],1,t)},expression:"strokeFields.paint['line-dasharray'][1]"}})],1)])]):e._e(),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Непрозрачность обводки"}},[e._v("\n        Непрозрачность обводки\n      ")]),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-tmp-polygon-style-form__slider-wrapper"},[n("Slider",{attrs:{options:e.strokeOpacityOptions},on:{valueChanged:e.strokeOpacityChanged}})],1)])])]),n("div",{ref:"mapContainer",staticClass:"gis-tmp-polygon-style-form__preview"})])},Ft=[],Bt=n("3835");n("ffc1");function Mt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function At(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mt(Object(n),!0).forEach((function(t){Object(mt["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Rt={previewFill:"fillFields",previewStroke:"strokeFields"},Vt={name:"GisTmpPolygonStyleForm",mixins:[S["a"]],components:{DxColorBox:D.a,DxNumberBox:E.a,DxSelectBox:T.a,Slider:j["a"]},props:{fillFields:Object,strokeFields:Object},data:function(){return{lineStyle:this.strokeFields.paint["line-dasharray"]?"dashed":"solid",lineStyleItems:[{value:"solid",text:"Сплошная"},{value:"dashed",text:"Прерывистая"}],mapbox:null}},computed:{strokeOpacityOptions:function(){return{value:Math.round(100*(void 0===this.strokeFields.paint["line-opacity"]?1:this.strokeFields.paint["line-opacity"])),unit:"%"}},fillOpacityOptions:function(){return{value:Math.round(100*(void 0===this.fillFields.paint["fill-opacity"]?1:this.fillFields.paint["fill-opacity"])),unit:"%"}}},mounted:function(){this.initMapPreview()},methods:{initMapPreview:function(){var e=this;this.mapbox=new yt.a.Map({container:this.$refs.mapContainer,center:[132.51088,43.59944],zoom:9}),this.mapbox.addSource("preview",{type:"geojson",data:vt["d"]}),setTimeout((function(){e.mapbox.resize()}),500),this.repaintPreview()},repaintPreview:function(){var e=this;Object.entries(Rt).forEach((function(t){var n=Object(Bt["a"])(t,2),i=n[0],o=n[1];e.mapbox.getLayer(i)&&e.mapbox.removeLayer(i),e.mapbox.addLayer(At(At({},e[o]),{},{source:"preview",id:i}))}))},lineStyleChanged:function(e){switch(e.value){case"solid":delete this.strokeFields.paint["line-dasharray"];break;case"dashed":this.strokeFields.paint["line-dasharray"]=[2,3]}this.repaintPreview()},fillOpacityChanged:function(e){var t=e.value,n=e.onInitialized;n||(this.fillFields.paint["fill-opacity"]=t/100,this.repaintPreview())},strokeOpacityChanged:function(e){var t=e.value,n=e.onInitialized;n||(this.strokeFields.paint["line-opacity"]=t/100,this.repaintPreview())},dasharrayChange:function(e,t){this.strokeFields.paint["line-dasharray"][e]=t.value,this.repaintPreview()}}},Gt=Vt,$t=(n("e36d"),Object(_["a"])(Gt,kt,Ft,!1,null,null,null)),Nt=$t.exports,Ut={name:"GisStyleItem",components:{GisGeoJsonOptionsForm:x,GisLineStyleForm:V,GisPolygonStyleForm:se,GisCircleStyleForm:pe,GisImageStyleForm:ve,GisTextStyleForm:we,GisChartStyleForm:Me,GisWmsPolygonStyleForm:Ne,GisWmsLineStyleForm:qe,GisWmsPointStyleForm:et,GisWmsOptionsForm:pt,GisWmsTextStyleForm:st,GisTmpLineStyleForm:It,GisTmpPointStyleForm:jt,GisTmpPolygonStyleForm:Nt},props:{title:String,component:String,isOpen:Boolean,deleteButton:{type:Boolean,default:!0},componentOptions:Object,popupContainer:null},data:function(){return{opened:this.isOpen}},watch:{isOpen:function(){this.opened=this.isOpen}},methods:{toggleItem:function(){this.opened=!this.opened,this.$emit("toggle",this.opened)}}},zt=Ut,Ht=(n("84cb"),Object(_["a"])(zt,i,o,!1,null,null,null));t["a"]=Ht.exports},"04d3":function(e,t,n){},"0531":function(e,t,n){},"0551":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAEKADAAQAAAABAAAAEAAAAAAXnVPIAAACaElEQVQ4EX1TTWgTURCe2c1P29SCRUgxSCjpQdtrPRVv9iS24EHBm+hNpB5s4l0PticpiIcoFaGIFUHBFql2W39AaxAPEiVJk012K2ptA1o1m+zuG9/b8JaminPY+eabv52ZXQAud17l7ioC5JypdqE9UYvGGlkjhUXPwpS2ObuSnylUjJJHFMoGZYlCzWDxTC5dL5XNMwJ61RDpuIs0IQhPRMGzL4+60oZP3zbrvuGDi9oapDS69zr3YLViUr5sTgpfQAaYY/0xgW/ql1StUgZFhRPcTHpNhcOyGsu1mvUsHhmY3PjSEbg2NBcXvC95vdLI6fp+n/gLJB8dCCc1s2QYmWw22yn9zRYpbQCCXR8IIAqAg7u695RN0/Q21xwcYAEdp6oqUOWZ1Xqjjr9d97So4k1hnO/fKwy+CftK/lQQ+QiOxT77AQ3bERgYMQDeB2y2kh6evy84rwJz2bIwuM92bGXsxvDcR2H7Is5TFNvTzas+uR2s8mPkdePWdk5ilMDX408PQSA0zd8oEXKZPXMsNj8Yi4wSoMWYk4Zw+HJfT8+6jPdP4RHji7M8+TkwN8En4hQCEfImCIyxNgXVc2qDlnJF46As4B9bENrJeBgVeCidRORktqbfvdXXCJvfGi+FFjG1j8dkRFxLgX27QyMyWWi+VvvFz++Ban19VFX4yypYJ4ctUC3wRMa1FADEDengrQAZ2nySmqKQyfk3ruNOpA8/9jrLuJYl8nM0fAf/MQjI7GrrHopGO79KfqduXSJAEBGD7R0Rlev3rqse+V+yKNYyAqKyxcC+YP/6cTvR22vt7PYv+w910ApHaWuciQAAAABJRU5ErkJggg=="},"057c":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"save-filter-panel",attrs:{animation:null,visible:e.visible,shading:!1,resizeEnabled:!1,width:489,height:185,toolbarItems:e.toolbarItems,container:e.popupContainer},on:{shown:function(t){return e.$emit("shown")}},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("div",{staticClass:"save-filter-panel__title"},[n("div",{staticClass:"save-filter-panel__wrapper"},[n("div",{staticClass:"save-filter-panel__main-title"},[e._v("Сохранить фильтр")]),n("div",{staticClass:"save-filter-panel__subtitle"},[e._v("\n          "+e._s(e.layerName)+"\n        ")])]),n("div",{staticClass:"save-filter-panel__close-button",on:{click:function(t){return e.$emit("hidden")}}},[n("i",{staticClass:"core core-057-close"})])])]},proxy:!0}])},[[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Название"}},[e._v("\n        Название\n      ")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{placeholder:"Название"},model:{value:e.filterName,callback:function(t){e.filterName=t},expression:"filterName"}})],1)])]],2)},o=[],a=n("d736"),s=n.n(a),r=n("e614"),l=n.n(r),c={name:"SaveFilterPanel",components:{DxPopup:s.a,DxTextBox:l.a},props:{layerName:String,visible:Boolean,popupContainer:null},data:function(){var e=this;return{filterName:"",toolbarItems:[{toolbar:"bottom",location:"center",widget:"dxButton",options:{text:"Сохранить",type:"success",onClick:function(){e.$emit("saveFilter",e.filterName)}}},{toolbar:"bottom",location:"center",widget:"dxButton",options:{text:"Отменить",onClick:function(){e.$emit("hidden")}}}]}}},d=c,u=(n("a502"),n("2877")),p=Object(u["a"])(d,i,o,!1,null,null,null);t["a"]=p.exports},"06a8":function(e,t,n){},"06dd":function(e,t,n){},"078a":function(e,t,n){"use strict";var i=n("b2e5"),o=n.n(i);o.a},"09e7":function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("ac6a"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("ac4d"),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("8a81"),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es6_string_iterator__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("5df3"),core_js_modules_es6_string_iterator__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es6_string_iterator__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("1c4c"),core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("6b54"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("a481"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("f751"),core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("7f7f"),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("6762"),core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_9__),core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("2fdb"),core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_10__),C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("2909"),core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("55dd"),core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_12__),devextreme_vue_data_grid__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("d30a"),devextreme_vue_data_grid__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(devextreme_vue_data_grid__WEBPACK_IMPORTED_MODULE_13__),devextreme_vue_color_box__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("9576"),devextreme_vue_color_box__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(devextreme_vue_color_box__WEBPACK_IMPORTED_MODULE_14__),devextreme_vue_number_box__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("7ea3"),devextreme_vue_number_box__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(devextreme_vue_number_box__WEBPACK_IMPORTED_MODULE_15__),devextreme_vue_select_box__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("049d"),devextreme_vue_select_box__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(devextreme_vue_select_box__WEBPACK_IMPORTED_MODULE_16__),devextreme_vue_radio_group__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("bf5f"),devextreme_vue_radio_group__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(devextreme_vue_radio_group__WEBPACK_IMPORTED_MODULE_17__),devextreme_vue_text_area__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("b8f5"),devextreme_vue_text_area__WEBPACK_IMPORTED_MODULE_18___default=__webpack_require__.n(devextreme_vue_text_area__WEBPACK_IMPORTED_MODULE_18__),_Editors_Slider_SliderBase__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("cb2e"),_GisContainer__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("5c46"),_GisAttributesListPopup__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("3bb0"),_models_canvas_DiagramCanvasLayer__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("5484"),_const__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("6ad3");function _createForOfIteratorHelper(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"===typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}__webpack_exports__["a"]={name:"GisChartStyleForm",mixins:[_GisContainer__WEBPACK_IMPORTED_MODULE_20__["a"]],components:{DxDataGrid:devextreme_vue_data_grid__WEBPACK_IMPORTED_MODULE_13__["DxDataGrid"],DxColumn:devextreme_vue_data_grid__WEBPACK_IMPORTED_MODULE_13__["DxColumn"],DxColorBox:devextreme_vue_color_box__WEBPACK_IMPORTED_MODULE_14___default.a,DxNumberBox:devextreme_vue_number_box__WEBPACK_IMPORTED_MODULE_15___default.a,DxSelectBox:devextreme_vue_select_box__WEBPACK_IMPORTED_MODULE_16___default.a,DxRadioGroup:devextreme_vue_radio_group__WEBPACK_IMPORTED_MODULE_17___default.a,DxTextArea:devextreme_vue_text_area__WEBPACK_IMPORTED_MODULE_18___default.a,Slider:_Editors_Slider_SliderBase__WEBPACK_IMPORTED_MODULE_19__["a"],GisAttributesListPopup:_GisAttributesListPopup__WEBPACK_IMPORTED_MODULE_21__["a"]},props:{fields:Object,dataFields:Array},data:function(){return{CHART_TYPES:_const__WEBPACK_IMPORTED_MODULE_23__["d"],PIECHART_CORNERS:_const__WEBPACK_IMPORTED_MODULE_23__["i"],PIECHART_DIRECTIONS:_const__WEBPACK_IMPORTED_MODULE_23__["j"],CHART_POSITIONS:_const__WEBPACK_IMPORTED_MODULE_23__["b"],BORDER_STYLES:_const__WEBPACK_IMPORTED_MODULE_23__["a"],CHART_SIZES:_const__WEBPACK_IMPORTED_MODULE_23__["c"],attrListVisible:!1,attributeLookupOptions:{onContentReady:function(e){var t=e.component._popup;t.option("showTitle",!1),t.option("maxHeight",300),t._$content.css("top",0)}},expressonError:!1}},computed:{hasBorder:function(){return"none"!==this.fields.paint["border-style"]},sortedDataFields:function(){var e=this,t=[];return this.dataFields&&(t=Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_11__["a"])(this.dataFields).filter((function(e){return["number"].includes(e.dataType)})).sort((function(t,n){return t.caption!==t.dataField&&n.caption!==n.dataField?e.sortValue(t.caption,n.caption):t.caption!==t.dataField&&n.caption===n.dataField?-1:t.caption===t.dataField&&n.caption!==n.dataField?1:e.sortValue(t.dataField,n.dataField)})).map((function(t){return{name:t.dataField,caption:t.caption,color:e.getRandomColor()}}))),t},filteredDataFields:function(){var e=this;return this.fields.layout["chart-attrs"]?this.sortedDataFields.filter((function(t){return!e.fields.layout["chart-attrs"].map((function(e){return e.name})).includes(t.name)})):this.sortedDataFields},borderOpacityOptions:function(){return{value:Math.round(100*(null===this.fields.paint["border-opacity"]?1:this.fields.paint["border-opacity"])),unit:"%"}},fillOpacityOptions:function(){return{value:Math.round(100*(null===this.fields.paint["fill-opacity"]?1:this.fields.paint["fill-opacity"])),unit:"%"}}},created:function(){this.fields.layout["chart-size-attribute"]||(this.fields.layout["chart-size-attribute"]="")},methods:{displayValue:function(e){return e?e.caption||e.name:""},attributeCaption:function(e){return e.caption||e.name},getRandomColor:function(){for(var e="0123456789abcdef",t="#",n=0;n<6;n++)t+=e[Math.floor(16*Math.random())];return t},onAttributeClick:function(e){this.fields.layout["chart-size-attribute"]+="[".concat(e.itemData.name,"]"),this.fields.layout=Object.assign({},this.fields.layout)},onExpressionChanged:function onExpressionChanged(event){this.expressonError=!1;var expression=event.value;if(expression)try{var attrs=_models_canvas_DiagramCanvasLayer__WEBPACK_IMPORTED_MODULE_22__["a"].parseAttributes(expression),_iterator=_createForOfIteratorHelper(attrs),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var attr=_step.value;expression=expression.replace("[".concat(attr,"]"),5.5)}}catch(err){_iterator.e(err)}finally{_iterator.f()}eval(expression)}catch(err){this.expressonError=!0}},fillOpacityChanged:function(e){var t=e.value,n=e.onInitialized;n||(this.fields.paint["fill-opacity"]=t/100)},borderOpacityChanged:function(e){var t=e.value,n=e.onInitialized;n||(this.fields.paint["border-opacity"]=t/100)},onAddAttribute:function(e){this.fields.layout["chart-attrs"]||(this.fields.layout["chart-attrs"]=[]),this.fields.layout["chart-attrs"].push(e)},onRemoveAttribute:function(e){this.fields.layout["chart-attrs"].splice(e,1)},sortValue:function(e,t){return e>t?1:e<t?-1:0}}}},"0a94":function(e,t,n){"use strict";var i=n("1576"),o=n.n(i);o.a},"0b1b":function(e,t,n){},"0c24":function(e,t,n){},"0c48":function(e,t,n){"use strict";var i=n("9a60"),o=n.n(i);o.a},"0c5e":function(e,t,n){"use strict";var i=n("d0ab"),o=n.n(i);o.a},"0d41":function(e,t,n){},"0da7":function(e,t,n){"use strict";var i=n("3fdc"),o=n.n(i);o.a},"0f81":function(e,t,n){"use strict";var i=n("b70e"),o=n.n(i);o.a},1:function(e,t){},1091:function(e,t,n){"use strict";var i=n("cc18"),o=n.n(i);o.a},"112a":function(e,t,n){"use strict";var i=n("2daa"),o=n.n(i);o.a},"11d4":function(e,t,n){},1368:function(e,t,n){},"13e9":function(e,t,n){},1576:function(e,t,n){},"15a1":function(e,t,n){},"162b":function(e,t,n){"use strict";var i=n("ba75"),o=n.n(i);o.a},"16a9":function(e,t,n){},"17ff":function(e,t,n){},1842:function(e,t,n){"use strict";var i=n("11d4"),o=n.n(i);o.a},"188b":function(e,t,n){"use strict";var i=n("cd98"),o=n.n(i);o.a},"1a37":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-legend-item-button",class:e.buttonClass,attrs:{title:e.text||""},on:{click:function(t){return t.stopPropagation(),e.handleClick(t)}}},[n("i",{class:e.toggable&&e.active&&e.activeIconCss?e.activeIconCss:e.iconCss})])},o=[],a={props:{active:Boolean,disabled:Boolean,toggable:{type:Boolean,default:!0},iconCss:String,activeIconCss:String,text:String},computed:{buttonClass:function(){return{"gis-legend-item-button_active":this.active,"gis-legend-item-button_disabled":this.disabled}}},methods:{handleClick:function(){this.toggable&&!this.disabled&&this.$emit("activeChanged",!this.active)}}},s=a,r=(n("31ae"),n("2877")),l=Object(r["a"])(s,i,o,!1,null,null,null);t["a"]=l.exports},"1b52":function(e,t,n){"use strict";var i=n("c684"),o=n.n(i);o.a},"1b83":function(e,t,n){},"1d1c":function(e,t,n){},"1d3c":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-legend-item-panel"},[n("div",{staticClass:"gis-legend-item-panel__wrapper"},[n("div",{staticClass:"gis-legend-item-panel__buttons"},[e.isTableButtonVisible(e.layerComponentId)?n("GisLegendItemButton",{staticClass:"gis-legend-item-panel__button",attrs:{active:e.isTableButtonActive(e.layerComponentId),iconCss:"fas fa-table",text:"Список объектов"},nativeOn:{click:function(t){return e.tableButtonClick(t)}}}):e._e(),e.isOptionsButtonVisible(e.layerComponentId)?n("GisLegendItemButton",{staticClass:"gis-legend-item-panel__button",attrs:{active:e.isOptionsButtonActive,iconCss:"core core-104-tune",text:"Настройки слоя"},nativeOn:{click:function(t){return e.optionsButtonClick(t)}}}):e._e(),e.isMoveToLayerButtonVisible(e.layerComponentId)?n("GisLegendItemButton",{staticClass:"gis-legend-item-panel__button",attrs:{active:!1,iconCss:"core core-055-arrows-inside",text:"Приблизить к слою"},nativeOn:{click:function(t){return e.moveToLayerButtonClick(t)}}}):e._e(),e.isExportButtonVisible(e.layerComponentId)?n("GisLegendItemButton",{staticClass:"gis-legend-item-panel__button",attrs:{active:!1,iconCss:"core core-071-download",text:"Экспорт"},nativeOn:{click:function(t){return e.exportButtonClick(t)}}}):e._e(),e.isBufferButtonVisible(e.layerComponentId)?n("GisLegendItemButton",{staticClass:"gis-legend-item-panel__button",attrs:{active:!1,iconCss:"core core-011-search-in-buffer",text:"Построить буферные зоны"},nativeOn:{click:function(t){return e.bufferButtonClick(t)}}}):e._e(),e.isFilterButtonVisible(e.layerComponentId)?n("GisLegendItemButton",{ref:"filterButton",staticClass:"gis-legend-item-panel__button",attrs:{active:!1,iconCss:"fas fa-filter",text:"Фильтр"},nativeOn:{click:function(t){return e.filterButtonClick(t)}}}):e._e(),e.isCloneButtonVisible(e.layerComponentId)?n("GisLegendItemButton",{staticClass:"gis-legend-item-panel__button",attrs:{active:!1,iconCss:"fas fa-table",text:"Клонировать слой"},nativeOn:{click:function(t){return e.cloneButtonClick(t)}}}):e._e(),e.isTooltipButtonVisible(e.layerComponentId)?n("GisLegendItemButton",{ref:"filterButton",staticClass:"gis-legend-item-panel__button",attrs:{active:!1,iconCss:"core core-tooltip-settings",text:"Всплывающая подсказка"},nativeOn:{click:function(t){return e.tooltipButtonClick(t)}}}):e._e()],1),e.isMoveToLayerButtonVisible(e.layerComponentId)?n("DxPopover",{ref:"moveToLayerPanelPopover",attrs:{visible:e.moveToLayerPanelVisible,position:"bottom",closeOnOutsideClick:e.moveToLayerPanelCloseOnOutsideClick,container:e.popoverContainer,target:e.moveToLayerPanelTarget}},[n("GisLegendMoveToLayerPanel",{attrs:{layerComponentId:e.layerComponentId},on:{moveToAllFeatures:function(t){return e.$emit("moveToAllFeatures",e.layerComponentId)},moveToSelectedFeatures:function(t){return e.$emit("moveToSelectedFeatures",e.layerComponentId)}}})],1):e._e(),e.isExportButtonVisible(e.layerComponentId)?n("DxPopover",{ref:"exportPanelPopover",attrs:{visible:e.exportPanelVisible,position:"bottom",closeOnOutsideClick:e.exportPanelCloseOnOutsideClick,container:e.popoverContainer,target:e.exportPanelTarget}},[n("GisLegendExportPanel",{attrs:{gisComponentId:e.parentGisId,layerComponentId:e.layerComponentId}})],1):e._e(),e.isBufferButtonVisible(e.layerComponentId)?n("DxPopover",{ref:"bufferPanelPopover",attrs:{visible:e.bufferPanelVisible,position:"bottom",closeOnOutsideClick:e.bufferPanelCloseOnOutsideClick,container:e.popoverContainer,target:e.bufferPanelTarget}},[n("GisBufferZonePanel",{attrs:{gisComponentId:e.parentGisId,layerComponentId:e.layerComponentId,showRounded:e.showRounded,showUnion:!0,showSide:!0}})],1):e._e(),e.isFilterButtonVisible(e.layerComponentId)?n("DxPopover",{ref:"filterPanelPopover",attrs:{visible:e.filterBuilderPanelVisible,position:"bottom",closeOnOutsideClick:!0,container:e.popoverContainer},on:{hidden:e.closeFilterPanel,disposing:e.closeFilterPanel}},[n("GisFilterBuilderPanel",{attrs:{layerComponentId:e.filterPanelLayerComponentId,popupContainer:e.popoverContainer},on:{closeButtonClick:e.closeFilterPanel}})],1):e._e()],1),e.isSearchVisible(e.layerComponentId)?n("GisLegendItemSearch",{attrs:{legendItemsSearch:e.legendItemsSearch,popupContainer:e.popoverContainer},on:{selectSearchItem:function(t){return e.$emit("selectSearchItem",{featureId:t})},searchLayerItem:function(t){return e.$emit("searchLayerItem",{value:t})}}}):e._e()],1)},o=[],a=(n("8e6e"),n("ac6a"),n("cadf"),n("456d"),n("6762"),n("2fdb"),n("ade3")),s=(n("551c"),n("2f62")),r=n("1a37"),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-legend-item-panel__search-wrapper"},[n("DxAutocomplete",{staticClass:"autocomplete",attrs:{placeholder:"Найти объект...",dataSource:e.store,showClearButton:!0,itemTemplate:"template",searchTimeout:1100,valueExpr:"key"},on:{itemClick:e.selectSearchItem,enterKey:e.selectSearchItem,valueChanged:e.search,selectionChanged:e.selectSearchItem,opened:e.selectBoxOpened},scopedSlots:e._u([{key:"template",fn:function(t){var i=t.data;return[n("span",{attrs:{title:i.key}},[e._v(" "+e._s(i.key)+" ")])]}}]),model:{value:e.searchString,callback:function(t){e.searchString=t},expression:"searchString"}})],1)},c=[],d=(n("7f7f"),n("e1e1")),u=n.n(d),p=n("c920"),f=n("5c46");function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g={name:"GisLegendItemSearch",mixins:[f["a"]],components:{DxAutocomplete:u.a},props:{popupContainer:null,legendItemsSearch:Promise},data:function(){var e=this;return{searchString:"",timeoutId:0,store:new p["a"]({key:"id",load:function(){return new Promise((function(t){return e.legendItemsSearch.then((function(e){t(e.map((function(e){return m(m({},e),{},{key:e.caption||e.name||e.id})})))}))}))}}),isValueInserted:!1}},methods:{selectSearchItem:function(e){e.itemData&&(this.searchString!==e.itemData.key&&(this.isValueInserted=!0),this.$emit("selectSearchItem",e.itemData.id))},search:function(){var e=this;this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.timeoutId=setTimeout((function(){e.isValueInserted?e.isValueInserted=!1:e.searchString&&e.$emit("searchLayerItem",e.searchString)}),1e3)}}},y=g,v=n("2877"),b=Object(v["a"])(y,l,c,!1,null,null,null),_=b.exports,C=n("adbc"),x=n.n(C),O=n("7209"),I=n("b039"),S=n("d45b"),L=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-filter-builder-panel"},[n("div",{staticClass:"gis-filter-builder-panel__toolbar"},[n("div",{staticClass:"gis-filter-builder-panel__name"},[e._v("\n      "+e._s("Фильтр "+e.layerName)+"\n    ")]),e.totalCount&&null!==e.filteredCount?n("div",{staticClass:"gis-filter-builder-panel__count"},[e.loading?e._e():n("span",[e._v(e._s(e.filteredCount.toLocaleString()))]),n("DxLoadIndicator",{staticClass:"gis-filter-builder-panel__loading",attrs:{visible:e.loading}}),n("span",{staticClass:"gis-filter-builder-panel__total-count"},[e._v("из "+e._s(e.totalCount.toLocaleString()))])],1):e._e(),n("div",{staticClass:"gis-filter-builder-panel__button-panel"},[n("div",{staticClass:"gis-filter-builder-panel__button-group"},[n("div",{staticClass:"gis-filter-builder-panel__button",attrs:{title:"Очистить фильтр"},on:{click:function(t){return e.handleValueChanged({value:null})}}},[n("i",{staticClass:"core core-190_mop"})]),n("div",{staticClass:"gis-filter-builder-panel__button",attrs:{title:"Сохранить фильтр"},on:{click:function(t){e.saveFilterPanelVisible=!0}}},[n("i",{staticClass:"core core-016-save"})]),n("div",{staticClass:"gis-filter-builder-panel__button",attrs:{title:"Выбрать фильтр из списка"},on:{click:function(t){e.filterListVisible=!0}}},[n("i",{staticClass:"core core-189_list"})])]),n("div",{staticClass:"gis-filter-builder-panel__button",attrs:{title:"Закрыть"},on:{click:function(t){return e.$emit("closeButtonClick")}}},[n("i",{staticClass:"core core-057-close"})])])]),n("DxFilterBuilder",{attrs:{fields:e.sortedFields,value:e.value},on:{valueChanged:e.handleValueChanged},scopedSlots:e._u([{key:"lookupEditor",fn:function(t){var i=t.data;return[n("DxLookup",e._b({attrs:{value:i.value,width:265},on:{valueChanged:function(t){return e.handlerLookupValueChanged(i,t)}}},"DxLookup",i.field.editorOptions,!1))]}}])}),n("SaveFilterPanel",{attrs:{visible:e.saveFilterPanelVisible,layerName:e.layerName,popupContainer:e.popupContainer},on:{shown:function(t){e.saveFilterPanelVisible=!0},hidden:function(t){e.saveFilterPanelVisible=!1},saveFilter:e.saveFilter}}),n("GisFilterListPopup",{attrs:{title:"Выбор фильтра",visible:e.filterListVisible,popupContainer:e.popupContainer,layerComponentId:e.layerComponentId},on:{shown:function(t){e.filterListVisible=!0},hidden:function(t){e.filterListVisible=!1},applyClick:e.filterListApplyClick}})],1)},D=[],P=(n("a481"),n("097d"),n("c22f")),E=n("eec1"),w=n("9841"),T=n("13f5"),j=n.n(T),k=n("057c"),F=n("81a7"),B=n("07e0"),M=n.n(B),A=n("4f34"),R=n.n(A),V=n("bf8c"),G=n("4f0d"),$=n("bc2f");function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var z={name:"FilterBuilder",mixins:[G["a"]],components:{DxFilterBuilder:j.a,SaveFilterPanel:k["a"],GisFilterListPopup:F["a"],DxLookup:M.a,DxLoadIndicator:R.a},props:{layerComponentId:String,popupContainer:null},data:function(){return{saveFilterPanelVisible:!1,filterListVisible:!1,filteredCount:null,totalCount:null,loading:!1}},computed:U(U({},Object(s["c"])("config",{getOptions:P["c"],getDataSetName:E["m"]})),{},{layerName:function(){return this.getOptions(this.layerComponentId).text||""},fields:function(){return this.getOptions(this.layerComponentId).filterBuilderFields||[]},value:function(){return this.getOptions(this.layerComponentId).filterValue},dataSetName:function(){return this.getDataSetName(this.layerComponentId)},sortedFields:function(){return Object($["d"])(this.fields)}}),watch:{layerComponentId:{handler:function(){if(!this.layerComponentId)return this.totalCount=null,void(this.filteredCount=null);this.loadTotalDataCount(),this.loadDataCount()},immediate:!0}},methods:U(U({},Object(s["b"])("config",{gisLayerLoadTotalDataCount:w["y"],gisLayerLoadDataCount:w["q"],changeFilter:w["e"]})),{},{handleValueChanged:function(e){var t=e.value;t!==this.value&&(this.changeFilter({layerComponentId:this.layerComponentId,filterValue:t}),this.loadDataCount())},saveFilter:function(e){var t=this;Object(V["c"])("insertData",{body:JSON.stringify(this.value),dataset:this.dataSetName,name:e,_config_dataset:"CONFIG.DSFILTER",filtergroup_id:1}).then((function(){t.saveFilterPanelVisible=!1}))},loadTotalDataCount:function(){var e=this;this.gisLayerLoadTotalDataCount({layerComponentId:this.layerComponentId}).then((function(t){e.totalCount=t}))},loadDataCount:function(){var e=this;return this.loading=!0,this.gisLayerLoadDataCount({layerComponentId:this.layerComponentId}).then((function(t){e.filteredCount=t})).finally((function(){e.loading=!1}))},filterListApplyClick:function(e){this.handleValueChanged({value:JSON.parse(e.body.replace(/\\"/g,'"'))}),this.filterListVisible=!1},handlerLookupValueChanged:function(e,t){e.setValue(t.value)}})},H=z,W=(n("ed28"),Object(v["a"])(H,L,D,!1,null,null,null)),K=W.exports,q=n("7a47"),J=n("e3b7"),Z=n("68b0");function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Q={name:"GisLegendItemPanel",components:{DxPopover:x.a,GisLegendItemButton:r["a"],GisLegendItemSearch:_,GisLegendMoveToLayerPanel:O["a"],GisLegendExportPanel:I["a"],GisBufferZonePanel:S["a"],GisFilterBuilderPanel:K},props:{layerComponentId:String,legendItemsSearch:Promise,popoverContainer:null},data:function(){return{moveToLayerPanelVisible:!1,exportPanelVisible:!1,bufferPanelVisible:!1,moveToLayerPanelTarget:null,exportPanelTarget:null,bufferPanelTarget:null}},computed:X(X({},Object(s["c"])("config",{getOptions:P["c"],isTableButtonVisible:E["hb"],isTableButtonActive:E["gb"],isOptionsButtonVisible:E["db"],isMoveToLayerButtonVisible:E["cb"],isExportButtonVisible:E["T"],isBufferButtonVisible:E["Q"],isFilterButtonVisible:E["U"],isCloneButtonVisible:E["R"],isTooltipButtonVisible:E["jb"],isSearchVisible:E["fb"],getStyleFormLayerComponentId:J["D"]})),{},{geomTypes:function(){return this.getOptions(this.layerComponentId).geomTypes},parentGisId:function(){return this.getOptions(this.layerComponentId).parentGisId},useFilterBuilder:function(){return this.getOptions(this.parentGisId).useFilterBuilder},filterPanelLayerComponentId:function(){return this.getOptions(this.parentGisId).filterPanelLayerComponentId},filterBuilderPanelVisible:function(){return this.useFilterBuilder&&!!this.filterPanelLayerComponentId},isOptionsButtonActive:function(){return this.layerComponentId===this.getStyleFormLayerComponentId(this.parentGisId)},showRounded:function(){return!(this.geomTypes&&this.geomTypes.includes("Point"))}}),watch:{layerComponentId:function(e){e||(this.exportPanelVisible=!1,this.bufferPanelVisible=!1)}},methods:X(X(X({},Object(s["b"])("config",{showTable:w["O"],setPopupMenuLayerComponent:Z["x"],loadFilterBuilderFields:w["t"]})),Object(s["d"])("config",{setStyleFormLayerComponentId:q["J"],setTablePanelLayerComponentId:q["K"],setFilterPanelLayerComponentId:q["m"],setTooltipFormLayerComponentId:q["L"]})),{},{tableButtonClick:function(){this.setTablePanelLayerComponentId({gisComponentId:this.parentGisId,layerComponentId:this.layerComponentId}),this.hideLayerPopupMenu()},optionsButtonClick:function(){var e=this;this.loadFilterBuilderFields({layerComponentId:this.layerComponentId,gisComponentId:this.parentGisId}).then((function(){e.setStyleFormLayerComponentId({gisComponentId:e.parentGisId,layerComponentId:e.layerComponentId}),e.hideLayerPopupMenu()}))},moveToLayerButtonClick:function(e){this.moveToLayerPanelTarget=e.target,this.moveToLayerPanelVisible=!0},exportButtonClick:function(e){this.exportPanelTarget=e.target,this.exportPanelVisible=!0},bufferButtonClick:function(e){this.bufferPanelTarget=e.target,this.bufferPanelVisible=!0},filterButtonClick:function(){var e=this;this.loadFilterBuilderFields({layerComponentId:this.layerComponentId,gisComponentId:this.parentGisId}).then((function(){e.setFilterPanelLayerComponentId({gisComponentId:e.parentGisId,layerComponentId:e.layerComponentId}),e.useFilterBuilder?e.setPopoverPosition("filterPanelPopover","filterButton"):e.hideLayerPopupMenu()}))},tooltipButtonClick:function(){var e=this;this.loadFilterBuilderFields({layerComponentId:this.layerComponentId,gisComponentId:this.parentGisId}).then((function(){e.setTooltipFormLayerComponentId({gisComponentId:e.parentGisId,layerComponentId:e.layerComponentId}),e.hideLayerPopupMenu()}))},closeFilterPanel:function(){this.setFilterPanelLayerComponentId({gisComponentId:this.parentGisId,layerComponentId:null})},cloneButtonClick:function(){},moveToLayerPanelCloseOnOutsideClick:function(e){return this.$refs.moveToLayerPanelPopover.instance.content().contains(e.target)||(this.hideLayerPopupMenu(),this.moveToLayerPanelVisible=!1),!1},exportPanelCloseOnOutsideClick:function(e){return this.$refs.exportPanelPopover.instance.content().contains(e.target)||(this.hideLayerPopupMenu(),this.exportPanelVisible=!1),!1},bufferPanelCloseOnOutsideClick:function(e){return this.$refs.bufferPanelPopover.instance.content().contains(e.target)||(this.hideLayerPopupMenu(),this.bufferPanelVisible=!1),!1},hideLayerPopupMenu:function(){this.setPopupMenuLayerComponent({gisComponentId:this.parentGisId,layerComponentId:null,targetElement:null})},setPopoverPosition:function(e,t){this.$refs[e]&&this.$refs[t]&&this.$refs[e].instance.option("target",this.$refs[t].$el)}})},ee=Q,te=(n("8fa7"),Object(v["a"])(ee,i,o,!1,null,null,null));t["a"]=te.exports},"1d7a":function(e,t,n){},"1efe":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-geojson-style"},[n("div",{staticClass:"gis-geojson-style__workspace"},[e.rules.length?n("div",{staticClass:"gis-geojson-style__list-wrapper"},[n("DxSortable",{attrs:{filter:".gis-geojson-rule",handle:".gis-geojson-rule__title",dropFeedbackMode:"indicate",height:"100%"},on:{reorder:e.reorderRule}},[n("DxScrollView",{ref:"scroll"},[n("div",{staticClass:"gis-geojson-style__list"},e._l(e.rules,(function(t){return n("GisGeoJsonRule",{key:t.id,ref:"rule_"+t.id,refInFor:!0,attrs:{id:t.id,optionsFields:t.options,isOptionsOpen:t.isOptionsOpen,subLayers:t.subLayers,selectionSubLayers:t.selectionSubLayers,hoverSubLayers:t.hoverSubLayers,hoverEnable:t.hoverEnable,isOpen:t.isOpen,filterFields:e.filterFields,layerType:e.layerType,dataFields:e.dataFields,geomTypes:e.geometryTypes,popupContainer:e.popupContainer,previewImage:t.previewImage},on:{toggleVisibility:e.toggleRule,deleteRule:e.deleteRule,deleteSubLayer:e.deleteSubLayer,reorderSubLayer:e.reorderSubLayer,toggleOptions:e.toggleOptions,addImage:e.addImage,deleteImage:e.deleteImage,savingRule:e.saveRule,addRuleFromList:function(t){return e.openStyleList(3,t)},styleChanged:e.repaintPreview,hoverEnableChanged:function(e){t.hoverEnable=e}}})})),1)])],1)],1):e.loadIndicatorOptions.visible?e._e():n("div",{staticClass:"gis-geojson-style__message"},[e._v("\n      У этого слоя пока нет ни одного стиля\n    ")]),n("div",{staticClass:"gis-geojson-style__buttons-wrapper"},[n("GisToolbarButtonGroup",{staticClass:"gis-geojson-style__buttons-group"},[e._e(),n("GisToolbarButton",{attrs:{active:!1,iconCss:"core core-201_autorule",text:"Автоматическое создание правил"},on:{click:function(t){e.autoRulePopupVisible=!0}}})],1),n("GisToolbarButtonGroup",{staticClass:"gis-geojson-style__buttons-group"},[n("GisToolbarButton",{attrs:{active:!1,disabled:!1,iconCss:"fas fa-filter",text:"Добавить правило"},on:{click:e.addRule}}),e._l(e.sublayerButtons,(function(t,i){return n("GisToolbarButton",e._b({key:i,on:{click:function(n){return e.onAddLayerClick(t.name)}}},"GisToolbarButton",t,!1))}))],2),n("GisToolbarButtonGroup",{staticClass:"gis-geojson-style__buttons-group"},[n("GisToolbarButton",{attrs:{active:!1,disabled:!1,iconCss:"core core-092-folder",text:"Применить набор правил"},on:{click:function(t){return e.openStyleList(2)}}}),n("GisToolbarButton",{attrs:{active:!1,disabled:!e.rules.length,iconCss:"core core-016-save",text:"Сохранить набор правил"},on:{click:e.saveStyle}})],1),n("GisToolbarButtonGroup",[n("GisToolbarButton",{attrs:{active:!1,disabled:!e.rules.length,iconCss:"fas fa-trash",text:"Удалить все правила"},on:{click:e.showDialog}})],1)],1)]),n("DxLoadPanel",e._b({attrs:{container:".gis-geojson-style"}},"DxLoadPanel",e.loadIndicatorOptions,!1)),n("SaveStyleForm",e._b({on:{shown:function(t){e.saveStylePopupOptions.visible=!0},hidden:function(t){e.saveStylePopupOptions.visible=!1},apply:e.styleSaved}},"SaveStyleForm",e.saveStylePopupOptions,!1)),n("StyleListPopup",e._b({on:{shown:function(t){e.styleListOptions.visible=!0},hidden:function(t){e.styleListOptions.visible=!1},apply:e.insertStyleFromList}},"StyleListPopup",e.styleListOptions,!1)),n("GisAutoRulePopup",{attrs:{visible:e.autoRulePopupVisible,layerComponentId:e.layerComponentId,popupContainer:e.popupContainer},on:{shown:function(t){e.autoRulePopupVisible=!0},hidden:function(t){e.autoRulePopupVisible=!1},apply:e.addAutoRules}}),n("div",{ref:"mapContainer",staticClass:"gis-geojson-style__preview"})],1)},o=[],a=(n("ac4d"),n("8a81"),n("1c4c"),n("6b54"),n("8e6e"),n("456d"),n("5df3"),n("3835")),s=(n("cadf"),n("ffc1"),n("097d"),n("551c"),n("2909")),r=(n("a481"),n("ade3")),l=(n("20d6"),n("ac6a"),n("7514"),n("7f7f"),n("6762"),n("2fdb"),n("5a1f")),c=n.n(l),d=n("0342"),u=n.n(d),p=n("5bba"),f=n.n(p),h=n("84a9"),m=n("62b3"),g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-geojson-rule",class:{"gis-geojson-rule_closed":!e.isOpen}},[n("div",{staticClass:"gis-geojson-rule__main"},[n("div",{staticClass:"gis-geojson-rule__header"},[n("div",{staticClass:"gis-geojson-rule__icon",on:{click:function(t){return e.$emit("toggleVisibility",{id:e.id,isOpen:!e.isOpen})}}},[n("i",{staticClass:"core",class:e.isOpen?"core-116-arrow-down":"core-117-arrow-right"})]),n("div",{staticClass:"gis-geojson-rule__title"},[e._v(e._s(e.optionsFields.caption||"Правило"))]),n("div",{staticClass:"gis-geojson-rule__icon",attrs:{title:"Применить стиль"},on:{click:function(t){return e.$emit("addRuleFromList",e.id)}}},[n("i",{staticClass:"core core-092-folder"})]),n("div",{staticClass:"gis-geojson-rule__icon",attrs:{title:"Сохранить стиль"},on:{click:e.saveRule}},[n("i",{staticClass:"core core core-016-save"})]),n("div",{staticClass:"gis-geojson-rule__icon",attrs:{title:"Удалить правило"},on:{click:function(t){return e.$emit("deleteRule",e.id)}}},[n("i",{staticClass:"core core-023-delete"})])]),n("div",{staticClass:"gis-geojson-rule__content"},[n("div",{staticClass:"gis-geojson-rule__workspace"},[n("GisStyleItem",{attrs:{title:"Опции",componentOptions:e.ruleComponentOptions,isOpen:e.isOptionsOpen,component:"GisGeoJsonOptionsForm",deleteButton:!1,popupContainer:e.popupContainer},on:{toggle:function(t){return e.$emit("toggleOptions",{id:e.id,isOpen:t})}}}),n("div",{staticClass:"gis-geojson-rule__mode-menu"},[n("div",{staticClass:"gis-geojson-rule__mode-button",class:{"gis-geojson-rule__mode-button-active":e.activeMode===e.$options.MODE_NORMAL},on:{click:function(t){return e.setActiveMode(e.$options.MODE_NORMAL)}}},[n("span",[e._v("Отображение")])]),n("div",{staticClass:"gis-geojson-rule__mode-button",class:{"gis-geojson-rule__mode-button-active":e.activeMode===e.$options.MODE_SELECT},on:{click:function(t){return e.setActiveMode(e.$options.MODE_SELECT)}}},[n("span",[e._v("Выделение")])]),n("div",{staticClass:"gis-geojson-rule__mode-button",class:e.hoverButtonClass,on:{click:function(t){e.hoverEnableComputed&&e.setActiveMode(e.$options.MODE_HOVER)}}},[n("span",{staticClass:"gis-geojson-rule__mode-button-text"},[e._v("Наведение")]),n("span",{on:{click:e.onHoverEnableClick}},[n("DxSwitch",{attrs:{value:e.hoverEnable,switchedOffText:"Нет",switchedOnText:"Да"},on:{valueChanged:e.onHoverEnableChanged}})],1)])]),n("DxSortable",{attrs:{filter:".gis-style-item",handle:".gis-style-item__title",dropFeedbackMode:"indicate"},on:{reorder:function(t){return e.$emit("reorderSubLayer",{ruleId:e.id,eventData:t})}}},[n("div",e._l(e.activeModeSubLayers,(function(t){return n("GisStyleItem",{key:t.id,staticClass:"gis-geojson-rule__style-item",attrs:{title:t.caption,componentOptions:{fields:t.options,dataFields:e.dataFields,geomTypes:e.geomTypes},isOpen:t.isOpen,component:t.componentType,popupContainer:e.popupContainer},on:{delete:function(n){return e.deleteSubLayer(t.id)},addImage:function(n){return e.addImage(t.id,n)},deleteImage:function(n){return e.deleteImage(t.id)}}})})),1)])],1)])]),n("div",{staticClass:"gis-geojson-rule__preview"},[e.previewImage?n("img",{attrs:{src:e.previewImage}}):e._e()])])},y=[],v=n("04be"),b=n("9953"),_=n.n(b),C={name:"GisGeoJsonRule",MODE_NORMAL:"normal",MODE_SELECT:"select",MODE_HOVER:"hover",components:{GisStyleItem:v["a"],DxSortable:u.a,DxSwitch:_.a},data:function(){return{activeMode:"normal",hoverEnableLocal:null}},props:{id:String,optionsFields:Object,isOptionsOpen:Boolean,hoverEnable:Boolean,subLayers:Array,selectionSubLayers:Array,hoverSubLayers:Array,isOpen:Boolean,filterFields:Array,layerType:String,dataFields:Array,previewImage:String,geomTypes:Array,popupContainer:null},computed:{hoverEnableComputed:function(){return null===this.hoverEnableLocal?this.hoverEnable:this.hoverEnableLocal},hoverButtonClass:function(){return{"gis-geojson-rule__mode-button-active":this.activeMode===this.$options.MODE_HOVER,"gis-geojson-rule__mode-button-disabled":!this.hoverEnableComputed}},ruleComponentOptions:function(){return{fields:this.optionsFields,filterFields:this.filterFields,layerType:this.layerType,id:this.id,isOpen:this.isOptionsOpen&&this.isOpen}},activeModeSubLayers:function(){switch(this.activeMode){case this.$options.MODE_HOVER:return this.hoverSubLayers;case this.$options.MODE_SELECT:return this.selectionSubLayers;default:return this.subLayers}}},watch:{subLayers:{handler:function(){this.$emit("styleChanged",this.id)},deep:!0,immediate:!0}},methods:{setActiveMode:function(e){this.activeMode=e},onHoverEnableClick:function(e){e.stopPropagation()},onHoverEnableChanged:function(e){this.hoverEnableLocal=e.value,this.$emit("hoverEnableChanged",e.value)},deleteSubLayer:function(e){this.$emit("deleteSubLayer",{ruleId:this.id,layerId:e})},addImage:function(e,t){var n={url:"".concat(t.url,"&_config_dataset=PAGES.DSPAGE"),name:t.name};this.$emit("addImage",{ruleId:this.id,layerId:e,image:n})},deleteImage:function(e){this.$emit("deleteImage",{ruleId:this.id,layerId:e})},saveRule:function(){this.$emit("savingRule",this.id)}}},x=C,O=(n("9341d"),n("2877")),I=Object(O["a"])(x,g,y,!1,null,null,null),S=I.exports,L=n("cfbd"),D=n("d34a"),P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"gis-auto-rule-popup",attrs:{animation:null,visible:e.visible,shading:!1,resizeEnabled:!0,width:480,height:"auto",container:e.popupContainer},on:{shown:e.onShown,hidden:function(t){return e.$emit("hidden")}},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:"Автоматическое создание правил",showCloseButton:!0},on:{closeClick:function(t){return e.$emit("hidden")}}})]},proxy:!0},{key:"toolbarButton",fn:function(){return[n("DxButton",{attrs:{text:"Применить",type:"success"},on:{click:e.apply}})]},proxy:!0}])},[n("div",{staticClass:"save-style-form__content"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Атрибут"}},[e._v("\n        Атрибут\n      ")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.attributes,displayExpr:e.displayExpr,searchEnabled:!0,searchExpr:["name","caption"],showClearButton:!0},on:{opened:e.selectBoxOpened},model:{value:e.selectedField,callback:function(t){e.selectedField=t},expression:"selectedField"}},[n("DxValidator",{attrs:{validationGroup:"autoRuleGroup"}},[n("DxValidationRule",{attrs:{type:"required",message:"Поле обязательно для заполнения"}})],1)],1)],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Разбиение"}},[e._v("\n        Разбиение\n      ")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.formulaItems,displayExpr:"name",valueExpr:"id",disabled:!e.selectedField||!e.NUMBER_TYPES.includes(this.selectedField.fieldtype_name)},on:{opened:e.selectBoxOpened},model:{value:e.formulaId,callback:function(t){e.formulaId=t},expression:"formulaId"}},[n("DxValidator",{attrs:{validationGroup:"autoRuleGroup"}},[n("DxValidationRule",{attrs:{type:"custom",validationCallback:e.numberValidationCallback}})],1)],1)],1)]),n("div",{staticClass:"gis-auto-rule-popup__wrapper"},[null!==e.formulaId?n("div",{staticClass:"gis-auto-rule-popup__field gis-auto-rule-popup__step"},[1===e.formulaId?n("div",{staticClass:"gis-auto-rule-popup__label",attrs:{title:"Шаг"}},[e._v("\n          Шаг\n        ")]):n("div",{staticClass:"gis-auto-rule-popup__label",attrs:{title:"Количество классов"}},[e._v("\n          Количество классов\n        ")]),n("div",{staticClass:"gis-auto-rule-popup__value gis-auto-rule-popup__number-box"},[n("DxNumberBox",{attrs:{disabled:!e.selectedField||!e.NUMBER_TYPES.includes(this.selectedField.fieldtype_name),min:0},model:{value:e.step,callback:function(t){e.step=t},expression:"step"}},[n("DxValidator",{attrs:{validationGroup:"autoRuleGroup"}},[n("DxValidationRule",{attrs:{type:"custom",validationCallback:e.numberValidationCallback}})],1)],1)],1)]):e._e(),n("div",{staticClass:"gis-auto-rule-popup__field"},[n("div",{staticClass:"gis-auto-rule-popup__label",attrs:{title:"Палитра"}},[e._v("\n          Палитра\n        ")]),n("div",{staticClass:"gis-auto-rule-popup__value"},[n("DxSelectBox",{attrs:{dataSource:e.paletteItems,displayExpr:"name",valueExpr:"id",searchEnabled:!1,showClearButton:!0,itemTemplate:"palette",fieldTemplate:"field"},on:{opened:e.selectBoxOpened},scopedSlots:e._u([{key:"field",fn:function(t){var i=t.data;return[n("div",{attrs:{title:i?i.name:null}},[i?n("div",{staticClass:"gis-auto-rule-popup__field-palette"},e._l(i.colors,(function(e){return n("div",{staticClass:"gis-auto-rule-popup__color",style:{backgroundColor:e,width:100/i.colors.length+"%"}})})),0):e._e(),n("DxTextBox",{staticClass:"gis-auto-rule-popup__palette-text-box",attrs:{value:i?i.name:null,readOnly:!0}})],1)]}},{key:"palette",fn:function(t){var i=t.data;return[n("div",[n("div",{staticClass:"gis-auto-rule-popup__palette-wrapper",attrs:{title:i.name}},e._l(i.colors,(function(e){return n("div",{staticClass:"gis-auto-rule-popup__color",style:{backgroundColor:e,width:100/i.colors.length+"%"}})})),0)])]}}]),model:{value:e.paletteId,callback:function(t){e.paletteId=t},expression:"paletteId"}},[n("DxValidator",{attrs:{validationGroup:"autoRuleGroup"}},[n("DxValidationRule",{attrs:{type:"required",message:"Поле обязательно для заполнения"}})],1)],1)],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Тип геометрии"}},[e._v("\n        Тип геометрии\n      ")]),n("div",{staticClass:"dx-field-value"},[n("GisToolbarButtonGroup",e._l(e.geomTypeItems,(function(t){return n("GisToolbarButton",{key:t.name,staticClass:"gis-auto-rule-popup__button",attrs:{text:t.text,active:t.active,iconCss:t.icon,disabled:t.disabled},on:{click:function(n){e.geomType=t.name}}})})),1)],1)])]),n("DxToolbarItem",{attrs:{toolbar:"bottom",location:"center",template:"toolbarButton"}})],1)},E=[],w=n("2f62"),T=n("9841"),j=n("eec1"),k=n("c22f"),F=n("d736"),B=n("6191"),M=n.n(B),A=n("049d"),R=n.n(A),V=n("25aa"),G=n("7ea3"),$=n.n(G),N=n("0db8"),U=n("bf8c"),z=n("4fac"),H=n("5c46");function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){Object(r["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var q=["timestamp without time zone","timestamp"],J=["bigint","integer","numeric","double precision"],Z=[{name:"circle",text:"Точка",icon:"core core-add-point"},{name:"line",text:"Линия",icon:"core core-094-line"},{name:"fill",text:"Полигон",icon:"core core-034-add-poly-2"}],Y={circle:"Point",line:"Line",fill:"Polygon"},X="CONFIG.DSFORMULA",Q="CONFIG.DSPALETTE",ee="CONFIG.PRGENERATIONLAYERRULES",te={name:"GisAutoRulePopup",mixins:[H["a"]],components:{DxPopup:F["DxPopup"],PopupTitleTemplate:V["a"],DxToolbarItem:F["DxToolbarItem"],DxButton:M.a,DxSelectBox:R.a,DxNumberBox:$.a,GisToolbarButton:m["a"],GisToolbarButtonGroup:h["a"],DxValidator:N["DxValidator"],DxValidationRule:N["DxValidationRule"]},props:{visible:Boolean,layerComponentId:String,popupContainer:null},data:function(){return{NUMBER_TYPES:J,selectedField:null,formulaId:null,step:null,paletteId:null,geomType:null,formulaItems:[],paletteItems:[],fields:[]}},computed:K(K({},Object(w["c"])("config",{getDataSetName:j["m"],getOptions:k["c"]})),{},{dataSetName:function(){return this.getDataSetName(this.layerComponentId)},geomTypes:function(){return this.getOptions(this.layerComponentId).geomTypes},attributes:function(){return this.fields?this.fields.filter((function(e){return e.is_visiblefilter&&!q.includes(e.fieldtype_name)})):[]},geomTypeItems:function(){var e=this;return Z.map((function(t){return K(K({},t),{},{active:e.geomType===t.name,disabled:!(!e.geomTypes||!e.geomTypes.length)&&!e.geomTypes.includes(Y[t.name])})}))}}),methods:K(K({},Object(w["b"])("config",{loadDataFields:T["r"]})),{},{onShown:function(){var e=this;this.getDataSources(),this.setGeomType(),this.loadDataFields({layerComponentId:this.layerComponentId}).then((function(t){e.fields=t})),this.$emit("shown")},getDataSources:function(){var e=this;this.formulaItems.length||Object(U["c"])("getData",{_config_dataset:X}).then((function(t){e.formulaItems=t,e.formulaId=t[0].id})),this.paletteItems.length||Object(U["c"])("getData",{_config_dataset:Q}).then((function(t){e.paletteItems=t}))},setGeomType:function(){this.geomType=this.geomTypeItems.find((function(e){return!e.disabled})).name},apply:function(){var e=z["a"].getGroupConfig("autoRuleGroup");if(e){var t=e.validate();if(!t.isValid)return}var n={_config_dataset:ee,connection_dataset_code:this.dataSetName,component_id:+this.layerComponentId,fieldname:this.selectedField.name,palette_id:this.paletteId,geomtype:this.geomType};this.selectedField.is_dictionary?(n.formula_id=0,n.dir_code=this.selectedField.dictionary_dataset_code):J.includes(this.selectedField.fieldtype_name)?(n.step=this.step,n.formula_id=this.formulaId):n.formula_id=4;var i=Object(U["c"])("getData",n);this.$emit("apply",i)},displayExpr:function(e){if(e)return e.caption||e.name},numberValidationCallback:function(e){var t=e.value;return t&&J.includes(this.selectedField.fieldtype_name)}})},ne=te,ie=(n("b905"),Object(O["a"])(ne,P,E,!1,null,null,null)),oe=ie.exports,ae=n("e192"),se=n.n(ae),re=(n("ac6d"),n("7e8b")),le=n("bc56"),ce=n("f2e7");function de(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?de(Object(n),!0).forEach((function(t){Object(r["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var pe={data:function(){return{mapboxItems:[],mapbox:null,mapBoxReady:null,isMapBusy:!1}},computed:{imagesArray:function(){return[].concat(Object(s["a"])(this.rules.map((function(e){return e.images})).flat()),Object(s["a"])(this.layersImages))}},watch:{imagesArray:function(){this.loadImages(this.imagesArray)}},beforeDestroy:function(){this.removeMapPreview()},methods:{getLayersForPreview:function(e){var t=this,n=[];return e.forEach((function(e){var i={id:e.id,source:t.source,type:e.type,paint:ue({},e.options.paint),layout:ue({},e.options.layout)};switch(e.type){case"text":i.layout["text-field"]=t.getLayerText(i.layout["text-field"]),i.type="symbol";break;case"image":i.type="symbol";break}if(e.options.geometry&&e.options.geometry.length){var o=e.options.geometry.map((function(e){return"Line"===e?"LineString":e}));i.filter=["match",["geometry-type"],o,!0,!1]}Object(le["a"])(i),n.push(i)})),Object(ce["a"])(n)},initMapPreview:function(e){var t=this;this.mapbox||(this.mapbox=new se.a.Map({container:this.$refs.mapContainer,center:[132.4976,43.59935],preserveDrawingBuffer:!0,zoom:9.5,style:{version:8,sources:{},layers:[],glyphs:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"}}),this.loadImages(this.imagesArray),this.mapBoxReady=this.getPreviewReadyPromise(),this.mapbox.on("load",(function(){t.mapbox.addSource(t.source,{type:"geojson",data:re["a"]}),t.repaintLayersOnMapPreview(e)})))},getPreviewReadyPromise:function(){var e=this,t=null;return new Promise((function(n){t=function(){e.isImagesLoaded(e.imagesArray)&&n()},e.mapbox.on("idle",t)})).then((function(){e.mapbox.off("idle",t)}))},removeMapPreview:function(){this.mapbox&&(this.mapbox.remove(),this.mapbox=null)},repaintLayersOnMapPreview:function(e){var t=this;this.mapBoxReady=this.getPreviewReadyPromise(),e.filter((function(e){return"chart"!==e.type})).forEach((function(e){t.mapbox.getLayer(e.id)&&t.mapbox.removeLayer(e.id),t.mapbox.addLayer(e)}))},deleteLayer:function(e){this.mapbox.getLayer(e)&&this.mapbox.removeLayer(e);var t="".concat(e,"_stroke");this.mapbox.getLayer(t)&&this.mapbox.removeLayer(t)},getLayerText:function(e){return"string"===typeof e?e:Array.isArray(e)?"concat"===e[0]?e.slice(1).map((function(e){return Array.isArray(e)?"[".concat(e[1],"]"):e})).join(""):"[".concat(e[1],"]"):""},loadImages:function(e){var t=this;this.mapbox&&e.forEach((function(e){t.mapbox.loadImage(e.url,(function(n,i){i&&(n?window.console.error(n):t.mapbox.hasImage(e.name)||t.mapbox.addImage(e.name,i))}))}))},isImagesLoaded:function(e){var t=this;return e.every((function(e){return t.mapbox.hasImage(e.name)}))},makeScreenShot:function(e,t){var n=this,i=!0;this.mapbox?this.repaintLayersOnMapPreview(e):(i=!1,this.initMapPreview(e)),this.mapBoxReady.then((function(){n.mapbox.getCanvas().toBlob(t),e.forEach((function(e){return n.deleteLayer(e.id)})),i||n.removeMapPreview()}))},getScreenShotUrl:function(e){var t=this;return this.isMapBusy?this.mapBoxReady.then((function(){return t.getScreenShotUrl(e)})):(this.isMapBusy=!0,this.mapbox?this.repaintLayersOnMapPreview(e):this.initMapPreview(e),this.mapBoxReady.then((function(){var n=t.mapbox.getCanvas().toDataURL();return e.forEach((function(e){return t.deleteLayer(e.id)})),t.isMapBusy=!1,n})))}}},fe=(n("28a5"),n("d4ec")),he=n("bee2"),me=n("a045"),ge=n("6ad3"),ye=n("f135"),ve=n("6e35");function be(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_e(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function _e(e,t){if(e){if("string"===typeof e)return Ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ce(e,t):void 0}}function Ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(n),!0).forEach((function(t){Object(r["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ie={circle:["Point"],line:["Line"],fill:["Polygon"],image:["Point"],text:["Polygon","Line","Point"],chart:["Marker","Point","Line","Polygon"]},Se=function(){function e(){Object(fe["a"])(this,e)}return Object(he["a"])(e,null,[{key:"getHierarchicalArcgisRules",value:function(e){var t=this;if(e.url.includes("https://pkk.rosreestr.ru"))return Promise.resolve([]);var n="".concat(e.url,"legend?f=pjson"),i=fetch("".concat("https://proxy.rusgis.com/proxy","?url=").concat(n)).then((function(e){return e.json()}));n="".concat(e.url,"layers?f=pjson");var o=fetch("".concat("https://proxy.rusgis.com/proxy","?url=").concat(n)).then((function(e){return e.json()}));return Promise.all([i,o]).then((function(n){return n[0].layers?n[0].layers?t._parseArcgisLegendResponse(n[0],n[1],e.layers):(window.console.log("Layers Info not loaded: "+e.url),[]):(window.console.log("Legends Info not loaded: "+e.url),[])}))}},{key:"getHierarchicalRules",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=arguments.length>5?arguments[5]:void 0,s=this.classifyLayers(e),r=this.classifyLayers(t),l=this.classifyLayers(n);return this.generateRules(s,r,l,i,o,a)}},{key:"classifyLayers",value:function(e){var t=this,n={};return e.forEach((function(e){e.name?t.pushObject(n,e.name,e):e["source-layer"]?t.pushObject(n,e["source-layer"],Oe(Oe({},e),{},{name:e["source-layer"]})):t.pushObject(n,"default",Oe(Oe({},e),{},{name:"default"}))})),n}},{key:"pushObject",value:function(e,t,n){e[t]&&Array.isArray(e[t])?e[t].push(n):e[t]=[n]}},{key:"generateRules",value:function(e,t,n,i,o,s){var r=this,l=[];return Object.entries(e).forEach((function(e,c){var d=Object(a["a"])(e,2),u=d[0],p=d[1],f=[],h={isOpen:!1,isOptionsOpen:!0,id:u,previewImage:null,filterId:p[0].filterId||null,options:{caption:p[0].caption||"Правило ".concat(c+1),filter:p[0].filter,maxzoom:p[0].maxzoom,minzoom:p[0].minzoom,visible:!0},subLayers:[],selectionSubLayers:[],hoverSubLayers:[]};p.forEach((function(e,t){var n=r.getSubLayer(e,"".concat(u,"_").concat(t),s,o,f);n&&h.subLayers.push(n)}));var m=t[u]||[];m.forEach((function(e,t){var n=r.getSubLayer(e,"".concat(u,"_").concat(t),s,o,f);n&&h.selectionSubLayers.push(n)}));var g=n[u]||[];g.forEach((function(e,t){var n=r.getSubLayer(e,"".concat(u,"_").concat(t),s,o,f);n&&(h.hoverEnable=h.hoverEnable||e.enabled,h.hoverSubLayers.push(n))})),h.subLayers.forEach((function(e){if(!["chart","text","heatmap"].includes(e.type)){var t=r.getFilterGeometries(e);if(!t||!r.layersHasGeometries(h.selectionSubLayers,t)){var n="".concat(u,"_").concat(h.selectionSubLayers.length),i=r.getSelectionSubLayer(n,e,ve["c"],o,f);h.selectionSubLayers.push(i)}if(!t||!r.layersHasGeometries(h.hoverSubLayers,t)){var a="".concat(u,"_").concat(h.hoverSubLayers.length),s=r.getSelectionSubLayer(a,e,ve["b"],o,f);h.hoverSubLayers.push(s)}}})),h.subLayers.length&&(h.images=f,i&&p[0]["source-layer"]&&(h.options["source-layer"]=p[0]["source-layer"]),l.push(h))})),l}},{key:"getType",value:function(e){var t=e.type,n=null;return"symbol"===t&&(e.layout["icon-image"]?(t="image",n=e.layout["icon-image"]):t="text"),"fill"===t&&e.paint["fill-pattern"]&&(n=e.paint["fill-pattern"]),{type:t,imageName:n}}},{key:"getSubLayer",value:function(e,t,n,i,o){var a=this.getType(e),s=a.type,r=a.imageName;if(n&&n.length&&Ie[s].every((function(e){return!n.includes(e)})))return null;var l=Oe(Oe({},ge["e"][s]),{},{id:t,type:s,options:{timeStamp:e.timeStamp,paint:Oe(Oe({},(ge["l"][s]||{}).paint),Object(me["a"])(e.paint)||{}),layout:Oe(Oe({},(ge["l"][s]||{}).layout),Object(me["a"])(e.layout)||{}),geometry:e.geometry||n||null},isOpen:!1});if(r){var c=i.find((function(e){return e.name===r}));c&&(l.options.iconUrl=c.url,o.push(c))}return l}},{key:"getSelectionSubLayer",value:function(e,t,n,i,o){var a=t.type;"image"===a&&(a="circle");var s=n[a],r=this.getType(s),l=r.type,c=r.imageName,d=Oe(Oe({},ge["e"][a]),{},{id:e,type:l,options:{timeStamp:s.timeStamp,paint:Oe(Oe({},(ge["l"][l]||{}).paint),Object(me["a"])(s.paint)||{}),layout:Oe(Oe({},(ge["l"][l]||{}).layout),Object(me["a"])(s.layout)||{}),geometry:s.geometry||t.options.geometry},isOpen:!1});if(c){var u=i.find((function(e){return e.name===c}));u&&(d.options.iconUrl=u.url,o.push(u))}return d}},{key:"getFilterGeometries",value:function(e){return e.options.geometry}},{key:"layersHasGeometries",value:function(e,t){var n,i=this,o=0,a=be(t);try{var s=function(){var t=n.value;e.filter((function(e){return!["text","chart"].includes(e.type)})).forEach((function(e){var n=e.options.geometry&&e.options.geometry.includes(t);n=n||t===i.getSublayerDefaultGeometry(e.type),n&&o++}))};for(a.s();!(n=a.n()).done;)s()}catch(r){a.e(r)}finally{a.f()}return o>=t.length}},{key:"getSublayerDefaultGeometry",value:function(e){switch(e){case"line":return"LineString";case"fill":return"Polygon";case"circle":return"Point";default:throw"Неизвестный тип геометрии"}}},{key:"getHierarchicalWmsRules",value:function(e){if(!e.wmsUrl)return[];var t=e.tooltipIconUrl||null,n=e.iconUrl||null;if(n){var i={id:e.layers,options:{showVisibleButton:!1,caption:e.text,iconUrl:n,tooltipIconUrl:t||n}};return[i]}var o=e.titles||[],a=(e.layers||"").split(",");return a.map((function(t,n){return{id:t,options:{showVisibleButton:!1,caption:o[n]||t,iconUrl:Object(ye["a"])(e,null,t),tooltipIconUrl:Object(ye["a"])(e,e.iconUrlRule,t)}}}))}},{key:"getLegendIcons",value:function(e){var t=e.tooltipIconUrl||null,n=e.iconUrl||null;if(n){var i={options:{showVisibleButton:!1,caption:e.text,iconUrl:n,tooltipIconUrl:t||n}};return[i]}return[]}},{key:"_parseArcgisLegendResponse",value:function(e,t,n){var i,o=this,a=n.replace("show:","").split(","),s=[],r=be(e.layers);try{var l=function(){var e=i.value;if(o._isArcgisLayerVisible(e.layerId,a,t))if(e.legend.length>1){var n={options:{showVisibleButton:!1,caption:e.layerName,iconCss:"core core-extern-layer",items:e.legend.map((function(t){return{options:{caption:t.label||e.layerName,iconUrl:"data:".concat(t.contentType,";base64,").concat(t.imageData)}}}))}};s.push(n)}else{var r,l=be(e.legend);try{for(l.s();!(r=l.n()).done;){var c=r.value,d={options:{showVisibleButton:!1,caption:c.label||e.layerName,iconUrl:"data:".concat(c.contentType,";base64,").concat(c.imageData)}};s.push(d)}}catch(u){l.e(u)}finally{l.f()}}};for(r.s();!(i=r.n()).done;)l()}catch(c){r.e(c)}finally{r.f()}return s}},{key:"_isArcgisLayerVisible",value:function(e,t,n){var i=t.includes(e.toString());if(!i){var o=this._findArcgisParentsForLayer(n.layers,e);i=o.some((function(e){return t.includes(e.toString())}))}return i}},{key:"_findArcgisParentsForLayer",value:function(e,t){var n,i=[],o=be(e);try{for(o.s();!(n=o.n()).done;){var a=n.value;if(a.id.toString()===t.toString()){i=[a.id.toString()];break}if(a.subLayers&&a.subLayers[0]){var r=this._findArcgisParentsForLayer(a.subLayers,t);if(r[0]){i=[].concat(Object(s["a"])(r),[a.id.toString()]);break}}}}catch(l){o.e(l)}finally{o.f()}return i}}]),e}(),Le=n("cbd3"),De=n("520c");function Pe(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Ee(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function Ee(e,t){if(e){if("string"===typeof e)return we(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?we(e,t):void 0}}function we(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function je(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(n),!0).forEach((function(t){Object(r["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ke="datetime:",Fe={Polygon:"Полигон",Line:"Линия",Point:"Точка"},Be={circle:["Point"],line:["Line"],fill:["Polygon"],image:["Point"],text:["Polygon","Line","Point"],chart:["Polygon","Line","Point"]},Me=[{name:"circle",text:"Добавить слой с кругом",icon:"core core-112-circle",geomTypes:Be.circle},{name:"line",text:"Добавить слой с линией",icon:"core core-094-line",geomTypes:Be.line},{name:"fill",text:"Добавить слой с полигоном",icon:"core core-034-add-poly-2",geomTypes:Be.fill},{name:"image",text:"Добавить слой с изображением",icon:"core core-053-image",geomTypes:Be.image},{name:"text",text:"Добавить слой с подписью",icon:"core core-113-text",geomTypes:Be.text},{name:"chart",text:"Добавить слой с картограммой",icon:"core core-pie",geomTypes:Be.chart}],Ae={name:"GisGeoJsonStyle",mixins:[pe],components:{DxScrollView:c.a,DxSortable:u.a,DxLoadPanel:f.a,GisToolbarButtonGroup:h["a"],GisToolbarButton:m["a"],GisGeoJsonRule:S,StyleListPopup:L["a"],SaveStyleForm:D["a"],GisAutoRulePopup:oe},props:{layerType:String,layers:Array,selectionLayers:Array,hoverLayers:Array,hoverEnable:Boolean,filterFields:Array,dataFields:Array,layerName:String,dataset:String,layersImages:Array,layerComponentId:String,geomTypes:Array,popupContainer:null},data:function(){return{rules:[],totalLayerIndex:this.layers.length,loadIndicatorOptions:{visible:!1,container:".gis-geojson-style",position:{at:"center",my:"center",of:".gis-geojson-style"}},styleListOptions:{visible:!1,styleType:null,geomTypes:this.geomTypes,popupContainer:this.popupContainer,title:""},saveStylePopupOptions:{visible:!1,name:"",title:"",styleType:null,styleBody:null,popupContainer:this.popupContainer},autoRulePopupVisible:!1,images:{},deletedFilterIds:[],previewForSave:null,editingRuleId:null,source:"stylePreview"}},computed:{geometryTypes:function(){return this.geomTypes?this.geomTypes.map((function(e){return{value:e,text:Fe[e]}})):ge["f"]},sublayerButtons:function(){var e=this;return Me.map((function(t,n){var i=!e.rules.length;return!i&&e.geomTypes&&e.geomTypes.length&&(i=t.geomTypes.every((function(t){return!e.geomTypes.includes(t)}))),{disabled:i,active:!1,first:!1,last:n===Me.length-1,iconCss:t.icon,text:t.text,name:t.name}}))},userId:function(){var e=this.$store.getters["session/userData"];return e.userId||"500322"}},watch:{layers:{handler:function(){var e=this;this.loadIndicatorOptions.visible=!0;var t=Se.getHierarchicalRules(this.layers,this.selectionLayers,this.hoverLayers,"vector"===this.layerType,this.layersImages,this.geomTypes);$e(t,this.dataset).then((function(){t.length&&(t[0].isOpen=!0),e.rules=t,e.loadIndicatorOptions.visible=!1}))},immediate:!0}},mounted:function(){this.$emit("loaded")},methods:{repaintPreview:function(e){var t=this.rules.find((function(t){return t.id===e})),n=this.getLayersForPreview(t.subLayers);this.getScreenShotUrl(n).then((function(e){t.previewImage=e}))},toggleRule:function(e){var t=e.id,n=e.isOpen;this.rules.forEach((function(e){e.id===t?e.isOpen=n:n&&(e.isOpen=!n)}))},toggleOptions:function(e){var t=e.id,n=e.isOpen,i=this.rules.find((function(e){return e.id===t}));i.isOptionsOpen=n},showDialog:function(){var e=this,t="Вы действительно хотите удалить все правила стиля?",n=Object(De["c"])({title:"Удаление правил",messageHtml:'<div style="font-size:16px;padding: 0 40px;">'.concat(t,"</div>"),buttons:[{text:"Удалить",type:"success",onClick:function(){e.deleteStyle()}},{text:"Отменить"}]});n.show()},deleteStyle:function(){var e=this;this.rules.forEach((function(t){t.filterId&&!e.deletedFilterIds.includes(t.filterId)&&e.deletedFilterIds.push(t.filterId)})),this.images={},this.rules=[],this.addRule()},deleteRule:function(e){var t=this,n=this.rules.findIndex((function(t){return t.id===e})),i=this.rules.splice(n,1)[0];i.filterId&&this.deletedFilterIds.push(i.filterId),i.subLayers.forEach((function(e){delete t.images[e.id]}))},deleteSubLayer:function(e){var t=e.ruleId,n=e.layerId,i=this.rules.find((function(e){return e.id===t})),o=this.$refs["rule_".concat(i.id)][0],a=o.activeModeSubLayers,s=a.findIndex((function(e){return e.id===n}));a.splice(s,1);var r=this.images[n];if(r){delete this.images[n];var l=i.images.findIndex((function(e){return e.name===r.name}));i.images.splice(l,1)}},addRule:function(){var e={isOpen:!0,isOptionsOpen:!0,id:"new_".concat(this.totalLayerIndex),images:[],previewImage:null,options:{caption:"Новое правило",maxzoom:24,minzoom:3,filter:null},subLayers:[],selectionSubLayers:[],hoverSubLayers:[]};if("vector"===this.layerType){var t=this.rules.find((function(e){return e.options["source-layer"]}));e.options["source-layer"]=t?t.options["source-layer"]:this.dataset||null}this.totalLayerIndex++,this.rules.forEach((function(e){return e.isOpen=!1})),this.rules.push(e);var n=this.sublayerButtons.find((function(e){return!e.disabled})).name;this.addLayerToRule(n,e,e.subLayers)},addLayerToRule:function(e,t,n){var i=je(je({},Object(me["a"])(ge["e"][e])),{},{type:e,id:"".concat(t.id,"_").concat(this.totalLayerIndex)});i.options.geometry||(i.options.geometry=this.geomTypes),n.push(i),this.totalLayerIndex++},onAddLayerClick:function(e){var t=this.rules.find((function(e){return e.isOpen}));t||(t=this.rules[0],t.isOpen=!0);var n=this.$refs["rule_".concat(t.id)][0];"chart"===e&&n.activeMode!==n.$options.MODE_NORMAL||this.addLayerToRule(e,t,n.activeModeSubLayers)},reorderRule:function(e){var t=e.fromIndex,n=e.toIndex,i=this.rules.splice(t,1)[0];this.rules.splice(n,0,i)},reorderSubLayer:function(e){var t=e.ruleId,n=e.eventData,i=n.fromIndex,o=n.toIndex,a=this.rules.find((function(e){return e.id===t})),s=a.subLayers.splice(i,1)[0];a.subLayers.splice(o,0,s)},saveStyle:function(){var e=this;this.validateRules().then((function(t){if(t){e.loadIndicatorOptions.visible=!0;var n=e.rules.map((function(e){return e.subLayers})).flat(),i=e.getLayersForPreview(n);e.makeScreenShot(i,(function(t){e.previewForSave=t,e.saveStylePopupOptions.styleType=2,e.saveStylePopupOptions.name=e.layerName,e.saveStylePopupOptions.title="Сохранить набор правил «".concat(e.layerName||"","»"),e.saveStylePopupOptions.styleBody=e.getReestrLayers(e.rules),e.saveStylePopupOptions.visible=!0,e.loadIndicatorOptions.visible=!1}))}}))},saveRule:function(e){var t=this;this.loadIndicatorOptions.visible=!0;var n=this.rules.find((function(t){return t.id===e})),i=this.getLayersForPreview(n.subLayers);this.makeScreenShot(i,(function(e){t.previewForSave=e,t.saveStylePopupOptions.styleType=3,t.saveStylePopupOptions.name=n.options.caption,t.saveStylePopupOptions.title="Сохранить стиль «".concat(n.options.caption||"Правило","»"),t.saveStylePopupOptions.styleBody=t.getReestrLayers([n]),t.saveStylePopupOptions.visible=!0,t.loadIndicatorOptions.visible=!1}))},styleSaved:function(e){if(this.saveStylePopupOptions.visible=!1,this.previewForSave){var t=e[0].name,n=e[0].guid;this.uploadPreviewFile(this.previewForSave,t,n),this.previewForSave=null}},openStyleList:function(e,t){this.styleListOptions.visible||(this.styleListOptions.visible=!0,this.styleListOptions.styleType=e,this.styleListOptions.title=t?"Выбрать правило":"Выбрать набор правил",this.editingRuleId=t||null)},insertStyleFromList:function(e){this.styleListOptions.visible=!1;var t=JSON.parse(e.replace(/\\/g,"")),n=t.layers,i=t.images,o=Se.getHierarchicalRules(n,this.selectionLayers,this.hoverLayers,"vector"===this.layerType,i||[],this.geomTypes),a=0;if(o.forEach((function(e){return a+=e.subLayers.length})),a){if(n.length>a&&Object(Le["a"])({message:"Стиль был адаптировать для данного слоя",width:"auto"},"success",3e3),null!==this.editingRuleId)return this.addSubLayersFromList(o[0],i||[]),void(this.editingRuleId=null);this.addListLayers(o,i||[])}else Object(Le["a"])({message:"Стиль нельзя применить к данному слою",width:"auto"},"warning",3e3)},addListLayers:function(e,t){var n=this,i=this.rules.length;this.images={},e.forEach((function(e,o){e.id="new_".concat(n.totalLayerIndex),e.isOpen=0===o,e.options.filter=Object(le["b"])(e.options.filter,n.filterFields),n.totalLayerIndex++,e.subLayers.forEach((function(i){i.id="".concat(e.id,"_").concat(n.totalLayerIndex),n.totalLayerIndex++;var o=null;i.options.paint&&i.options.paint["fill-pattern"]&&(o=i.options.paint["fill-pattern"]),i.options.layout&&i.options.layout["icon-image"]&&(o=i.options.layout["icon-image"]),o&&(n.images[i.id]=t.find((function(e){return e.name===o})))})),"vector"===n.layerType&&(e.options["source-layer"]=i?n.rules[o%i].options["source-layer"]||n.dataset||null:n.dataset||null)})),this.rules=e},addSubLayersFromList:function(e,t){var n=this,i=this.rules.findIndex((function(e){return e.id===n.editingRuleId})),o=this.rules[i],a="new_".concat(e.id),s=e.subLayers.map((function(e){e.id="".concat(a,"_").concat(n.totalLayerIndex),n.totalLayerIndex++;var i=null;return e.options.paint&&e.options.paint["fill-pattern"]&&(i=e.options.paint["fill-pattern"]),e.options.layout&&e.options.layout["icon-image"]&&(i=e.options.layout["icon-image"]),i&&(n.images[e.id]=t.find((function(e){return e.name===i}))),e})),r=je(je({},o),{},{id:a,subLayers:s,images:e.images}),l=this.rules.splice(i,1,r)[0];l.subLayers.forEach((function(e){delete n.images[e.id]})),this.toggleRule({id:a,isOpen:!0})},getReestrLayers:function(e){var t=[],n=[];return e.forEach((function(e){n.push.apply(n,Object(s["a"])(e.images)),e.subLayers.forEach((function(n){var i=n.type;["text","image"].includes(i)&&(i="symbol");var o=je(je(je({type:i},Object(me["a"])(e.options)),Object(me["a"])(n.options)),{},{name:e.id,filterId:null});Object(le["a"])(o),t.push(o)}))})),{layers:t,geomTypes:this.geomTypes,images:n}},getLayersStyles:function(){var e=this;return this.loadIndicatorOptions.visible=!0,Ne(this.rules,this.dataset).then((function(t){var n=[],i=[],o=[],a=!1,s=!1;return e.rules.forEach((function(e){a=a||Re(e.selectionSubLayers,ve["c"]),s=s||e.hoverEnable||Re(e.hoverSubLayers,ve["b"])})),e.rules.forEach((function(r,l){var c=t.find((function(e){return r.id===e.name}));!c&&r.filterId&&(e.deletedFilterIds.push(r.filterId),r.filterId=null),r.subLayers.forEach((function(e){n.push(Ge(r,l,e,c))})),a&&r.selectionSubLayers.forEach((function(e){i.push(Ge(r,l,e,c))})),s&&r.hoverSubLayers.forEach((function(e){var t=Ge(r,l,e,c);t.enabled=r.hoverEnable,o.push(t)}))})),Ue(e.deletedFilterIds,e.dataset),e.loadIndicatorOptions.visible=!1,{layers:n,selectionLayers:i,hoverLayers:o}}))},validateRules:function(){var e=this;return new Promise((function(t){var n=z["a"].getGroupConfig("ruleOptions");if(n){var i=n.validate();if(e.rules.forEach((function(e){e.subLayers.forEach((function(e){e.options.timeStamp=(new Date).getTime()}))})),i.isValid)t(!0);else{e.rules.forEach((function(e){return e.isOpen=!1}));var o=i.brokenRules[0],a=e.rules.find((function(e){return e.id===o.id}));a.isOpen=!0,a.isOptionsOpen=!0,setTimeout((function(){e.scrollToRule(a.id)}),100),t(!1)}}}))},addImage:function(e){var t=e.ruleId,n=e.layerId,i=e.image;this.images[n]=i;var o=this.rules.find((function(e){return e.id===t}));o.images.push(i)},deleteImage:function(e){var t=e.ruleId,n=e.layerId,i=this.images[n];delete this.images[n];var o=this.rules.find((function(e){return e.id===t})),a=o.images.findIndex((function(e){return e.name===i.name}));o.images.splice(a,1)},getImages:function(){return this.images},scrollToRule:function(e){var t=this.$refs.scroll.instance,n=this.$refs["rule_".concat(e)][0].$el;t.scrollToElement(n)},addAutoRules:function(e){var t=this;this.autoRulePopupVisible=!1,this.loadIndicatorOptions.visible=!0;var n=this.rules.length;e.then((function(e){var i=e.map((function(e,t){var n={name:e.name||"rule_".concat(t),caption:e.caption||"Правило ".concat(t+1),filter:JSON.parse(e.filter),type:e.geomtype,minzoom:0,maxzoom:24,paint:je(je({},ge["e"][e.geomtype].options.paint),{},Object(r["a"])({},"".concat(e.geomtype,"-color"),e.color)),layout:{},geometry:ge["e"][e.geomtype].options.geometry};return"circle"===n.type&&(n.paint["circle-stroke-color"]=e.color,n.paint["circle-opacity"]=.5),"fill"===n.type&&(n.paint["line-color"]=e.color,n.paint["fill-opacity"]=.5),n})),o=Se.getHierarchicalRules(i,[],[],"vector"===t.layerType);o.forEach((function(e,i){e.id="".concat(e.id,"_").concat(t.totalLayerIndex),e.isOpen=0===i,t.totalLayerIndex++,"vector"===t.layerType&&n&&(e.options["source-layer"]=n?t.rules[i%n].options["source-layer"]||t.dataset||null:t.dataset||null)})),t.rules=o})).catch((function(){Object(Le["a"])({message:"Ошибка выполнения запроса",width:"auto"},"error",3e3)})).finally((function(){t.loadIndicatorOptions.visible=!1}))},uploadPreviewFile:function(e,t,n){var i=new FormData;i.append("files[]",new File([e],t+".png"));var o={guid_link:n,_config_dataset:"PAGE.DSPAGE",_config_user_id:this.userId,name:t,extension:"png"};return i.append("param",JSON.stringify(o)),fetch("https://files-service.rusgis.com/uploadFile",{method:"POST",body:i}).then((function(e){return e.json()}))}}};function Re(e,t){var n,i=!1,o=Pe(e);try{for(o.s();!(n=o.n()).done;){var a=n.value,s=t[a.type];i=!s||(i||Ve(a.options.paint)!==Ve(s.paint))}}catch(r){o.e(r)}finally{o.f()}return i}function Ve(e){for(var t="",n=0,i=Object.entries(e);n<i.length;n++){var o=Object(a["a"])(i[n],2),s=o[0],r=o[1];null!==r&&(t+=s+"="+r+",")}return t}function Ge(e,t,n,i){var o=n.type;["text","image"].includes(o)&&(o="symbol");var a=je(je({type:o,name:"rule_".concat(t)},Object(me["a"])(e.options)),Object(me["a"])(n.options));return i&&(a.filter=i.value,a.filterId=i.id),Object(le["a"])(a),a}function $e(e,t){var n=[];if(e.forEach((function(e){e.filterId&&n.push(["id","=",e.filterId],"or")})),!n.length)return Promise.resolve();var i={dataset:t,_config_dataset:"CONFIG.DSFILTER",filtergroup_id:2,where:n};return Object(U["c"])("getData",i).then((function(t){e.forEach((function(e){var n=t.find((function(t){return e.filterId===t.id}));if(!n)return e.options.filter=null,void(e.filterId=null);var i=JSON.parse(n.body.replace(/\\"/g,'"'));e.options.filter=He(i)}))}))}function Ne(e,t){var n=[],i=[];if(e.filter((function(e){return e.options.filter})).forEach((function(e){n.push({dataset:t,_config_dataset:"CONFIG.DSFILTER",filtergroup_id:2,body:JSON.stringify(e.options.filter,ze),name:e.id,id:e.filterId});var o=e.options.filter.map((function(e){return e instanceof Date?new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds())):e}));i.push({_config_dataset:"CONNECTIONS.PRFILTERMAPBOX",filter:o})})),!n.length)return new Promise((function(e){return e([])}));var o=[];return o.push(Object(U["c"])("updateData",n)),o.push(Object(U["c"])("updateData",i)),Promise.all(o).then((function(e){var t=e[0].map((function(t,n){return je(je({},t),e[1][n])}));return t.map((function(e){return{name:e.name,id:e.id,value:e.r_filter1}}))}))}function Ue(e,t){if(e.length){var n=e.map((function(e){return{dataset:t,id:e,_config_dataset:"CONFIG.DSFILTER"}}));Object(U["c"])("deleteData",n)}}function ze(e,t){return this[e]instanceof Date?"".concat(ke).concat(t):t}function He(e){return Array.isArray(e)?e.map((function(e){return He(e)})):"string"===typeof e&&e.indexOf(ke)>-1?new Date(e.substring(e.indexOf(":")+1)):e}var We=Ae,Ke=(n("5cae"),Object(O["a"])(We,i,o,!1,null,null,null));t["a"]=Ke.exports},"1f58":function(e,t,n){},"214d":function(e,t,n){},2419:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n("6b54");var i=n("d4ec"),o=n("bee2"),a=n("ade3"),s=n("dd50"),r=function(){function e(t){Object(i["a"])(this,e),Object(a["a"])(this,"mapbox",null),Object(a["a"])(this,"elementId",""),Object(a["a"])(this,"layerId",null),Object(a["a"])(this,"sourceId",""),Object(a["a"])(this,"ctx",null),Object(a["a"])(this,"disposed",!1),Object(a["a"])(this,"onComplete",null),this.mapbox=t}return Object(o["a"])(e,[{key:"init",value:function(){this.layerId=(new s["a"]).toString(),this.elementId="canvas_"+this.layerId,this.sourceId="source_"+this.layerId;var e=this.mapbox.getContainer(),t=document.createElement("CANVAS");t.id=this.elementId,t.width=e.offsetWidth,t.height=e.offsetHeight,e.parentElement.appendChild(t)}},{key:"dispose",value:function(){this.disposed=!0;var e=document.getElementById(this.elementId);e.remove(),this.ctx=null,this.onComplete=null,this.ctx=null}},{key:"add",value:function(){var e=this.mapbox.getBounds(),t=[[e.getWest(),e.getNorth()],[e.getEast(),e.getNorth()],[e.getEast(),e.getSouth()],[e.getWest(),e.getSouth()]];this.mapbox.addSource(this.sourceId,{type:"canvas",canvas:this.elementId,coordinates:t,animate:!1}),this.mapbox.addLayer({id:this.layerId,type:"raster",source:this.sourceId})}},{key:"repaint",value:function(){var e=this.mapbox.getSource(this.sourceId);e._playing=!0,e.prepare(),e._playing=!1}},{key:"formatAlfaColor",value:function(e,t){if(t<1){4===e.length&&(e="#"+e.substring(1)+e.substring(1));var n=Math.floor(255*t).toString(16);return n.length<2&&(n="0"+n),e+n}return e}},{key:"sources",get:function(){var e=this.mapbox.getBounds(),t=[[e.getWest(),e.getNorth()],[e.getEast(),e.getNorth()],[e.getEast(),e.getSouth()],[e.getWest(),e.getSouth()]];return Object(a["a"])({},this.sourceId,{type:"canvas",canvas:this.elementId,coordinates:t,animate:!1})}},{key:"layers",get:function(){return Object(a["a"])({},this.layerId,{id:this.layerId,type:"raster",source:this.sourceId})}}]),e}()},"24e6":function(e,t,n){},2717:function(e,t,n){},"2aef":function(e,t,n){},"2bb6":function(e,t,n){"use strict";var i=n("ec1d"),o=n.n(i);o.a},"2c6b":function(e,t,n){},"2cdb":function(e,t,n){"use strict";var i=n("8b63"),o=n.n(i);o.a},"2d14":function(e,t,n){"use strict";var i=n("7bc7"),o=n.n(i);o.a},"2daa":function(e,t,n){},"2ed7":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"user-avatar-with-name-cell",on:{click:function(t){return t.stopPropagation(),e.onCellClick(t)}}},[n("div",{staticClass:"user-avatar-with-name-cell__img"},[n("img",{directives:[{name:"show",rawName:"v-show",value:!e.showDefaultIcon,expression:"!showDefaultIcon"}],attrs:{src:e.avatarSrc},on:{error:e.imgError}}),n("i",{directives:[{name:"show",rawName:"v-show",value:e.showDefaultIcon,expression:"showDefaultIcon"}],staticClass:"core core-user"})]),n("div",{staticClass:"user-avatar-with-name-cell__user-name",domProps:{innerHTML:e._s(e.userName)}})])},o=[],a=n("508a"),s={name:"UserAvatarWithNameCellTemplate",mixins:[a["a"]],props:{options:{type:Object,default:function(){return{}}}},computed:{userName:function(){var e=this.options.data||{},t=(this.options.column||{}).fioField||"fioField";return e[t]||"No Name"}},methods:{onCellClick:function(){var e=this.options.data;this.$parent.$parent.$emit("click1",{rowData:e,row_id:e.id,row_guid:e.guid,rowIndex:this.options.rowIndex,value:this.options.value,dataField:this.options.column.dataField})}}},r=s,l=(n("c639"),n("2877")),c=Object(l["a"])(r,i,o,!1,null,"913da0ec",null);t["a"]=c.exports},"2f59":function(e,t,n){},"2f7c":function(e,t,n){},"303d":function(e,t,n){},"30a0":function(e,t,n){"use strict";var i=n("c8a1"),o=n.n(i);o.a},"30b8":function(e,t,n){"use strict";var i=n("e8e2"),o=n.n(i);o.a},"31ae":function(e,t,n){"use strict";var i=n("df23"),o=n.n(i);o.a},3281:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-legend-style-item",class:{"gis-legend-style-item_with-items":e.hasItems}},[n("div",{staticClass:"gis-legend-style-item__root"},[n("div",{staticClass:"gis-legend-style-item__icon",class:{"gis-legend-style-item__icon-noborder":!1===e.options.wmsSingleRule},on:{mouseenter:e.handleMouseEnter,mouseleave:e.handleMouseLeave}},[e.hasItems?e._e():[e.iconUrl?n("img",{attrs:{src:e.iconUrl}}):e.iconCss?n("i",{class:e.expanded?e.iconExpandedCss:e.iconCss,style:{color:e.iconColor}}):e._e()]],2),e.text?n("div",{staticClass:"gis-legend-style-item__text",attrs:{title:e.text},on:{mouseenter:function(t){e.hover=!0},mouseleave:function(t){e.hover=!1}}},[e._v("\n      "+e._s(e.text)+"\n    ")]):e._e(),e.hideVisibleButton?e._e():n("GisLegendItemButton",{staticClass:"gis-legend-style-item__button",style:e.itemButtonStyle,attrs:{active:e.visible||e.halfVisible,iconCss:"core core-081-no-visible",activeIconCss:e.visibleButtonIconCss,text:e.visibleButtonText},on:{activeChanged:e.visibleButtonClick}})],1),e.hasItems?n("div",{staticClass:"gis-legend-style-item__sub-items"},e._l(e.items,(function(t,i){return n("GisLegendStyleItem",{key:t,attrs:{legendStyleItemId:t,layerComponentId:e.layerComponentId,images:e.images,expanded:!1,rightShift:e.rightShift}})})),1):e._e()])},o=[],a=(n("8e6e"),n("ac6a"),n("cadf"),n("456d"),n("ade3")),s=n("2f62"),r=n("1a37"),l=n("8bc1"),c=n("eec1"),d=n("9841");function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f="core core-082-visible",h="core core-081-no-visible",m="core core-193_halfeye",g={name:"GisLegendStyleItem",components:{GisLegendItemButton:r["a"]},props:{layerComponentId:null,legendStyleItemId:null,images:null,rightShift:{type:Boolean,default:!1}},computed:p(p({},Object(s["c"])("config",{getLegendStyleItem:c["v"],isLegendStyleItemVisible:c["bb"],isLegendStyleItemHalfVisible:c["ab"]})),{},{options:function(){return this.getLegendStyleItem(this.layerComponentId,this.legendStyleItemId)},caption:function(){return this.options.caption},visible:function(){return this.isLegendStyleItemVisible(this.layerComponentId,this.legendStyleItemId)},halfVisible:function(){return this.isLegendStyleItemHalfVisible(this.layerComponentId,this.legendStyleItemId)},expanded:function(){return this.options.expanded},iconCss:function(){return this.options.iconCss},iconExpandedCss:function(){return this.options.iconExpandedCss},iconColor:function(){return this.options.iconColor},iconUrl:function(){return this.options.iconUrl?this.options.iconUrl:this.options.mapboxLayerConfigs?Object(l["a"])(this.options.mapboxLayerConfigs,this.images):null},items:function(){return this.options.items||[]},hideVisibleButton:function(){return"rule"===this.options.type},visibleButtonText:function(){return this.hasItems?this.visible||this.halfVisible?"Скрыть вложенные слои":"Показать вложенные слои":this.visible||this.halfVisible?"Скрыть слой":"Показать слой"},visibleButtonIconCss:function(){return this.visible?f:this.halfVisible?m:h},text:function(){return this.caption||this.id},hasItems:function(){return this.items&&this.items.length>0},itemButtonStyle:function(){return{marginRight:this.rightShift?"29px":"20px"}}}),methods:p(p({},Object(s["b"])("config",{setLegendStyleItemVisible:d["J"]})),{},{handleMouseEnter:function(){},handleMouseLeave:function(){},visibleButtonClick:function(){this.setLegendStyleItemVisible({componentId:this.layerComponentId,legendStyleItemId:this.legendStyleItemId,visible:!(this.visible||this.halfVisible)})}})},y=g,v=(n("85b7"),n("2877")),b=Object(v["a"])(y,i,o,!1,null,null,null);t["a"]=b.exports},3298:function(e,t,n){"use strict";var i=n("875f"),o=n.n(i);o.a},3524:function(e,t,n){"use strict";var i=n("2f7c"),o=n.n(i);o.a},"36ac":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"gis-popup-add-layer",attrs:{animation:null,visible:e.visible,shading:!1,resizeEnabled:!0,position:e.popupPosition,width:600,height:"auto",maxHeight:e.popupMaxHeight,minHeight:300,container:e.popupContainer},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:e.isNew?"Подключить сервис":"Редактировать сервис",showCloseButton:!0},on:{closeClick:e.onFormHidden}})]},proxy:!0},{key:"content",fn:function(){return[n("div",[n("GisAddServiceForm",{ref:"gisAddLayerForm",attrs:{popupContainer:e.popupContainer,options:e.layerOptions,isNew:e.isNew},on:{change:function(t){e.editorOptions=t},changeExtents:e.changeExtents,layerOptionsTreeChange:function(t){e.layersTree=t}}}),n("DxLoadPanel",{attrs:{visible:e.loadPanelVisible,container:".gis-add-layer-form"}},[n("DxLoadPanelPosition",{attrs:{my:"center",at:"center",of:".gis-add-layer-form"}})],1)],1)]},proxy:!0},{key:"applyButton",fn:function(){return[n("DxButton",{attrs:{visible:!e.isWcsType,focusStateEnabled:!1,text:e.addLayerText,type:"success",icon:"check"},on:{click:e.apply}})]},proxy:!0},{key:"applyGroupButton",fn:function(){return[n("DxButton",{attrs:{visible:e.isGroupAdd||e.isWcsType,focusStateEnabled:!1,text:"Сохранить как группу слоев",type:"success",icon:"core core-189_list"},on:{click:e.applyLayersTree}})]},proxy:!0}])},[n("DxToolbarItem",{attrs:{toolbar:"bottom",location:"center",template:"applyButton"}}),n("DxToolbarItem",{attrs:{toolbar:"bottom",location:"center",template:"applyGroupButton"}})],1)},o=[],a=(n("8e6e"),n("456d"),n("cadf"),n("5df3"),n("551c"),n("ac6a"),n("6b54"),n("097d"),n("6762"),n("2fdb"),n("ade3")),s=n("d736"),r=n("6191"),l=n.n(r),c=n("5bba"),d=n("cbd3"),u=n("25aa"),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxScrollView",[n("div",{staticClass:"gis-add-layer-form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Заголовок")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{disabled:"wcs"===e.options.type&&!e.isNew},on:{valueChanged:e.onFieldChange},model:{value:e.caption,callback:function(t){e.caption=t},expression:"caption"}},[n("DxValidator",{attrs:{validationGroup:"serviceGroup"}},[n("DxCustomRule",{attrs:{message:"Необходимо ввести заголовок",validationCallback:e.validateCaption,reevaluate:!0}})],1)],1)],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Копирайт")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{on:{valueChanged:e.onFieldChange},model:{value:e.copyright,callback:function(t){e.copyright=t},expression:"copyright"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Описание")]),n("div",{staticClass:"dx-field-value"},[n("DxTextArea",{on:{valueChanged:e.onFieldChange},model:{value:e.comments,callback:function(t){e.comments=t},expression:"comments"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Тип сервиса")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.serviceTypeDataSource,displayExpr:"text",valueExpr:"value",readOnly:!e.isNew},on:{opened:e.selectBoxOpened,valueChanged:e.onFieldChange},model:{value:e.options.type,callback:function(t){e.$set(e.options,"type",t)},expression:"options.type"}})],1)]),"wms"===e.options.type?n("GisAddWMS",{attrs:{popupContainer:e.popupContainer,options:e.options},on:{change:e.onFormChange,changeExtents:e.changeExtents,layerOptionsTreeChange:e.onLayerOptionsTreeChange}}):e._e(),"wmts"===e.options.type?n("GisAddWMTS",{attrs:{popupContainer:e.popupContainer,options:e.options},on:{change:e.onFormChange,changeExtents:e.changeExtents}}):e._e(),"wcs"===e.options.type?n("GisAddWCS",{attrs:{popupContainer:e.popupContainer,options:e.wcsLayerOptions,isNew:e.isNew},on:{change:e.onWcsFormChange,changeExtents:e.changeExtents,layerOptionsTreeChange:e.onLayerOptionsTreeChange}}):"wfs"===e.options.type?n("GisAddWFS",{attrs:{popupContainer:e.popupContainer,options:e.options},on:{change:e.onFormChange,changeExtents:e.changeExtents,layerOptionsTreeChange:e.onLayerOptionsTreeChange}}):"tile"===e.options.type?n("GisAddTileLayer",{on:{change:e.onFormChange}}):"vector"===e.options.type?n("GisAddVectorLayer",{attrs:{options:e.options},on:{change:e.onFormChange}}):"pkk"===e.options.type?n("GisAddArcGis",{attrs:{popupContainer:e.popupContainer,options:e.options},on:{change:e.onFormChange,changeExtents:e.changeExtents,layerOptionsTreeChange:e.onLayerOptionsTreeChange}}):e._e()],1)])},f=[],h=n("5c46"),m=n("0187"),g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-add-wmts"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Как базовая карта")]),n("div",{staticClass:"dx-field-value"},[n("DxCheckBox",{on:{valueChanged:e.emitChanges},model:{value:e.layersOptions.baseMap,callback:function(t){e.$set(e.layersOptions,"baseMap",t)},expression:"layersOptions.baseMap"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("URL-адрес")]),n("div",{staticClass:"dx-field-value dx-field-value_custom"},[n("DxTextBox",{staticClass:"gis-add-wmts__url",attrs:{valueChangeEvent:"input"},on:{valueChanged:e.emitChanges},model:{value:e.url,callback:function(t){e.url=t},expression:"url"}}),n("DxButton",{attrs:{text:"Получить",type:"default",disabled:!e.url||e.loading,template:e.loading?"loadIndicatorContent":"content",width:"76"},on:{click:e.getWmts},scopedSlots:e._u([{key:"loadIndicatorContent",fn:function(){return[n("div",[n("dx-load-indicator",{staticClass:"gis-add-wmts__load-indicator",attrs:{visible:!0}})],1)]},proxy:!0}])})],1)]),n("DxButton",{attrs:{type:"default",text:"Логин/пароль для доступа к сервису",stylingMode:"text"},on:{click:function(t){e.authorizationFormVisible=!e.authorizationFormVisible}}}),e.authorizationFormVisible?n("GisLoginForm",{attrs:{login:this.login,password:this.password},on:{authorizationDataChange:e.authorizationDataChange}}):e._e(),0!==e.layers.length?n("div",{staticClass:"gis-add-wmts__layers-settings"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"}),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-add-wmts__list"},[n("DxList",{attrs:{searchExpr:"title",searchEnabled:!0,displayExpr:"title",valueExpr:"id",keyExpr:"id",dataSource:e.layers,showSelectionControls:!0,selectedItemKeys:e.selectedLayers,selectionMode:"single",scrollingEnabled:!0,pageLoadMode:"scrollBottom"},on:{"update:selectedItemKeys":function(t){e.selectedLayers=t},"update:selected-item-keys":function(t){e.selectedLayers=t},selectionChanged:e.selectLayer,contentReady:e.calcHeight,itemClick:e.onListItemClick,itemRendered:e.onListItemRendered}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Формат")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.formatDataSource,displayExpr:"text",valueExpr:"value"},on:{opened:e.selectBoxOpened,valueChanged:e.emitChanges},model:{value:e.layersOptions.format,callback:function(t){e.$set(e.layersOptions,"format",t)},expression:"layersOptions.format"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Стили")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.stylesDataSource,displayExpr:"name",valueExpr:"name",showClearButton:!0},on:{opened:e.selectBoxOpened,valueChanged:e.styleChanged},model:{value:e.layersOptions.styles,callback:function(t){e.$set(e.layersOptions,"styles",t)},expression:"layersOptions.styles"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Версия")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{on:{valueChanged:e.emitChanges},model:{value:e.layersOptions.version,callback:function(t){e.$set(e.layersOptions,"version",t)},expression:"layersOptions.version"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Размер тайла")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{on:{valueChanged:e.emitChanges},model:{value:e.layersOptions.tileSize,callback:function(t){e.$set(e.layersOptions,"tileSize",t)},expression:"layersOptions.tileSize"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Поддомены")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{on:{valueChanged:e.emitChanges},model:{value:e.layersOptions.subdomains,callback:function(t){e.$set(e.layersOptions,"subdomains",t)},expression:"layersOptions.subdomains"}})],1)])]):e._e(),n("DxTooltip",{ref:"tooltip",staticClass:"gis-add-wmts__tooltip",attrs:{maxWidth:440,position:"top"}},[n("div",{staticClass:"gis-add-wmts__tooltip-content"},[e._v("\n        Слой не может быть добавлен к карте, поскольку он не поддерживает необходимую систему координат или схему разбиения на листы.\n      ")])])],1)},y=[],v=(n("7514"),n("2909")),b=(n("7f7f"),n("28a5"),n("d400")),_=n("7511"),C=n("e614"),x=n.n(C),O=n("6dd7"),I=n.n(O),S=n("049d"),L=n.n(S),D=n("7ea3"),P=n.n(D),E=n("ee80"),w=n.n(E),T=n("4344"),j=n.n(T);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var B={baseMap:!1,format:"image/png",styles:"",iconUrl:"",version:"1.0.0",tileSize:256,subdomains:"",layers:[]},M={name:"GisAddWMTS",mixins:[h["a"],b["a"]],components:{DxTextBox:x.a,DxButton:l.a,DxList:I.a,DxSelectBox:L.a,DxNumberBox:P.a,DxCheckBox:w.a,DxTooltip:j.a,GisLoginForm:_["a"]},props:{options:Object},data:function(){return{layersOptions:F({},B),formatDataSource:[{value:"image/png",text:"PNG"},{value:"image/png8",text:"PNG8"},{value:"image/jpeg",text:"JPEG"},{value:"image/vnd.jpeg-png",text:"JPEG-PNG"}],stylesDataSource:[],tooltipVisible:!1}},computed:{selectedLayers:{get:function(){return this.layersOptions.layers},set:function(e){this.layersOptions.layers=e}}},watch:{options:{handler:function(){var e=this,t=this.options||{};if(this.layersOptions={},Object.keys(B).forEach((function(n){e.layersOptions[n]=t[n]||B[n]})),t.token){var n=atob(t.token).split(":");this.login=n[0],this.password=n[1]}t.url&&(this.url=t.url,this.getCapabilities("service=WMTS&request=GetCapabilities")),this.emitChanges()},immediate:!0}},methods:{getWmts:function(){this.setDefaultOptions(),this.getCapabilities("service=WMTS&request=GetCapabilities")},parseXML:function(e){var t=this,i=n("083c").parseString;i(e,(function(e,n){var i="ows:Title",o="ows:Identifier",a="ows:WGS84BoundingBox",s="ows:UpperCorner",r="ows:LowerCorner";n.Capabilities.Contents[0].Layer.forEach((function(e){var n={id:e[o][0],title:e[i][0],styles:e.Style.map((function(e){return{name:e[o][0],legendUrl:e.LegendURL?e.LegendURL[0].$["xlink:href"]:""}})),disabled:!e.TileMatrixSetLink.some((function(e){return e.TileMatrixSet.includes("EPSG:900913")&&e.TileMatrixSetLimits}))};if(t.layers.push(n),t.layersOptions.layers.includes(n.id)&&(t.stylesDataSource=n.styles,t.layersOptions.styles||(t.layersOptions.styles=t.stylesDataSource[0].name,t.layersOptions.iconUrl=t.stylesDataSource[0].legendUrl,t.emitChanges())),e[a]){var l=e[a][0],c=[Object(v["a"])(l[s][0].split(" ")),Object(v["a"])(l[r][0].split(" "))];t.extents[e[o][0]]=t.formatExtent(c)}}))}))},onListItemClick:function(e){this.getExtents(e.itemData.id);var t=e.element.querySelector(".item-extent");t&&t.classList.remove("item-extent"),e.itemElement.classList.add("item-extent")},selectLayer:function(e){this.stylesDataSource=e.addedItems[0].styles,this.layersOptions.styles=this.stylesDataSource[0].name,this.layersOptions.iconUrl=this.stylesDataSource[0].legendUrl;var t=e.component.instance().option("selectedItemKeys");this.layersOptions.bounds=this.getBounds(t),this.emitChanges()},onListItemRendered:function(e){var t=this,n=e.itemElement,i=e.itemData;i.disabled&&(n.addEventListener("mouseenter",(function(){t.$refs.tooltip.instance.show(n)})),n.addEventListener("mouseleave",(function(){t.$refs.tooltip.instance.hide()})))},setDefaultOptions:function(){this.layersOptions=F({},B)},styleChanged:function(e){var t=e.value,n=this.stylesDataSource.find((function(e){return e.name===t}));this.layersOptions.styles=n?n.name:"",this.layersOptions.iconUrl=n?n.legendUrl:this.layersOptions.iconUrl,this.emitChanges()},emitChanges:function(){var e=F(F({},this.layersOptions),{},{url:this.url});this.login&&this.password&&(e.token=btoa("".concat(this.login,":").concat(this.password))),this.$emit("change",e)}}},A=M,R=(n("53c0"),n("2877")),V=Object(R["a"])(A,g,y,!1,null,null,null),G=V.exports,$=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-add-wcs"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Как базовая карта")]),n("div",{staticClass:"dx-field-value"},[n("DxCheckBox",{on:{valueChanged:e.emitChanges},model:{value:e.layersOptions.baseMap,callback:function(t){e.$set(e.layersOptions,"baseMap",t)},expression:"layersOptions.baseMap"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("URL-адрес")]),n("div",{staticClass:"dx-field-value dx-field-value_custom"},[n("DxTextBox",{staticClass:"gis-add-wcs__url",attrs:{valueChangeEvent:"input"},on:{valueChanged:e.emitChanges},model:{value:e.url,callback:function(t){e.url=t},expression:"url"}}),n("DxButton",{attrs:{text:"Получить",type:"default",disabled:!e.url||e.loading,template:e.loading?"loadIndicatorContent":"content",width:"76"},on:{click:e.getWms},scopedSlots:e._u([{key:"loadIndicatorContent",fn:function(){return[n("div",[n("dx-load-indicator",{staticClass:"gis-add-wcs__load-indicator",attrs:{visible:!0}})],1)]},proxy:!0}])})],1)]),n("DxButton",{attrs:{type:"default",text:"Логин/пароль для доступа к сервису",stylingMode:"text"},on:{click:function(t){e.authorizationFormVisible=!e.authorizationFormVisible}}}),e.authorizationFormVisible?n("GisLoginForm",{attrs:{login:this.login,password:this.password},on:{authorizationDataChange:e.authorizationDataChange}}):e._e(),0!==e.layers.length?n("div",{staticClass:"gis-add-wcs__layers-settings"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"}),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-add-wcs__list"},[n("DxList",{ref:"listComponent",attrs:{searchExpr:"title",searchEnabled:!0,displayExpr:"title",valueExpr:"id",keyExpr:"id",dataSource:e.layers,showSelectionControls:!0,selectedItemKeys:e.selectedLayers,selectionMode:e.isNew?"all":"single",scrollingEnabled:!0,pageLoadMode:"scrollBottom"},on:{"update:selectedItemKeys":function(t){e.selectedLayers=t},"update:selected-item-keys":function(t){e.selectedLayers=t},selectionChanged:e.layersSelectionChanged,contentReady:e.calcHeight,itemClick:e.onListItemClick}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Формат")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.formatDataSource,displayExpr:"text",valueExpr:"value"},on:{opened:e.selectBoxOpened,valueChanged:e.emitChanges},model:{value:e.layersOptions.format,callback:function(t){e.$set(e.layersOptions,"format",t)},expression:"layersOptions.format"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Стили")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{on:{valueChanged:e.emitChanges},model:{value:e.layersOptions.styles,callback:function(t){e.$set(e.layersOptions,"styles",t)},expression:"layersOptions.styles"}})],1)])]):e._e()],1)},N=[],U=n("595b"),z=n("b432");function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var K={baseMap:!1,format:"",styles:"",coordinates:{},layers:[],bounds:null},q=[{value:"image/png",text:"PNG"},{value:"image/gif",text:"GIF"},{value:"image/jpeg",text:"JPEG"},{value:"image/vnd.jpeg-png",text:"JPEG-PNG"}],J={name:"GisAddWCS",mixins:[h["a"],b["a"]],components:{DxTextBox:x.a,DxButton:l.a,DxList:I.a,DxSelectBox:L.a,DxCheckBox:w.a,GisLoginForm:_["a"]},props:{options:Object,isNew:Boolean},data:function(){return{coordinates:{},extents:{},layers:[],layersOptions:W({},K),formatDataSource:[]}},computed:{selectedLayers:{get:function(){return this.layersOptions.layers},set:function(e){this.layersOptions.layers=e}}},watch:{options:{handler:function(){var e=this,t=this.options||{};if(this.layersOptions={},Object.keys(K).forEach((function(n){e.layersOptions[n]=t[n]||K[n]})),t.token){var n=atob(t.token).split(":");this.login=n[0],this.password=n[1]}t.url&&(this.url=t.url,this.getCapabilities("service=WCS&request=GetCapabilities&version=".concat(z["i"]))),this.emitChanges()},immediate:!0}},methods:{getWms:function(){this.setDefaultOptions(),this.getCapabilities("service=WCS&request=GetCapabilities&version=".concat(z["i"]))},parseXML:function(e){var t=this,i=n("083c").parseString;i(e,(function(e,n){t.formatDataSource=[];var i="wcs:Capabilities",o="wcs:Contents",a="wcs:CoverageSummary",s="wcs:CoverageId",r="ows:WGS84BoundingBox",l="ows:UpperCorner",c="ows:LowerCorner";n[i][o][0][a].forEach((function(e){var n=e[s][0];t.layers.push({id:n,title:n});var i=e[r][0],o=[Object(v["a"])(i[l][0].split(" ")),Object(v["a"])(i[c][0].split(" "))];t.extents[n]=t.formatExtent(o);var a=[].concat(Object(v["a"])(i[l][0].split(" ")),Object(v["a"])(i[c][0].split(" "))),d=U["bboxPolygon"](a).geometry.coordinates[0].slice(0,-1);t.coordinates[n]=[d[1],d[0],d[3],d[2]]}));var d="wcs:ServiceMetadata",u="wcs:formatSupported";n[i][d]&&n[i][d][0][u].forEach((function(e){if(e.indexOf("image")>-1){var n=e.split("/");t.formatDataSource.push({value:e,text:n[1].toUpperCase()})}})),0===t.formatDataSource.length&&(t.formatDataSource=q),t.layersOptions.format&&(t.layersOptions.format=t.formatDataSource[0].value,t.emitChanges())}))},setDefaultOptions:function(){this.layersOptions=W({},K)},layersSelectionChanged:function(){var e=this,t=this.layersOptions.layers;this.layersOptions.coordinates={},t.forEach((function(t){e.layersOptions.coordinates[t]=e.coordinates[t]})),this.layersOptions.bounds=this.getBounds(t),this.emitChanges()},emitLayerOptionsTree:function(){var e=this;if(this.$refs.listComponent){var t=this.$refs.listComponent.instance.option("selectedItems").map((function(t){return{options:W(W({},e.layersOptions),{},{layers:t.id,text:t.title,coordinates:e.coordinates[t.id],url:e.url,type:"wcs",visible:!1,token:e.login&&e.password?btoa("".concat(e.login,":").concat(e.password)):null}),group:!1}})),n={options:{text:"",iconCss:"core core-092-folder",iconColor:"#ecc849",visible:!1,expanded:!1,allowDropInside:!0,allowFolderEdit:!0},group:!0,items:t};this.$emit("layerOptionsTreeChange",[n])}},emitChanges:function(){this.emitLayerOptionsTree();var e=W(W({},this.layersOptions),{},{url:this.url});this.login&&this.password&&(e.token=btoa("".concat(this.login,":").concat(this.password))),this.$emit("change",e)}}},Z=J,Y=(n("0411"),Object(R["a"])(Z,$,N,!1,null,null,null)),X=Y.exports,Q=n("b6eb"),ee=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-add-vector-layer"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("URL-адрес")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{on:{valueChanged:e.onChange},model:{value:e.layersSettings.url,callback:function(t){e.$set(e.layersSettings,"url",t)},expression:"layersSettings.url"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Источник")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{on:{valueChanged:e.onChange},model:{value:e.layersSettings.sourceLayer,callback:function(t){e.$set(e.layersSettings,"sourceLayer",t)},expression:"layersSettings.sourceLayer"}})],1)])])},te=[];n("f751");function ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var oe={baseMap:!1,url:"",maxNativeZoom:20,sourceLayer:"",mapboxLayers:[{geometry:["Polygon"],minzoom:0,layout:{visibility:"visible"},maxzoom:24,name:"Полигон",paint:{"fill-opacity":1,"line-opacity":1,"line-width":4,"line-color":"#958661","fill-color":"#d2c6b0"},type:"fill"},{geometry:["Line"],minzoom:0,layout:{visibility:"visible"},maxzoom:24,name:"Линия",paint:{"line-width":2,"line-dasharray":[2,3],"line-opacity":1,"line-color":"#c406b4","line-translate":[0,0]},type:"line"},{geometry:["Point"],minzoom:0,layout:{visibility:"visible"},maxzoom:24,name:"Точка",paint:{"circle-radius":5,"circle-stroke-opacity":1,"circle-color":"#d2c6b0","circle-stroke-color":"#867e6e","circle-stroke-width":2,"circle-opacity":1},type:"circle"}]},ae={name:"GisAddVectorLayer",components:{DxTextBox:x.a},props:{options:Object},data:function(){return{layersSettings:ie({},oe)}},watch:{options:{handler:function(){this.layersSettings=Object.assign({},oe,this.options),this.onChange()},immediate:!0}},mounted:function(){this.$emit("change",this.layersSettings)},methods:{onChange:function(){var e=this;this.layersSettings.mapboxLayers.forEach((function(t){return t["source-layer"]=e.layersSettings.sourceLayer})),this.$emit("change",this.layersSettings)}}},se=ae,re=(n("9f3f"),Object(R["a"])(se,ee,te,!1,null,null,null)),le=re.exports,ce=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-add-arcgis"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Как базовая карта")]),n("div",{staticClass:"dx-field-value"},[n("DxCheckBox",{on:{valueChanged:e.emitChanges},model:{value:e.layersOptions.baseMap,callback:function(t){e.$set(e.layersOptions,"baseMap",t)},expression:"layersOptions.baseMap"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("URL-адрес")]),n("div",{staticClass:"dx-field-value dx-field-value_custom"},[n("DxTextBox",{staticClass:"gis-add-arcgis__url",attrs:{valueChangeEvent:"input"},on:{valueChanged:e.emitChanges},model:{value:e.url,callback:function(t){e.url=t},expression:"url"}}),n("DxButton",{attrs:{text:"Получить",type:"default",disabled:!e.url||e.loading,template:e.loading?"loadIndicatorContent":"content",width:"76"},on:{click:e.getArcGis},scopedSlots:e._u([{key:"loadIndicatorContent",fn:function(){return[n("div",[n("dx-load-indicator",{staticClass:"gis-add-wcs__load-indicator",attrs:{visible:!0}})],1)]},proxy:!0}])})],1)]),n("DxButton",{attrs:{type:"default",text:"Логин/пароль для доступа к сервису",stylingMode:"text"},on:{click:function(t){e.authorizationFormVisible=!e.authorizationFormVisible}}}),e.authorizationFormVisible?n("GisLoginForm",{attrs:{login:this.login,password:this.password},on:{authorizationDataChange:e.authorizationDataChange}}):e._e(),0!==e.dataSource.length?n("div",{staticClass:"gis-add-arcgis__layers-settings"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"}),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-add-arcgis__list"},[n("DxTreeView",{attrs:{keyExpr:"id",valueExpr:"id",displayExpr:"text",parentIdExpr:"parentLayerId",rootValue:-1,searchEnabled:!0,searchExpr:["id","text"],dataSource:e.dataSource,selectionMode:"multiple",selectNodesRecursive:!0,showCheckBoxesMode:"normal"},on:{itemCollapsed:e.calcHeight,itemExpanded:e.calcHeight,contentReady:e.calcHeight,itemClick:e.onListItemClick,selectionChanged:e.selectLayer}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Формат")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{items:e.formatItems},on:{opened:e.selectBoxOpened,valueChanged:e.emitChanges},model:{value:e.layersOptions.format,callback:function(t){e.$set(e.layersOptions,"format",t)},expression:"layersOptions.format"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Размер тайла")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{on:{valueChanged:e.emitChanges},model:{value:e.layersOptions.size,callback:function(t){e.$set(e.layersOptions,"size",t)},expression:"layersOptions.size"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Прозрачность")]),n("div",{staticClass:"dx-field-value"},[n("DxCheckBox",{on:{valueChanged:e.emitChanges},model:{value:e.layersOptions.transparent,callback:function(t){e.$set(e.layersOptions,"transparent",t)},expression:"layersOptions.transparent"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("BboxSR")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{on:{valueChanged:e.emitChanges},model:{value:e.layersOptions.bboxSR,callback:function(t){e.$set(e.layersOptions,"bboxSR",t)},expression:"layersOptions.bboxSR"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("ImageSR")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{on:{valueChanged:e.emitChanges},model:{value:e.layersOptions.imageSR,callback:function(t){e.$set(e.layersOptions,"imageSR",t)},expression:"layersOptions.imageSR"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Dpi")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{on:{valueChanged:e.emitChanges},model:{value:e.layersOptions.dpi,callback:function(t){e.$set(e.layersOptions,"dpi",t)},expression:"layersOptions.dpi"}})],1)])]):e._e()],1)},de=[],ue=(n("3b2b"),n("aef6"),n("2824")),pe=n.n(ue),fe=n("ec14");function he(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?he(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):he(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ge={baseMap:!1,bbox:"{bbox-epsg-3857}",format:"",size:256,transparent:!0,bboxSR:102100,imageSR:102100,dpi:90,layers:"",bounds:null},ye=[3785,3857],ve={name:"GisAddArcGis",mixins:[h["a"],b["a"]],components:{DxTextBox:x.a,DxButton:l.a,DxTreeView:pe.a,DxCheckBox:w.a,DxSelectBox:L.a,DxNumberBox:P.a,GisLoginForm:_["a"]},props:{options:Object},data:function(){return{layersOptions:me({},ge),groupLayerItems:[],formatItems:[],loading:!1,url:null,dataSource:[],credentials:null,token:null}},computed:{selectedLayers:{get:function(){return this.layersOptions.layers.slice(5).split(",")},set:function(e){this.layersOptions.layers="show:".concat(e.join(","))}}},watch:{options:{handler:function(){var e=this,t=this.options||{};if(this.layersOptions={},Object.keys(ge).forEach((function(n){e.layersOptions[n]=void 0!==t[n]?t[n]:ge[n]})),t.token){this.credentials=t.token;var n=atob(t.token).split(":");this.login=n[0],this.password=n[1]}t.url&&(this.url=t.url,this.getLayers()),this.emitChanges()},immediate:!0}},methods:{calcHeight:function(e){var t=e.element.querySelector(".dx-treeview-node-container"),n=t.offsetHeight>370?400:t.offsetHeight+30;e.component.option("height",n)},emitChanges:function(){var e;this.emitTreeChanges(),this.url&&(e=this.url.endsWith("/")?this.url:this.url+"/");var t=me(me({},this.layersOptions),{},{url:e});this.login&&this.password&&(t.token=btoa("".concat(this.login,":").concat(this.password)),this.credentials=t.token),this.$emit("change",t)},emitTreeChanges:function(){if(this.dataSource.length){var e=[{group:!0,options:{group:!0,expanded:!1,iconColor:"#ecc849",iconCss:"core core-092-folder",text:this.dataSource[0].text,visible:!1,allowDropInside:!0,allowFolderEdit:!0},items:this.groupLayerItems}];this.$emit("layerOptionsTreeChange",e)}},getArcGis:function(){this.setDefaultOptions(),this.getLayers()},getLayers:function(){var e=this;this.loading=!0,this.dataSource=[];var t="".concat(this.url,"?f=json"),n={mode:"cors",method:"GET",headers:{"Content-Type":"application/json;charset=utf-8"}};Object(fe["a"])(this.url,this.credentials).then((function(i){return e.token=i,i&&(t="".concat(t,"&token=").concat(i)),fetch("".concat("https://proxy.rusgis.com/proxy","?url=").concat(t),n).then((function(e){if(!e.ok)throw e;return e.json()}))})).then((function(t){if(t.error&&499===t.error.code)return e.authorizationFormVisible=!0,void Object(d["a"])({message:"Неверный логин или пароль",width:"auto"},"error",3e3);e.formatLayers(t),e.formatItems=t.supportedImageFormatTypes.split(","),e.layersOptions.format||(e.layersOptions.format=e.formatItems[0],e.emitChanges()),e.loading=!1})).catch((function(){Object(d["a"])({message:"Получение информации о сервисе недоступно",width:"auto"},"error",3e3)})).finally((function(){e.loading=!1}))},setDefaultOptions:function(){this.extents={},this.layersOptions=me({},ge)},formatLayers:function(e){var t=this,n=RegExp(/^.*\/([\wа-я]+)\/MapServer\/?$/gi),i=n.exec(this.url),o=i&&i[1];this.layersOptions.text=e.serviceDescription;var a={id:e.serviceItemId||o,text:e.serviceDescription||o,expanded:!0,items:[]};e.layers.forEach((function(e){e.text="".concat(e.name," (").concat(e.id,")");var n=t.selectedLayers.includes(e.id.toString());e.selected=n,e.expanded=n,n&&t.setExtent(e.id.toString()),a.items.push(e)})),this.dataSource=[a]},selectLayer:function(e){var t=this,n=e.component.instance().getSelectedNodes().filter((function(e){return!e.children.length})),i=n.map((function(e){return e.itemData.id.toString()}));this.selectedLayers=i,1===i.length?this.layersOptions.text=n[0].text:this.layersOptions.text=this.dataSource[0].text;var o="".concat(this.url);o.endsWith("/")||(o+="/"),this.groupLayerItems=n.map((function(e){return{group:!1,options:me(me(me({},ge),e.itemData),{},{layers:"show:".concat(e.itemData.id.toString()),url:o,type:"pkk"})}}));var a=[];n.forEach((function(e){a.push(t.setExtent(e.itemData.id.toString()))})),Promise.all(a).then((function(){t.layersOptions.bounds=t.getBounds(i),t.groupLayerItems.forEach((function(e){return e.options.bounds=t.extents[e.options.id]})),t.emitChanges()}))},onListItemClick:function(e){var t=this,n=e.element.querySelector(".item-extent");n&&n.classList.remove("item-extent"),e.itemElement.classList.add("item-extent"),this.setExtent(e.itemData.id.toString()).then((function(){return t.getExtents(e.itemData.id.toString())}))},setExtent:function(e){var t=this;return this.extents.hasOwnProperty(e)?Promise.resolve():this.getLayerInfo(e).then((function(n){var i=[[n.extent.xmax,n.extent.ymax],[n.extent.xmin,n.extent.ymin]],o=n.extent.spatialReference.latestWkid||n.extent.spatialReference.wkid;i.flat().every((function(e){return!isNaN(+e)}))?t.extents[e]=ye.includes(o)?t.extentToWGS(i):i:t.extents[e]=!1}))},getLayerInfo:function(e){var t="".concat(this.url);return t.endsWith("/")||(t+="/"),t+="".concat(e,"?f=json"),this.token&&(t="".concat(t,"&token=").concat(this.token)),fetch("".concat("https://proxy.rusgis.com/proxy","?url=").concat(t)).then((function(e){if(!e.ok)throw e;return e.json()}))}}},be=ve,_e=(n("c643"),Object(R["a"])(be,ce,de,!1,null,null,null)),Ce=_e.exports,xe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-add-wfs"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Как базовая карта")]),n("div",{staticClass:"dx-field-value"},[n("DxCheckBox",{on:{valueChanged:e.emitChanges},model:{value:e.layersOptions.baseMap,callback:function(t){e.$set(e.layersOptions,"baseMap",t)},expression:"layersOptions.baseMap"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("URL-адрес")]),n("div",{staticClass:"dx-field-value dx-field-value_custom"},[n("DxTextBox",{staticClass:"gis-add-wfs__url",attrs:{valueChangeEvent:"input"},on:{valueChanged:e.emitChanges},model:{value:e.url,callback:function(t){e.url=t},expression:"url"}}),n("DxButton",{attrs:{text:"Получить",type:"default",disabled:!e.url||e.loading,template:e.loading?"loadIndicatorContent":"content",width:"76"},on:{click:e.getWfs},scopedSlots:e._u([{key:"loadIndicatorContent",fn:function(){return[n("div",[n("DxLoadIndicator",{staticClass:"gis-add-wfs__load-indicator",attrs:{visible:!0}})],1)]},proxy:!0}])})],1)]),n("DxButton",{attrs:{type:"default",text:"Логин/пароль для доступа к сервису",stylingMode:"text"},on:{click:function(t){e.authorizationFormVisible=!e.authorizationFormVisible}}}),e.authorizationFormVisible?n("GisLoginForm",{attrs:{login:this.login,password:this.password},on:{authorizationDataChange:e.authorizationDataChange}}):e._e(),0!==e.layers.length?n("div",{staticClass:"gis-add-wfs__layers-settings"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"}),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-add-wfs__list"},[n("DxList",{ref:"listComponent",attrs:{searchExpr:"title",searchEnabled:!0,displayExpr:"title",valueExpr:"id",keyExpr:"id",dataSource:e.layers,showSelectionControls:!0,selectedItemKeys:e.selectedLayers,selectionMode:"all",scrollingEnabled:!0,pageLoadMode:"scrollBottom"},on:{"update:selectedItemKeys":function(t){e.selectedLayers=t},"update:selected-item-keys":function(t){e.selectedLayers=t},selectionChanged:e.selectLayers,contentReady:e.calcHeight,itemClick:e.onListItemClick}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Версия")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.versionDataSource,displayExpr:"text",valueExpr:"value"},on:{opened:e.selectBoxOpened,valueChanged:e.emitChanges},model:{value:e.layersOptions.version,callback:function(t){e.$set(e.layersOptions,"version",t)},expression:"layersOptions.version"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Максимальное количество объектов"}},[e._v("Максимальное количество объектов")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{attrs:{min:0},on:{valueChanged:e.emitChanges},model:{value:e.layersOptions.maxFeatures,callback:function(t){e.$set(e.layersOptions,"maxFeatures",t)},expression:"layersOptions.maxFeatures"}})],1)])]):e._e()],1)},Oe=[];function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Le={baseMap:!1,version:"2.0.0",maxFeatures:500,typeName:"",bounds:null,mapboxLayers:[{name:"rule_0",type:"circle",paint:{"circle-radius":5,"circle-color":"#d2c6b0"},geometry:["Point"],maxzoom:24,minzoom:0},{name:"rule_0",type:"line",paint:{"line-color":"#d2c6b0","line-width":4},geometry:["Line"],maxzoom:24,minzoom:0},{name:"rule_0",type:"fill",paint:{"fill-color":"#d2c6b0","fill-opacity":.5,"line-color":"#958661","line-width":2},geometry:["Polygon"],maxzoom:24,minzoom:0}]},De={name:"GisAddWFS",mixins:[b["a"],h["a"]],components:{DxTextBox:x.a,DxNumberBox:P.a,DxButton:l.a,DxList:I.a,DxCheckBox:w.a,GisLoginForm:_["a"]},props:{options:Object},data:function(){return{layersOptions:Se({},Le),versionDataSource:[{value:"1.0.0",text:"1.0.0"},{value:"1.1.0",text:"1.1.0"},{value:"2.0.0",text:"2.0.0"}]}},computed:{selectedLayers:{get:function(){return this.layersOptions.typeName.split(",")},set:function(e){this.layersOptions.typeName=e.join(",")}}},watch:{options:{handler:function(){var e=this,t=this.options||{};if(this.layersOptions={},Object.keys(Le).forEach((function(n){e.layersOptions[n]=t[n]||Le[n]})),t.token){var n=atob(t.token).split(":");this.login=n[0],this.password=n[1]}t.url&&(this.url=t.url,this.getCapabilities("service=WFS&request=GetCapabilities")),this.emitChanges()},immediate:!0}},methods:{getWfs:function(){this.setDefaultOptions(),this.getCapabilities("service=WFS&request=GetCapabilities")},parseXML:function(e){var t=this,i=n("083c").parseString;i(e,(function(e,n){var i=n["wfs:WFS_Capabilities"]||n.WFS_Capabilities;i.FeatureTypeList[0].FeatureType.forEach((function(e){var n=e.Name[0],i=e.Title[0];t.layers.push({id:n,title:i});var o=t.getExtentByWfs(e);o&&(t.extents[n]=t.formatExtent(o))}))}))},getExtentByWfs:function(e){var t;return e["ows:WGS84BoundingBox"]?(t=e["ows:WGS84BoundingBox"][0],[t["ows:UpperCorner"][0].split(" "),t["ows:LowerCorner"][0].split(" ")]):e.LatLongBoundingBox?(t=e.LatLongBoundingBox[0]["$"],[[t.maxx,t.maxy],[t.minx,t.miny]]):null},selectLayers:function(e){var t=e.component.instance().option("selectedItemKeys");this.layersOptions.bounds=this.getBounds(t),this.emitChanges()},setDefaultOptions:function(){this.layersOptions=Se({},Le)},emitLayerOptionsTree:function(){var e=this;if(this.$refs.listComponent){var t=this.$refs.listComponent.instance.option("selectedItems").map((function(t){return{options:Se(Se({},e.layersOptions),{},{typeName:t.id,text:t.title,url:e.url,type:"wfs",visible:!1,token:e.login&&e.password?btoa("".concat(e.login,":").concat(e.password)):null}),group:!1}})),n={options:{text:"",iconCss:"core core-092-folder",iconColor:"#ecc849",visible:!1,expanded:!1,allowDropInside:!0,allowFolderEdit:!0},group:!0,items:t};this.$emit("layerOptionsTreeChange",[n])}},emitChanges:function(){this.emitLayerOptionsTree();var e=Se(Se({},this.layersOptions),{},{url:this.url});this.login&&this.password&&(e.token=btoa("".concat(this.login,":").concat(this.password))),this.$emit("change",e)}}},Pe=De,Ee=(n("610b"),Object(R["a"])(Pe,xe,Oe,!1,null,null,null)),we=Ee.exports,Te=n("b8f5"),je=n.n(Te),ke=n("5a1f"),Fe=n.n(ke),Be=n("0db8"),Me=n("4fac");function Ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ve={name:"GisAddLayerFrom",mixins:[h["a"]],components:{GisAddWMS:m["a"],GisAddWMTS:G,GisAddWCS:X,GisAddTileLayer:Q["a"],GisAddVectorLayer:le,GisAddArcGis:Ce,GisAddWFS:we,DxSelectBox:L.a,DxTextArea:je.a,DxTextBox:x.a,DxScrollView:Fe.a,DxValidator:Be["DxValidator"],DxCustomRule:Be["DxCustomRule"]},props:{options:Object,isNew:Boolean},data:function(){return{serviceTypeDataSource:[{value:"wms",text:"WMS"},{value:"wmts",text:"WMTS"},{value:"wcs",text:"WCS"},{value:"wfs",text:"WFS"},{value:"tile",text:"Растровый тайловый слой"},{value:"vector",text:"Векторный тайловый слой"},{value:"pkk",text:"REST ArcGIS"}],caption:"",copyright:"",comments:"",layerOptions:null}},computed:{wcsLayerOptions:function(){return Re(Re({},this.options),{},{layers:[this.options.layers],coordinates:Object(a["a"])({},this.options.layers,this.options.coordinates)})}},watch:{options:{handler:function(){this.options?(this.layerOptions=Re({},this.options),this.caption=this.options.text||"",this.copyright=this.options.copyright||"",this.comments=this.options.comments||"",this.$emit("change",this.layerOptions)):this.resetForm()},immediate:!0}},methods:{onFieldChange:function(){this.layerOptions=Re(Re({},this.layerOptions),{},{text:this.caption,copyright:this.copyright,comments:this.comments,type:this.options.type}),this.$emit("change",this.layerOptions)},onFormChange:function(e){this.layerOptions=Re(Re({},e),{},{text:this.caption||e.text,copyright:this.copyright,comments:this.comments,type:this.options.type}),this.$emit("change",this.layerOptions)},onWcsFormChange:function(e){var t=Re(Re({},e),{},{type:this.options.type,layers:e.layers[0],text:e.layers[0],coordinates:e.coordinates[e.layers[0]]});this.$emit("change",t)},changeExtents:function(e){this.$emit("changeExtents",e)},resetForm:function(){this.caption="",this.copyright="",this.comments="",this.layerOptions=null},onLayerOptionsTreeChange:function(e){var t=this;this.$emit("layerOptionsTreeChange",e.map((function(e){return Re(Re({},e),{},{options:Re(Re({},e.options),{},{text:t.caption||e.options.text}),copyright:t.copyright,comments:t.comments})})))},validateCaption:function(e){var t=e.value;return t||!["wmts","wfs","tile","wcs"].includes(this.options.type)},validate:function(){var e=Me["a"].getGroupConfig("serviceGroup");if(e){var t=e.validate();return t.isValid}return!0}}},Ge=Ve,$e=(n("b436"),Object(R["a"])(Ge,p,f,!1,null,null,null)),Ne=$e.exports,Ue=n("68b0"),ze=n("9841"),He=n("2f62"),We=n("bf8c"),Ke=n("c22f"),qe=n("fe56"),Je=n("7a47"),Ze=n("e3b7"),Ye=n("eec1"),Xe=n("233b");function Qe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function et(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qe(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var tt="CONFIG.DSCOMPONENTS",nt={text:"Новый слой",type:null},it={name:"GisPopupAddLayer",components:{DxPopup:s["DxPopup"],DxToolbarItem:s["DxToolbarItem"],DxButton:l.a,DxLoadPanel:c["DxLoadPanel"],DxLoadPanelPosition:c["DxPosition"],GisAddServiceForm:Ne,PopupTitleTemplate:u["a"]},props:{popupContainer:null,gisComponentId:String},data:function(){return{popupPosition:{at:"top",my:"top",offset:"0, 36"},loadPanelVisible:!1,layerOptions:et({},nt),editorOptions:null,layersTree:null}},computed:et(et({},Object(He["c"])("config",{getOptions:Ke["c"],getItem:Ke["b"],getLegendPanelLayerIds:Ze["t"],isLayerVisible:Ye["kb"],lastItemPos:"lastItemPos"})),{},{layerComponentId:function(){return this.getOptions(this.gisComponentId).editingOptionsLayerComponentId||null},isGroupAdd:function(){return this.editorOptions&&this.isNew&&!["wmts","tile","vector"].includes(this.editorOptions.type)},isWcsType:function(){return this.editorOptions&&this.isNew&&"wcs"===this.editorOptions.type},addLayerText:function(){return this.isGroupAdd?"Сохранить как один слой":"Сохранить слой"},layerParentComponentId:function(){return this.getItem(this.layerComponentId).parentComponentId},visible:function(){return!!this.layerComponentId&&("service"===this.layerComponentId||["wfs","wcs","wmts","pkk","wms"].includes(this.getOptions(this.layerComponentId).type)&&!this.getOptions(this.layerComponentId).raster)},isNew:function(){return!this.layerComponentId||"service"===this.layerComponentId}}),watch:{layerComponentId:function(){var e=this;this.visible&&(this.loadPanelVisible=!0,this.loadLayerOptions().finally((function(){e.loadPanelVisible=!1})))}},methods:et(et(et({},Object(He["b"])("config",{loadLayerComponent:Ue["l"],updateLayerOptions:ze["R"],setVisible:ze["N"],loadWms:ze["z"],loadArcGis:ze["m"],uploadAndSetGeoJsonData:ze["T"]})),Object(He["d"])("config",{setOptions:qe["a"],setBounds:Je["i"]})),{},{popupMaxHeight:function(){return.7*window.innerHeight},apply:function(){var e=this;this.loadPanelVisible=!0;var t={id:this.layerComponentId,parent_id:this.layerParentComponentId||this.gisComponentId,_config_dataset:tt,componenttype_id:160,prop:{editorOptions:et({},this.editorOptions)},name:this.editorOptions.text},n="updateData";this.isNew&&(n="insertData",t.pos=(this.lastItemPos(this.layerParentComponentId||this.gisComponentId)||0)+100,t.enable=!0,t.visible=!1,delete t.id);var i=this.isLayerVisible(this.layerComponentId);Object(We["c"])(n,t).then((function(t){var o=t.length?t[0]:{},a=o.id.toString();if("insertData"===n)return i=!0,e.loadLayerComponent({gisComponentId:e.gisComponentId,layerComponentId:a});var s=at(t);return e.updateLayerOptions({layerComponentId:a,options:s}).then((function(t){return e.updateLegends(i),"wfs"===e.editorOptions.type&&e.uploadAndSetGeoJsonData({componentId:a,reload:!0}),t}))})).then((function(t){e.setVisible({componentId:t,visible:i})})).finally((function(){e.loadPanelVisible=!1,e.onFormHidden()}))},applyLayersTree:function(){if(this.layersTree&&0!==this.layersTree.length){var e=[];this.layersTree.forEach((function(t){ot(t,0,e)})),this.saveLayersByLevels(e,0,{})}else Object(d["a"])({message:"Необходимо выбрать хотя бы 1 слой",width:"auto"},"warning",2e3)},onFormHidden:function(){this.$refs.gisAddLayerForm.resetForm(),this.setOptions({componentId:this.gisComponentId,optionName:"editingOptionsLayerComponentId",optionValue:null})},loadLayerOptions:function(){var e=this;return this.isNew?(this.layerOptions=et({},nt),Promise.resolve()):Object(We["c"])("getData",{_config_dataset:tt,id:this.layerComponentId}).then((function(t){e.layerOptions=at(t)}))},changeExtents:function(e){this.setBounds({gisComponentId:this.gisComponentId,bounds:[].concat(e[0],e[1])})},saveLayersByLevels:function(e,t,n){var i=this,o=this.getLegendPanelLayerIds(this.gisComponentId);if(t>e.length-1)return this.loadPanelVisible=!1,void this.onFormHidden();0===t&&(this.loadPanelVisible=!0);var a=e[t].map((function(a,s){var r="133566",l=i.gisComponentId;-1!==a.parentIndex?l=n[a.parentIndex]:"110785"===l&&(l=r);var c=100*(e[t].length-s);if(0===t){var d=i.getOptions(r);if(l===r&&d&&d.items&&d.items.length>0){var u=d.items[d.items.length-1],p=i.getItem(u)||{},f=p.componentPos||0;c+=f}else if(o[0]){var h=i.getItem(o[0]);c+=h.componentPos}}return{parent_id:l,_config_dataset:tt,componenttype_id:a.group?161:160,pos:c,prop:{cssStyle:{},editorOptions:et({},a.options)},name:a.options.text}}));return Object(We["c"])("insertData",a).then((function(e){var o=e.map((function(e,o){var a=e.id.toString();return n[o]=a,t?Promise.resolve():i.loadLayerComponent({gisComponentId:i.gisComponentId,layerComponentId:a})}));return Promise.all(o)})).then((function(){return i.saveLayersByLevels(e,t+1,n)})).catch((function(){i.loadPanelVisible=!1}))},updateLegends:function(e){var t=this;if(["pkk","wms"].includes(this.editorOptions.type)){var n=Object(Xe["c"])(this.layerComponentId,et(et({},this.editorOptions),{},{visible:e})),i=Object.keys(n).filter((function(e){return n[e].parentId===t.layerComponentId})),o="loadWms";"pkk"===this.editorOptions.type&&(o="loadArcGis"),this.setOptions({componentId:this.layerComponentId,optionName:"legendStyleItems",optionValue:n}),this.setOptions({componentId:this.layerComponentId,optionName:"legendStyleItemIds",optionValue:i}),this[o]({layerComponentId:this.layerComponentId,update:!0})}}})};function ot(e,t,n){n[t]||n.push([]),n[t].push(et(et({},e),{},{parentIndex:n[t-1]?n[t-1].length-1:-1})),e.group&&e.items.forEach((function(e){ot(e,t+1,n)}))}function at(e){var t=e.length?e[0]:{},n=t.prop?JSON.parse(t.prop):{};return n.editorOptions.wmsUrl&&(n.editorOptions.url=n.editorOptions.wmsUrl),et({},n.editorOptions||nt)}var st=it,rt=(n("112a"),Object(R["a"])(st,i,o,!1,null,null,null));t["a"]=rt.exports},"37de":function(e,t,n){"use strict";var i=n("8f37"),o=n.n(i);o.a},3882:function(e,t,n){"use strict";var i=n("cd62"),o=n.n(i);o.a},"38b2":function(e,t,n){"use strict";var i=n("6a44"),o=n.n(i);o.a},"39d6":function(e,t,n){},"3b72":function(e,t,n){},"3bb0":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{attrs:{visible:e.visible,width:400,height:300,shading:!1},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("div",{staticClass:"gis-attrs-popup__title"},[n("div",{staticClass:"gis-attrs-popup__title-text",attrs:{title:e.title}},[e._v("\n        "+e._s(e.title)+"\n      ")]),n("div",{staticClass:"gis-attrs-popup__title-close-button",on:{click:function(t){return e.$emit("hidden")}}},[n("i",{staticClass:"core core-057-close"})])])]},proxy:!0}])},[n("DxDataGrid",{attrs:{height:"100%",dataSource:e.dataSource},on:{rowDblClick:e.handleRowClick}},[n("DxSearchPanel",{attrs:{visible:!0}}),n("DxSelection",{attrs:{mode:"single"}}),n("DxColumn",{attrs:{dataField:"name",caption:"Название"}}),n("DxColumn",{attrs:{dataField:"caption",caption:"Псевдоним"}})],1)],1)},o=[],a=n("d30a"),s=n.n(a),r=n("d736"),l=n.n(r),c={components:{DxDataGrid:s.a,DxPopup:l.a,DxColumn:a["DxColumn"],DxSearchPanel:a["DxSearchPanel"],DxSelection:a["DxSelection"]},props:{title:String,visible:Boolean,dataSource:Array},methods:{handleRowClick:function(e){this.$emit("dblClick",e.data),this.$emit("hidden")}}},d=c,u=(n("0f81"),n("2877")),p=Object(u["a"])(d,i,o,!1,null,null,null);t["a"]=p.exports},"3ce8":function(e,t,n){"use strict";n("ac4d"),n("8a81"),n("1c4c"),n("8e6e"),n("097d"),n("28a5"),n("55dd"),n("5df3"),n("6b54"),n("a481");var i=n("3835"),o=(n("ffc1"),n("7f7f"),n("96cf"),n("1da1")),a=(n("551c"),n("7514"),n("8615"),n("2909")),s=(n("ac6a"),n("cadf"),n("456d"),n("6762"),n("2fdb"),n("ade3")),r=n("e192"),l=n.n(r),c=n("595b"),d=(n("ac6d"),n("2f62")),u=n("dd50"),p=n("cae8"),f=n.n(p);n("bdd0");function h(e,t){return t.snapMapDraw&&t.snapMapDraw.point?t.snapMapDraw.point:[e.lngLat.lng,e.lngLat.lat]}function m(e){return{x:c["toMercator"](e)[0],y:c["toMercator"](e)[1]}}function g(e){var t=c["point"]([e[0],e[1]]);return c["toWgs84"](t)}function y(e,t,n){var i=c["length"](c["lineString"]([t[n-2],t[n-3]])),o=c["length"](c["lineString"]([e,t[n-2]])),a=o/i,s=[t[n-2][0]+1,t[n-2][1]],r=[t[n-2][0],t[n-2][1]+1],l=c["length"](c["lineString"]([t[n-2],s])),d=c["length"](c["lineString"]([t[n-2],r])),u=l/d,p=(t[n-2][1]-t[n-3][1])*a/u,f=(t[n-2][0]-t[n-3][0])*a*u;return t[n-2][1]>t[n-3][1]?t[n-2][0]>t[n-3][0]?e[1]>t[n-2][1]+p?(e[0]=t[n-2][0]-p,e[1]=t[n-2][1]+f):e[0]>t[n-2][0]+f||e[1]<t[n-2][1]-p?(e[0]=t[n-2][0]+p,e[1]=t[n-2][1]-f):(e[0]=t[n-2][0]-p,e[1]=t[n-2][1]+f):e[1]>t[n-2][1]+p||e[0]>t[n-2][0]-f?(e[0]=t[n-2][0]+p,e[1]=t[n-2][1]-f):(e[0]=t[n-2][0]-p,e[1]=t[n-2][1]+f):t[n-2][0]>t[n-3][0]?e[1]<t[n-2][1]+p?(e[0]=t[n-2][0]+p,e[1]=t[n-2][1]-f):e[0]>t[n-2][0]+f?(e[0]=t[n-2][0]-p,e[1]=t[n-2][1]+f):e[1]<t[n-2][1]-p?(e[0]=t[n-2][0]+p,e[1]=t[n-2][1]-f):(e[0]=t[n-2][0]-p,e[1]=t[n-2][1]+f):e[1]<t[n-2][1]+p||e[0]>t[n-2][0]-f?(e[0]=t[n-2][0]-p,e[1]=t[n-2][1]+f):(e[0]=t[n-2][0]+p,e[1]=t[n-2][1]-f),e}function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _=b(b({},f.a.modes.simple_select),{},{NAME:"directSelectPointMode",onSetup:function(e){var t=this,n=e.geojson,i=this.newFeature(n),o=i.id;this.addFeature(i);var a={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:[o]||!1};return this.setSelected(a.initiallySelectedFeatureIds.filter((function(e){return void 0!==t.getFeature(e)}))),this.fireActionable(),this.setActionableState({trash:!0}),a},dragMove:function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();var n=h(t,this.map),i=this.getSelected()[0];i.updateCoordinate("",n[0],n[1]),e.dragMoveLocation=t.lngLat}}),C=n("e105"),x=n("3436"),O=n.n(x),I=n("9787"),S=n("3e33");function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P=D(D({},C["a"]),{},{NAME:"drawCircleMode",onStop:function(e){this.updateUIClasses({mouse:"none"}),S["a"].enable(this),this.activateUIButton(),void 0!==this.getFeature(e.polygon.id)&&(e.polygon.removeCoordinate("0.".concat(e.currentVertexPosition)),e.polygon.isValid()?this.map.fire("draw.create",{features:[e.polygon.toGeoJSON()],shiftKey:e.shiftKey}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(this.NAME,{},{silent:!0})))},onKeyUp:function(e,t){I["c"](t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(this.NAME)):I["b"](t)&&this.changeMode(this.NAME)}});P.onMouseUp=P.onTouchEnd=function(e,t){return e.shiftKey=t.originalEvent.shiftKey,O.a.enable(this),this.changeMode(this.NAME)};var E=P,w=n("4f01");function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k=j(j({},f.a.modes.draw_line_string),{},{NAME:"drawLineMode",onKeyUp:function(e,t){I["c"](t)?(this.deleteFeature([e.line.id],{silent:!0}),this.map.fire("draw.delete"),this.changeMode(this.NAME)):I["b"](t)&&this.changeMode(this.NAME)},onStop:function(e){this.updateUIClasses({mouse:"none"}),S["a"].enable(this),this.activateUIButton(),void 0!==this.getFeature(e.line.id)&&(e.line.isValid()?this.map.fire("draw.create",{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(this.NAME,{},{silent:!0})))},clickOnVertex:function(e,t){if(2===t.originalEvent.button)e.currentVertexPosition--,e.line.removeCoordinate("".concat(e.currentVertexPosition));else if(0===t.originalEvent.button)return this.changeMode(this.NAME)},onMouseMove:function(e,t){var n=h(t,this.map),i=e.line.coordinates.length;t.originalEvent.ctrlKey&&i>2&&(n=y(n,e.line.coordinates,i)),e.line.updateCoordinate(e.currentVertexPosition,n[0],n[1]),I["e"](t)&&this.updateUIClasses({mouse:"pointer"})},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&Object(w["a"])(t,e.line.coordinates[e.currentVertexPosition-1])||"backwards"===e.direction&&Object(w["a"])(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode("simple_select",{featureIds:[e.line.id]});if(0===t.originalEvent.button){var n=h(t,this.map),i=e.line.coordinates.length;t.originalEvent.ctrlKey&&i>2&&(n=y(n,e.line.coordinates,i)),this.updateUIClasses({mouse:"add"}),e.line.updateCoordinate(e.currentVertexPosition,n[0],n[1]),"forward"===e.direction?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,n[0],n[1])):e.line.addCoordinate(0,n[0],n[1])}2===t.originalEvent.button&&(e.currentVertexPosition--,e.line.removeCoordinate("".concat(e.currentVertexPosition)))}}),F=n("b386");function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A=M(M({},f.a.modes.draw_polygon),{},{NAME:"drawPolygonMode",onKeyUp:function(e,t){I["c"](t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.map.fire("draw.delete"),this.changeMode(this.NAME)):I["b"](t)&&this.changeMode(this.NAME)},onStop:function(e){this.updateUIClasses({mouse:"none"}),S["a"].enable(this),this.activateUIButton(),void 0!==this.getFeature(e.polygon.id)&&(e.polygon.removeCoordinate("0.".concat(e.currentVertexPosition)),e.polygon.isValid()?this.map.fire("draw.create",{features:[e.polygon.toGeoJSON()],shiftKey:e.shiftKey}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(this.NAME,{},{silent:!0})))},clickOnVertex:function(e,t){if(e.shiftKey=t.originalEvent.shiftKey,t.originalEvent.ctrlKey){var n=e.polygon.coordinates[0].length;if(n%2){var i=e.polygon.coordinates[0][n-1],o=e.polygon.coordinates[0][n-3],a=Object(F["a"])(m(o),m(i));this.removeLastCoord(e);var s=e.polygon.coordinates[0][0],r=e.polygon.coordinates[0],l=y(i,r.reverse().slice(1),r.length),c=Object(F["a"])(m(s),m(l)),d=(c.b-a.b)/(a.k-c.k),u=a.k*d+a.b,p=g([d,u]).geometry.coordinates;r.reverse(),e.polygon.updateCoordinate("0.".concat(e.currentVertexPosition),p[0],p[1]),e.polygon.updateCoordinate("0.".concat(e.currentVertexPosition+1),p[0],p[1])}}if(2===t.originalEvent.button)this.removeLastCoord(e);else if(0===t.originalEvent.button)return this.changeMode(this.NAME)},onMouseMove:function(e,t){var n=h(t,this.map),i=e.polygon.coordinates[0]?e.polygon.coordinates[0].length:0;t.originalEvent.ctrlKey&&i>2&&(n=y(n,e.polygon.coordinates[0],i)),e.polygon.updateCoordinate("0.".concat(e.currentVertexPosition),n[0],n[1]),I["e"](t)&&this.updateUIClasses({mouse:"pointer"})},clickAnywhere:function(e,t){if(e.shiftKey=t.originalEvent.shiftKey,e.polygon.coordinates[0][0]||(e.currentVertexPosition=0),e.currentVertexPosition>0&&Object(w["a"])(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode("simple_select",{featureIds:[e.polygon.id]});if(0===t.originalEvent.button){var n=h(t,this.map),i=e.polygon.coordinates[0]?e.polygon.coordinates[0].length:0;t.originalEvent.ctrlKey&&i>2&&(n=y(n,e.polygon.coordinates[0],i)),this.updateUIClasses({mouse:"add"}),e.polygon.updateCoordinate("0.".concat(e.currentVertexPosition),n[0],n[1]),e.currentVertexPosition++,e.polygon.updateCoordinate("0.".concat(e.currentVertexPosition),n[0],n[1])}2===t.originalEvent.button&&this.removeLastCoord(e)},removeLastCoord:function(e){e.currentVertexPosition--;var t=e.polygon.coordinates.length?e.polygon.coordinates[0].length:0,n=e.polygon.coordinates[0][0],i=e.polygon.coordinates[0][2];e.polygon.removeCoordinate("0.".concat(e.currentVertexPosition)),e.polygon.coordinates.length||3!==t||(e.polygon.updateCoordinate("0.0",n[0],n[1]),e.polygon.updateCoordinate("0.1",i[0],i[1]))}}),R=n("a4bb"),V={NAME:"drawRectangleDragMode",onSetup:function(){var e=this.newFeature({type:R["geojsonTypes"].FEATURE,properties:{},geometry:{type:R["geojsonTypes"].POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),S["a"].disable(this),O.a.disable(this),this.updateUIClasses({mouse:R["cursors"].ADD}),this.setActionableState({trash:!0}),{rectangle:e}},onMouseDown:function(e,t){var n=[t.lngLat.lng,t.lngLat.lat];e.startPoint=n},onClick:function(e){e.startPoint=null},onDrag:function(e,t){e.startPoint&&(e.rectangle.updateCoordinate("0.0",e.startPoint[0],e.startPoint[1]),e.rectangle.updateCoordinate("0.1",t.lngLat.lng,e.startPoint[1]),e.rectangle.updateCoordinate("0.2",t.lngLat.lng,t.lngLat.lat),e.rectangle.updateCoordinate("0.3",e.startPoint[0],t.lngLat.lat),e.rectangle.updateCoordinate("0.4",e.startPoint[0],e.startPoint[1]))},onMouseUp:function(e,t){return e.shiftKey=t.originalEvent.shiftKey,this.updateUIClasses({mouse:R["cursors"].POINTER}),O.a.enable(this),this.changeMode(this.NAME)},onKeyUp:function(e,t){I["c"](t)?(this.deleteFeature([e.rectangle.id],{silent:!0}),this.changeMode(this.NAME)):I["b"](t)&&this.changeMode(this.NAME)},toDisplayFeatures:function(e,t,n){var i=t.properties.id===e.rectangle.id;return t.properties.active=i?"true":"false",i?e.startPoint?n(t):void 0:n(t)},onStop:function(e){this.updateUIClasses({mouse:"none"}),S["a"].enable(this),this.activateUIButton(),void 0!==this.getFeature(e.rectangle.id)&&(e.rectangle.removeCoordinate("0.4"),e.rectangle.isValid()?this.map.fire("draw.create",{features:[e.rectangle.toGeoJSON()],shiftKey:e.shiftKey}):(this.deleteFeature([e.rectangle.id],{silent:!0}),this.changeMode(this.NAME,{},{silent:!0})))}};V.onMouseMove=V.onDrag;var G=V;function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var U=N(N({},f.a.modes.draw_point),{},{NAME:"drawPointMode",onClick:function(e,t){if(0===t.originalEvent.button){this.updateUIClasses({mouse:"move"});var n=h(t,this.map);e.point.updateCoordinate("",n[0],n[1]),this.map.fire("draw.create",{features:[e.point.toGeoJSON()]}),this.changeMode(this.NAME,{featureIds:[e.point.id]})}}}),z=n("a6af");function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var K=W(W({},f.a.modes.direct_select),{},{NAME:"directSelectMode",onSetup:function(e){var t=e.geojson;if(!t)throw new Error("You must provide a geojson to enter direct_select mode");var n=this.newFeature(t),i=n.id;if(this.addFeature(n),"Point"===n.type)throw new TypeError("direct_select mode doesn't handle point features");var o={featureId:i,feature:n,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(i,o.selectedCoordPaths)),this.setSelected(i),S["a"].disable(this),this.setActionableState({trash:!0}),o},onClick:function(e,t){return Object(I["a"])(t)?this.clickActiveFeature(e,t):Object(I["d"])(t)?this.clickInactive(e,t):void this.stopDragging(e)},dragVertex:function(e,t,n){for(var i=e.selectedCoordPaths.map((function(t){return e.feature.getCoordinate(t)})),o=i.map((function(e){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:e}}})),a=Object(z["a"])(o,n),s=0;s<i.length;s++){var r=i[s];this.map.snapMapDraw&&this.map.snapMapDraw.point?e.feature.updateCoordinate(e.selectedCoordPaths[s],this.map.snapMapDraw.point[0],this.map.snapMapDraw.point[1]):e.feature.updateCoordinate(e.selectedCoordPaths[s],r[0]+a.lng,r[1]+a.lat)}}});function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Z=J(J({},f.a.modes.simple_select),{},{NAME:"moveMode",onSetup:function(e){var t=this,n={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(n.initiallySelectedFeatureIds.filter((function(e){return void 0!==t.getFeature(e)}))),this.fireActionable(),this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:!1}),n},onClick:function(){}}),Y=n("bc2f"),X=n("bf8c"),Q=n("1284"),ee=n("f87d"),te=n.n(ee),ne=n("5a1f"),ie=n.n(ne),oe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-context-menu"},[e._t("default")],2)},ae=[],se={},re=se,le=(n("e531"),n("2877")),ce=Object(le["a"])(re,oe,ae,!1,null,null,null),de=ce.exports,ue=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-context-menu-item"},[e._v("\n  "+e._s(e.text)+"\n")])},pe=[],fe={props:{text:String}},he=fe,me=(n("927b"),Object(le["a"])(he,ue,pe,!1,null,null,null)),ge=me.exports,ye=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"gis-popup-edit-layer-style",attrs:{animation:null,visible:e.visible,shading:!1,resizeEnabled:!0,title:"Редактирование слоя «"+(e.layerConfig.name||"")+"»",position:e.popupPosition,width:800,height:"auto",maxHeight:e.popupMaxHeight,minHeight:300,toolbarItems:e.toolbarItems,container:e.popupContainer},on:{shown:e.onShown},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:"Редактирование слоя «"+(e.layerConfig.name||"")+"»",showCloseButton:!0},on:{closeClick:e.close}})]},proxy:!0}])},[n("div",{staticClass:"gis-popup-edit-layer-style__wrapper"},[e.showContent&&e.VECTOR_LAYER_TYPES.includes(e.layerConfig.type)?n("GisGeoJsonStyle",{ref:"gisGeoJsonStyle",attrs:{dataFields:e.layerConfig.dataFields,layerType:e.layerConfig.type,layerName:e.layerConfig.name,layers:e.layerConfig.styles,selectionLayers:e.layerConfig.selectionStyles,hoverLayers:e.layerConfig.hoverStyles,layersImages:e.layerConfig.images,filterFields:e.layerConfig.filterFields,dataset:e.layerConfig.dataset,layerComponentId:e.layerConfig.componentId,geomTypes:e.layerConfig.geomTypes,popupContainer:e.popupContainer}}):e._e(),!e.showContent||e.VECTOR_LAYER_TYPES.includes(e.layerConfig.type)||e.layerConfig.raster?e._e():n("GisWmsStyle",{ref:"gisWmsStyle",attrs:{layerName:e.layerConfig.layerName,layerText:e.layerConfig.name}}),e.showContent&&!e.VECTOR_LAYER_TYPES.includes(e.layerConfig.type)&&e.layerConfig.raster?n("GisRasterStyle",{ref:"gisRasterStyle",attrs:{layerName:e.layerConfig.layerName,layerText:e.layerConfig.name,popupContainer:e.popupContainer}}):e._e()],1)])},ve=[],be=n("d736"),_e=n.n(be),Ce=n("25aa"),xe=n("1efe"),Oe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-wms-style"},[n("div",{staticClass:"gis-wms-style__workspace"},[null!==e.styleId&&e.rules.length?n("div",{staticClass:"gis-wms-style__list-wrapper"},[n("DxSortable",{attrs:{filter:".gis-wms-rule",handle:".gis-wms-rule__header",dropFeedbackMode:"indicate",height:"100%"},on:{reorder:e.onRuleReorder}},[n("DxScrollView",[n("div",{staticClass:"gis-wms-style__list"},e._l(e.rules,(function(t){return n("GisWmsRule",{key:t.id,attrs:{id:t.id,optionsFields:t.options,filter:t.filter,symbolizers:t.symbolizers,dataSources:e.dataSources,isOpen:t.isOpen},on:{changed:e.onChanged,toggleVisibility:e.onToggleRule,deleteRule:function(n){return e.onDeleteRule(t)},deleteSymbolizer:e.onDeleteSymbolizer,reorderSymbolizer:e.onSymbolizerReorder}})})),1)])],1)],1):e.loadIndicatorOptions.visible?e._e():n("div",[e._v("Слоя нет в базе")]),n("div",{staticClass:"gis-wms-style__button-group"},[n("GisToolbarButtonGroup",[n("GisToolbarButton",{attrs:{active:!1,disabled:!1,iconCss:"fas fa-filter",text:"Добавить правило"},on:{click:function(t){return e.onAddRule()}}}),n("GisToolbarButton",{attrs:{active:!1,disabled:!1,iconCss:"core core-112-circle",text:"Добавить слой с точкой"},on:{click:function(t){return e.onAddSymbolizer("point")}}}),n("GisToolbarButton",{attrs:{active:!1,disabled:!1,iconCss:"core core-094-line",text:"Добавить слой с линией"},on:{click:function(t){return e.onAddSymbolizer("line")}}}),n("GisToolbarButton",{attrs:{active:!1,disabled:!1,iconCss:"core core-034-add-poly-2",text:"Добавить слой с полигоном"},on:{click:function(t){return e.onAddSymbolizer("polygon")}}}),n("GisToolbarButton",{attrs:{active:!1,disabled:!1,iconCss:"core core-113-text",text:"Добавить слой с текстом"},on:{click:function(t){return e.onAddSymbolizer("text")}}})],1)],1)]),n("div",[n("div",{staticClass:"gis-wms-style__preview"},[n("div",{ref:"mapContainer",staticClass:"gis-wms-style__preview-map"}),n("div",{staticClass:"gis-wms-style__preview-loader"},[n("DxLoadIndicator",{attrs:{visible:e.previewLoading}})],1)]),n("div",{staticClass:"gis-wms-style__buttons"},[n("GisToolbarButtonGroup",[n("GisToolbarButton",{attrs:{active:!1,disabled:!1,iconCss:"core core-styles",text:"Добавить стиль из реестра"},on:{click:function(t){e.styleListOptions.visible=!0}}}),n("GisToolbarButton",{attrs:{active:!1,disabled:!1,iconCss:"core core-016-save",text:"Сохранить стиль"},on:{click:e.saveStyle}})],1)],1)]),n("DxLoadPanel",e._b({attrs:{container:".gis-wms-style"}},"DxLoadPanel",e.loadIndicatorOptions,!1)),n("SaveStyleForm",e._b({on:{shown:function(t){e.saveStylePopupOptions.visible=!0},hidden:function(t){e.saveStylePopupOptions.visible=!1}}},"SaveStyleForm",e.saveStylePopupOptions,!1)),n("StyleListPopup",e._b({on:{shown:function(t){e.styleListOptions.visible=!0},hidden:function(t){e.styleListOptions.visible=!1},apply:e.addListLayers}},"StyleListPopup",e.styleListOptions,!1))],1)},Ie=[],Se=(n("20d6"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-wms-rule",class:{"gis-wms-rule_closed":!e.isOpen}},[n("div",{staticClass:"gis-wms-rule__header"},[n("div",{staticClass:"gis-wms-rule__icon",on:{click:function(t){return e.$emit("toggleVisibility",{id:e.id,isOpen:!e.isOpen})}}},[n("i",{staticClass:"core",class:e.isOpen?"core-116-arrow-down":"core-117-arrow-right"})]),n("div",{staticClass:"gis-wms-rule__title"},[e._v(e._s(e.optionsFields.caption))]),n("div",{staticClass:"gis-wms-rule__icon",on:{click:function(t){return e.$emit("deleteRule")}}},[n("i",{staticClass:"core core-023-delete"})])]),n("div",{staticClass:"gis-wms-rule__content"},[n("GisStyleItem",{attrs:{title:"Опции",componentOptions:e.ruleComponentOptions,isOpen:e.isOptionsOpen,component:"GisWmsOptionsForm",deleteButton:!1,popupContainer:e.popupContainer},on:{changed:function(t){return e.$emit("changed",Object.assign({},{ruleId:e.id},t))},toggle:function(t){e.isOptionsOpen=t}}}),n("DxSortable",{attrs:{filter:".gis-style-item",handle:".gis-style-item__header",dropFeedbackMode:"indicate",height:"100%"},on:{reorder:function(t){return e.$emit("reorderSymbolizer",{ruleId:e.id,eventData:t})}}},[n("div",e._l(e.symbolizers,(function(t){return n("GisStyleItem",{key:t.fields.id,attrs:{title:t.title,componentOptions:{fields:t.fields,dataSources:e.dataSources},isOpen:t.isOpen,component:t.componentType,popupContainer:e.popupContainer},on:{changed:function(n){return e.$emit("changed",{ruleId:e.id,symbolizer:t})},delete:function(n){return e.$emit("deleteSymbolizer",t)}}})})),1)])],1)])}),Le=[],De=(n("c5f6"),n("04be")),Pe=n("0342"),Ee=n.n(Pe),we={name:"GisWmsRule",components:{GisStyleItem:De["a"],DxSortable:Ee.a},props:{id:[Number,String],optionsFields:Object,symbolizers:Array,isOpen:Boolean,dataSources:Object,filter:Object,popupContainer:null},data:function(){return{isOptionsOpen:!0}},computed:{ruleComponentOptions:function(){return{fields:this.optionsFields,filter:this.filter,isOpen:this.isOptionsOpen&&this.isOpen}}}},Te=we,je=(n("6fce"),Object(le["a"])(Te,Se,Le,!1,null,null,null)),ke=je.exports,Fe=n("84a9"),Be=n("62b3"),Me=n("d34a"),Ae=n("cfbd"),Re=n("5bba"),Ve=n.n(Re),Ge=n("4f34"),$e=n.n(Ge),Ne=n("bc56");function Ue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var He=Object({NODE_ENV:"production",VUE_APP_API_FILES_SERVICE:"https://files-service.rusgis.com/apiFiles",VUE_APP_API_SERVICE:"https://api.rusgis.com/api",VUE_APP_DATASET_SERVICE:"https://ds.rusgis.com/dataset",VUE_APP_DOWNLOAD_FILE_SERVICE:"https://files-service.rusgis.com/downloadFile",VUE_APP_GET_PORTRAIT_IMAGE_SERVICE:"https://files-service.rusgis.com/getPortraitImage",VUE_APP_INNER_TILE_SERVICES:"/tms,http://89.108.84.38:8101/tms,https://composite.rusgis.com",VUE_APP_JS_API:"true",VUE_APP_PROXY_SERVICE:"https://proxy.rusgis.com/proxy",VUE_APP_SHOW_DESIGNER_SERVICE:"https://reports.rusgis.com/showDesigner",VUE_APP_SHOW_REPORT_SERVICE:"https://reports.rusgis.com/showReport",VUE_APP_UPLOAD_FILE_SERVICE:"https://files-service.rusgis.com/uploadFile",VUE_APP_USER_ID:"500322",BASE_URL:"/"}).VUE_APP_WMS_STYLE_PREVIEW,We=100,Ke={polygon:"GIS.DSPOLYGONSYMBOLIZER",line:"GIS.DSLINESYMBOLIZER",point:"GIS.DSPOINTSYMBOLIZER",text:"GIS.DSTEXTSYMBOLIZER"},qe={polygon:{componentType:"GisWmsPolygonStyleForm",title:"Полигон",isOpen:!1},line:{componentType:"GisWmsLineStyleForm",title:"Линия",isOpen:!1},point:{componentType:"GisWmsPointStyleForm",title:"Точка",isOpen:!1},text:{componentType:"GisWmsTextStyleForm",title:"Текст",isOpen:!1}},Je={name:"GisWmsStyle",components:{GisWmsRule:ke,DxScrollView:ie.a,DxLoadPanel:Ve.a,DxLoadIndicator:$e.a,GisToolbarButtonGroup:Fe["a"],GisToolbarButton:Be["a"],SaveStyleForm:Me["a"],StyleListPopup:Ae["a"],DxSortable:Ee.a},props:{layerName:String,layerText:String},data:function(){return{rules:[],dataSources:{},styleId:null,layerId:null,loadIndicatorOptions:{visible:!1,container:".gis-wms-style",position:{at:"center",my:"center",of:".gis-wms-style"}},previewLoading:!1,mapbox:null,saveStylePopupOptions:{visible:!1,name:this.layerText,title:"Сохранить стиль слоя «".concat(this.layerText||"","»"),styleType:1,styleBody:null},styleListOptions:{visible:!1,styleType:1}}},mounted:function(){this.initMapPreview(),this.getDataSources()},watch:{layerName:{handler:function(){this.getRules()},immediate:!0}},methods:{initMapPreview:function(){this.mapbox=new l.a.Map({container:this.$refs.mapContainer,center:[37.444132,55.771558],zoom:13}),this.mapbox.addSource("preview",{bounds:[-180,-85.051129,180,85.051129],maxzoom:22,minzoom:0,tileSize:256,tiles:[He],type:"raster"})},repaintPreview:function(){this.mapbox.getLayer("preview")&&this.mapbox.removeLayer("preview"),this.mapbox.addLayer({id:"preview",maxzoom:22,minzoom:0,source:"preview",type:"raster"})},setPreview:function(){var e=this;this.previewLoading=!0,Object(X["c"])("getData",{_config_dataset:"GIS.PRPUBLICSTYLE",style_id:We}).then((function(){e.repaintPreview()})).finally((function(){e.previewLoading=!1}))},getDataSources:function(){this.layerName&&(this.getMarks(),this.getFormat(),this.getStrokeLineCup(),this.getStrokeLineJoin())},getMarks:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:Object(X["c"])("getData",{_config_dataset:"GIS.DSMARK"}).then((function(e){t.dataSources.marks=e}));case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),getFormat:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:Object(X["c"])("getData",{_config_dataset:"GIS.DSFORMAT"}).then((function(e){t.dataSources.format=e}));case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),getStrokeLineCup:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:Object(X["c"])("getData",{_config_dataset:"GIS.DSSTROKELINECAP"}).then((function(e){t.dataSources.strokeLineCap=e}));case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),getStrokeLineJoin:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:Object(X["c"])("getData",{_config_dataset:"GIS.DSSTROKELINEJOIN"}).then((function(e){t.dataSources.strokeLineJoin=e}));case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),getRules:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.layerName){e.next=2;break}return e.abrupt("return");case 2:this.loadIndicatorOptions.visible=!0,this.previewLoading=!0,Object(X["c"])("getData",{layer_name:this.layerName,_config_dataset:"GIS.DSLAYER"}).then((function(e){var n=e.find((function(e){return null!==e.layerstyle_id}));return t.layerId=n.id,t.styleId=n.layerstyle_id,Object(X["c"])("getData",{_config_dataset:"GIS.PRSETPREVIEW",style_id:t.styleId})})).then((function(){return t.repaintPreview(),t.previewLoading=!1,Object(X["c"])("getData",{_config_dataset:"GIS.DSRULE",style_id:We})})).then((function(e){var n={};if(!e||!e.length)return t.previewLoading=!1,void(t.loadIndicatorOptions.visible=!1);e.sort((function(e,t){return e.pos-t.pos})).forEach((function(e){n[e.id]={id:e.id,options:e,symbolizers:[],filter:{}}}));var o=[],a=Object(X["c"])("getData",{_config_dataset:"GIS.PRPARCEFILTER",layer_id:t.layerId}).then((function(e){e.forEach((function(e){n[e.rule_id].filter={body:JSON.parse(e.body),fields:JSON.parse(e.fields)}}))}));o.push(a),Object.entries(Ke).forEach((function(e){var t=Object(i["a"])(e,2),s=t[0],r=t[1];a=Object(X["c"])("getData",{_config_dataset:r,rule_id:Object.keys(n)}).then((function(e){e.length&&e.forEach((function(e){n[e.rule_id].symbolizers.push(ze({fields:e,type:s},qe[s]))}))})),o.push(a)})),Promise.all(o).then((function(){n=Object.values(n).map((function(e,t){return ze(ze({},e),{},{isOpen:!t})})),n.forEach((function(e){e.symbolizers.sort((function(e,t){return e.fields.pos-t.fields.pos}))})),t.rules=n})).finally((function(){t.previewLoading=!1,t.loadIndicatorOptions.visible=!1}))})).catch((function(){t.previewLoading=!1,t.loadIndicatorOptions.visible=!1}));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onToggleRule:function(e){var t=e.id,n=e.isOpen;this.rules.forEach((function(e){e.id===t?e.isOpen=n:n&&(e.isOpen=!n)}))},onAddRule:function(){var e=this,t={options:{caption:"Новое правило",maxscaledenominator:null,minscaledenominator:null,pos:this.rules.length?this.rules[this.rules.length-1].options.pos+100:100},symbolizers:[],filter:{body:null,fields:this.rules[0].filter.fields},isOpen:!0};this.loadIndicatorOptions.visible=!0,Object(X["c"])("insertData",ze({_config_dataset:"GIS.DSRULE",style_id:We},t.options)).then((function(n){t.id=n[0].id,t.options=n[0],e.rules.forEach((function(e){e.isOpen=!1})),e.rules.push(t)})).finally((function(){e.loadIndicatorOptions.visible=!1}))},onAddSymbolizer:function(e){var t=this;this.loadIndicatorOptions.visible=!0;var n=this.rules.find((function(e){return e.isOpen}));n||(n=this.rules[0],n.isOpen=!0);var i=n.symbolizers,o=ze({fields:{rule_id:n.id,pos:i.length?i[i.length-1].fields.pos+100:100},type:e},qe[e]);Object(X["c"])("insertData",ze(ze({},o.fields),{},{_config_dataset:Ke[e]})).then((function(e){t.setPreview(),o.fields=e[0],i.push(o)})).finally((function(){t.loadIndicatorOptions.visible=!1}))},onDeleteRule:function(e){var t=this;this.loadIndicatorOptions.visible=!0,Object(X["c"])("deleteData",{_config_dataset:"GIS.DSRULE",id:e.id}).then((function(){t.setPreview();var n=t.rules.findIndex((function(t){return t.id===e.id}));t.rules.splice(n,1)})).finally((function(){t.loadIndicatorOptions.visible=!1}))},onDeleteSymbolizer:function(e){var t=this;this.loadIndicatorOptions.visible=!0,Object(X["c"])("deleteData",{_config_dataset:Ke[e.type],id:e.fields.id}).then((function(){t.setPreview();var n=t.rules.find((function(t){return t.id===e.fields.rule_id})),i=n.symbolizers,o=i.findIndex((function(t){return t===e}));i.splice(o,1)})).finally((function(){t.loadIndicatorOptions.visible=!1}))},onRuleReorder:function(e){var t=this,n=e.fromIndex,i=e.toIndex,o=i-n<0?-1:1,a=this.rules[n],s=this.rules[i],r=this.rules[i+o];a.options.pos=r?Math.round((s.options.pos+r.options.pos)/2):s.options.pos+100*o,this.rules.sort((function(e,t){return e.options.pos-t.options.pos})),Object(X["c"])("updateData",ze(ze({},a.options),{},{_config_dataset:"GIS.DSRULE"})).then((function(){t.setPreview()}))},onSymbolizerReorder:function(e){var t=this,n=e.ruleId,i=e.eventData,o=i.fromIndex,a=i.toIndex,s=this.rules.find((function(e){return e.id===n})),r=a-o<0?-1:1,l=s.symbolizers[o],c=s.symbolizers[a],d=s.symbolizers[a+r];l.fields.pos=d?Math.round((c.fields.pos+d.fields.pos)/2):c.fields.pos+100*r,s.symbolizers.sort((function(e,t){return e.fields.pos-t.fields.pos})),Object(X["c"])("updateData",ze(ze({},l.fields),{},{_config_dataset:Ke[l.type]})).then((function(){t.setPreview()}))},onChanged:function(e){var t=this,n=e.ruleId,i=e.filter,o=e.symbolizer;if(void 0!==o)Object(X["c"])("updateData",ze(ze({},o.fields),{},{_config_dataset:Ke[o.type]})).then((function(){t.setPreview()}));else if(void 0!==i)Object(X["c"])("updateData",{filter:i,rule_id:n,_config_dataset:"GIS.PRPARCEFILTER"});else{var a=this.rules.find((function(e){return e.id===n}));Object(X["c"])("updateData",ze(ze({},a.options),{},{_config_dataset:"GIS.DSRULE"}))}},apply:function(){var e=this;return this.loadIndicatorOptions.visible=!0,Object(X["c"])("getData",{style_id:this.styleId,_config_dataset:"GIS.PRSETSTYLEFROMPREVIEW"}).finally((function(){e.loadIndicatorOptions.visible=!1}))},saveStyle:function(){this.saveStylePopupOptions.styleBody=this.rules,this.saveStylePopupOptions.visible=!0},addListLayers:function(e){var t=this;this.styleListOptions.visible=!1,this.loadIndicatorOptions.visible=!0;var n=JSON.parse(e.replace(/\\/g,"")),i={},o=[];Object(X["c"])("insertData",n.map((function(e){return ze(ze({_config_dataset:"GIS.DSRULE",style_id:We},e.options),{},{feature_id:null})}))).then((function(e){var a={};e.forEach((function(e,o){a[n[o].id]=e.id,i[e.id]={id:e.id,options:e,isOpen:!1,filter:{body:Object(Ne["b"])(n[o].filter.body,t.rules[0].filter.fields),fields:t.rules[0].filter.fields},symbolizers:[]}}));var s=[];return n.forEach((function(e){s.push({filter:Object(Ne["b"])(e.filter.body,t.rules[0].filter.fields),rule_id:a[e.id],_config_dataset:"GIS.PRPARCEFILTER"}),o.push(null),e.symbolizers.forEach((function(t){s.push(ze(ze({_config_dataset:Ke[t.type]},t.fields),{},{rule_id:a[e.id]})),o.push(t.type)}))})),Object(X["c"])("insertData",s)})).then((function(e){var n;e.forEach((function(e,t){o[t]&&i[e.rule_id].symbolizers.push(ze(ze({},qe[o[t]]),{},{fields:e,type:o[t]}))})),(n=t.rules).push.apply(n,Object(a["a"])(Object.values(i))),t.setPreview()})).finally((function(){t.loadIndicatorOptions.visible=!1}))}}},Ze=Je,Ye=(n("bb40"),Object(le["a"])(Ze,Oe,Ie,!1,null,null,null)),Xe=Ye.exports,Qe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-raster-style"},[n("div",{staticClass:"gis-raster-style__workspace"},[n("DxScrollView",[n("div",{staticClass:"gis-raster-style__list-wrapper"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Изображение"}},[e._v("\n            Изображение\n          ")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.imagesDataSource,valueExpr:"value",displayExpr:"name",value:e.image},on:{valueChanged:e.imageChanged,opened:e.selectBoxOpened}})],1)]),"colored"===e.image?n("GisRasterColoredForm",{attrs:{channels:e.channelsList,fields:e.coloredChannels,popupContainer:e.popupContainer},on:{formChanged:function(t){e.coloredChannels=t}}}):e._e(),"gray"===e.image?n("GisRasterGrayForm",{attrs:{channels:e.channelsList,fields:e.grayChannels,gradients:e.gradients,popupContainer:e.popupContainer},on:{formChanged:function(t){e.grayChannels=t}}}):e._e()],1)])],1),n("DxLoadPanel",e._b({attrs:{container:".gis-raster-style"}},"DxLoadPanel",e.loadIndicatorOptions,!1))],1)},et=[],tt=n("049d"),nt=n.n(tt),it=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-raster-colored-form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Красный канал"}},[e._v("\n      Красный канал\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.channels,valueExpr:"value",displayExpr:"name",value:e.redChannel.number},on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.handleFieldsChanged("redChannel",{number:t.value})}}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"}),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-raster-colored-form__slider-wrapper"},[n("CustomRangeSlider",{class:e.redSliderClass,attrs:{min:0,max:255,start:e.redChannel.minvalue,end:e.redChannel.maxvalue},on:{valueChanged:function(t){return e.handleFieldsChanged("redChannel",{minvalue:t.start,maxvalue:t.end,is_defaultvalue:!1})}}}),n("DxButton",{attrs:{hint:"Сбросить",icon:"close"},on:{click:function(t){return e.handleFieldsChanged("redChannel",{minvalue:0,maxvalue:255,is_defaultvalue:!0})}}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Зеленый канал"}},[e._v("\n      Зеленый канал\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.channels,valueExpr:"value",displayExpr:"name",value:e.greenChannel.number},on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.handleFieldsChanged("greenChannel",{number:t.value})}}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"}),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-raster-colored-form__slider-wrapper"},[n("CustomRangeSlider",{class:e.greenSliderClass,attrs:{min:0,max:255,start:e.greenChannel.minvalue,end:e.greenChannel.maxvalue},on:{valueChanged:function(t){return e.handleFieldsChanged("greenChannel",{minvalue:t.start,maxvalue:t.end,is_defaultvalue:!1})}}}),n("DxButton",{attrs:{hint:"Сбросить",icon:"close"},on:{click:function(t){return e.handleFieldsChanged("greenChannel",{minvalue:0,maxvalue:255,is_defaultvalue:!0})}}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Синий канал"}},[e._v("\n      Синий канал\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.channels,valueExpr:"value",displayExpr:"name",value:e.blueChannel.number},on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.handleFieldsChanged("blueChannel",{number:t.value})}}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"}),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-raster-colored-form__slider-wrapper"},[n("CustomRangeSlider",{class:e.blueSliderClass,attrs:{min:0,max:255,start:e.blueChannel.minvalue,end:e.blueChannel.maxvalue},on:{valueChanged:function(t){return e.handleFieldsChanged("blueChannel",{minvalue:t.start,maxvalue:t.end,is_defaultvalue:!1})}}}),n("DxButton",{attrs:{hint:"Сбросить",icon:"close"},on:{click:function(t){return e.handleFieldsChanged("blueChannel",{minvalue:0,maxvalue:255,is_defaultvalue:!0})}}})],1)])])])},ot=[],at=n("6191"),st=n.n(at),rt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"custom-range-slider"},[n("div",{staticClass:"custom-range-slider__wrapper"},[n("span",{staticClass:"custom-range-slider__label"},[e._v("Мин.")]),n("DxNumberBox",{attrs:{disable:!0,width:44,value:e.start,min:e.min,max:e.max},on:{valueChanged:function(t){return e.onValueChanged({start:t.value,end:e.end})}}}),n("DxRangeSlider",{staticClass:"custom-range-slider__slider",attrs:{min:e.min,max:e.max,value:[e.start,e.end]},on:{valueChanged:e.onValueChanged}}),n("span",{staticClass:"custom-range-slider__label"},[e._v("Макс.")]),n("DxNumberBox",{attrs:{width:44,value:e.end,min:e.min,max:e.max},on:{valueChanged:function(t){return e.onValueChanged({start:e.start,end:t.value})}}})],1)])},lt=[],ct=n("9435"),dt=n.n(ct),ut=n("7ea3"),pt=n.n(ut),ft={name:"CustomRangeSlider",components:{DxRangeSlider:dt.a,DxNumberBox:pt.a},props:{start:Number,end:Number,min:Number,max:Number},methods:{onValueChanged:function(e){e.start===this.start&&e.end===this.end||this.$emit("valueChanged",e)}}},ht=ft,mt=(n("dbf2"),Object(le["a"])(ht,rt,lt,!1,null,null,null)),gt=mt.exports,yt=n("5c46");function vt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function bt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vt(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _t=["redChannel","greenChannel","blueChannel"],Ct={number:null,maxvalue:255,minvalue:0,is_defaultvalue:!0},xt="gis-raster-colored-form__slider",Ot={name:"GisRasterColoredForm",mixins:[yt["a"]],components:{DxSelectBox:nt.a,CustomRangeSlider:gt,DxButton:st.a},props:{channels:Array,fields:Array},computed:{redChannel:function(){return this.fields.find((function(e){return"RedChannel"===e.channeltype_name}))||bt(bt({},Ct),{},{channeltype_id:1,channeltype_name:"RedChannel"})},redSliderClass:function(){var e;return e={},Object(s["a"])(e,xt,!0),Object(s["a"])(e,"".concat(xt,"_default"),this.redChannel.is_defaultvalue),e},greenChannel:function(){return this.fields.find((function(e){return"GreenChannel"===e.channeltype_name}))||bt(bt({},Ct),{},{channeltype_id:2,channeltype_name:"GreenChannel"})},greenSliderClass:function(){var e;return e={},Object(s["a"])(e,xt,!0),Object(s["a"])(e,"".concat(xt,"_default"),this.greenChannel.is_defaultvalue),e},blueChannel:function(){return this.fields.find((function(e){return"BlueChannel"===e.channeltype_name}))||bt(bt({},Ct),{},{channeltype_id:3,channeltype_name:"BlueChannel"})},blueSliderClass:function(){var e;return e={},Object(s["a"])(e,xt,!0),Object(s["a"])(e,"".concat(xt,"_default"),this.blueChannel.is_defaultvalue),e}},methods:{handleFieldsChanged:function(e,t){var n=this,i=_t.map((function(i){return e!==i?n[i]:bt(bt({},n[i]),t)}));this.$emit("formChanged",i)}}},It=Ot,St=(n("88301"),Object(le["a"])(It,it,ot,!1,null,null,null)),Lt=St.exports,Dt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-raster-gray-form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Канал серого"}},[e._v("\n      Канал серого\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.channels.slice(1),valueExpr:"value",displayExpr:"name",value:e.fields[0].number},on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.handleFieldsChanged({number:t.value})}}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Градиент"}},[e._v("\n      Градиент\n    ")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.gradients,valueExpr:"id",displayExpr:"name",value:e.fields[0].gradienttype_id},on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.handleFieldsChanged({gradienttype_id:t.value})}}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"}),n("div",{staticClass:"dx-field-value"},[n("div",{staticClass:"gis-raster-gray-form__slider-wrapper"},[n("CustomRangeSlider",{class:e.sliderClass,attrs:{min:0,max:255,start:e.fields[0].minvalue,end:e.fields[0].maxvalue},on:{valueChanged:function(t){return e.handleFieldsChanged({minvalue:t.start,maxvalue:t.end,is_defaultvalue:!1})}}}),n("DxButton",{attrs:{hint:"Сбросить",icon:"close"},on:{click:function(t){return e.handleFieldsChanged({minvalue:0,maxvalue:255,is_defaultvalue:!0})}}})],1)])])])},Pt=[];function Et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function wt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Et(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Et(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Tt="gis-raster-gray-form__slider",jt={name:"GisRasterGrayForm",mixins:[yt["a"]],components:{DxSelectBox:nt.a,DxButton:st.a,CustomRangeSlider:gt},props:{channels:Array,fields:Array,gradients:Array},computed:{sliderClass:function(){var e;return e={},Object(s["a"])(e,Tt,!0),Object(s["a"])(e,"".concat(Tt,"_default"),this.fields[0].is_defaultvalue),e}},methods:{handleFieldsChanged:function(e){var t=wt(wt({},this.fields[0]),e);this.$emit("formChanged",[t])}}},kt=jt,Ft=(n("c01e"),Object(le["a"])(kt,Dt,Pt,!1,null,null,null)),Bt=Ft.exports,Mt=n("a045");function At(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?At(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):At(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Vt="GIS.DSRASTERSYMBOLIZER",Gt="GIS.DSCHANNEL",$t="GIS.DSGRADIENTTYPE",Nt="GIS.PRPUBLICSTYLE",Ut=[{channeltype_id:1,channeltype_name:"RedChannel",number:1,maxvalue:255,minvalue:0,is_defaultvalue:!0},{channeltype_id:2,channeltype_name:"GreenChannel",number:2,maxvalue:255,minvalue:0,is_defaultvalue:!0},{channeltype_id:3,channeltype_name:"BlueChannel",number:3,maxvalue:255,minvalue:0,is_defaultvalue:!0}],zt=[{channeltype_id:4,channeltype_name:"GrayChannel",number:1,maxvalue:255,minvalue:0,is_defaultvalue:!0,gradienttype_id:1}],Ht={name:"GisRasterStyle",mixins:[yt["a"]],components:{DxScrollView:ie.a,DxSelectBox:nt.a,GisRasterColoredForm:Lt,GisRasterGrayForm:Bt,DxLoadPanel:Ve.a},props:{layerName:String,layerText:String},data:function(){return{image:null,imagesDataSource:[{name:"Многоканальное цветное",value:"colored"},{name:"Одноканальное серое",value:"gray"}],channelsList:[{name:"Не задано",value:0},{name:"Канал 1 (Red)",value:1},{name:"Канал 2 (Green)",value:2},{name:"Канал 3 (Blue)",value:3},{name:"Канал 4 (Alpha)",value:4}],coloredChannels:Object(Mt["a"])(Ut),grayChannels:Object(Mt["a"])(zt),loadIndicatorOptions:{visible:!1,container:".gis-raster-style",position:{at:"center",my:"center",of:".gis-raster-style"}},symbolizer:null,gradients:null}},mounted:function(){this.getDataSources()},watch:{layerName:{handler:function(){this.getStyle()},immediate:!0}},methods:{imageChanged:function(e){var t=e.value;this.image=t,"gray"!==t?this.grayChannels=Object(Mt["a"])(zt):this.coloredChannels=Object(Mt["a"])(Ut)},getStyle:function(){var e=this;this.layerName&&(this.loadIndicatorOptions.visible=!0,Object(X["c"])("getData",{layer_name:this.layerName,_config_dataset:Vt}).then((function(t){return t&&t.length?Promise.resolve(t):Object(X["c"])("insertData",{layer_name:e.layerName,layer_caption:e.layerText,_config_dataset:Vt})})).then((function(t){return e.symbolizer=t[0],Object(X["c"])("getData",{_config_dataset:Gt,rastersymbolizer_id:e.symbolizer.id})})).then((function(t){if(t.length){if(4===t[0].channeltype_id)return e.grayChannels=t,e.grayChannels[0].gradienttype_id=e.symbolizer.gradienttype_id,void(e.image="gray");e.coloredChannels=t,e.image="colored"}else e.image="colored"})).finally((function(){e.loadIndicatorOptions.visible=!1})))},mergeChannels:function(){var e=this;return Object(X["c"])("getData",{_config_dataset:Gt,rastersymbolizer_id:this.symbolizer.id}).then((function(t){t.length&&(4!==t[0].channeltype_id||"gray"!==e.image?4!==t[0].channeltype_id&&"colored"===e.image&&(e.coloredChannels=e.mergeChannelsArray(e.coloredChannels,t)):e.grayChannels=e.mergeChannelsArray(e.grayChannels,t))}))},mergeChannelsArray:function(e,t){return e.map((function(e){var n=t.find((function(t){return t.channeltype_id===e.channeltype_id}));return Rt(Rt({},n||{}),e)}))},getDataSources:function(){var e=this;Object(X["c"])("getData",{_config_dataset:$t}).then((function(t){e.gradients=t})).catch((function(){e.gradients=[]}))},apply:function(){var e=this;return this.loadIndicatorOptions.visible=!0,this.mergeChannels().then((function(){var t=e.coloredChannels;return e.symbolizer.gradienttype_id=null,"gray"===e.image&&(t=e.grayChannels,e.symbolizer.gradienttype_id=t[0].gradienttype_id),t.forEach((function(t){t.rastersymbolizer_id=e.symbolizer.id,t._config_dataset=Gt})),e.symbolizer._config_dataset=Vt,Object(X["c"])("updateData",e.symbolizer).then((function(){return Object(X["c"])("updateData",t)}))})).then((function(){return Object(X["c"])("getData",{_config_dataset:Nt,style_id:e.symbolizer.layerstyle_id})})).finally((function(){e.loadIndicatorOptions.visible=!1}))}}},Wt=Ht,Kt=(n("5fe3"),Object(le["a"])(Wt,Qe,et,!1,null,null,null)),qt=Kt.exports,Jt=n("e3b7"),Zt=n("7a47"),Yt=n("eec1"),Xt=n("9841");function Qt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function en(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qt(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var tn=["geojson","vector","wfs"],nn={name:"GisPopupEditLayerStyle",components:{DxPopup:_e.a,GisGeoJsonStyle:xe["a"],GisWmsStyle:Xe,PopupTitleTemplate:Ce["a"],GisRasterStyle:qt},props:{gisComponentId:null,popupContainer:null},data:function(){var e=this;return{VECTOR_LAYER_TYPES:tn,showContent:!1,toolbarItems:[{toolbar:"bottom",location:"center",widget:"dxButton",options:{text:"OK",type:"success",onClick:function(){e.apply().then((function(){return e.close()}))}}},{toolbar:"bottom",location:"center",widget:"dxButton",options:{text:"Применить",type:"default",onClick:function(){e.apply()}}},{toolbar:"bottom",location:"center",widget:"dxButton",options:{text:"Отменить",onClick:function(){e.close()}}}]}},computed:en(en({},Object(d["c"])("config",{getStyleFormLayerComponentId:Jt["D"],getConfigForStyleForm:Yt["l"],isLayerVisible:Yt["kb"]})),{},{styleFormLayerComponentId:function(){return this.getStyleFormLayerComponentId(this.gisComponentId)},visible:function(){return!!this.styleFormLayerComponentId},layerConfig:function(){return this.getConfigForStyleForm(this.styleFormLayerComponentId)},popupPosition:function(){return{at:"top",my:"top",offset:"0, 36",of:this.popupContainer}}}),methods:en(en(en({},Object(d["b"])("config",{updateMapboxLayers:Xt["S"],setVisible:Xt["N"]})),Object(d["d"])("config",{setStyleFormLayerComponentId:Zt["J"]})),{},{popupMaxHeight:function(){return.9*window.innerHeight},close:function(){this.showContent=!1,this.setStyleFormLayerComponentId({gisComponentId:this.gisComponentId,layerComponentId:null})},onShown:function(){this.showContent=!0,this.$emit("shown")},apply:function(){return this.VECTOR_LAYER_TYPES.includes(this.layerConfig.type)?this.applyGeoJsonStyle():this.applyWmsStyle()},applyGeoJsonStyle:function(){var e=this;return this.$refs.gisGeoJsonStyle.validateRules().then((function(t){return t?e.$refs.gisGeoJsonStyle.getLayersStyles().then((function(t){var n=t.layers,i=t.selectionLayers,o=t.hoverLayers,a=e.styleFormLayerComponentId,s=e.isLayerVisible(a);e.updateMapboxLayers({layerComponentId:a,layerStyles:n,selectionLayerStyles:i,hoverLayerStyles:o}).then((function(){e.setVisible({componentId:a,visible:s})}))})):Promise.reject()}))},applyWmsStyle:function(){var e=this,t=this.layerConfig.raster?"gisRasterStyle":"gisWmsStyle",n=this.isLayerVisible(this.styleFormLayerComponentId);return this.$refs[t].apply().then((function(){e.updateMapboxLayers({layerComponentId:e.styleFormLayerComponentId,layerStyles:[]}).then((function(){e.setVisible({componentId:e.styleFormLayerComponentId,visible:n})}))}))}})},on=nn,an=(n("162b"),Object(le["a"])(on,ye,ve,!1,null,null,null)),sn=an.exports,rn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"gis-popup-edit-layer-tooltip",attrs:{animation:null,visible:e.visible,shading:!1,resizeEnabled:!0,title:"Настройка всплывающей подсказки: «"+(e.layerOptions.text||"")+"»",position:e.popupPosition,width:"700",height:"400",toolbarItems:e.toolbarItems,container:e.popupContainer},on:{shown:e.onShown},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:"Настройка всплывающей подсказки: «"+(e.layerOptions.text||"")+"»",showCloseButton:!0},on:{closeClick:e.close}})]},proxy:!0},{key:"loadIndicatorContent",fn:function(t){var i=t.data;return[n("div",[e.loading?n("dx-load-indicator",{staticClass:"gis-popup-edit-layer-tooltip__load-indicator",attrs:{visible:!0}}):e._e(),n("span",{staticClass:"dx-button-text"},[e._v(e._s(i.text))])],1)]}}])},[n("div",{staticClass:"gis-popup-edit-layer-tooltip__wrapper"},[n("GisEditLayerTooltipForm",{attrs:{dataFields:e.layerOptions.filterBuilderFields,tooltipPosition:e.tooltipPositionEdited,tooltipExpression:e.tooltipExpressionEdited},on:{positionChange:function(t){e.tooltipPositionEdited=t},expressionChange:function(t){e.tooltipExpressionEdited=t}}})],1)])},ln=[],cn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-layer-tooltip-form"},[n("div",{staticClass:"dx-field dx-field-separator"},[n("div",{staticClass:"dx-field-label"},[e._v("Отображать подсказку ")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{value:e.tooltipPosition,valueExpr:"code",displayExpr:"name",dataSource:e.tooltipPositions},on:{valueChanged:e.onPositionChanged}})],1)]),n("div",{staticClass:"dx-field dx-field-fill"},[n("DxHtmlEditor",{ref:"htmlEditor",staticClass:"gis-layer-tooltip-form__expression",attrs:{"value-type":"html",value:e.tooltipExpression},on:{focusOut:e.onEditorFocusOut,valueChanged:e.onExpressionChanged}},[n("DxToolbar",{attrs:{multiline:!0,container:null}},[n("DxItem",{attrs:{"format-name":"undo"}}),n("DxItem",{attrs:{"format-name":"redo"}}),n("DxItem",{attrs:{"format-name":"separator"}}),n("DxItem",{attrs:{"format-name":"size","format-values":e.$options.fontSizeFormatValues,options:e.$options.fontSizeOptions}}),n("DxItem",{attrs:{"format-name":"separator"}}),n("DxItem",{attrs:{"format-name":"bold"}}),n("DxItem",{attrs:{"format-name":"italic"}}),n("DxItem",{attrs:{"format-name":"strike"}}),n("DxItem",{attrs:{"format-name":"underline"}}),n("DxItem",{attrs:{"format-name":"color"}}),n("DxItem",{attrs:{"format-name":"separator"}}),n("DxItem",{attrs:{"format-name":"alignLeft"}}),n("DxItem",{attrs:{"format-name":"alignCenter"}}),n("DxItem",{attrs:{"format-name":"alignRight"}}),n("DxItem",{attrs:{"format-name":"alignJustify"}}),n("DxItem",{attrs:{"format-name":"separator"}}),n("DxItem",{attrs:{"format-name":"orderedList"}}),n("DxItem",{attrs:{"format-name":"bulletList"}}),n("DxItem",{attrs:{"format-name":"separator"}}),n("DxItem",{attrs:{"format-name":"insertTable"}}),n("DxItem",{attrs:{"format-name":"insertRowBelow"}}),n("DxItem",{attrs:{"format-name":"insertColumnRight"}}),n("DxItem",{attrs:{"format-name":"deleteColumn"}}),n("DxItem",{attrs:{"format-name":"deleteRow"}}),n("DxItem",{attrs:{"format-name":"deleteTable"}})],1),n("DxVariables",{attrs:{dataSource:e.fieldNames,escapeChar:e.$options.escapeChars}})],1)],1),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Атрибут")]),n("div",{staticClass:"dx-field-value"},[n("DxLookup",{staticClass:"gis-chart-style-form__field-lookup",attrs:{items:e.sortedDataFields,displayExpr:e.displayValue,searchExpr:["caption","dataField","name"],showClearButton:!1},on:{contentReady:e.onFieldsContentReady,opened:e.selectBoxOpened,itemClick:e.onAttributeClick}})],1)])])},dn=[],un=n("6a70"),pn={name:"GisEditLayerTooltipForm",mixins:[yt["a"]],fontSizeFormatValues:["9px","10px","12px","15px","19px","25px"],fontSizeOptions:{width:150},escapeChars:["[","]"],components:{DxSelectBox:nt.a,DxHtmlEditor:un["DxHtmlEditor"],DxToolbar:un["DxToolbar"],DxItem:un["DxItem"],DxVariables:un["DxVariables"]},props:{dataFields:Array,tooltipPosition:String,tooltipExpression:String},data:function(){return{expressonError:!1,editorSelection:null,tooltipPositions:[{code:"none",name:"Не отображать"},{code:"mouse",name:"В точке курсора"},{code:"center",name:"В центре объекта"}]}},computed:{sortedDataFields:function(){var e=this,t=[];return this.dataFields&&(t=Object(a["a"])(this.dataFields).sort((function(t,n){return t.caption!==t.dataField&&n.caption!==n.dataField?e.sortValue(t.caption,n.caption):t.caption!==t.dataField&&n.caption===n.dataField?-1:t.caption===t.dataField&&n.caption!==n.dataField?1:e.sortValue(t.dataField,n.dataField)})).map((function(e){return{name:e.dataField,caption:e.caption||e.dataField}}))),t},fieldNames:function(){return this.sortedDataFields.map((function(e){return e.name}))}},methods:{displayValue:function(e){return e?e.caption||e.name:""},onAttributeClick:function(e){var t,n='<span class="dx-variable" data-var-start-esc-char="[" data-var-end-esc-char="]" data-var-value="'.concat(e.itemData.name,'"><span contenteditable="false">[').concat(e.itemData.name,"]</span></span>");t=this.editorSelection?this.tooltipExpression.substring(0,this.editorSelection.index)+n+this.tooltipExpression.substring(this.editorSelection.index):"".concat(this.tooltipExpression).concat(n),this.$emit("expressionChange",t)},onEditorFocusOut:function(){},onExpressionChanged:function(e){var t=e.value;this.expressonError=!1,this.$emit("expressionChange",t)},onPositionChanged:function(e){var t=e.value;this.$emit("positionChange",t)},onFieldsContentReady:function(e){var t=e.component._popup;t.option("showTitle",!1),t.option("maxHeight",300),t._$content.css("top",0)},sortValue:function(e,t){return e>t?1:e<t?-1:0}}},fn=pn,hn=(n("a55a"),Object(le["a"])(fn,cn,dn,!1,null,null,null)),mn=hn.exports,gn=n("d6fe");function yn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function vn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yn(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var bn="CONFIG.DSCOMPONENT",_n={name:"GisPopupEditLayerTooltip",components:{DxPopup:_e.a,PopupTitleTemplate:Ce["a"],GisEditLayerTooltipForm:mn,DxLoadIndicator:$e.a},props:{gisComponentId:null,popupContainer:null},data:function(){var e=this;return{tooltipPositionEdited:null,tooltipExpressionEdited:null,showContent:!1,loading:!1,toolbarItems:[{toolbar:"bottom",location:"center",widget:"dxButton",options:{text:"Сохранить",type:"success",template:"loadIndicatorContent",onClick:function(){e.apply().then((function(){return e.close()}))}}}]}},computed:vn(vn({},Object(d["c"])("config",{getLayerOptions:Yt["E"],getTooltipFormLayerComponentId:Jt["H"]})),{},{tooltipFormLayerComponentId:function(){return this.getTooltipFormLayerComponentId(this.gisComponentId)},layerOptions:function(){var e=this.getLayerOptions(this.tooltipFormLayerComponentId);return e},tooltipPosition:function(){return this.layerOptions.tooltipPosition},tooltipExpression:function(){return this.layerOptions.tooltipExpression},visible:function(){return!!this.tooltipFormLayerComponentId},popupPosition:function(){return{at:"center",my:"center",of:this.popupContainer}}}),watch:{tooltipPosition:function(e){this.tooltipPositionEdited=e},tooltipExpression:function(e){this.tooltipExpressionEdited=e}},methods:vn(vn(vn({},Object(d["b"])("config",{})),Object(d["d"])("config",{setTooltipFormLayerComponentId:Zt["L"],setLayerTooltipExpression:gn["M"],setLayerTooltipPosition:gn["N"]})),{},{close:function(){this.showContent=!1,this.setTooltipFormLayerComponentId({gisComponentId:this.gisComponentId,layerComponentId:null})},onShown:function(){this.showContent=!0,this.$emit("shown")},onFormChange:function(){},apply:function(){var e=this,t=!1;return this.tooltipPositionEdited!==this.tooltipPosition&&(t=!0,this.setLayerTooltipPosition({layerComponentId:this.tooltipFormLayerComponentId,position:this.tooltipPositionEdited})),this.tooltipExpressionEdited!==this.tooltipExpression&&(t=!0,this.setLayerTooltipExpression({layerComponentId:this.tooltipFormLayerComponentId,expression:this.tooltipExpressionEdited})),t?(this.loading=!0,this.saveServer().then((function(){e.loading=!1}))):Promise.resolve()},saveServer:function(){var e=this;return Object(X["c"])("getData",{_config_dataset:bn,id:this.tooltipFormLayerComponentId}).then((function(t){var n=t[0],i=n.prop.editorOptions;i.tooltipPosition=e.tooltipPositionEdited||i.tooltipPosition||"none",i.tooltipExpression=e.tooltipExpressionEdited||i.tooltipExpression||"";var o=vn({parent_id:e.gisComponentId,_config_dataset:bn},n);return Object(X["c"])("updateData",o)}))}})},Cn=_n,xn=(n("188b"),Object(le["a"])(Cn,rn,ln,!1,null,null,null)),On=xn.exports,In=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-toolbar"},[n("div",{staticClass:"gis-toolbar__left"},[e.visibleTools.toggleLegend||e.visibleTools.toggleSpaceImageryPanel||e.toggleTimeline?n("GisToolbarButtonGroup",[e.visibleTools.toggleLegend?n("GisToolbarButton",{attrs:{active:e.legendButtonActive,iconCss:"core core-001-layers",text:"Показать каталог слоев"},on:{click:function(t){return e.toggleButton(e.$options.LEGEND)}}}):e._e(),e.visibleTools.toggleSpaceImageryPanel?n("GisToolbarButton",{attrs:{active:e.spaceImageButtonActive,iconCss:"core core-002-planet",text:"Показать панель космических снимков"},on:{click:function(t){return e.toggleButton(e.$options.SPACE_IMAGERY)}}}):e._e(),e.toggleTimeline?n("GisToolbarButton",{attrs:{active:e.timelineButtonActive&&e.timelineButtonEnable,disabled:!e.timelineButtonEnable,iconCss:"core core-timeline",text:"Показать временную шкалу"},on:{click:e.toggleTimelineButton}}):e._e()],1):e._e(),e.visibleTools.select?n("GisToolbarButtonGroup",[n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.SELECT,iconCss:"core core-003-coursor",text:"Выбор объекта"},on:{click:function(t){return e.setActiveMouseTool(e.$options.SELECT)}}}),e.visibleTools.rectangleSelect?n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.RECTANGLE_SELECT,iconCss:"core core-005-search-by-poly-1",text:"Выбрать объекты внутри прямоугольника"},on:{click:function(t){return e.setActiveMouseTool(e.$options.RECTANGLE_SELECT)}}}):e._e(),e.visibleTools.polygonSelect?n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.POLYGON_SELECT,iconCss:"core core-007-search-by-poly-3",text:"Выбрать объекты внутри полигона"},on:{click:function(t){return e.setActiveMouseTool(e.$options.POLYGON_SELECT)}}}):e._e(),e.visibleTools.circleSelect?n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.CIRCLE_SELECT,iconCss:"core core-009-search-by-circle-1",text:"Выбрать объекты внутри окружности"},on:{click:function(t){return e.setActiveMouseTool(e.$options.CIRCLE_SELECT)}}}):e._e(),e.visibleTools.bufferZoneSelect?n("GisToolbarButton",{attrs:{active:!1,disabled:e.buttonDisabled[e.$options.BUFFER_ZONE_SELECT],label:e.buttonValues[e.$options.BUFFER_ZONE_SELECT],contextMenuVisible:e.modeVisible[e.$options.BUFFER_ZONE_SELECT],iconCss:"core core-011-search-in-buffer",text:"Выбрать объекты внутри буферной зоны, м",popoverContainer:e.popoverContainer},on:{click:function(t){return e.handleButtonClick(e.$options.BUFFER_ZONE_SELECT)},contextMenu:function(t){e.modeVisible[e.$options.BUFFER_ZONE_SELECT]=!0},modeHidden:function(t){e.modeVisible[e.$options.BUFFER_ZONE_SELECT]=!1}}},[n("GisBufferZonePanel",{attrs:{showUnion:!1,showSide:!1},on:{zoneChanged:function(t){return e.$emit("buttonValueChanged",{value:t,name:e.$options.BUFFER_ZONE_SELECT})},roundedChanged:function(t){return e.$emit("buttonValueChanged",{value:t,name:e.$options.BUFFER_ZONE_SELECT_ROUNDED})}}})],1):e._e(),e.visibleTools.circleRadiusSelect?n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.CIRCLE_RADIUS_SELECT,label:e.buttonValues[e.$options.CIRCLE_RADIUS_SELECT],contextMenuVisible:e.modeVisible[e.$options.CIRCLE_RADIUS_SELECT],iconCss:"core core-009-search-by-circle-1",text:"Выбрать объекты внутри окружности, км",popoverContainer:e.popoverContainer},on:{click:function(t){return e.setActiveMouseTool(e.$options.CIRCLE_RADIUS_SELECT)},contextMenu:function(t){e.modeVisible[e.$options.CIRCLE_RADIUS_SELECT]=!0},modeHidden:function(t){e.modeVisible[e.$options.CIRCLE_RADIUS_SELECT]=!1}}},[n("DxNumberBox",{attrs:{value:e.buttonValues[e.$options.CIRCLE_RADIUS_SELECT],width:90,showSpinButtons:!0,step:.5,min:.001,format:"#0.000 км"},on:{valueChanged:function(t){return e.$emit("buttonValueChanged",{value:t.value,name:e.$options.CIRCLE_RADIUS_SELECT})}}})],1):e._e()],1):e._e(),e.visibleTools.objectIdentification?n("GisToolbarButtonGroup",[n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.OBJECT_IDENTIFICATION,iconCss:"core core-identification",text:"Идентифицировать объект"},on:{click:function(t){return e.setActiveMouseTool(e.$options.OBJECT_IDENTIFICATION)}}})],1):e._e(),e.visibleTools.scale?n("GisToolbarButtonGroup",[e.visibleTools.gotoCurrentPosition?n("GisToolbarButton",{attrs:{active:!1,iconCss:"core core-072-geoposition",text:"Перейти к текущему расположению"},on:{click:function(t){return e.setActiveMouseTool(e.$options.CURRENT_POSITION)}}}):e._e(),e.visibleTools.gotoExtent?n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.BOX_ZOOM,iconCss:"core core-box-zoom",text:"Приблизить по экстенту"},on:{click:function(t){return e.setActiveMouseTool(e.$options.BOX_ZOOM)}}}):e._e(),e.visibleTools.gotoSelectedObjects?n("GisToolbarButton",{attrs:{active:!1,disabled:e.buttonDisabled[e.$options.SELECTED_OBJECTS_ZOOM],iconCss:"core core-219_close-to-selected",text:"Приблизить к выбранным объектам"},on:{click:function(t){return e.setActiveMouseTool(e.$options.SELECTED_OBJECTS_ZOOM)}}}):e._e(),e.visibleTools.gotoPreviousExtent?n("GisToolbarButton",{attrs:{active:!1,disabled:e.buttonDisabled[e.$options.EXTENT_PREVIOUS],iconCss:"core core-063-arrow-left",text:"Перейти на предыдущую область отображения карты"},on:{click:function(t){return e.setActiveMouseTool(e.$options.EXTENT_PREVIOUS)}}}):e._e(),e.visibleTools.gotoNextExtent?n("GisToolbarButton",{attrs:{active:!1,disabled:e.buttonDisabled[e.$options.EXTENT_NEXT],iconCss:"core core-065-arrow-right",text:"Перейти на последующую область отображения карты"},on:{click:function(t){return e.setActiveMouseTool(e.$options.EXTENT_NEXT)}}}):e._e()],1):e._e(),e.visibleTools.fullScreenMode?n("GisToolbarButtonGroup",[n("GisToolbarButton",{attrs:{active:e.isFullScreen,iconCss:"fas fa-expand",text:e.fullScreenToolText},on:{click:function(t){return e.setActiveMouseTool(e.$options.FULL_SCREEN_TOOL)}}})],1):e._e(),e.visibleTools.measure?n("GisToolbarButtonGroup",[n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.MEASURE_DISTANCE,iconCss:"core core-014-measure-1",text:"Измерение длины"},on:{click:function(t){return e.setActiveMouseTool(e.$options.MEASURE_DISTANCE)}}}),n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.MEASURE_AREA,iconCss:"core core-015-measure-2",text:"Измерение площади"},on:{click:function(t){return e.setActiveMouseTool(e.$options.MEASURE_AREA)}}}),e.visibleTools.perimeterMeasure?n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.MEASURE_PERIMETER,disabled:e.buttonDisabled[e.$options.MEASURE_PERIMETER],iconCss:"core core-perimetr",text:"Расчёт периметра"},on:{click:function(t){return e.handlePerimeterButtonClick()}}}):e._e()],1):e._e(),e.visibleTools.save?n("GisToolbarButtonGroup",[n("GisToolbarButton",{attrs:{active:!1,loadIndicator:e.buttonLoading[e.$options.SAVE],disabled:e.buttonDisabled[e.$options.SAVE],text:"Сохранить изменения",iconCss:"core core-016-save"},on:{click:function(t){return e.handleButtonClick(e.$options.SAVE)}}})],1):e._e(),e.visibleTools.history?n("GisToolbarButtonGroup",[n("GisToolbarButton",{attrs:{active:!1,disabled:e.buttonDisabled[e.$options.UNDO],text:"Отменить последнее действие",iconCss:"core core-017-step-back"},on:{click:function(t){return e.handleButtonClick(e.$options.UNDO)}}}),n("GisToolbarButton",{attrs:{active:!1,disabled:e.buttonDisabled[e.$options.REDO],text:"Повторить последнее действие",iconCss:"core core-018-step-forward"},on:{click:function(t){return e.handleButtonClick(e.$options.REDO)}}})],1):e._e(),e.visibleTools.buffer?n("GisToolbarButtonGroup",[e.visibleTools.bufferCopy?n("GisToolbarButton",{attrs:{active:!1,disabled:e.buttonDisabled[e.$options.COPY],iconCss:"core core-020-copy",text:"Копировать"},on:{click:function(t){return e.handleButtonClick(e.$options.COPY)}}}):e._e(),e.visibleTools.bufferPaste?n("GisToolbarButton",{attrs:{active:!1,disabled:e.buttonDisabled[e.$options.PASTE],iconCss:"core core-021-paste",text:"Вставить",contextMenuVisible:e.modeVisible[e.$options.PASTE],popoverContainer:e.popoverContainer},on:{click:function(t){return e.handleButtonClick(e.$options.PASTE)},mouseenter:function(t){e.modeVisible[e.$options.PASTE]=!0},mouseleave:function(t){e.modeVisible[e.$options.PASTE]=!1}}},[n("div",{staticClass:"gis-toolbar__message"},[e._v(e._s(e.pasteButtonMessage))])]):e._e(),e.visibleTools.deleteFeature?n("GisToolbarButton",{attrs:{active:!1,disabled:e.buttonDisabled[e.$options.DELETE],iconCss:"core core-023-delete",text:"Удалить выбранные объекты"},on:{click:function(t){return e.handleDeleteButtonClick()}}}):e._e()],1):e._e(),e.visibleTools.addFeature?n("GisToolbarButtonGroup",[e.visibleTools.addPoint?n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.MARKER,disabled:e.buttonDisabled[e.$options.MARKER],iconCss:"core core-add-point",text:"Точечный объект"},on:{click:function(t){return e.setActiveMouseTool(e.$options.MARKER)}}}):e._e(),e.visibleTools.addLine?n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.LINE,disabled:e.buttonDisabled[e.$options.LINE],iconCss:"core core-094-line",text:"Линия по точкам"},on:{click:function(t){return e.setActiveMouseTool(e.$options.LINE)}}}):e._e(),e.visibleTools.addPolygon?n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.POLYGON,disabled:e.buttonDisabled[e.$options.POLYGON],iconCss:"core core-034-add-poly-2",text:"Полигон по точкам"},on:{click:function(t){return e.setActiveMouseTool(e.$options.POLYGON)}}}):e._e(),e.visibleTools.addBufferZone?n("GisToolbarButton",{attrs:{active:!1,disabled:e.buttonDisabled[e.$options.BUFFER_ZONE],label:e.buttonValues[e.$options.BUFFER_ZONE],contextMenuVisible:e.modeVisible[e.$options.BUFFER_ZONE],iconCss:"core core-048-new-from-buffer",text:"Построить буферную зону, м",popoverContainer:e.popoverContainer},on:{click:function(t){return e.handleButtonClick(e.$options.BUFFER_ZONE)},contextMenu:function(t){e.modeVisible[e.$options.BUFFER_ZONE]=!0},modeHidden:function(t){e.modeVisible[e.$options.BUFFER_ZONE]=!1}}},[n("GisBufferZonePanel",{attrs:{showUnion:!0,showSide:!1},on:{zoneChanged:function(t){return e.$emit("buttonValueChanged",{value:t,name:e.$options.BUFFER_ZONE})},roundedChanged:function(t){return e.$emit("buttonValueChanged",{value:t,name:e.$options.BUFFER_ZONE_ROUNDED})},unionChanged:function(t){return e.$emit("buttonValueChanged",{value:t,name:e.$options.BUFFER_ZONE_UNION})}}})],1):e._e(),e.visibleTools.coordinates?n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.COORDINATES,disabled:e.buttonDisabled[e.$options.COORDINATES],iconCss:"core core-coordinates",text:"Координаты"},on:{click:function(t){return e.setActiveMouseTool(e.$options.COORDINATES)}}}):e._e(),e.visibleTools.addIntersectionObject?n("GisToolbarButton",{attrs:{active:!1,disabled:e.buttonDisabled[e.$options.NEW_INTERSECTION_OBJECT],iconCss:"core core-045-new-on-intersection",text:"Новый объект на пересечении"},on:{click:function(t){return e.handleButtonClick(e.$options.NEW_INTERSECTION_OBJECT)}}}):e._e(),e.visibleTools.addUnionObject?n("GisToolbarButton",{attrs:{active:!1,disabled:e.buttonDisabled[e.$options.NEW_UNION_OBJECT],iconCss:"core core-046-ungroup",text:"Новый объект на объединении"},on:{click:function(t){return e.handleButtonClick(e.$options.NEW_UNION_OBJECT)}}}):e._e(),e.visibleTools.addConvexHull?n("GisToolbarButton",{attrs:{active:!1,disabled:e.buttonDisabled[e.$options.CONVEX_HULL],iconCss:"core core-100-group",text:"Выпуклая оболочка"},on:{click:function(t){return e.handleButtonClick(e.$options.CONVEX_HULL)}}}):e._e()],1):e._e(),e.visibleTools.snapping?n("GisToolbarButtonGroup",[n("GisToolbarButton",{attrs:{active:e.activeSnapTool===e.$options.SNAP_TO_POINT,disabled:e.isSnappingToolDisabled,iconCss:"core core-041-snapping-1",text:"Привязка к точкам"},on:{click:function(t){return e.setActiveSnapTool(e.$options.SNAP_TO_POINT)}}}),n("GisToolbarButton",{attrs:{active:e.activeSnapTool===e.$options.SNAP_TO_LINE,disabled:e.isSnappingToolDisabled,iconCss:"core core-042-snapping-2",text:"Привязка к линиям"},on:{click:function(t){return e.setActiveSnapTool(e.$options.SNAP_TO_LINE)}}}),e.visibleTools.addSubstractAll?n("GisToolbarButton",{attrs:{active:e.activeSubstractTool,disabled:e.buttonDisabled[e.$options.SUBSTRACT_ALL],iconCss:"core core-minus",text:"Вычесть пересекающиеся объекты"},on:{click:function(t){return e.handleButtonClick(e.$options.SUBSTRACT_ALL)}}}):e._e()],1):e._e(),e.visibleTools.sliceGeom?n("GisToolbarButtonGroup",[n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.SLICE_GEOM,disabled:e.buttonDisabled[e.$options.SLICE_GEOM],iconCss:"core core-slice-geom",text:"Разделение объекта"},on:{click:function(t){return e.setActiveMouseTool(e.$options.SLICE_GEOM)}}})],1):e._e(),e.visibleTools.editFeature?n("GisToolbarButtonGroup",[e.visibleTools.editVertexes?n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.EDIT,disabled:e.buttonDisabled[e.$options.EDIT],iconCss:"core core-025-move-node",text:"Перемещение объекта и его вершин"},on:{click:function(t){return e.setActiveMouseTool(e.$options.EDIT)}}}):e._e(),e.visibleTools.editMove?n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.MOVE,disabled:e.buttonDisabled[e.$options.MOVE],iconCss:"core core-027-arrows-outwards",text:"Перемещение объектов"},on:{click:function(t){return e.setActiveMouseTool(e.$options.MOVE)}}}):e._e(),e.visibleTools.part?n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.PART,disabled:e.buttonDisabled[e.$options.PART],iconCss:"core core-028-add-ring",text:"Добавить часть/отверстие"},on:{click:function(t){return e.setActiveMouseTool(e.$options.PART)}}}):e._e(),e.visibleTools.removePart?n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.REMOVE_PART,disabled:e.buttonDisabled[e.$options.REMOVE_PART],iconCss:"core core-029-delete-ring",text:"Удалить часть/отверстие"},on:{click:function(t){return e.setActiveMouseTool(e.$options.REMOVE_PART)}}}):e._e(),e.visibleTools.changeType?n("GisToolbarDropDownButton",{attrs:{disabled:e.buttonDisabled[e.$options.CHANGE_TYPE]}},[e.changeTypeButtonsVisible[e.$options.CHANGE_TYPE_LINE]?n("GisToolbarButton",{attrs:{iconCss:"core core-into-line",text:"Сделать линией"},on:{click:function(t){return e.handleButtonClick(e.$options.CHANGE_TYPE_LINE)}}}):e._e(),e.changeTypeButtonsVisible[e.$options.CHANGE_TYPE_MULTI_LINE]?n("GisToolbarButton",{attrs:{iconCss:"core core-into-multi-line",text:"Сделать мультилинией"},on:{click:function(t){return e.handleButtonClick(e.$options.CHANGE_TYPE_MULTI_LINE)}}}):e._e(),e.changeTypeButtonsVisible[e.$options.CHANGE_TYPE_POINT]?n("GisToolbarButton",{attrs:{iconCss:"core core-into-point",text:"Сделать точкой"},on:{click:function(t){return e.handleButtonClick(e.$options.CHANGE_TYPE_POINT)}}}):e._e(),e.changeTypeButtonsVisible[e.$options.CHANGE_TYPE_MULTI_POINT]?n("GisToolbarButton",{attrs:{iconCss:"core core-into-multi-point",text:"Сделать мультиточкой"},on:{click:function(t){return e.handleButtonClick(e.$options.CHANGE_TYPE_MULTI_POINT)}}}):e._e(),e.changeTypeButtonsVisible[e.$options.CHANGE_TYPE_POLY]?n("GisToolbarButton",{attrs:{iconCss:"core core-into-poly",text:"Сделать полигоном"},on:{click:function(t){return e.handleButtonClick(e.$options.CHANGE_TYPE_POLY)}}}):e._e(),e.changeTypeButtonsVisible[e.$options.CHANGE_TYPE_MULTI_POLY]?n("GisToolbarButton",{attrs:{iconCss:"core core-into-multi-poly",text:"Сделать мультиполигоном"},on:{click:function(t){return e.handleButtonClick(e.$options.CHANGE_TYPE_MULTI_POLY)}}}):e._e()],1):e._e()],1):e._e(),e.visibleTools.snapshotForReport?n("GisToolbarButtonGroup",[n("GisToolbarButton",{attrs:{active:!1,disabled:e.buttonDisabled[e.$options.SNAPSHOT_FOR_REPORT],iconCss:"core core-049-print",text:"Отчет по объекту"},on:{click:function(t){return e.handleButtonClick(e.$options.SNAPSHOT_FOR_REPORT)}}})],1):e._e(),e.visibleTools.mapSnapshot?n("GisToolbarButtonGroup",[n("GisToolbarButton",{attrs:{active:!1,iconCss:"core core-photo-full",text:"Снимок карты"},on:{click:function(t){return e.handleButtonClick(e.$options.FULL_MAP_SNAPSHOT)}}}),n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.PART_MAP_SNAPSHOT,iconCss:"core core-photo-part",text:"Снимок участка карты"},on:{click:function(t){return e.setActiveMouseTool(e.$options.PART_MAP_SNAPSHOT)}}})],1):e._e(),n("GisToolbarButtonGroup",e._l(e.leftButtonItems,(function(t,i){return n("GisToolbarButton",{key:i,attrs:{iconCss:t.options.icon,text:t.options.text},on:{click:function(n){return e.customButtonClick(t.componentId)}}})})),1),e.visibleTools.searchPoint?n("GisToolbarButtonGroup",[n("GisToolbarButton",{attrs:{active:e.modeVisible[e.$options.SEARCH_POINT],iconCss:"core core-031-add-point",text:"Поиск точки по координатам",closeModeOnOutsideClick:!1,contextMenuVisible:e.modeVisible[e.$options.SEARCH_POINT],popoverContainer:e.popoverContainer},on:{click:function(t){return e.handleSearchPoint(e.$options.SEARCH_POINT)},contextMenu:function(t){e.modeVisible[e.$options.SEARCH_POINT]=!0},modeHidden:function(t){e.modeVisible[e.$options.SEARCH_POINT]=!1}}},[n("GisSearchPointPanel",{attrs:{popupContainer:e.popoverContainer},on:{searchPoint:e.searchPoint}})],1)],1):e._e()],1),n("div",{staticClass:"gis-toolbar__right"},[e.visibleTools.geocoder?n("GisGeocoder",{attrs:{activeMouseTool:e.activeMouseTool===e.$options.REVERSE_GEOCODE,modeVisible:e.modeVisible[e.$options.REVERSE_GEOCODE],geocodePoint:e.geocodePoint,allAddresses:e.allAddresses,validateLatLng:e.validateLatLng,popupContainer:e.popoverContainer},on:{addressSearchFocusIn:e.addressSearchFocusIn,handleMarker:e.handleAddMarker,handleMarkerPopup:e.handleAddMarkerPopup,handleRemoveMarker:function(t){return e.$emit("handleRemoveMarker")},handleRemovePoint:function(t){return e.$emit("handleRemovePoint")},onReverseGeocode:e.onReverseGeocode,handleCoordinatesChanged:e.handleCoordinates,useIdentificationRequestTool:e.identificationRequestTool,resetIdentification:e.handleResetIdentification}}):e._e(),e.rightButtonItems&&e.rightButtonItems.length>0?n("GisToolbarButtonGroup",e._l(e.rightButtonItems,(function(t,i){return n("GisToolbarButton",{key:i,attrs:{iconCss:t.options.icon,text:t.options.text},on:{click:function(n){return e.customButtonClick(t.componentId)}}})})),1):e._e()],1)])},Sn=[],Ln=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-toolbar-button",class:e.cssClass},[n("div",{staticClass:"gis-toolbar-dropdown-button__wrapper"},[n("div",{ref:"popoverTarget",attrs:{title:e.activeTitle},on:{click:e.handlePopupButtonClick,contextmenu:e.handleContextMenu,mouseenter:function(t){return e.$emit("mouseenter")},mouseleave:function(t){return e.$emit("mouseleave")}}},[n("i",{class:e.activeIconCss}),e.activeLabel?n("div",{staticClass:"gis-toolbar-dropdown-button__label-wrapper"},[n("div",{staticClass:"gis-toolbar-dropdown-button__label"},[e._v("\n          "+e._s(e.activeLabel)+"\n        ")])]):e._e()]),n("div",{staticClass:"gis-toolbar-dropdown-button__drop-icon",on:{click:function(t){e.menuVisible=!e.menuVisible}}},[e.menuVisible?n("i",{staticClass:"core core-triangle-up"}):e._e(),e.menuVisible?e._e():n("i",{staticClass:"core core-triangle-down"})])]),n("DxPopover",{ref:"popover",staticClass:"gis-toolbar-dropdown-button__popover",attrs:{visible:e.menuVisible,container:e.popoverContainer,position:"bottom",deferRendering:!1},on:{contentReady:e.onContentReady}},[n("div",{ref:"container"},[e._t("default")],2)])],1)},Dn=[],Pn=n("86ba"),En="gis-toolbar-dropdown-button",wn={mixins:[Pn["a"]],data:function(){return{CLASS:En,activeTitle:"",activeLabel:"",activeIconCss:"",menuVisible:!1,observer:null}},mounted:function(){var e=this;this.$refs.popover.instance.option("target",this.$refs.popoverTarget);var t=this.$refs.container;this.observer=new MutationObserver((function(){return e.onButtonsListChanged()})),this.observer.observe(t,{attributes:!1,childList:!0,characterData:!1,subtree:!1})},beforeDestroy:function(){this.observer.disconnect()},methods:{onContentReady:function(){this.onButtonsListChanged()},handlePopupButtonClick:function(){var e=this,t=this.$slots.default.find((function(t){var n=t.componentInstance;return n&&n.text===e.activeTitle&&n.label===e.activeLabel&&n.iconCss===e.activeIconCss}));t.componentInstance.$emit("click",t.componentInstance)},onButtonsListChanged:function(){var e=this,t=this.$slots.default,n=t.find((function(t){var n=t.componentInstance;return n&&n.activeTitle===e.activeTitle&&n.label===e.activeLabel&&n.iconCss===e.activeIconCss}));if(n||(n=t.find((function(e){return!!e.componentInstance}))),n&&n.componentInstance){var i=n.componentInstance;this.activeTitle=i.text,this.activeLabel=i.label,this.activeIconCss=i.iconCss}else this.activeTitle="",this.activeLabel="",this.activeIconCss="";var o=function(t){e.activeTitle=t.targetComponent.text,e.activeLabel=t.targetComponent.label,e.activeIconCss=t.targetComponent.iconCss,e.menuVisible=!1};this.$slots.default.forEach((function(e){var t=e.componentInstance;t&&(t.$off("click",o),t.$on("click",o))}))}}},Tn=wn,jn=(n("d32a"),Object(le["a"])(Tn,Ln,Dn,!1,null,null,null)),kn=jn.exports,Fn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.cssClass,attrs:{title:e.label},on:{click:e.handleClick}},[e._v("\n  "+e._s(e.text)+"\n")])},Bn=[],Mn="gis-toolbar-text-button",An={name:"GisToolbarTextButton",mixins:[Pn["a"]],data:function(){return{CLASS:Mn}}},Rn=An,Vn=(n("e481"),Object(le["a"])(Rn,Fn,Bn,!1,null,null,null)),Gn=Vn.exports,$n=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("GisToolbarButtonGroup",[n("GisDirectGeocoder",{attrs:{store:e.store,searchValue:e.searchValue,popupContainer:e.popupContainer},on:{addressSearchFocusIn:function(t){return e.$emit("addressSearchFocusIn")},handleValueChanged:e.handleValueChanged,handleSelectionChanged:function(t){return e.$emit("handleRemoveMarker")}}}),n("GisReverseGeocoder",{attrs:{activeMouseTool:e.activeMouseTool,modeVisible:e.modeVisible,validateLatLng:e.validateLatLng,allAddresses:e.allAddresses,coordinatesValue:e.geocodePoint},on:{reverseGeocode:function(t){return e.$emit("onReverseGeocode")},handleCoordinatesChanged:e.handleCoordinates,itemClick:e.onItemClick}})],1)},Nn=[],Un=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._m(0),n("DxAutocomplete",{staticClass:"autocomplete",attrs:{placeholder:"Поиск по адресу или кадастру",dataSource:e.store,showClearButton:!0,width:"300px",height:"30px"},on:{opened:e.selectBoxOpened,focusIn:function(t){return e.$emit("addressSearchFocusIn")},itemClick:function(t){return e.$emit("handleValueChanged",t)},valueChanged:function(t){return e.$emit("handleSelectionChanged",t)},enterKey:function(t){return e.$emit("handleValueChanged",t,e.inputText)},selectionChanged:function(t){return e.$emit("handleSelectionChanged")}},scopedSlots:e._u([{key:"item",fn:function(t){var i=t.data;return[n("span",{attrs:{title:i}},[e._v("\n          "+e._s(i)+"\n        ")])]}}]),model:{value:e.inputText,callback:function(t){e.inputText=t},expression:"inputText"}})],1)},zn=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"search-icon"},[n("i",{staticClass:"core core-108-search"})])}],Hn=n("e1e1"),Wn=n.n(Hn),Kn={mixins:[yt["a"]],components:{DxAutocomplete:Wn.a},props:{store:Object},data:function(){return{inputText:""}}},qn=Kn,Jn=(n("c32c"),Object(le["a"])(qn,Un,zn,!1,null,null,null)),Zn=Jn.exports,Yn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("GisToolbarButton",{ref:"button",attrs:{active:e.activeMouseTool,iconCss:"core core-revert-geocode",text:"Обратное геокодирование",contextMenuVisible:e.modeVisible,closeModeOnOutsideClick:!1},on:{click:e.onClick}},[n("div",[n("div",{staticStyle:{"margin-bottom":"8px"}},[e._v("Введите координаты или укажите точку на карте")]),n("DxTextBox",{attrs:{showClearButton:!0,placeholder:"широта долгота"},on:{enterKey:function(t){return e.$emit("handleCoordinatesChanged",t.component._changedValue)}},model:{value:e.pointCoordinates,callback:function(t){e.pointCoordinates=t},expression:"pointCoordinates"}},[n("DxValidator",{ref:"lngLatValidator"},[n("DxCustomRule",{attrs:{validationCallback:e.validateLatLng,message:"Необходимо ввести широту и долготу через пробел"}})],1)],1),e.allAddresses.length?n("DxList",{attrs:{width:"280px",dataSource:e.allAddresses},on:{itemClick:function(t){return e.$emit("itemClick",t)}},scopedSlots:e._u([{key:"item",fn:function(t){var i=t.data;return[n("span",{attrs:{title:i.address}},[e._v("\n          "+e._s(i.address)+"\n        ")])]}}],null,!1,180714888)}):n("div",{staticClass:"empty-address-list"},[e._v("\n      Ничего не найдено\n    ")])],1)])},Xn=[],Qn=n("e614"),ei=n.n(Qn),ti=n("6dd7"),ni=n.n(ti),ii=n("0db8"),oi={components:{GisToolbarButton:Be["a"],DxTextBox:ei.a,DxList:ni.a,DxValidator:ii["DxValidator"],DxCustomRule:ii["DxCustomRule"]},props:{activeMouseTool:Boolean,modeVisible:Boolean,validateLatLng:Function,allAddresses:Array,coordinatesValue:String},computed:{last:{get:function(){return this.$refs.button.last},set:function(e){this.$refs.button.last=e}},first:{get:function(){return this.$refs.button.first},set:function(e){this.$refs.button.first=e}},pointCoordinates:{get:function(){return this.coordinatesValue},set:function(e){e||this.$emit("handleCoordinatesChanged",e),this.$emit("update:coordinatesValue",e)}}},methods:{onClick:function(){this.$emit("reverseGeocode"),this.$refs.lngLatValidator.instance.reset()}}},ai=oi,si=(n("8e4b"),Object(le["a"])(ai,Yn,Xn,!1,null,null,null)),ri=si.exports,li="legend",ci="spaceImagery",di="select",ui="lineSelect",pi="rectangleSelect",fi="circleSelect",hi="polygonSelect",mi="bufferZoneSelect",gi="bufferZoneSelectRounded",yi="circleRadiusSelect",vi="measureDistance",bi="measureArea",_i="measurePerimeter",Ci="save",xi="undo",Oi="redo",Ii="copy",Si="paste",Li="cut",Di="delete",Pi="marker",Ei="pencilLine",wi="pencilPolygon",Ti="line",ji="polygon",ki="geoJson",Fi="bufferZone",Bi="bufferZoneRounded",Mi="bufferZoneUnion",Ai="coordinates",Ri="newIntersectionObject",Vi="newUnionObject",Gi="convexHull",$i="substructAll",Ni="sliceGeom",Ui="snapToPoint",zi="snapToLine",Hi="edit",Wi="move",Ki="part",qi="removePart",Ji="changeType",Zi="changeTypeLineString",Yi="changeTypeMultiLineString",Xi="changeTypePoint",Qi="changeTypeMultiPoint",eo="changeTypePolygon",to="changeTypeMultiPolygon",no="snapshotForReport",io="fullMapSnapshot",oo="partMapSnapshot",ao="scale",so="boxZoom",ro="selectedObjectsZoom",lo="extentPrevious",co="extentNext",uo="currentPosition",po="objectIdentification",fo="reverseGeocode",ho="fullScreenTool",mo="searchPoint",go=n("c920"),yo={SELECT:di,components:{GisDirectGeocoder:Zn,GisReverseGeocoder:ri,GisToolbarButtonGroup:Fe["a"]},props:{activeMouseTool:Boolean,modeVisible:Boolean,geocodePoint:String,allAddresses:Array,objectProperties:Object,validateLatLng:Function,popupContainer:null},data:function(){return{searchValue:"",store:new go["a"]({load:function(e){return Object(X["a"])(e.searchValue)}})}},methods:{handleValueChanged:function(e,t){var n=this,i=!!t&&t.includes(":");if(i){var o="https://pkk.rosreestr.ru/api/features",a=t.split(":").filter((function(e){return e})).map((function(e){for(var t=0;t<e.length;t++){if("0"!==e[t])return e.slice(t);if(t===e.length-1)return"0"}}));this.$emit("useIdentificationRequestTool","".concat(o,"/").concat(5-a.length,"/").concat(a.join(":")))}else{this.$emit("resetIdentification");var s={_config_is_geojson:!0,_address:e.itemData||t,_configYandex:"bound",_config_dataset:"BASE.DSYANDEXGEOLOC"};Object(X["c"])("getData",s).then((function(e){n.$emit("handleMarker",e.features[0].geometry.coordinates,[e.features[0].properties.point.split(" ")],"direct")}))}},handleCoordinates:function(e){this.$emit("handleCoordinatesChanged",e)},onItemClick:function(e){this.$emit("handleMarkerPopup",e.itemData)}}},vo=yo,bo=Object(le["a"])(vo,$n,Nn,!1,null,null,null),_o=bo.exports,Co=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-search-point-panel"},[n("DxSelectBox",{staticClass:"gis-search-point-panel__field",attrs:{dataSource:e.projections,displayExpr:"text",valueExpr:"value"},on:{opened:e.selectBoxOpened,valueChanged:e.projectionChanged},model:{value:e.projection,callback:function(t){e.projection=t},expression:"projection"}}),n("DxNumberBox",{staticClass:"gis-search-point-panel__field",attrs:{placeholder:"WGS84"===e.projection?"широта":"x"},model:{value:e.coord1,callback:function(t){e.coord1=t},expression:"coord1"}}),n("DxNumberBox",{staticClass:"gis-search-point-panel__field",attrs:{placeholder:"WGS84"===e.projection?"долгота":"y"},model:{value:e.coord2,callback:function(t){e.coord2=t},expression:"coord2"}}),n("DxButton",{staticClass:"gis-search-point-panel__button",attrs:{text:"Найти",type:"success"},on:{click:e.handleSearchPoint}})],1)},xo=[],Oo={name:"GisSearchPointPanel",mixins:[yt["a"]],components:{DxSelectBox:nt.a,DxNumberBox:pt.a,DxButton:st.a},data:function(){return{projections:[{text:"EPSG:4326",value:"WGS84"},{text:"EPSG:3857",value:"mercator"}],projection:"WGS84",coord1:null,coord2:null}},methods:{projectionChanged:function(){this.coord1=null,this.coord2=null},handleSearchPoint:function(){if(this.coord1&&this.coord2){var e=c["point"]([this.coord2,this.coord1]);"mercator"===this.projection&&(e=c["toWgs84"](e));var t=c["buffer"](e,15,{units:"kilometers"}),n=c["bbox"](t);this.$emit("searchPoint",n,e.geometry.coordinates)}}}},Io=Oo,So=(n("f948"),Object(le["a"])(Io,Co,xo,!1,null,null,null)),Lo=So.exports,Do=n("d45b"),Po=n("a2f8"),Eo=n("c22f"),wo=n("fe56");function To(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function jo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?To(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):To(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ko={LEGEND:li,SPACE_IMAGERY:ci,SELECT:di,LINE_SELECT:ui,RECTANGLE_SELECT:pi,CIRCLE_SELECT:fi,POLYGON_SELECT:hi,BUFFER_ZONE_SELECT:mi,BUFFER_ZONE_SELECT_ROUNDED:gi,CIRCLE_RADIUS_SELECT:yi,MEASURE_DISTANCE:vi,MEASURE_AREA:bi,MEASURE_PERIMETER:_i,SAVE:Ci,UNDO:xi,REDO:Oi,COPY:Ii,PASTE:Si,CUT:Li,DELETE:Di,MARKER:Pi,PENCIL_LINE:Ei,PENCIL_POLYGON:wi,LINE:Ti,POLYGON:ji,BUFFER_ZONE:Fi,BUFFER_ZONE_ROUNDED:Bi,BUFFER_ZONE_UNION:Mi,COORDINATES:Ai,GEO_JSON:ki,SNAP_TO_POINT:Ui,SNAP_TO_LINE:zi,NEW_INTERSECTION_OBJECT:Ri,NEW_UNION_OBJECT:Vi,CONVEX_HULL:Gi,SUBSTRACT_ALL:$i,SLICE_GEOM:Ni,EDIT:Hi,MOVE:Wi,PART:Ki,REMOVE_PART:qi,CHANGE_TYPE:Ji,CHANGE_TYPE_LINE:Zi,CHANGE_TYPE_MULTI_LINE:Yi,CHANGE_TYPE_POINT:Xi,CHANGE_TYPE_MULTI_POINT:Qi,CHANGE_TYPE_POLY:eo,CHANGE_TYPE_MULTI_POLY:to,SNAPSHOT_FOR_REPORT:no,FULL_MAP_SNAPSHOT:io,PART_MAP_SNAPSHOT:oo,SCALE:ao,BOX_ZOOM:so,SELECTED_OBJECTS_ZOOM:ro,EXTENT_PREVIOUS:lo,EXTENT_NEXT:co,CURRENT_POSITION:uo,OBJECT_IDENTIFICATION:po,REVERSE_GEOCODE:fo,FULL_SCREEN_TOOL:ho,SEARCH_POINT:mo,TOOLS_WITH_SNAP:[yi,vi,bi,Pi,Ei,wi,Ti,ji,Hi,Ki,Ni],GEOCODE_TOOLS:[fo,mo],components:{GisToolbarButton:Be["a"],GisToolbarButtonGroup:Fe["a"],GisToolbarDropDownButton:kn,GisGeocoder:_o,DxAutocomplete:Wn.a,DxNumberBox:pt.a,DxTextBox:ei.a,DxList:ni.a,DxValidator:ii["DxValidator"],DxCustomRule:ii["DxCustomRule"],GisToolbarTextButton:Gn,GisBufferZonePanel:Do["a"],GisSearchPointPanel:Lo},mixins:[Po["a"]],props:{legendButtonActive:Boolean,spaceImageButtonActive:Boolean,buttonValues:Object,buttonDisabled:Object,roundedBuffer:Boolean,visibleTools:Object,leftButtonItems:Array,rightButtonItems:Array,activeMouseTool:{type:String,default:di},geocodePoint:String,allAddresses:Array,objectProperties:Object,validateLatLng:Function,pasteButtonMessage:String,isFullScreen:Boolean,popoverContainer:null,activeLegendLayer:Object,gisComponentId:String},data:function(){var e,t;return{activeSubstractTool:!1,activeSnapTool:null,buttonActive:(e={},Object(s["a"])(e,li,!1),Object(s["a"])(e,ci,!1),e),buttonLoading:Object(s["a"])({},Ci,!1),modeVisible:(t={},Object(s["a"])(t,this.$options.BUFFER_ZONE_SELECT,!1),Object(s["a"])(t,this.$options.CIRCLE_RADIUS_SELECT,!1),Object(s["a"])(t,this.$options.BUFFER_ZONE,!1),Object(s["a"])(t,this.$options.REVERSE_GEOCODE,!1),Object(s["a"])(t,this.$options.PASTE,!1),Object(s["a"])(t,this.$options.SEARCH_POINT,!1),t),scales:[500,1e3,2e3]}},computed:jo(jo({},Object(d["c"])("config",{getOptions:Eo["c"],getTimelineEnable:Jt["F"]})),{},{toggleTimeline:function(){return this.getOptions(this.gisComponentId).showTimeline},timelineButtonActive:function(){return this.getOptions(this.gisComponentId).timelineButtonActive},timelineButtonEnable:function(){return this.getTimelineEnable(this.gisComponentId)},isSnappingToolDisabled:function(){return!this.$options.TOOLS_WITH_SNAP.includes(this.activeMouseTool)},fullScreenToolText:function(){return this.isFullScreen?"Выйти из полноэкранного режима":"Перейти в полноэкранный режим"},changeTypeButtonsVisible:function(){var e;return e={},Object(s["a"])(e,Zi,this.isLayerGeometryCanType(Zi)),Object(s["a"])(e,Yi,this.isLayerGeometryCanType(Yi)),Object(s["a"])(e,Xi,this.isLayerGeometryCanType(Xi)),Object(s["a"])(e,Qi,this.isLayerGeometryCanType(Qi)),Object(s["a"])(e,eo,this.isLayerGeometryCanType(eo)),Object(s["a"])(e,to,this.isLayerGeometryCanType(to)),e}}),watch:{isSnappingToolDisabled:function(){this.isSnappingToolDisabled&&this.activeSnapTool&&(this.emitButtonActiveStateChanged(this.activeSnapTool),this.activeSnapTool=null)},buttonDisabled:{handler:function(){var e=this;Object.keys(this.buttonDisabled).forEach((function(t){e.buttonDisabled[t]&&e.activeMouseTool===t&&e.emitButtonActiveStateChanged(di)}))},deep:!0}},methods:jo(jo({},Object(d["d"])("config",{setOption:wo["a"]})),{},{isLayerGeometryCanType:function(e){var t=this.activeLegendLayer,n=e.replace("changeType","").replace("Multi","");return!t||!t.geomTypes||t.geomTypes.some((function(e){return e.includes(n)}))},onReverseGeocode:function(){this.modeVisible[this.$options.REVERSE_GEOCODE]?this.setActiveMouseTool(di):(this.modeVisible[this.$options.REVERSE_GEOCODE]=!0,this.setActiveMouseTool(this.$options.REVERSE_GEOCODE))},setActiveMouseTool:function(e){var t=this;this.emitButtonActiveStateChanged(e),this.$options.GEOCODE_TOOLS.includes(e)?this.$options.GEOCODE_TOOLS.forEach((function(n){e!==n&&(t.modeVisible[n]=!1)})):this.handleRemoveGeocodeMarkers()},toggleButton:function(e){this.buttonActive[e]=!this.buttonActive[e],this.emitButtonActiveStateChanged(e),this.handleRemoveGeocodeMarkers()},toggleTimelineButton:function(){this.setOption({componentId:this.gisComponentId,optionName:"timelineButtonActive",optionValue:!this.timelineButtonActive}),this.handleRemoveGeocodeMarkers()},handleButtonClick:function(e,t){this.$emit("buttonClick",{buttonName:e,value:t,callback:this.buttonCallback}),this.handleRemoveGeocodeMarkers(),e===$i&&(this.activeSubstractTool=!this.activeSubstractTool)},buttonCallback:function(e){var t=e.buttonName,n=e.state;void 0!==n.loading&&(this.buttonLoading[t]=n.loading)},setActiveSnapTool:function(e){e===this.activeSnapTool?this.activeSnapTool=null:this.activeSnapTool=e,this.emitButtonActiveStateChanged(e),this.handleRemoveGeocodeMarkers()},emitButtonActiveStateChanged:function(e){this.$emit("buttonActiveStateChanged",{buttonName:e,active:this.buttonActive[e]})},customButtonClick:function(e){this.callEventAction(e,"onClick",{}),this.handleRemoveGeocodeMarkers()},handleAddMarker:function(e,t,n){this.$emit("handleMarker",e,t,n)},handleAddMarkerPopup:function(e){this.$emit("handleMarkerPopup",e)},handleCoordinates:function(e){this.$emit("handleCoordinatesChanged",e)},handleDeleteButtonClick:function(){this.handleRemoveGeocodeMarkers(),this.handleButtonClick(this.$options.DELETE)},handlePerimeterButtonClick:function(){this.handleRemoveGeocodeMarkers(),this.emitButtonActiveStateChanged(_i),this.handleButtonClick(this.$options.MEASURE_PERIMETER)},handleRemoveGeocodeMarkers:function(){this.$emit("handleRemoveAddresses"),this.$emit("handleRemovePoint"),this.$emit("handleRemoveMarker"),this.modeVisible[this.$options.REVERSE_GEOCODE]=!1,this.modeVisible[this.$options.SEARCH_POINT]=!1},addressSearchFocusIn:function(){this.modeVisible[this.$options.REVERSE_GEOCODE]&&this.setActiveMouseTool(di)},identificationRequestTool:function(e){this.$emit("useIdentificationRequestTool",e)},handleResetIdentification:function(){this.$emit("resetIdentification")},handleSearchPoint:function(){this.setActiveMouseTool(this.$options.SEARCH_POINT),this.modeVisible[this.$options.SEARCH_POINT]=!0},searchPoint:function(e,t){this.$emit("handleRemoveMarker"),this.handleAddMarker(e,[t],"direct")}})},Fo={mixins:[ko]},Bo=Fo,Mo=(n("d855"),Object(le["a"])(Bo,In,Sn,!1,null,null,null)),Ao=Mo.exports,Ro=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-layer-list"},e._l(e.layers,(function(t){return n("GisLayer",{key:t.componentId,attrs:{componentId:t.componentId,mapbox:e.mapbox},on:{featureSelecting:e.onFeatureSelecting,layerChanged:e.onLayerChanged,dataRefreshing:e.onLayerDataRefreshing,filtering:e.onLayerFiltering,filterPanelLoaded:e.onLayerFilterPanelLoaded,clearGeoJson:e.onLayerClearGeoJson}})})),1)},Vo=[],Go=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-layer"},[n("div",{class:e.cssClass},[n("span",{staticClass:"gis-layer__text"},[e._v("\n      "+e._s(e.options.text)+" ("+e._s(e.componentId)+")\n    ")]),0!==e.popupItems.length?n("button",{staticClass:"gis-layer__toggle",on:{click:function(t){e.isOpen=!e.isOpen}}},[n("i",{class:"fas fa-angle-"+(e.isOpen?"down":"up")})]):e._e(),n("SimpleInvisibleComponentContainer",{staticClass:"gis-layer__invisible-items",class:{"gis-layer__invisible-items_collapsed":!e.isOpen},attrs:{icon:"far fa-window-restore",items:e.popupItems}})],1)])},$o=[],No=n("15fd"),Uo=n("104d"),zo=n("7bf0"),Ho={name:"GisLayer",mixins:[Q["a"],zo["b"]],components:{SimpleInvisibleComponentContainer:Uo["a"]},props:{mapbox:null},data:function(){return{isOpen:!0}},computed:{popupItems:function(){var e=this,t=this.$store.getters["config/getComponentConstructorOptions"](this.componentId),n=t.items;return n?n.map((function(t){return e.$store.getters["config/getItem"](t)})).filter((function(e){return e})):[]},cssClass:function(){return{"gis-layer__layer":!0,"gis-layer_hidden":!this.$store.state.uiConstructor.active}},layerData:function(){return this.$store.getters["config/getItemField"](this.dataSetComponentId,"selectedData")},layerInfo:function(){return this.options.layerInfo||{}},isDataRefresing:function(){return this.$store.getters["config/getItemField"](this.dataSetComponentId,"selectedData")}},watch:{layerData:function(e,t){"geojson"===this.options.type&&e===t||this.$emit("dataRefreshing",{data:e,layerId:this.componentId})}},mounted:function(){this.options.visible&&this.callEventAction(this.componentId,"onShown",this.layerInfo),this.$emit("initialized")},methods:{locate:function(e){var t=e.zoom,n=Object(No["a"])(e,["zoom"]);this.$emit("featureSelecting",{zoom:t,param:n,layerId:this.componentId})},filter:function(e){this.$emit("filtering",{param:e,layerId:this.componentId})},setLayerParamValue:function(){this.$emit("layerChanged",{componentId:this.componentId,options:this.options})},loadFilterPanelContent:function(e){var t=this;this.filterPanelComponentId=e.componentId||e.component_id;var n=this.componentId;if(null!=this.filterPanelComponentId){var i=this.$store.getters["config/getItem"](this.filterPanelComponentId);return i?this.$store.dispatch("config/setComponentParent",{componentId:this.filterPanelComponentId,componentPos:0,oldParentId:i.parentComponentId,newParentId:n,oldUrl:null,newUrl:null,changeConstructor:!1,changeLoaded:!1}).then((function(){t.emitFilterPanelLoaded()})):this.$store.dispatch("config/loadComponent",{componentId:this.filterPanelComponentId,parentComponentId:n}).then((function(){t.emitFilterPanelLoaded()}))}},emitFilterPanelLoaded:function(){this.$emit("filterPanelLoaded",{filterPanelComponentConfig:this.$store.getters["config/getItem"](this.filterPanelComponentId)})},clearGeoJson:function(){return this.$emit("clearGeoJson",{componentId:this.componentId}),Promise.resolve()}}},Wo=Ho,Ko=(n("2bb6"),Object(le["a"])(Wo,Go,$o,!1,null,null,null)),qo=Ko.exports,Jo={name:"GisLayerList",components:{GisLayer:qo},props:{layers:Array,mapbox:null},methods:{onFeatureSelecting:function(e){this.$emit("featureSelecting",e)},onLayerChanged:function(e){this.$emit("layerChanged",e)},onLayerDataRefreshing:function(e){this.$emit("dataRefreshing",e)},onLayerFiltering:function(e){this.$emit("filtering",e)},onLayerFilterPanelLoaded:function(e){this.$emit("filterPanelLoaded",e)},onLayerClearGeoJson:function(e){this.$emit("clearGeoJson",e)}}},Zo=Jo,Yo=(n("d08a"),Object(le["a"])(Zo,Ro,Vo,!1,null,null,null)),Xo=Yo.exports,Qo=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"layout-draw__menu"},[n("div",{staticClass:"layout-draw__toolbar"},[n("div",[n("GisToolbarButtonGroup",[n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.SELECT,iconCss:"core core-003-coursor",text:"Выбор объекта"},on:{click:function(t){return e.setActiveMouseTool(e.$options.SELECT)}}}),n("GisToolbarButton",{attrs:{disabled:e.buttonDisabled[e.$options.DELETE],iconCss:"core core-023-delete",text:"Удалить объекты"},on:{click:function(t){return e.execCommand(e.$options.DELETE)}}}),n("GisToolbarButton",{attrs:{disabled:e.buttonDisabled[e.$options.UNDO],iconCss:"core core-017-step-back",text:"Отменить последнее действие"},on:{click:function(t){return e.execCommand(e.$options.UNDO)}}}),n("GisToolbarButton",{attrs:{disabled:e.buttonDisabled[e.$options.REDO],iconCss:"core core-018-step-forward",text:"Повторить последнее действие"},on:{click:function(t){return e.execCommand(e.$options.REDO)}}}),n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.EDIT,disabled:e.buttonDisabled[e.$options.EDIT],iconCss:"core core-025-move-node",text:"Перемещение вершин"},on:{click:function(t){return e.setActiveMouseTool(e.$options.EDIT)}}}),n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.MOVE,disabled:e.buttonDisabled[e.$options.MOVE],iconCss:"core core-027-arrows-outwards",text:"Перемещение объектов"},on:{click:function(t){return e.setActiveMouseTool(e.$options.MOVE)}}}),n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.MARKER,iconCss:"core core-add-point",text:"Точечный объект"},on:{click:function(t){return e.setActiveMouseTool(e.$options.MARKER)}}}),n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.LINE,iconCss:"core core-094-line",text:"Линия по точкам"},on:{click:function(t){return e.setActiveMouseTool(e.$options.LINE)}}}),n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.POLYGON,iconCss:"core core-034-add-poly-2",text:"Полигон по точкам"},on:{click:function(t){return e.setActiveMouseTool(e.$options.POLYGON)}}}),n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.FLY_NOTE,iconCss:"core core-038-add-text",text:"Выноска с текстом"},on:{click:function(t){return e.setActiveMouseTool(e.$options.FLY_NOTE)}}}),n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.FLY_COORDS,iconCss:"core core-039-add-coords",text:"Выноска с координатами"},on:{click:function(t){return e.setActiveMouseTool(e.$options.FLY_COORDS)}}}),n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.TEXT,iconCss:"core core-113-text",text:"Текст"},on:{click:function(t){return e.setActiveMouseTool(e.$options.TEXT)}}}),n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.ARROW_SINGLE,iconCss:"core core-arrow-single",text:"Одинарная стрелка"},on:{click:function(t){return e.setActiveMouseTool(e.$options.ARROW_SINGLE)}}}),n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.ARROW_DOUBLE,iconCss:"core core-arrow-double",text:"Двойная стрелка"},on:{click:function(t){return e.setActiveMouseTool(e.$options.ARROW_DOUBLE)}}}),n("GisToolbarButton",{attrs:{iconCss:"core core-node-num",text:"Подписи к вершинам"},on:{click:function(t){return e.generateVertexLabels()}}})],1)],1)]),n("div",{staticClass:"layout-draw__toolbar"},[n("div",{staticClass:"gis-toolbar-button-group"},[e.fillToolsVisible?n("div",{staticClass:"gis-toolbar-button layout-draw__button"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Заливка")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",e._b({staticClass:"layout-draw__color-box",on:{opened:e.selectBoxOpened,valueChanged:e.onStyleChange},model:{value:e.modelStyle["fill-color"],callback:function(t){e.$set(e.modelStyle,"fill-color",t)},expression:"modelStyle['fill-color']"}},"DxColorBox",e.colorOptions,!1))],1)])]):e._e(),e.lineToolsVisible?n("div",{staticClass:"gis-toolbar-button layout-draw__button"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Обводка")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"layout-draw__number-box",attrs:{min:0},on:{valueChanged:e.onStyleChange},model:{value:e.modelStyle["stroke-width"],callback:function(t){e.$set(e.modelStyle,"stroke-width",t)},expression:"modelStyle['stroke-width']"}}),n("DxColorBox",e._b({staticClass:"layout-draw__color-box",on:{opened:e.selectBoxOpened,valueChanged:e.onStyleChange},model:{value:e.modelStyle["stroke-color"],callback:function(t){e.$set(e.modelStyle,"stroke-color",t)},expression:"modelStyle['stroke-color']"}},"DxColorBox",e.colorOptions,!1))],1)])]):e._e(),e.textToolsVisible?n("div",{staticClass:"gis-toolbar-button layout-draw__button"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Текст")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{staticClass:"layout-draw__font-selectbox",attrs:{dataSource:e.fontsAvailable},on:{valueChanged:e.onStyleChange},model:{value:e.modelStyle["text-font-name"],callback:function(t){e.$set(e.modelStyle,"text-font-name",t)},expression:"modelStyle['text-font-name']"}}),n("DxNumberBox",{staticClass:"layout-draw__number-box",attrs:{min:1},on:{valueChanged:e.onStyleChange},model:{value:e.modelStyle["text-size"],callback:function(t){e.$set(e.modelStyle,"text-size",t)},expression:"modelStyle['text-size']"}}),n("GisToolbarButton",{attrs:{active:this.modelStyle["text-bold"],iconCss:"core core-font-bold"},on:{click:function(t){return e.toggleFont("text-bold")}}}),n("GisToolbarButton",{attrs:{active:this.modelStyle["text-italic"],iconCss:"core core-font-italic"},on:{click:function(t){return e.toggleFont("text-italic")}}}),n("DxColorBox",e._b({staticClass:"layout-draw__color-box",on:{opened:e.selectBoxOpened,valueChanged:e.onStyleChange},model:{value:e.modelStyle["text-color"],callback:function(t){e.$set(e.modelStyle,"text-color",t)},expression:"modelStyle['text-color']"}},"DxColorBox",e.colorOptions,!1))],1)])]):e._e()])])])},ea=[],ta=(n("f751"),n("d4ec")),na=n("bee2");function ia(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=oa(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function oa(e,t){if(e){if("string"===typeof e)return aa(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?aa(e,t):void 0}}function aa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var sa=function(){function e(t){Object(ta["a"])(this,e),Object(s["a"])(this,"mapbox",null),Object(s["a"])(this,"style",null),this.mapbox=t}return Object(na["a"])(e,[{key:"getFullFontValue",value:function(){var e=this.style["text-font-name"],t="";return this.style["text-bold"]&&(t+=" Bold"),this.style["text-italic"]&&(t+=" Italic"),t||(t=" Regular"),[e+t]}},{key:"getFeatures",value:function(e){var t,n=ia(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;Object.assign(i.properties,this.style)}}catch(o){n.e(o)}finally{n.f()}return Promise.resolve(e)}},{key:"changeStyle",value:function(e,t){var n,i=ia(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;Object.assign(o.properties,t)}}catch(a){i.e(a)}finally{i.f()}}},{key:"cancel",value:function(){}}]),e}(),ra=(n("2397"),n("257e")),la=n("45eb"),ca=n("262e"),da=n("99de"),ua=n("7e84");function pa(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=fa(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function fa(e,t){if(e){if("string"===typeof e)return ha(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ha(e,t):void 0}}function ha(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ma(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ga(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ma(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ma(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ya(e){var t=va();return function(){var n,i=Object(ua["a"])(e);if(t){var o=Object(ua["a"])(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return Object(da["a"])(this,n)}}function va(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var ba=15,_a=Math.PI/8,Ca="on",xa="back",Oa=function(e){Object(ca["a"])(n,e);var t=ya(n);function n(e,i){var o;return Object(ta["a"])(this,n),o=t.call(this,e),Object(s["a"])(Object(ra["a"])(o),"objectType",Aa),o.objectType=i,o}return Object(na["a"])(n,[{key:"getFeatures",value:function(e,t){var n,i=[],o=0,a=t?t.map((function(e){return e.id})):null,s=e[0].geometry.coordinates.filter((function(e,t,n){return!(t>0&&e[0]===n[t-1][0]&&e[1]===n[t-1][1])}));n=a?a[o++]:(new u["a"]).toString(),i.push({type:"Feature",id:n,properties:{id:n,"fill-color":this.style["stroke-color"],"stroke-color":this.style["stroke-color"],"stroke-width":1},geometry:this.getArrowPolygon(s,s.length-1,Ca)});var r=ba*Math.cos(_a);s[s.length-1]=this.transferTo(s,s.length-1,r,xa),this.objectType===Ra&&(n=a?a[o++]:(new u["a"]).toString(),i.push({type:"Feature",id:n,properties:{id:n,"fill-color":this.style["stroke-color"],"stroke-color":this.style["stroke-color"],"stroke-width":1},geometry:this.getArrowPolygon(s,0,xa)}),s[0]=this.transferTo(s,0,r,Ca));var l=[];return Object(Mt["a"])(s,l),n=a?a[o]:(new u["a"]).toString(),i.push({type:"Feature",id:n,properties:ga({id:n},this.style),geometry:{type:"LineString",coordinates:l}}),Promise.resolve(i)}},{key:"changeStyle",value:function(e,t){var n,i=pa(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;o.properties["fill-color"]=t["stroke-color"],o.properties["stroke-color"]=t["stroke-color"],o.properties["stroke-width"]=t["stroke-width"]}}catch(a){i.e(a)}finally{i.f()}}},{key:"getArrowPolygon",value:function(e,t,n){t>e.length-1&&(t=e.length-1);var i=n===Ca?e[t-1]:e[t+1],o=e[t],a=this.mapbox.project(i),s=this.mapbox.project(o),r={y:s.y-a.y,x:a.x-s.x},l=this.rotate(r,_a);l=this.setLength(l,ba);var c=this.rotate(r,-_a);c=this.setLength(c,ba);var d=[{lng:o[0],lat:o[1]},this.mapbox.unproject({x:s.x+l.x,y:s.y-l.y}),this.mapbox.unproject({x:s.x+c.x,y:s.y-c.y})];return{type:"Polygon",coordinates:[[[d[0].lng,d[0].lat],[d[1].lng,d[1].lat],[d[2].lng,d[2].lat],[d[0].lng,d[0].lat]]]}}},{key:"rotate",value:function(e,t){var n=e.x*Math.cos(t)-e.y*Math.sin(t),i=e.y*Math.cos(t)+e.x*Math.sin(t);return{x:n,y:i}}},{key:"transferTo",value:function(e,t,n,i){var o=i===Ca?e[t+1]:e[t-1],a=e[t],s=this.mapbox.project(o),r=this.mapbox.project(a),l={x:s.x-r.x,y:s.y-r.y};l=this.setLength(l,n);var c=r.x+l.x,d=r.y+l.y,u=this.mapbox.unproject({x:c,y:d});return[u.lng,u.lat]}},{key:"setLength",value:function(e,t){var n=Math.sqrt(e.x*e.x+e.y*e.y),i=e.x*t/n,o=e.y*t/n;return{x:i,y:o}}}]),n}(sa);function Ia(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Sa(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function Sa(e,t){if(e){if("string"===typeof e)return La(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?La(e,t):void 0}}function La(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Da(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Pa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Da(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Da(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ea(e){var t=wa();return function(){var n,i=Object(ua["a"])(e);if(t){var o=Object(ua["a"])(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return Object(da["a"])(this,n)}}function wa(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var Ta=5,ja=90,ka=function(e){Object(ca["a"])(n,e);var t=Ea(n);function n(e,i){var o;return Object(ta["a"])(this,n),o=t.call(this,e),Object(s["a"])(Object(ra["a"])(o),"objectType",Fa),Object(s["a"])(Object(ra["a"])(o),"textboxMarker",null),o.objectType=i,o}return Object(na["a"])(n,[{key:"getFeatures",value:function(e,t){var n=this,i=e[0].geometry.coordinates.filter((function(e,t,n){return!(t>0&&e[0]===n[t-1][0]&&e[1]===n[t-1][1])})),o=i[0],a=i[i.length-1],s=o[0]>a[0];if(t){var r=this.getEditedFeatures(i,s,t);return Promise.resolve(r)}if(this.objectType===Fa)return new Promise((function(e){n.showTextbox(a,s).then((function(t){var o=t.textbox,a=1.1*o.offsetWidth+2*Ta,r=n.textboxMarker.getElement().innerHTML;r=r.replace(/<div>/g,"\n"),r=r.replace(/<[/]div>/g,""),n.textboxMarker.remove(),n.textboxMarker=null;var l=n.finishFigure(i,r,a,s);e(l)}))}));if(this.objectType===Ba){var l="".concat(this.formatCoord(o[1],"lat"),"\n").concat(this.formatCoord(o[0],"lng")),c=ja/13*this.style["text-size"],d=this.finishFigure(i,l,c,s);return Promise.resolve(d)}}},{key:"getEditedFeatures",value:function(e,t,n){var i=[],o=e[e.length-1],a=n[0].geometry.coordinates,s=a[a.length-1][0]-a[a.length-2][0];s=t?-s:s,e.push([o[0]+s,o[1]]),i.push({type:"Feature",id:n[0].id,properties:Pa({id:n[0].id},this.style),geometry:{type:"LineString",coordinates:Object(Mt["a"])(e)}});var r=Pa({},this.style);return r.id=n[1].id,r["text-font-name"]=this.getFullFontValue(),r.text=n[1].properties.text,r.anchor=t?"bottom-right":"bottom-left",r.offset=t?[-.5,0]:[.5,0],i.push({type:"Feature",id:n[1].id,properties:r,geometry:{type:"Point",coordinates:[o[0],o[1]]}}),i}},{key:"showTextbox",value:function(e,t){var n=this;return new Promise((function(i){var o=document.createElement("DIV");o.className="layout-draw__div-input",o.style.fontSize=(n.style["text-size"]||13)+"px",o.addEventListener("mousedown",(function(e){e.stopPropagation(),e.target.setAttribute("contenteditable",!0),e.target.focus()})),o.addEventListener("blur",(function(e){e.stopPropagation(),i({textbox:o})})),n.textboxMarker=new l.a.Marker({element:o,anchor:t?"bottom-right":"bottom-left"}),n.textboxMarker.setLngLat([e[0],e[1]]),n.textboxMarker.addTo(n.mapbox)}))}},{key:"finishFigure",value:function(e,t,n,i){var o=e[e.length-1],a=i?-1:1,s=a*n,r=this.mapbox.project(o);r.x+=s;var l=this.mapbox.unproject(r);e.push([l.lng,l.lat]);var c=[],d=(new u["a"]).toString();c.push({type:"Feature",id:d,properties:Pa({id:d},this.style),geometry:{type:"LineString",coordinates:Object(Mt["a"])(e)}}),d=(new u["a"]).toString();var p=Pa({id:d},this.style);return p.text=t,p["text-font-name"]=this.getFullFontValue(),p.anchor=i?"bottom-right":"bottom-left",p.offset=i?[-.5,0]:[.5,0],c.push({type:"Feature",id:d,properties:p,geometry:{type:"Point",coordinates:[o[0],o[1]]}}),c}},{key:"changeStyle",value:function(e,t){Object(la["a"])(Object(ua["a"])(n.prototype),"changeStyle",this).call(this,e,t);var i,o=Ia(e);try{for(o.s();!(i=o.n()).done;){var a=i.value;a.properties["text-font-name"]=this.getFullFontValue()}}catch(s){o.e(s)}finally{o.f()}}},{key:"formatCoord",value:function(e,t){var n=e.toFixed(4)+" ";return n+="lat"===t?e>0?"С.Ш.":"Ю.Ш.":e>0?"В.Д.":"З.Д.",n}}]),n}(sa),Fa="flyNote",Ba="flyCoords",Ma="text",Aa="arrowSingle",Ra="arrowDouble",Va=function(){function e(){Object(ta["a"])(this,e)}return Object(na["a"])(e,null,[{key:"getInstance",value:function(e,t){switch(t){case Aa:case Ra:return new Oa(e,t);case Fa:case Ba:return new ka(e,t);case Ma:return new qa(e,t);default:return new sa(e,t)}}}]),e}();function Ga(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=$a(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function $a(e,t){if(e){if("string"===typeof e)return Na(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Na(e,t):void 0}}function Na(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Ua(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function za(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ua(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ua(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ha(e){var t=Wa();return function(){var n,i=Object(ua["a"])(e);if(t){var o=Object(ua["a"])(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return Object(da["a"])(this,n)}}function Wa(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var Ka,qa=function(e){Object(ca["a"])(n,e);var t=Ha(n);function n(e,i){var o;return Object(ta["a"])(this,n),o=t.call(this,e),Object(s["a"])(Object(ra["a"])(o),"objectType",Ma),Object(s["a"])(Object(ra["a"])(o),"textboxMarker",null),o.objectType=i,o}return Object(na["a"])(n,[{key:"getFeatures",value:function(e,t){var n=this;if(this.textboxMarker)return Promise.reject();var i=e[0].geometry.coordinates;if(t){var o=t[0].properties.text,a=t[0].id,s=this.finishFigure(i,o,a);return Promise.resolve(s)}return new Promise((function(e,t){n.showTextbox(i).then((function(){var o=n.textboxMarker&&n.textboxMarker.getElement().innerHTML;if(o){o=o.replace(/<div>/g,"\n"),o=o.replace(/<[/]div>/g,""),n.textboxMarker.remove(),n.textboxMarker=null;var a=n.finishFigure(i,o);e(a)}else n.cancel(),t()}))}))}},{key:"showTextbox",value:function(e){var t=this;return new Promise((function(n){var i=document.createElement("DIV");i.className="layout-draw__div-input",i.addEventListener("mousedown",(function(e){e.stopPropagation(),e.target.setAttribute("contenteditable",!0),e.target.focus()})),i.addEventListener("blur",(function(e){e.stopPropagation(),n()})),t.textboxMarker=new l.a.Marker({element:i,anchor:"center"}),t.textboxMarker.setLngLat([e[0],e[1]]),t.textboxMarker.addTo(t.mapbox)}))}},{key:"finishFigure",value:function(e,t,n){n=n||(new u["a"]).toString();var i=za({id:n},this.style);return i["text-font-name"]=this.getFullFontValue(),i.text=t,i.anchor="center",[{type:"Feature",id:n,properties:i,geometry:{type:"Point",coordinates:[e[0],e[1]]}}]}},{key:"changeStyle",value:function(e,t){Object(la["a"])(Object(ua["a"])(n.prototype),"changeStyle",this).call(this,e,t);var i,o=Ga(e);try{for(o.s();!(i=o.n()).done;){var a=i.value;a.properties["text-font-name"]=this.getFullFontValue()}}catch(s){o.e(s)}finally{o.f()}}},{key:"cancel",value:function(){this.textboxMarker&&(this.textboxMarker.remove(),this.textboxMarker=null)}}]),n}(sa),Ja=function(){function e(t){Object(ta["a"])(this,e),Object(s["a"])(this,"baseFeature",null),Object(s["a"])(this,"features",[]),Object(s["a"])(this,"selected",!1),Object(s["a"])(this,"type",null),Object(s["a"])(this,"style",null),Object.assign(this,t)}return Object(na["a"])(e,[{key:"getIds",value:function(){return this.features.map((function(e){return e.id}))}}]),e}(),Za=function(){var e=["monospace","sans-serif","serif"],t="mmmmmmmmmmlli",n="72px",i=document.getElementsByTagName("body")[0],o=document.createElement("span");o.style.fontSize=n,o.innerHTML=t;var a={},s={};for(var r in e)o.style.fontFamily=e[r],i.appendChild(o),a[e[r]]=o.offsetWidth,s[e[r]]=o.offsetHeight,i.removeChild(o);function l(t){var n=!1;for(var r in e){o.style.fontFamily='"'+t+'",'+e[r],i.appendChild(o);var l=o.offsetWidth!=a[e[r]]||o.offsetHeight!=s[e[r]];i.removeChild(o),n=n||l}return n}this.detect=l},Ya=Za,Xa=n("68b0");function Qa(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=es(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function es(e,t){if(e){if("string"===typeof e)return ts(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ts(e,t):void 0}}function ts(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ns(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function is(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ns(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ns(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var os=(Ka={},Object(s["a"])(Ka,di,"simple_select"),Object(s["a"])(Ka,ji,A.NAME),Object(s["a"])(Ka,Ti,k.NAME),Object(s["a"])(Ka,Pi,U.NAME),Object(s["a"])(Ka,Aa,k.NAME),Object(s["a"])(Ka,Ra,k.NAME),Object(s["a"])(Ka,Fa,k.NAME),Object(s["a"])(Ka,Ba,k.NAME),Object(s["a"])(Ka,Ma,U.NAME),Ka),as={tmpLayer:!0,type:"geojson",enable:!0,visible:!0,geomTypes:["Point","LineString","Polygon"],sourceOptions:{tolerance:.001},legendStyleItems:{},showInsertCard:!1,excludeSelectedFeatures:!0,selectionMapboxLayers:[{type:"line",paint:{"line-color":"#000","line-width":["+",4,["get","stroke-width"]],"line-opacity":1},filter:["match",["geometry-type"],["LineString","MultiLineString","Polygon","MultiPolygon"],!0,!1],layout:{visibility:"visible"},maxzoom:24,minzoom:0},{type:"line",paint:{"line-color":"#fff","line-width":["+",2,["get","stroke-width"]],"line-opacity":1},filter:["match",["geometry-type"],["LineString","MultiLineString","Polygon","MultiPolygon"],!0,!1],layout:{visibility:"visible"},maxzoom:24,minzoom:0},{type:"circle",paint:{"circle-color":"#fff","circle-radius":["+",7,["get","stroke-width"]],"circle-opacity":1,"circle-stroke-color":"#000","circle-stroke-width":1,"circle-stroke-opacity":1},filter:["all",["in",["geometry-type"],["literal",["Point","MultiPoint"]]]],maxzoom:24,minzoom:0}]},ss={componentId:"reportTmpLayer",componentType:"GisLayer",specialSortLayer:"legendSpecialSortLayer",options:as},rs=[{type:"fill",paint:{"fill-color":["get","fill-color"],"fill-opacity":["get","fill-opacity"]},filter:["all",["in",["geometry-type"],["literal",["Polygon","MultiPolygon"]]]],layout:{visibility:"visible"},maxzoom:24,minzoom:0},{type:"line",paint:{"line-color":["get","stroke-color"],"line-width":["get","stroke-width"],"line-opacity":1,"line-translate":[0,0]},filter:["all",["in",["geometry-type"],["literal",["Polygon","MultiPolygon"]]]],layout:{visibility:"visible"},maxzoom:24,minzoom:0},{type:"line",paint:{"line-color":["get","stroke-color"],"line-width":["get","stroke-width"],"line-opacity":1,"line-translate":[0,0]},filter:["all",["in",["geometry-type"],["literal",["LineString","MultiLineString"]]]],layout:{visibility:"visible"},maxzoom:24,minzoom:0},{type:"circle",paint:{"circle-color":["get","fill-color"],"circle-radius":5,"circle-opacity":1,"circle-stroke-color":["get","stroke-color"],"circle-stroke-width":["get","stroke-width"],"circle-stroke-opacity":1},filter:["all",["in",["geometry-type"],["literal",["Point","MultiPoint"]]],["!",["has","text"]]],maxzoom:24,minzoom:0},{type:"symbol",paint:{"text-color":["get","text-color"]},layout:{"text-field":["get","text"],"text-size":["get","text-size"],"text-font":["get","text-font-name"],"symbol-placement":"point","text-offset":["get","offset"],"text-anchor":["get","anchor"],"text-justify":"auto"},filter:["has","text"],maxzoom:24,minzoom:0}],ls=["Alegreya","Asap","Crimson","Droid Serif","EB Garamond","Faustina","Frank Ruhl Libre","Lato","League Mono","Merriweather","Montserrat","Open Sans","Playfair Display SC","Playfair Display","PT Sans","PT Serif","Raleway","Roboto Condensed","Roboto Mono","Roboto","Rubik","Source Sans Pro","Spectral","Ubuntu Mono","Ubuntu"],cs={SELECT:di,MARKER:Pi,LINE:Ti,POLYGON:ji,UNDO:xi,REDO:Oi,COPY:Ii,PASTE:Si,DELETE:Di,EDIT:Hi,MOVE:Wi,MEASURE_DISTANCE:vi,MEASURE_AREA:bi,MEASURE_PERIMETER:_i,FLY_NOTE:Fa,FLY_COORDS:Ba,TEXT:Ma,ARROW_SINGLE:Aa,ARROW_DOUBLE:Ra,data:function(){return{fontsAvailable:ls,layerComponentId:ss.componentId,activeMouseTool:"",modelStyle:{"fill-color":"#adadff","stroke-color":"#333333","stroke-width":2,"text-color":"#333333","text-size":13,"text-bold":!1,"text-italic":!1,"text-underline":!1,"text-font-name":"Open Sans"},currentHandler:null,figures:[],colorOptions:{acceptCustomValue:!1,editAlphaChannel:!0}}},props:{gisModule:Object,visible:Boolean},computed:is(is({},Object(d["c"])("config",{getLayerOptions:Yt["E"],getSelectedIds:Yt["H"],getFeaturesByIds:Yt["p"],canUndo:Yt["b"],canRedo:Yt["a"],getMapboxLayerIds:Yt["A"],getLayerAllFeatures:Yt["d"],getAllSelected:Jt["h"]})),{},{fillToolsVisible:function(){return this.getToolsVisibility([Pi,ji])},lineToolsVisible:function(){return this.getToolsVisibility([Pi,Ti,ji,Fa,Ba,Aa,Ra])},textToolsVisible:function(){return this.getToolsVisibility([Fa,Ba,Ma])},selectedFigures:function(){return this.figures.filter((function(e){return e.selected}))},selectedFeatures:function(){var e=this.getSelectedIds(this.layerComponentId);return this.getFeaturesByIds(this.layerComponentId,e)},copiedFeatures:function(){return[]},buttonDisabled:function(){var e;return e={},Object(s["a"])(e,Pi,!1),Object(s["a"])(e,Ti,!1),Object(s["a"])(e,ji,!1),Object(s["a"])(e,Ii,0===this.selectedFigures.length),Object(s["a"])(e,Si,0===this.selectedFigures.length),Object(s["a"])(e,Di,0===this.selectedFigures.length),Object(s["a"])(e,Hi,1!==this.selectedFigures.length),Object(s["a"])(e,Wi,0===this.selectedFigures.length),Object(s["a"])(e,_i,0===this.selectedFigures.length),Object(s["a"])(e,xi,!this.canUndo(this.layerComponentId)),Object(s["a"])(e,Oi,!this.canRedo(this.layerComponentId)),e}}),created:function(){this.createLayer(),this.gisModule.mapbox.on("draw.create",this.onDrawFeatures),this.gisModule.mapbox.on("draw.update",this.onEditFeatures),this.gisModule.mapbox.on("draw.modechange",this.onModeChange),this.gisModule.mapbox.on("click",this.onMapClick),this.gisModule.mapbox.on("contextmenu",this.onMouseDown)},beforeDestroy:function(){this.setSelectableLayerIds({gisComponentId:this.gisModule.componentId,selectableLayerIds:null}),this.deleteReportDrawLayerComponent({gisComponentId:this.gisModule.componentId,layerComponentId:this.layerComponentId}),this.gisModule.mapbox.off("draw.create",this.onDrawFeatures),this.gisModule.mapbox.off("draw.update",this.onEditFeatures),this.gisModule.mapbox.off("draw.modechange",this.onModeChange),this.gisModule.mapbox.off("click",this.onMapClick),this.gisModule.mapbox.off("contextmenu",this.onMouseDown),this.currentHandler=null,this.activeMouseTool=null},methods:is(is(is({},Object(d["d"])("config",{setSelectableLayerIds:Zt["E"],clearLayerFeatures:gn["d"],setLayerFeatures:gn["v"],addLayerFeatures:gn["a"],editLayerFeatures:gn["h"],deleteLayerFeatures:gn["g"],layerUndo:gn["Q"],layerRedo:gn["m"],removeChange:gn["n"],clearChanges:gn["c"],setLayerEditingIds:gn["s"],setLayerSelectedIds:gn["K"]})),Object(d["b"])("config",{gisLayerLoadGeoJson:Xt["v"],setReportDrawLayerComponent:Xa["y"],deleteReportDrawLayerComponent:Xa["f"]})),{},{getToolsVisibility:function(e){var t=e.includes(this.activeMouseTool);return t=t||this.selectedFigures.some((function(t){return e.includes(t.type)})),t},toggleFont:function(e){this.modelStyle[e]=!this.modelStyle[e],this.onStyleChange()},loadFeature:function(){var e=this,t=this.getAllSelected(this.gisModule.componentId),n=Object.keys(t)[0],i=t[n][0],o=this.getLayerOptions(n),a=this.getLayerAllFeatures(n).filter((function(e){return e.id===i}));return a[0]?Promise.resolve(a[0]):this.loadGeoJsons(n,[i],o).then((function(t){return e.setLayerFeatures({layerComponentId:n,features:t}),t[0]}))},createLayer:function(){var e=rs;ss.options.mapboxLayers=e;var t=is({id:this.layerComponentId,layerComponentId:this.layerComponentId},ss);this.setReportDrawLayerComponent({gisComponentId:this.gisModule.componentId,layerConfig:t}),this.setSelectableLayerIds({gisComponentId:this.gisModule.componentId,selectableLayerIds:[]})},execCommand:function(e){var t=this.selectedFeatures;switch(e){case Di:this.deleteLayerFeatures({layerComponentId:this.layerComponentId,features:t});break;case xi:this.layerUndo({layerComponentId:this.layerComponentId});break;case Oi:this.layerRedo({layerComponentId:this.layerComponentId});break}},setActiveMouseTool:function(e){if(this.activeMouseTool!==e)switch(this.cancelEdit(),this.activeMouseTool=e,this.currentHandler=null,e){case di:this.gisModule.setMapTool({name:di}),this.gisModule.mapboxDraw.deleteAll(),this.setLayerEditingIds({componentId:this.layerComponentId,ids:[]});break;case Pi:this.gisModule.toggleDrawerTool(os[e],e),this.currentHandler=new sa(this.gisModule.mapbox);break;case Ti:this.currentHandler=new sa(this.gisModule.mapbox),this.gisModule.toggleDrawerTool(os[e],e);break;case Aa:case Ra:this.currentHandler=Va.getInstance(this.gisModule.mapbox,e),this.gisModule.toggleDrawerTool(os[e],e);break;case ji:this.currentHandler=new sa(this.gisModule.mapbox),this.gisModule.toggleDrawerTool(os[e],e);break;case Hi:this.startEditFigure();break;case Wi:this.startMoveFigures();break;case Ba:case Fa:this.currentHandler=Va.getInstance(this.gisModule.mapbox,e),this.gisModule.toggleDrawerTool(os[e],e);break;case Ma:this.currentHandler=Va.getInstance(this.gisModule.mapbox,e),this.gisModule.toggleDrawerTool(os[e],e);break;default:this.gisModule.setMapTool({name:di})}},startEditFigure:function(){var e=this.selectedFigures[0];this.gisModule.editFeaturePoints(e.baseFeature);var t=e.getIds();this.setLayerEditingIds({componentId:this.layerComponentId,ids:t})},startMoveFigures:function(){var e=this.selectedFigures[0];this.gisModule.setEditMoveMode([e.baseFeature]);var t=e.getIds();this.setLayerEditingIds({componentId:this.layerComponentId,ids:t})},onMapClick:function(e){this.activeMouseTool===di&&this.selectByPoint(e.point,!e.originalEvent.shiftKey)},onMouseDown:function(e){2===e.originalEvent.button&&this.cancelEdit()},cancelEdit:function(){this.currentHandler&&this.currentHandler.cancel()},selectByPoint:function(e,t){var n=5,i=[[e.x-n,e.y-n],[e.x+n,e.y+n]],o=this.getMapboxLayerIds(this.layerComponentId),a=this.gisModule.mapbox.queryRenderedFeatures(i,{layers:o});t&&this.clearSelection();var s=this.getFiguresByFeatures(a);this.selectFigures(s,t)},clearSelection:function(){this.figures.forEach((function(e){return e.selected=!1}))},selectFigures:function(e,t){var n,i=[],o=Qa(e);try{for(o.s();!(n=o.n()).done;){var s=n.value;s.selected=!0,i=[].concat(Object(a["a"])(i),Object(a["a"])(s.getIds()))}}catch(r){o.e(r)}finally{o.f()}this.setLayerSelectedIds({componentId:this.layerComponentId,ids:i,shiftKey:!t}),e[0]&&(this.modelStyle=is({},e[0].style))},getFiguresByFeatures:function(e){var t,n=[],i=Qa(e);try{for(i.s();!(t=i.n()).done;){var o,a=t.value,s=Qa(this.figures);try{for(s.s();!(o=s.n()).done;){var r,l=o.value,c=Qa(l.features);try{for(c.s();!(r=c.n()).done;){var d=r.value;if(d.id===a.id){n.push(l);break}}}catch(u){c.e(u)}finally{c.f()}}}catch(u){s.e(u)}finally{s.f()}}}catch(u){i.e(u)}finally{i.f()}return n},onModeChange:function(e){var t=this.activeMouseTool,n=os[t];n&&e.mode!==n&&this.gisModule.toggleDrawerTool(n,t)},onDrawFeatures:function(e){var t=this;this.gisModule.mapboxDraw.deleteAll(),this.clearSelection();var n=is({},this.modelStyle);if(this.activeMouseTool===Fa){var i,o=Qa(e.features);try{for(o.s();!(i=o.n()).done;){var a=i.value;Object.assign(a.properties,n)}}catch(s){o.e(s)}finally{o.f()}this.addLayerFeatures({layerComponentId:this.layerComponentId,features:e.features,noHistory:!0})}this.currentHandler.style=n,this.currentHandler.getFeatures(e.features).then((function(i){t.activeMouseTool===Fa&&t.deleteLayerFeatures({layerComponentId:t.layerComponentId,features:e.features,noHistory:!0}),t.addLayerFeatures({layerComponentId:t.layerComponentId,features:i});var o=new Ja({baseFeature:e.features[0],features:i,selected:!1,type:t.activeMouseTool,style:n});t.figures.push(o),[ji,Ti,Pi].includes(t.activeMouseTool)&&t.selectFigures([o],!0)}))},onEditFeatures:function(e){var t,n=this,i={},o=null,a=this.selectedFigures[0].style;switch(this.activeMouseTool){case Hi:Object(Mt["a"])(e.features[0],i),t=this.selectedFigures[0].features,o=Va.getInstance(this.gisModule.mapbox,this.selectedFigures[0].type),o.style=a,o.getFeatures([i],t).then((function(e){n.selectedFigures[0].features=e,n.selectedFigures[0].baseFeature=i,n.editLayerFeatures({layerComponentId:n.layerComponentId,features:e})}));break;case Wi:Object(Mt["a"])(e.features[0],i),t=this.selectedFigures[0].features,o=Va.getInstance(this.gisModule.mapbox,this.selectedFigures[0].type),o.style=a,o.getFeatures([i],t).then((function(e){n.selectedFigures[0].features=e,n.selectedFigures[0].baseFeature=i,n.editLayerFeatures({layerComponentId:n.layerComponentId,features:e})}));break}},onStyleChange:function(){var e=this.modelStyle;if(this.selectedFigures&&this.selectedFigures[0]){var t,n=Qa(this.selectedFigures);try{for(n.s();!(t=n.n()).done;){var i=t.value,o=Va.getInstance(this.gisModule.mapbox,i.type);o.style=e;var a=[];Object(Mt["a"])(i.features,a),o.changeStyle(a,e),i.style=is({},e),this.editLayerFeatures({layerComponentId:this.layerComponentId,features:a}),i.features=a}}catch(s){n.e(s)}finally{n.f()}}this.$emit("changed")},setFonts:function(){this.fontsAvailable=[];var e,t=new Ya,n=Qa(ls);try{for(n.s();!(e=n.n()).done;){var i=e.value;t.detect(i)&&this.fontsAvailable.push(i)}}catch(o){n.e(o)}finally{n.f()}},generateVertexLabels:function(){var e=this;this.loadFeature().then((function(t){var n=e.getPoints(t.geometry);n.forEach((function(t,n){e.addText(t,(n+1).toString())}))}))},getPoints:function(e){var t=[];switch(e.type){case"Point":t=[e.coordinates];break;case"MultiPoint":case"LineString":t=e.coordinates;break;case"MultiLineString":t=e.coordinates.reduce((function(e,t){return e.concat(t)}),[]);break;case"Polygon":t=e.coordinates.reduce((function(e,t){return e.concat(t.slice(1,t.length-1))}),[]);break;case"MultiPolygon":var n,i=Qa(e.coordinates);try{for(i.s();!(n=i.n()).done;){var o=n.value;t=t.concat(o.reduce((function(e,t){return e.concat(t.slice(0,t.length-1))}),[]))}}catch(a){i.e(a)}finally{i.f()}}return t},addText:function(e,t){var n=(new u["a"]).toString(),i=is({},this.modelStyle),o=i["text-size"],a=this.gisModule.mapbox.project(e);a.x-=o,a.y-=o;var s=this.gisModule.mapbox.unproject(a);e=[s.lng,s.lat];var r={type:"Feature",id:n,properties:{},geometry:{type:"Point",coordinates:e}},l=new qa(this.gisModule.mapbox);l.style=i;var c=l.finishFigure(e,t,n);this.editLayerFeatures({layerComponentId:this.layerComponentId,features:c});var d=new Ja({baseFeature:r,features:c,selected:!1,type:Ma,style:i});this.figures.push(d)},loadGeoJsons:function(e,t,n){var i=this,o=t.map((function(t){return i.gisLayerLoadGeoJson(Object(s["a"])({layerComponentId:e},n.keyField,t)).then((function(e){var t=e.features[0];return t.id=t.properties[n.keyField],t}))}));return Promise.all(o)}})},ds={name:"SnapshotDraw",mixins:[cs,yt["a"]],components:{GisToolbarButtonGroup:Fe["a"],GisToolbarButton:Be["a"]}},us=ds,ps=(n("61a1"),Object(le["a"])(us,Qo,ea,!1,null,null,null)),fs=ps.exports,hs=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-document-snapshot-panel",style:e.panelStyle})},ms=[],gs={name:"GisDocumentSnapshotPanel",props:{panelStyle:{type:Object,default:function(){return{}}}}},ys=gs,vs=(n("f1a5"),Object(le["a"])(ys,hs,ms,!1,null,null,null)),bs=vs.exports,_s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.visible?n("div",{staticClass:"reports-popup"},[n("div",{staticClass:"reports-popup__top"},[n("DxToolbar",{staticClass:"reports-popup__top-toolbar"},[n("DxToolbarItem",{attrs:{widget:"dxButton",location:"before",options:e.topToolbarButtons.update}})],1),n("DxDataGrid",{staticClass:"reports-popup__grid",attrs:{selection:{mode:"single"},showBorders:!0,dataSource:e.dataSource},on:{contentReady:e.onContentReady,selectionChanged:e.onSelectionChanged}},[n("DxSearchPanel",{attrs:{visible:!0}}),n("DxColumn",{attrs:{dataField:"name",caption:"Название отчёта"}}),n("DxColumn",{attrs:{dataField:"reportgroup_name",caption:"Группа",groupIndex:0}})],1)],1),n("DxToolbar",{staticClass:"reports-popup__bottom-toolbar"},[n("DxToolbarItem",{attrs:{widget:"dxButton",location:"before",options:e.bottomToolbarButtons.select}}),n("DxToolbarItem",{attrs:{widget:"dxButton",location:"after",options:e.bottomToolbarButtons.close}})],1)],1):e._e()},Cs=[],xs=n("d158"),Os=n("d30a"),Is=n.n(Os),Ss={name:"GisReportList",components:{DxToolbar:xs["DxToolbar"],DxToolbarItem:xs["DxItem"],DxDataGrid:Os["DxDataGrid"],DxColumn:Os["DxColumn"],DxSearchPanel:Os["DxSearchPanel"]},data:function(){var e=this;return{reportData:{},dataSource:[],topToolbarButtons:{update:{icon:"refresh",type:"normal",onClick:function(){e.getDataSource()}}}}},props:{visible:Boolean,reportGroupId:Number},computed:{bottomToolbarButtons:function(){var e=this;return{select:{type:"success",text:"Выбрать",disabled:!Object.keys(this.reportData).length,onClick:function(){e.$emit("apply",e.reportData.iwidth,e.reportData.iheight,e.reportData.name,e.reportData.filename,e.reportData.id,e.reportData.is_xml),e.reportData={}}},close:{type:"danger",text:"Закрыть",onClick:function(){e.$emit("hidden"),e.reportData={}}}}}},watch:{visible:{handler:function(){this.visible&&this.getDataSource()},immediate:!0}},methods:{getDataSource:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={_config_dataset:"CONFIG.DSREPORT",reportgroup_id:this.reportGroupId},e.next=3,Object(X["c"])("getData",t);case 3:this.dataSource=e.sent;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onSelectionChanged:function(e){var t=e.selectedRowsData;this.reportData=t[0]},onContentReady:function(e){this.selectFirstDataRow(e.component)},selectFirstDataRow:function(e){var t=e.getSelectedRowKeys();if(!(t.length>0))for(var n=e.getVisibleRows(),i=0;i<n.length;++i)if("data"===n[i].rowType){e.selectRowsByIndexes(i);break}}}},Ls=Ss,Ds=(n("998b"),Object(le["a"])(Ls,_s,Cs,!1,null,null,null)),Ps=Ds.exports,Es=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-report-img-panel"},[n("div",{staticClass:"gis-report-img-panel__report-name"},[e._v(e._s(e.docName))]),n("div",{staticClass:"gis-report-img-panel__snapshots-title"},[e._v("Снимки для отчета")]),n("DxScrollView",{ref:"dxScroll",staticClass:"gis-report-img-panel__content"},[n("div",e._l(e.reportImageData,(function(t,i){return n("div",{key:i},[n("div",{ref:"snapshotTitle_"+i,refInFor:!0,staticClass:"gis-report-img-panel__snapshot-title"},[n("div",{staticClass:"gis-report-img-panel__snapshot-index"},[e._v(e._s(i+1)+".")]),n("div",{staticClass:"gis-report-img-panel__snapshot-name"},[e._v(e._s(t.name))])]),e.isWarning(i)?n("div",{attrs:{lass:"gis-report-img-panel__warning"}},[n("i",{staticClass:"fas fa-exclamation-triangle"}),n("div",{staticClass:"gis-report-img-panel__warning-text"},[e._v("\n            Данный функционал не доступен, обратитесь к администратору\n          ")])]):n("div",[t.src?n("img",{staticClass:"gis-report-img-panel__snapshot-img",class:{"snapshot-selected":e.selectedIndex===i},attrs:{src:t.src,title:"перейти к снимку"},on:{click:function(t){return e.changeSelectedSnapshot(i)}}}):n("div",{staticClass:"gis-report-img-panel__empty-img",class:{"snapshot-selected":e.selectedIndex===i},attrs:{title:"перейти к снимку"},on:{click:function(t){return e.changeSelectedSnapshot(i)}}},[n("i",{staticClass:"fas fa-camera"})])])])})),0)]),n("DxToolbar",{staticClass:"gis-report-img-panel__toolbar",scopedSlots:e._u([{key:"reportButtonTemplate",fn:function(){return[n("DxButton",{attrs:{type:"default",text:"Сформировать отчет",template:e.reportCreatingState?"loadIndicatorContent":"content"},on:{click:e.getReport},scopedSlots:e._u([{key:"loadIndicatorContent",fn:function(){return[n("div",[n("DxLoadIndicator",{staticClass:"gis-report-img-panel__load-indicator",attrs:{visible:!0}})],1)]},proxy:!0}])})]},proxy:!0},{key:"closeButtonTemplate",fn:function(){return[n("DxButton",{attrs:{type:"normal",text:"Закрыть"},on:{click:e.close}})]},proxy:!0}])},[n("DxToolbarItem",{attrs:{location:"center",template:"reportButtonTemplate"}}),n("DxToolbarItem",{attrs:{location:"center",template:"closeButtonTemplate"}})],1)],1)},ws=[];function Ts(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function js(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ts(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ts(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ks={name:"GisReportImgPanel",components:{DxScrollView:ie.a,DxToolbar:xs["DxToolbar"],DxToolbarItem:xs["DxItem"],DxButton:st.a,DxLoadIndicator:$e.a},props:{docName:{type:String,default:"Отчет"},reportImageData:{type:Array,default:function(){return[]}},selectedIndex:{type:Number,default:0},featureGuid:{type:String,default:""},gisComponentId:{type:String,default:""}},data:function(){return{snapshotClick:!1}},computed:js(js({},Object(d["c"])("config",{getGisOptions:Jt["z"]})),{},{reportCreatingState:function(){return this.getGisOptions(this.gisComponentId).reportCreatingState||!1}}),watch:{selectedIndex:function(e){var t=e;this.snapshotClick?this.snapshotClick=!1:t>0&&t--;var n=this.$refs["snapshotTitle_".concat(t)];n&&n[0]&&this.$refs.dxScroll.instance.scrollTo(n[0].offsetTop)}},methods:{snapshoTitleRef:function(e){return"snapshotTitle".concat(e)},isWarning:function(e){return"PAGE"===this.reportImageData[e].code&&!this.featureGuid},changeSelectedSnapshot:function(e){this.snapshotClick=!0,this.$emit("changeSelectedSnapshot",e)},getReport:function(){this.$emit("apply")},close:function(){this.$emit("hidden")}}},Fs=ks,Bs=(n("7ece"),Object(le["a"])(Fs,Es,ws,!1,null,null,null)),Ms=Bs.exports,As=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"gis-popup-add-layer",attrs:{animation:null,visible:e.visible,shading:!1,resizeEnabled:!0,title:"Снимки объекта",position:e.popupPosition,width:440,height:"auto",maxHeight:e.popupMaxHeight,minHeight:300,toolbarItems:e.toolbarItems,container:e.popupContainer},on:{shown:function(t){return e.$emit("shown")}},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:"Снимки объекта",showCloseButton:!1},on:{closeClick:function(t){return e.$emit("hidden")}}})]},proxy:!0},{key:"contentTemplate",fn:function(){return[n("GisSelectSnapshot",{ref:"gisSelectSnapshot",attrs:{featureGuid:e.featureGuid,snapshotDataSetName:e.snapshotDataSetName,visible:e.visible,popupContainer:e.popupContainer},on:{selectionChanged:e.getRowData}})]},proxy:!0}])})},Rs=[],Vs=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-select-snapshot"},[n("div",{staticClass:"gis-select-snapshot__top"},[n("DxFileUploader",e._b({ref:"dxFileUploaderComponent",staticClass:"gis-select-snapshot__file-uploader",on:{uploaded:e.onUploaded,valueChanged:e.onValueChanged}},"DxFileUploader",e.uploadOptions,!1))],1),n("div",{staticClass:"gis-select-snapshot__down"},[n("DxToolbar",{staticClass:"gis-select-snapshot__down-toolbar"},[n("DxToolbarItem",{attrs:{widget:"dxButton",location:"before",options:e.topToolbarButtons.update}})],1),n("DxDataGrid",{ref:"dxGridComponent",staticClass:"gis-select-snapshot__grid",attrs:{selection:{mode:"single"},showBorders:!1,dataSource:e.dataSource,"row-template":"SnapshotRowTemplate",height:"100%"},on:{selectionChanged:e.onSelectionChanged,deleteFileButtonClick:e.deleteImg},scopedSlots:e._u([{key:"SnapshotRowTemplate",fn:function(e){var t=e.data;return[n("SnapshotRowTemplate",{attrs:{options:t}})]}}])},[n("DxSearchPanel",{attrs:{visible:!0}}),n("DxColumn",{attrs:{dataField:"url",caption:"Снимок",width:"114"}}),n("DxColumn",{attrs:{dataField:"name",caption:"Название"}})],1)],1)])},Gs=[],$s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("tbody",{staticClass:"dx-row select-snapshot-row-template",class:{"dx-row-alt":e.options.rowIndex%2}},[n("tr",[n("td",{staticClass:"select-snapshot-row-template__img-cell"},[n("img",{staticClass:"select-snapshot-row-template__img",attrs:{src:e.url}})]),n("td",{staticClass:"select-snapshot-row-template__name-cell"},[n("span",[e._v(e._s(e.options.data.name))]),n("div",{staticClass:"select-snapshot-row-template__delete-button",on:{click:e.onDeleteFileButtonClick}},[e.loadIndicator?n("DxLoadIndicator",{staticClass:"gis-toolbar-button__load-indicator",attrs:{height:12,width:12,visible:!0}}):n("i",{staticClass:"fas fa-trash"})],1)])])])},Ns=[],Us=n("520c"),zs={name:"GisSelectSnapshotRowTemplate",components:{DxLoadIndicator:$e.a},props:{options:{type:Object,default:function(){return{}}}},data:function(){return{loadIndicator:!1}},computed:{url:function(){return this.options.data.url+"&_config_dataset=PAGES.DSPAGE"}},methods:{onDeleteFileButtonClick:function(){var e=this;this.loadIndicator=!0;var t=this.options.data||{};t.id?Object(Us["b"])("Удалить выбранное изображение?","Подтвердите удаление").then((function(n){n?e.$parent.$parent.$emit("deleteFileButtonClick",t.id):e.loadIndicator=!1})):this.loadIndicator=!1}}},Hs=zs,Ws=(n("d79c"),Object(le["a"])(Hs,$s,Ns,!1,null,"8840fd04",null)),Ks=Ws.exports,qs=n("81f7"),Js=n.n(qs),Zs="PAGES.DSPAGE",Ys={name:"GisSelectSnapshot",components:{DxToolbar:xs["DxToolbar"],DxToolbarItem:xs["DxItem"],DxDataGrid:Os["DxDataGrid"],DxColumn:Os["DxColumn"],DxSearchPanel:Os["DxSearchPanel"],SnapshotRowTemplate:Ks,DxFileUploader:Js.a},data:function(){var e=this;return{dxFileUploaderComponent:null,dxGridComponent:null,dataSource:[],selectedRowData:{},topToolbarButtons:{update:{icon:"refresh",type:"normal",onClick:function(){e.getDataSource()}}}}},props:{featureGuid:String,visible:Boolean,snapshotDataSetName:String},computed:{requestParams:function(){return{_config_dataset:"PAGES.DSPAGE"}},uploadOptions:function(){return{uploadUrl:"https://files-service.rusgis.com/uploadFile",accept:"*.*",multiple:!0,uploadMode:"useButtons",labelText:"или перетащите файл сюда"}}},mounted:function(){var e=this;this.dxGridComponent=this.$refs.dxGridComponent.instance,this.dxFileUploaderComponent=this.$refs.dxFileUploaderComponent,this.dxFileUploaderComponent.instance._uploadStrategy._createFormData=function(t,n){return e.createFormData(t,n)}},watch:{visible:{handler:function(){this.visible&&this.getDataSource()},immediate:!0}},methods:{getDataSource:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={_config_dataset:"PAGES.DSPAGE",guid_link:this.featureGuid},e.next=3,Object(X["c"])("getData",t);case 3:this.dataSource=e.sent,window.setTimeout((function(){n.selectFirstDataRow()}),500);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onSelectionChanged:function(e){var t=e.selectedRowsData;this.selectedRowData=t[0]||{},this.$emit("selectionChanged",this.selectedRowData)},selectFirstDataRow:function(){if(this.dxGridComponent){this.dxGridComponent.clearSelection();for(var e=this.dxGridComponent.getVisibleRows(),t=0;t<e.length;++t)if("data"===e[t].rowType){this.dxGridComponent.selectRowsByIndexes(t);break}}},createFormData:function(e,t){var n=this.$store.getters["session/userData"].userId,i=new FormData,o="",a="",s=t.name.lastIndexOf(".");-1!==s?(o=t.name.substring(0,s),a=t.name.substring(s+1)):(o=t.name,a="");var r={guid_link:this.featureGuid,_config_dataset:this.snapshotDataSetName||Zs,_config_user_id:n,name:o,extension:a};return i.append(e,t),i.append("userid",n),i.append("param",JSON.stringify(r)),i},onUploaded:function(){this.dxFileUploaderComponent.instance.reset(),this.getDataSource()},onValueChanged:function(){this.dxFileUploaderComponent.$el.querySelectorAll(".dx-fileuploader-upload-button").forEach((function(e){e.classList.contains("dx-button-has-icon")&&(e.style.display="none")}))},deleteImg:function(e){var t=this,n={id:e,_config_dataset:Zs};return Object(X["c"])("deleteData",n).then((function(){t.getDataSource()}))}}},Xs=Ys,Qs=(n("0c48"),Object(le["a"])(Xs,Vs,Gs,!1,null,null,null)),er=Qs.exports,tr={name:"GisPopupSelectSnapshot",components:{DxPopup:_e.a,GisSelectSnapshot:er,PopupTitleTemplate:Ce["a"]},props:{visible:Boolean,popupContainer:null,featureGuid:String,snapshotDataSetName:{type:String,default:""}},data:function(){var e=this;return{guid:"",toolbarItems:[{toolbar:"bottom",location:"center",widget:"dxButton",options:{text:"Выбрать",type:"success",onClick:function(){e.apply()}}},{toolbar:"bottom",location:"center",widget:"dxButton",options:{text:"Закрыть",onClick:function(){e.$emit("hidden")}}}],popupPosition:{at:"top",my:"top",offset:"0, 36"},layersOptions:null}},methods:{popupMaxHeight:function(){return.9*window.innerHeight},apply:function(){this.$emit("apply",this.guid)},getRowData:function(e){this.guid=e.guid}}},nr=tr,ir=(n("754d"),Object(le["a"])(nr,As,Rs,!1,null,null,null)),or=ir.exports,ar=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{attrs:{animation:null,visible:!0,shading:!1,resizeEnabled:!1,title:"Координаты объекта «"+e.featureName+"»",position:e.popupPosition,width:"auto",height:"auto",maxHeight:e.popupMaxHeight,minHeight:300,container:e.popupContainer},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:"Координаты объекта",showCloseButton:!0},on:{closeClick:e.close}})]},proxy:!0},{key:"contentTemplate",fn:function(){return[n("DxScrollView",[n("div",[e.contentVisible?n("div",{staticClass:"coords-editor__root"},[n("div",{staticClass:"coords-editor__toolbar"},[n("div",{staticClass:"coords-editor__toolbar-item"},[n("div",[e._v("Тип")]),n("DxSelectBox",{attrs:{disabled:!e.isNew,valueExpr:"value",displayExpr:"title",items:e.allowedGeometryTypes},on:{opened:e.selectBoxOpened,valueChanged:e.onGeometryTypeChange},model:{value:e.feature.geometry.type,callback:function(t){e.$set(e.feature.geometry,"type",t)},expression:"feature.geometry.type"}})],1),n("div",{staticClass:"coords-editor__toolbar-item"},[n("div",[e._v("Отображение")]),n("DxSelectBox",{attrs:{valueExpr:"value",displayExpr:"title",items:e.coordViewTypes},on:{opened:e.selectBoxOpened,valueChanged:e.onCoordViewTypeChange},model:{value:e.coordViewType,callback:function(t){e.coordViewType=t},expression:"coordViewType"}})],1)]),e._l(e.coordinates,(function(t,i){return n("GeometryComponent",{key:i,attrs:{index:i,type:e.feature.geometry.type,opened:e.states[i].opened,enableDelete:e.coordinates.length>1,coordViewType:e.coordViewType,coordinates:t},on:{toggle:function(t){return e.onGeometryToggle(i)},"delete-geometry":function(t){return e.onGeometryDelete(i)},"focus-point":function(t){return e.onFocusPoint(t)},change:e.onGeometryChange}})})),n("div",{staticClass:"coords-editor__icon-text",attrs:{title:"Добавить"+e.geometryTitleVin},on:{click:e.onAddGeometry}},[n("i",{staticClass:"core core-109-add"}),n("span",[e._v("Добавить "+e._s(e.geometryTitleVin))])])],2):e._e()])])]},proxy:!0}])})},sr=[],rr=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"coords-editor__block-header"},[n("div",{staticClass:"coords-editor__toggle-button"},[n("div",{staticClass:"coords-editor__icon",on:{click:function(t){return e.toogleGeometry()}}},[n("i",{staticClass:"core",class:e.opened?"core-116-arrow-down":"core-117-arrow-right"})]),n("div",{staticClass:"coords-editor__clickable",on:{click:function(t){return e.toogleGeometry()}}},[e._v("\n        "+e._s(e.geometryTitle)+"-"+e._s(e.index+1)+"\n      ")])]),n("button",{staticClass:"coords-editor__icon-button",attrs:{disabled:!e.enableDelete,title:"Удалить"+e.geometryTitleVin},on:{click:function(t){return e.$emit("delete-geometry")}}},[n("i",{staticClass:"core core-023-delete"})])]),e.opened?n("div",[e.hasContoures?n("div",[e._l(e.coordinates,(function(t,i){return n("div",{key:i,staticClass:"coords-editor__block-container"},[n("div",{staticClass:"coords-editor__block-header"},[n("div",{staticClass:"coords-editor__toggle-button"},[n("div",{staticClass:"coords-editor__icon",on:{click:function(t){return e.toogleContour(i)}}},[n("i",{staticClass:"core",class:e.opened?"core-116-arrow-down":"core-117-arrow-right"})]),n("div",{staticClass:"coords-editor__clickable",on:{click:function(t){return e.toogleContour(i)}}},[e._v("\n              Контур-"+e._s(i+1)+"\n            ")])]),n("button",{staticClass:"coords-editor__icon-button",attrs:{disabled:e.coordinates.length<=1,title:"Удалить контур"},on:{click:function(t){return e.deleteContour(i)}}},[n("i",{staticClass:"core core-023-delete"})])]),e.states[i].opened?n("PointsComponent",{staticClass:"coords-editor__block-container",attrs:{type:e.type,points:t,coordViewType:e.coordViewType},on:{change:e.onChange,"focus-point":function(t){return e.onFocusPoint(t)}}}):e._e()],1)})),n("div",{staticClass:"coords-editor__icon-text",staticStyle:{"margin-left":"20px"},attrs:{title:"Добавить контур"},on:{click:e.onAddContour}},[n("i",{staticClass:"core core-109-add"}),n("span",[e._v("Добавить контур")])])],2):e._e(),e.hasContoures?e._e():n("div",[n("PointsComponent",{staticClass:"coords-editor__block-container",attrs:{type:e.type,points:e.coordinates,coordViewType:e.coordViewType},on:{change:e.onChange,"focus-point":function(t){return e.onFocusPoint(t)}}})],1)]):e._e()])},lr=[],cr=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"coords-editor__title-row"},[e._m(0),e.isPoint?e._e():n("button",{staticClass:"coords-editor__icon-button",staticStyle:{visibility:"hidden"}},[n("i",{staticClass:"core core-023-delete"})])]),e._l(e.pointsView,(function(t,i){return n("div",{key:i},[n("PointComponent",{key:t[0],attrs:{type:e.type,coordViewType:e.coordViewType,deleteEnabled:e.deletePointsEnabled,point:t},on:{"focus-in":function(n){return e.onFocus(t)},"focus-out":function(t){return e.onFocus(null)},delete:function(t){return e.deletePoint(i)},change:function(t){return e.onChangePoint(t,i)}}})],1)})),e.isPoint?e._e():n("div",{staticClass:"coords-editor__icon-text",attrs:{title:"Добавить точку"},on:{click:function(t){return e.onAddPoint()}}},[n("i",{staticClass:"core core-109-add"}),n("span",[e._v("Добавить точку")])])],2)},dr=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"coords-editor__coord-title-pair"},[n("div",{staticClass:"coords-editor__coord-title"},[e._v("Долгота")]),n("div",{staticClass:"coords-editor__coord-title"},[e._v("Широта")])])}],ur="degree-decimal",pr="degree-min-sec",fr="epsg3857",hr={type:"geojson",enable:!0,visible:!0,sourceOptions:{tolerance:.001},showInsertCard:!1,excludeSelectedFeatures:!0,selectionMapboxLayers:[]},mr={componentId:"coordinatesEditorTmpLayer",componentType:"GisLayer",historyLength:0,options:hr},gr=[{type:"circle",paint:{"circle-color":"#fbb03b","circle-radius":6,"circle-opacity":1,"circle-stroke-color":"#fff","circle-stroke-width":2,"circle-stroke-opacity":1},maxzoom:24,minzoom:0}],yr=[{value:"Point",title:"Точка"},{value:"MultiPoint",title:"Мультиточка"},{value:"LineString",title:"Линия"},{value:"MultiLineString",title:"Мультилиния"},{value:"Polygon",title:"Полигон"},{value:"MultiPolygon",title:"Мультиполигон"}],vr=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"coords-editor__point-row"},[e.coordViewType!==e.$options.VIEW_DEGREE_MINSEC?[n("DxNumberBox",e._b({attrs:{value:e.x},on:{change:function(t){return e.onChangePointXY(t,0)},focusIn:e.onFocus,focusOut:e.onFocusOut}},"DxNumberBox",e.coordViewType===e.$options.VIEW_EPSG3857?e.inputOptions:e.inputOptionsLng,!1)),n("DxNumberBox",e._b({attrs:{value:e.y},on:{change:function(t){return e.onChangePointXY(t,1)},focusIn:e.onFocus,focusOut:e.onFocusOut}},"DxNumberBox",e.coordViewType===e.$options.VIEW_EPSG3857?e.inputOptions:e.inputOptionsLat,!1))]:e._e(),e.coordViewType===e.$options.VIEW_DEGREE_MINSEC?[n("DxNumberBox",e._b({attrs:{value:e.getDegrees(e.point[0])},on:{change:function(t){return e.onChangePointDegrees(t,0)},focusIn:e.onFocus,focusOut:e.onFocusOut}},"DxNumberBox",e.inputOptionsDegreeLng,!1)),e._v("\n    °\n    "),n("DxNumberBox",e._b({attrs:{value:e.getMinutes(e.point[0])},on:{change:function(t){return e.onChangePointMinutes(t,0)},focusIn:e.onFocus,focusOut:e.onFocusOut}},"DxNumberBox",e.inputOptionsMin,!1)),e._v("\n    '\n    "),n("DxNumberBox",e._b({attrs:{value:e.getSeconds(e.point[0])},on:{change:function(t){return e.onChangePointSeconds(t,0)},focusIn:e.onFocus,focusOut:e.onFocusOut}},"DxNumberBox",e.inputOptionsSec,!1)),e._v("\n    ''\n    "),n("DxNumberBox",e._b({attrs:{value:e.getDegrees(e.point[1])},on:{change:function(t){return e.onChangePointDegrees(t,1)},focusIn:e.onFocus,focusOut:e.onFocusOut}},"DxNumberBox",e.inputOptionsDegreeLat,!1)),e._v("\n    °\n    "),n("DxNumberBox",e._b({attrs:{value:e.getMinutes(e.point[1])},on:{change:function(t){return e.onChangePointMinutes(t,1)},focusIn:e.onFocus,focusOut:e.onFocusOut}},"DxNumberBox",e.inputOptionsMin,!1)),e._v("\n    '\n    "),n("DxNumberBox",e._b({attrs:{value:e.getSeconds(e.point[1])},on:{change:function(t){return e.onChangePointSeconds(t,1)},focusIn:e.onFocus,focusOut:e.onFocusOut}},"DxNumberBox",e.inputOptionsSec,!1)),e._v("\n    ''\n  ")]:e._e(),e.isPoint?e._e():n("button",{staticClass:"coords-editor__icon-button",attrs:{disabled:!e.deleteEnabled,title:"Удалить точку"},on:{click:e.onDelete}},[n("i",{staticClass:"core core-023-delete"})])],2)},br=[],_r={name:"PointComponent",VIEW_DEGREE_DECIMAL:ur,VIEW_DEGREE_MINSEC:pr,VIEW_EPSG3857:fr,components:{DxNumberBox:pt.a},props:{point:Array,type:String,coordViewType:String,deleteEnabled:Boolean},data:function(){return{inputOptions:{width:"100px",format:"#0",min:Number.MIN_VALUE,max:Number.MAX_VALUE},inputOptionsLat:{width:"100px",format:"#0.########",min:-90,max:90},inputOptionsLng:{width:"100px",format:"#0.########",min:-180,max:180},inputOptionsDegreeLat:{width:"30px",format:"##0",min:-90,max:90},inputOptionsDegreeLng:{width:"30px",format:"##0",min:-180,max:180},inputOptionsMin:{width:"30px",format:"##0",min:-59,max:59},inputOptionsSec:{width:"40px",format:"#0.##",min:-59.99,max:59.99}}},computed:{isPoint:function(){return["Point","MultiPoint"].includes(this.type)},x:function(){return this.point[0]},y:function(){return this.point[1]}},methods:{onFocus:function(){this.$emit("focus-in")},onFocusOut:function(){this.$emit("focus-out")},getPointX:function(e){if(this.coordViewType===fr){var t=this.lngLatToMeters(e);return t[0]}return e[0]},getPointY:function(e){if(this.coordViewType===fr){var t=this.lngLatToMeters(e);return t[1]}return e[1]},getDegrees:function(e){return Math.floor(e)},getMinutes:function(e){return Math.floor(60*(e-this.getDegrees(e)))},getSeconds:function(e){return 3600*(e-this.getDegrees(e)-this.getMinutes(e)/60)},onDelete:function(){this.$emit("delete")},onChangePointDegrees:function(e,t){var n=this.parseValue(e),i=this.point[t];this.point[t]=n+(i-Math.floor(i)),this.onChangePoint()},onChangePointMinutes:function(e,t){var n=this.parseValue(e),i=this.point[t];this.point[t]=this.getDegrees(i)+n/60+this.getSeconds(i)/3600,this.onChangePoint()},onChangePointSeconds:function(e,t){var n=this.parseValue(e),i=this.point[t];this.point[t]=this.getDegrees(i)+this.getMinutes(i)/60+n/3600,this.onChangePoint()},onChangePointXY:function(e,t){var n=this.parseValue(e);if(this.coordViewType===fr){var i=this.lngLatToMeters(this.point);i[t]=n,this.point[t]=this.metersToLngLat(i)[t]}else this.point[t]=n;this.onChangePoint()},onChangePoint:function(){this.$emit("change",this.point)},parseValue:function(e){var t=parseFloat(e.event.target.value.replace(",","."));return isNaN(t)&&(t=0),t},lngLatToMeters:function(e){return c["toMercator"](e)},metersToLngLat:function(e){return c["toWgs84"](e)}}},Cr=_r,xr=(n("b4a2"),Object(le["a"])(Cr,vr,br,!1,null,null,null)),Or=xr.exports,Ir={name:"PointsComponent",VIEW_DEGREE_DECIMAL:ur,VIEW_DEGREE_MINSEC:pr,VIEW_EPSG3857:fr,components:{PointComponent:Or},props:{type:String,points:Array,coordViewType:String},data:function(){return{}},computed:{pointsView:function(){var e=this;switch(this.type){case"Polygon":case"MultiPolygon":return this.points.filter((function(t,n){return n!==e.points.length-1}));default:return this.points}},deletePointsEnabled:function(){return this.getValidLengthValue(this.points)>0},isPoint:function(){return["Point","MultiPoint"].includes(this.type)}},methods:{onFocus:function(e){window.console.log(e?e[0]:"null"),this.$emit("focus-point",e)},onAddPoint:function(){["Polygon","MultiPolygon"].includes(this.type)?this.points.splice(this.points.length-1,0,[0,0]):this.points.push([0,0]),this.onChange()},deletePoint:function(e){this.points.splice(e,1),this.onChange()},getValidLengthValue:function(){switch(this.type){case"Polygon":case"MultiPolygon":return this.points.length-4;case"LineString":case"MultiLineString":return this.points.length-2;default:return this.points.length-1}},onChangePoint:function(e,t){0!==t||"Polygon"!==this.type&&"MultiPolygon"!==this.type||(this.points[this.points.length-1][0]=e[0],this.points[this.points.length-1][1]=e[1]),this.onChange(),this.onFocus(e)},onChange:function(){this.$emit("change")}}},Sr=Ir,Lr=(n("eee4"),Object(le["a"])(Sr,cr,dr,!1,null,null,null)),Dr=Lr.exports,Pr={name:"GeometryComponent",components:{PointsComponent:Dr},props:{type:String,coordinates:Array,opened:Boolean,index:Number,enableDelete:Boolean,coordViewType:String},data:function(){return{states:[]}},computed:{hasContoures:function(){return["Polygon","MultiPolygon"].includes(this.type)},geometryTitle:function(){switch(this.type){case"Polygon":case"MultiPolygon":return"Полигон";case"LineString":case"MultiLineString":return"Линия";default:return"Точка"}},geometryTitleVin:function(){switch(this.type){case"Polygon":case"MultiPolygon":return"полигон";case"LineString":case"MultiLineString":return"линию";default:return"точку"}}},created:function(){this.states=this.coordinates.map((function(e,t){return{opened:0===t}}))},methods:{onFocusPoint:function(e){this.$emit("focus-point",e)},onAddContour:function(){this.states.push({opened:!0}),this.coordinates.push([[0,0],[0,0]]),this.onChange()},deleteContour:function(e){this.coordinates.splice(e,1),this.states.splice(e,1),this.onChange()},toogleGeometry:function(){this.$emit("toggle")},toogleContour:function(e){this.states[e].opened=!this.states[e].opened},onChange:function(){this.$emit("change")}}},Er=Pr,wr=(n("eb5c"),Object(le["a"])(Er,rr,lr,!1,null,null,null)),Tr=wr.exports;function jr(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=kr(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function kr(e,t){if(e){if("string"===typeof e)return Fr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Fr(e,t):void 0}}function Fr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Br(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Mr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Br(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Br(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ar={name:"GisCoordinatesEditor",geojsonLayer:null,components:{DxPopup:_e.a,DxScrollView:ie.a,DxSelectBox:nt.a,PopupTitleTemplate:Ce["a"],GeometryComponent:Tr},props:{editFeature:Object,gisModule:Object,geometryTypes:Array,popupContainer:HTMLElement},data:function(){return{contentVisible:!0,feature:null,popupPosition:{at:"right top",my:"right top",offset:"-50, 100"},popupMaxHeight:function(){return.7*window.innerHeight},isNew:!1,states:[],coordViewTypes:[{value:ur,title:"Десятичные градусы"},{value:pr,title:"Градусы-минуты-секунды"},{value:fr,title:"EPSG:3857 (метры)"}],coordViewType:ur}},computed:{allowedGeometryTypes:function(){var e=this;return yr.filter((function(t){return!e.geometryTypes||e.geometryTypes.some((function(e){return t.value.includes(e)}))}))},featureName:function(){return this.feature&&this.feature.id?this.feature.id:""},isGeometryMultiple:function(){return["MultiPolygon","MultiStringLine"].includes(this.feature.geometry.type)},coordinates:function(){if(!this.feature)return[];var e=this.feature.geometry.coordinates;switch(this.feature.geometry.type){case"Polygon":case"LineString":return[e];case"Point":return[[e]];case"MultiPoint":return e.map((function(e){return[e]}));default:return e}},geometryTitleVin:function(){switch(this.feature.geometry.type){case"Polygon":case"MultiPolygon":return"полигон";case"LineString":case"MultiLineString":return"линию";default:return"точку"}}},created:function(){this.setFeature(),this.createLayer()},beforeDestroy:function(){this.deleteNoParentLayerComponent({gisComponentId:this.gisModule.componentId,layerComponentId:mr.componentId})},methods:Mr(Mr(Mr({},Object(d["d"])("config",{setLayerFeatures:gn["v"]})),Object(d["b"])("config",{addNoParentLayerComponent:Xa["a"],deleteNoParentLayerComponent:Xa["e"]})),{},{onFocusPoint:function(e){var t=[];e&&(t=[{type:"Feature",id:"1",properties:{id:"1"},geometry:{type:"Point",coordinates:e}}]),this.setLayerFeatures({layerComponentId:mr.componentId,features:t})},createLayer:function(){var e=gr;mr.options.mapboxLayers=e;var t=Mr({id:mr.componentId,layerComponentId:mr.componentId,specialSortLayer:"legendSpecialSortLayer"},mr);this.addNoParentLayerComponent({gisComponentId:this.gisModule.componentId,layerConfig:t})},refresh:function(){var e=this;this.contentVisible=!1,setTimeout((function(){e.setFeature(),e.contentVisible=!0}),100)},setFeature:function(){if(this.isNew=!(this.editFeature&&this.editFeature.geometry),this.isNew){var e=(new u["a"]).toString();this.feature={type:"Feature",id:e,properties:{id:e},geometry:{type:"Point",coordinates:[0,0]}}}else this.feature=this.editFeature;this.states=this.coordinates.map((function(e,t){return{opened:0===t}}))},onAddGeometry:function(){switch(this.feature.geometry.type){case"Polygon":this.feature.geometry.coordinates=[this.feature.geometry.coordinates],this.feature.geometry.type="MultiPolygon";case"MultiPolygon":this.coordinates.push([[[0,0],[0,0]]]);break;case"LineString":this.feature.geometry.coordinates=[this.feature.geometry.coordinates],this.feature.geometry.type="MultiLineString";case"MultiLineString":this.coordinates.push([[0,0]]);break;case"Point":this.feature.geometry.coordinates=[this.feature.geometry.coordinates],this.feature.geometry.type="MultiPoint";case"MultiPoint":this.feature.geometry.coordinates.push([0,0]);break}this.states.push({opened:!0}),this.onGeometryChange()},onGeometryDelete:function(e){this.feature.geometry.coordinates.splice(e,1),this.states.splice(e,1),this.onGeometryChange()},onGeometryToggle:function(e){this.states[e].opened=!this.states[e].opened},onGeometryChange:function(){this.isGeometryValid()&&(this.$emit("change",{feature:this.feature,isNew:this.isNew}),this.isNew=!1)},onGeometryTypeChange:function(e){if(e.event){var t;switch(this.feature.geometry.type){case"Polygon":t=[[[0,0],[0,0]]];break;case"MultiPolygon":t=[[[[0,0],[0,0]]]];break;case"LineString":t=[[0,0]];break;case"MultiLineString":t=[[[0,0]]];break;case"Point":t=[0,0];break;case"MultiPoint":t=[[0,0]];break}this.feature.geometry={type:this.feature.geometry.type,coordinates:t}}},onCoordViewTypeChange:function(){var e=[];Object(Mt["a"])(this.feature.geometry.coordinates,e),this.feature.geometry.coordinates=e},convertParts:function(e,t){var n=this;e.forEach((function(e,i,o){Array.isArray(e[0])?n.convertParts(e,t):o[i]=t===fr?n.lngLatToMeters(e):n.metersToLngLat(e)}))},close:function(){this.$emit("close")},isGeometryValid:function(){var e,t=this.feature.geometry.type,n=!!this.coordinates[0],i=jr(this.coordinates);try{for(i.s();!(e=i.n()).done;){var o=e.value;if(["Polygon","MultiPolygon"].includes(t)){var a,s=jr(o);try{for(s.s();!(a=s.n()).done;){var r=a.value;n=n&&r.length>3}}catch(l){s.e(l)}finally{s.f()}}else["LineString","MultiLineString"].includes(t)&&(n=n&&o.length>1)}}catch(l){i.e(l)}finally{i.f()}return n=n&&this.isPointValid(this.coordinates),n},isPointValid:function(e){var t=this;return e.every((function(e){return Array.isArray(e)?t.isPointValid(e):0!=e}))},selectBoxOpened:function(e){var t=e.component;t._popup.option("container",this.popupContainer)}})},Rr=Ar,Vr=(n("ee23"),Object(le["a"])(Rr,ar,sr,!1,null,null,null)),Gr=Vr.exports;function $r(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Nr(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function Nr(e,t){if(e){if("string"===typeof e)return Ur(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ur(e,t):void 0}}function Ur(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function zr(e,t,n,i){return t.forEach((function(t){switch(t.type){case"Feature":i=Wr(e,t,n,i);break;case"FeatureCollection":var o,a=$r(t.features);try{for(a.s();!(o=a.n()).done;){var s=o.value;i=zr(e,s,n,i)}}catch(r){a.e(r)}finally{a.f()}break}})),i}function Hr(e,t,n,i){return t.forEach((function(t){switch(t.type){case"Feature":i=qr(e,t,n,i);break;case"FeatureCollection":var o,a=$r(t.features);try{for(a.s();!(o=a.n()).done;){var s=o.value;i=Hr(e,s,n,i)}}catch(r){a.e(r)}finally{a.f()}break}})),i}function Wr(e,t,n,i){var o=t.geometry,a=o.type,s=o.coordinates;switch(a){case"Point":i=Zr(e,s,n,i);break;case"MultiPoint":case"LineString":i=Kr(e,s,n,i);break;case"MultiLineString":case"Polygon":var r,l=$r(s);try{for(l.s();!(r=l.n()).done;){var c=r.value;i=Kr(e,c,n,i)}}catch(g){l.e(g)}finally{l.f()}break;case"MultiPolygon":var d,u=$r(s);try{for(u.s();!(d=u.n()).done;){var p,f=d.value,h=$r(f);try{for(h.s();!(p=h.n()).done;){var m=p.value;i=Kr(e,m,n,i)}}catch(g){h.e(g)}finally{h.f()}}}catch(g){u.e(g)}finally{u.f()}break}return i}function Kr(e,t,n,i){var o,a=$r(t);try{for(a.s();!(o=a.n()).done;){var s=o.value;i=Zr(e,s,n,i)}}catch(r){a.e(r)}finally{a.f()}return i}function qr(e,t,n,i){var o=t.geometry,a=o.type,s=o.coordinates;switch(a){case"LineString":i=Jr(e,s,n,i);break;case"MultiLineString":case"Polygon":var r,l=$r(s);try{for(l.s();!(r=l.n()).done;){var c=r.value;i=Jr(e,c,n,i)}}catch(g){l.e(g)}finally{l.f()}break;case"MultiPolygon":var d,u=$r(s);try{for(u.s();!(d=u.n()).done;){var p,f=d.value,h=$r(f);try{for(h.s();!(p=h.n()).done;){var m=p.value;i=Jr(e,m,n,i)}}catch(g){h.e(g)}finally{h.f()}}}catch(g){u.e(g)}finally{u.f()}break}return i}function Jr(e,t,n,i){for(var o=0;o<t.length-1;++o)i=Yr(e,t[o],t[o+1],n,i);return i}function Zr(e,t,n,i){if(!t)return i;if(e.lat===t[1]&&e.lng===t[0])return i;var o=n.project(e),a=n.project(t),s=Qr(o,a);return Xr(s,i,t)}function Yr(e,t,n,i,o){if(!t||!n)return o;var a=i.project(e),s=i.project(t),r=i.project(n),l=el(a,s,r),c=tl(a,s,r),d=Object.values(i.unproject(c));return Xr(l,o,d,t,n)}function Xr(e,t,n,i,o){return null===t?t={distance:e,lngLat:n,prevCoordinate:i,nextCoordinate:o}:e<t.distance&&(t.distance=e,t.lngLat=n,t.prevCoordinate=i,t.nextCoordinate=o),t}function Qr(e,t){var n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}function el(e,t,n){return Math.sqrt(nl(e,t,n,!0))}function tl(e,t,n){return nl(e,t,n)}function nl(e,t,n,i){var o,a=t.x,s=t.y,r=n.x-a,l=n.y-s,c=r*r+l*l;return c>0&&(o=((e.x-a)*r+(e.y-s)*l)/c,o>1?(a=n.x,s=n.y):o>0&&(a+=r*o,s+=l*o)),r=e.x-a,l=e.y-s,i?r*r+l*l:{x:a,y:s}}function il(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ol(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?il(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):il(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var al={computed:ol({},Object(d["c"])("config",{getLayerOptions:Yt["E"]})),methods:{moveMapToLayer:function(e){var t=!1,n=this.getLayerOptions(e);return n.bounds?(this.mapbox.fitBounds(n.bounds,{animate:!1,padding:50}),t=!0):["geojson","wfs"].includes(n.layerType)&&(this.moveMapToGeoJson(),t=!0),t},moveMapToGeoJson:function(){var e=c["bbox"]({type:"FeatureCollection",features:this.geojsonData.features.filter((function(e){return e.geometry}))});this.mapbox.fitBounds(e,{animate:!1,padding:50})}}},sl=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-space-imagery-panel"},[e.dataLoading?n("DxLoadPanel",{attrs:{container:e.loadPanelContainer,visible:!0}},[n("DxPosition",{attrs:{of:e.loadPanelContainer}})],1):e._e(),n("div",{staticClass:"gis-space-imagery-panel__title"},[e._v("\n    Поиск снимков\n  ")]),n("GisSpaceImagerySearch",{staticClass:"gis-space-imagery-panel__search",attrs:{activeMouseTool:e.$attrs.activeMouseTool,sourceimage_id:e.sourceimage_id,selectedSatellites:e.selectedSatellites,bdate:e.bdate,edate:e.edate,cloud_cover:e.cloud_cover,imagerySources:e.imagerySources,satellites:e.satellites,popupContainer:e.popupContainer},on:{buttonActiveStateChanged:e.$listeners.buttonActiveStateChanged,fieldChanged:e.handleFieldChanged,clearResultClick:e.clearResultClick}}),n("GisSpaceImageryList",{staticClass:"gis-space-imagery-panel__list",attrs:{items:e.listItems,planetApiKey:e.planetApiKey},on:{hoveredItemChanged:e.$listeners.hoveredItemChanged,itemVisibleClick:e.$listeners.itemVisibleClick,itemMouseOver:e.$listeners.itemMouseOver,itemMouseOut:e.$listeners.itemMouseOut}})],1)},rl=[],ll=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-space-imagery-search"},[n("DxSelectBox",{attrs:{placeholder:"Источник...",value:e.sourceimage_id,dataSource:e.imagerySources,valueExpr:"id",displayExpr:"name"},on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.fieldChanged("sourceimage_id",t.value)}}}),n("DxTagBox",{staticClass:"gis-space-imagery-search__satellite",attrs:{placeholder:"Спутники...",value:e.selectedSatellites,dataSource:e.satellites,displayExpr:"name",showSelectionControls:!0},on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.fieldChanged("selectedSatellites",t.value)}}}),n("div",{staticClass:"gis-space-imagery-search__date-interval"},[n("DxDateBox",{staticClass:"gis-space-imagery-search__date-start",attrs:{placeholder:"Дата от",value:e.bdate},on:{valueChanged:function(t){return e.fieldChanged("bdate",t.value)}}}),n("DxDateBox",{staticClass:"gis-space-imagery-search__date-end",attrs:{placeholder:"Дата до",value:e.edate},on:{valueChanged:function(t){return e.fieldChanged("edate",t.value)}}})],1),n("div",{staticClass:"gis-space-imagery-search__cloud-cover"},[n("div",{staticClass:"gis-space-imagery-search__cloud-cover-label"},[e._v("\n      Облачность\n    ")]),n("DxSlider",{staticClass:"gis-space-imagery-search__cloud-cover-value",attrs:{min:0,max:1,step:.1,value:e.cloud_cover,label:e.cloudCoverLabel,tooltip:e.cloudCoverTooltip},on:{valueChanged:function(t){return e.fieldChanged("cloud_cover",t.value)}}})],1),n("div",{staticClass:"gis-space-imagery-search__aoi"},[n("div",{staticClass:"gis-space-imagery-search__aoi-label"},[e._v("\n      Территория\n    ")]),n("div",{staticClass:"gis-space-imagery-search__aoi-toolbar"},[n("GisToolbarButtonGroup",[n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.RECTANGLE_AOI,iconCss:"core core-005-search-by-poly-1",text:"Поиск снимков прямоугольной областью"},on:{click:function(t){return e.setActiveMouseTool(e.$options.RECTANGLE_AOI)}}}),n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.POLYGON_AOI,iconCss:"core core-007-search-by-poly-3",text:"Поиск снимков полигоном"},on:{click:function(t){return e.setActiveMouseTool(e.$options.POLYGON_AOI)}}}),n("GisToolbarButton",{attrs:{active:e.activeMouseTool===e.$options.CIRCLE_AOI,iconCss:"core core-009-search-by-circle-1",text:"Поиск снимков окружностью"},on:{click:function(t){return e.setActiveMouseTool(e.$options.CIRCLE_AOI)}}})],1),n("GisToolbarButtonGroup",[n("GisToolbarButton",{attrs:{active:!1,iconCss:"core core-057-close",text:"Очистить результаты поиска"},on:{click:e.clearResultClick}})],1)],1)])],1)},cl=[],dl=n("e96d"),ul=n.n(dl),pl=n("a013"),fl=n.n(pl),hl=n("c0c5"),ml=n.n(hl),gl="rectangleAoi",yl="circleAoi",vl="polygonAoi",bl={name:"GisSpaceImagerySearch",mixins:[yt["a"]],components:{DxDateBox:ul.a,DxSelectBox:nt.a,DxSlider:fl.a,DxTagBox:ml.a,GisToolbarButton:Be["a"],GisToolbarButtonGroup:Fe["a"]},RECTANGLE_AOI:gl,CIRCLE_AOI:yl,POLYGON_AOI:vl,props:{imagerySources:Array,satellites:Array,sourceimage_id:Number,selectedSatellites:Array,bdate:Date,edate:Date,cloud_cover:Number,activeMouseTool:String},data:function(){return{cloudCoverLabel:{visible:!0,format:function(e){return 100*e+"%"},position:"top"},cloudCoverTooltip:{enabled:!0,format:function(e){return 100*e+"%"},showMode:"onHover",position:"top"}}},methods:{setActiveMouseTool:function(e){this.$emit("buttonActiveStateChanged",{buttonName:e})},fieldChanged:function(e,t){this.$emit("fieldChanged",{fieldName:e,fieldValue:t})},clearResultClick:function(){this.$emit("clearResultClick")}}},_l=bl,Cl=(n("6acc"),Object(le["a"])(_l,ll,cl,!1,null,null,null)),xl=Cl.exports,Ol=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxDataGrid",{staticClass:"gis-space-imagery-list",attrs:{dataSource:e.items,showColumnHeaders:!1},scopedSlots:e._u([{key:"rowTemplate",fn:function(t){var i=t.data;return[n("tbody",[n("tr",[n("td",{staticStyle:{width:"100%"}},[n("GisSpaceImageryListItem",e._b({attrs:{planetApiKey:e.planetApiKey},on:{visibleClick:e.itemVisibleClick},nativeOn:{mouseover:function(t){return e.itemMouseOver(i.data)},mouseout:function(t){return e.itemMouseOut(i.data)}}},"GisSpaceImageryListItem",i.data,!1))],1)])])]}}])},[n("DxColumn",{attrs:{dataField:"id"}}),n("DxSummary",[n("DxTotalItem",{attrs:{column:"id","summary-type":"count"}})],1)],1)},Il=[],Sl=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.cssClass},[n("img",{staticClass:"gis-space-imagery-list-item__thumb",attrs:{src:e.thumbnail}}),n("div",{staticClass:"gis-space-imagery-list-item__fields"},[n("div",{staticClass:"gis-space-imagery-list-item__field"},[n("div",{staticClass:"gis-space-imagery-list-item__field-label"},[e._v("\n        Источник\n      ")]),n("div",{staticClass:"gis-space-imagery-list-item__field-value"},[e._v("\n        "+e._s(e.item_type)+"\n      ")])]),n("div",{staticClass:"gis-space-imagery-list-item__field"},[n("div",{staticClass:"gis-space-imagery-list-item__field-label"},[e._v("\n        Дата\n      ")]),n("div",{staticClass:"gis-space-imagery-list-item__field-value"},[e._v("\n        "+e._s(e.acquired.toLocaleDateString())+" "+e._s(e.acquired.toLocaleTimeString([],{timeStyle:"short"}))+"\n      ")])]),n("div",{staticClass:"gis-space-imagery-list-item__field"},[n("div",{staticClass:"gis-space-imagery-list-item__field-label"},[e._v("\n        Облачность\n      ")]),n("div",{staticClass:"gis-space-imagery-list-item__field-value"},[e._v("\n        "+e._s(Math.round(100*e.cloud_cover))+"%\n      ")])])]),n("div",{staticClass:"gis-space-imagery-list-item__buttons"},[n("div",{staticClass:"gis-space-imagery-list-item__visible-button",class:{"gis-space-imagery-list-item__visible-button_active":e.visible},attrs:{title:e.visible?"Скрыть снимок":"Показать снимок"},on:{mouseover:function(e){e.stopPropagation()},mouseout:function(e){e.stopPropagation()},click:e.visibleClick}},[n("i",{class:e.visibleButtonIconCssClass})]),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.downloading,expression:"!downloading"}],staticClass:"gis-space-imagery-list-item__download-button",class:{"gis-space-imagery-list-item__visible-button_active":e.visible},attrs:{title:e.downloaded?"Загрузка завершена":"Загрузить снимок"},on:{mouseover:function(e){e.stopPropagation()},mouseout:function(e){e.stopPropagation()},click:e.downloadClick}},[n("i",{class:e.downloadButtonIconCssClass})]),e.downloading?n("div",{staticClass:"gis-space-imagery-list-item__status-percent",attrs:{title:"Процент завершения"}},[e._v("\n      "+e._s(e.status_percent)+"%\n    ")]):e._e()])])},Ll=[],Dl={props:{id:String,thumbnail:String,item_type:String,acquired:Date,cloud_cover:Number,hover:Boolean,visible:Boolean,planetApiKey:String,bbox:Array},data:function(){return{downloaded:!1,downloading:!1,status_percent:0}},computed:{cssClass:function(){return{"gis-space-imagery-list-item":!0,"gis-space-imagery-list-item_hover":this.hover}},visibleButtonIconCssClass:function(){return this.visible?"core core-082-visible":"core core-081-no-visible"},downloadButtonIconCssClass:function(){return this.downloaded?"fas fa-check":"fas fa-download"}},mounted:function(){this.loadStatus()},methods:{visibleClick:function(){this.$emit("visibleClick",{itemId:this.id,itemType:this.item_type})},downloadClick:function(){var e=this;this.downloaded||this.jsonRPC("add_task_to_queue",[{id:this.id,item_type:this.item_type,api_key:this.planetApiKey,bbox:this.bbox}]).then((function(){e.loadStatus()}))},loadStatus:function(){var e=this;return this.jsonRPC("get_status_task",[this.id]).then((function(t){e.statusLoaded(t)}))},jsonRPC:function(e,t){var n=Object({NODE_ENV:"production",VUE_APP_API_FILES_SERVICE:"https://files-service.rusgis.com/apiFiles",VUE_APP_API_SERVICE:"https://api.rusgis.com/api",VUE_APP_DATASET_SERVICE:"https://ds.rusgis.com/dataset",VUE_APP_DOWNLOAD_FILE_SERVICE:"https://files-service.rusgis.com/downloadFile",VUE_APP_GET_PORTRAIT_IMAGE_SERVICE:"https://files-service.rusgis.com/getPortraitImage",VUE_APP_INNER_TILE_SERVICES:"/tms,http://89.108.84.38:8101/tms,https://composite.rusgis.com",VUE_APP_JS_API:"true",VUE_APP_PROXY_SERVICE:"https://proxy.rusgis.com/proxy",VUE_APP_SHOW_DESIGNER_SERVICE:"https://reports.rusgis.com/showDesigner",VUE_APP_SHOW_REPORT_SERVICE:"https://reports.rusgis.com/showReport",VUE_APP_UPLOAD_FILE_SERVICE:"https://files-service.rusgis.com/uploadFile",VUE_APP_USER_ID:"500322",BASE_URL:"/"}).VUE_APP_SPACE_IMAGERY_URL;return fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",method:e,params:t,id:1})}).then((function(e){return e.ok||window.console.error(e),e.json()})).then((function(e){return e.result}))},statusLoaded:function(e){var t=this;if(Array.isArray(e)&&0===e.length)return this.downloaded=!1,void(this.downloading=!1);e.hasOwnProperty("status_bool")&&(this.downloaded=e.status_bool,this.downloading=!e.status_bool,this.status_percent=e.status_percent,e.status_bool||setTimeout((function(){t.loadStatus()}),15e3))}}},Pl=Dl,El=(n("e768"),Object(le["a"])(Pl,Sl,Ll,!1,null,null,null)),wl=El.exports,Tl={components:{DxDataGrid:Is.a,DxColumn:Os["DxColumn"],DxSummary:Os["DxSummary"],DxTotalItem:Os["DxTotalItem"],GisSpaceImageryListItem:wl},props:{items:Array,planetApiKey:String},methods:{itemMouseOver:function(e){var t=e.id,n=e.index;this.$emit("itemMouseOver",{itemId:t,itemIndex:n})},itemMouseOut:function(e){var t=e.id,n=e.index;this.$emit("itemMouseOut",{itemId:t,itemIndex:n})},itemVisibleClick:function(e){this.$emit("itemVisibleClick",e)}}},jl=Tl,kl=(n("0a94"),Object(le["a"])(jl,Ol,Il,!1,null,null,null)),Fl=kl.exports,Bl="GIS.DSSOURCEIMAGE",Ml="GIS.DSSATELLITE",Al=864e6,Rl={name:"GisSpaceImageryPanel",components:{DxLoadPanel:Ve.a,DxPosition:Re["DxPosition"],GisSpaceImagerySearch:xl,GisSpaceImageryList:Fl},props:{aoiGeoJson:null,planetUrl:String,planetApiKey:String,listItems:Array,popupContainer:null},data:function(){return{sourceimage_id:2,selectedSatellites:[],bdate:new Date((new Date).getTime()-Al),edate:new Date,cloud_cover:.1,imagerySources:[],satellites:[],dataLoading:!1,loadPanelContainer:null}},watch:{aoiGeoJson:function(){this.loadPlanetData()}},mounted:function(){this.loadSourceImages(),this.loadSatellites()},methods:{loadSourceImages:function(){var e=this;Object(X["c"])("getData",{_config_dataset:Bl}).then((function(t){e.imagerySources=t}))},loadSatellites:function(){var e=this,t={_config_dataset:Ml,sourceimage_ids:this.sourceimage_id};Object(X["c"])("getData",t).then((function(t){e.satellites=t,t&&t[0]&&(e.selectedSatellites=[t[0]])}))},loadPlanetData:function(){var e=this,t={type:"RangeFilter",field_name:"cloud_cover",config:{lte:this.cloud_cover}},n={type:"GeometryFilter",field_name:"geometry",config:this.aoiGeoJson},i={type:"DateRangeFilter",field_name:"acquired",config:{gte:this.bdate,lte:this.edate}},o={type:"AndFilter",config:[n,t,i]},a=this.selectedSatellites.map((function(e){return e.name})),s={item_types:a,filter:o};this.dataLoading=!0,this.loadPanelContainer=this.$el,fetch(this.planetUrl,{method:"POST",headers:{Authorization:"Basic "+btoa(this.planetApiKey+":"),"Content-Type":"application/json"},body:JSON.stringify(s)}).finally((function(){e.dataLoading=!1})).then((function(e){return e.ok||window.console.error(e),e.json()})).then((function(t){e.$emit("planetDataLoaded",t)}))},handleFieldChanged:function(e){var t=e.fieldName,n=e.fieldValue;this[t]=n},clearResultClick:function(){this.$emit("clearResultClick")}}},Vl=Rl,Gl=(n("aeef"),Object(le["a"])(Vl,sl,rl,!1,null,null,null)),$l=Gl.exports;function Nl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ul(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nl(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var zl="spaceImagerySource",Hl="spaceImageryGeoJsonLayer",Wl="spaceImageryGeoJsonFillLayer",Kl={"line-color":["case",["boolean",["feature-state","hover"],!1],"#ffcd41","#3388ff"],"line-width":2},ql="https://api.planet.com/data/v1/quick-search",Jl="7de79fb692a642fd8881fa3d18c2c3dd",Zl={components:{GisSpaceImageryPanel:$l},data:function(){return{spaceImageryAOI:null,spaceImageryListItems:[]}},computed:{showSpaceImageryPanel:function(){return void 0===this.options.spaceImagery||!!this.options.spaceImagery&&this.options.spaceImagery.visible},planetUrl:function(){return this.options.planetUrl||ql},planetApiKey:function(){return this.options.planetApiKey||Jl}},mounted:function(){var e,t=this;(e=this.mouseTools).push.apply(e,[gl,yl,vl]),[yl,vl,gl].forEach((function(e){t.drawCreateHandlers[e]=function(e){return t.useAOIByPolygonTool(e)}}))},methods:{moveSpaceImageryLayersToFront:function(){var e=this;[Wl,Hl].forEach((function(t){e.mapbox.getLayer(t)&&e.mapbox.moveLayer(t)}))},useAOIByPolygonTool:function(e){var t=this;window.console.log(e.features),e.features&&e.features[0]&&(this.spaceImageryAOI=e.features[0].geometry),setTimeout((function(){t.selectedMouseTool=t.SELECT,t.handleToolbarButtonActiveStateChanged({buttonName:t.SELECT})}),1)},spaceImageryPanelButtonStateChanged:function(e){var t=e.buttonName;this.mouseTools.includes(t)&&(this.selectedMouseTool=t);var n=this.mapboxDraw.options.modes;switch(t){case gl:this.toggleDrawerTool(n.drawRectangleDragMode.NAME,t);break;case vl:this.toggleDrawerTool(n.drawPolygonMode.NAME,t);break;case yl:this.toggleDrawerTool(n.drawCircleMode.NAME,t);break}},spaceImageryDataLoaded:function(e){var t=this;this.clearPlanetRasterLayers(),this.spaceImageryFeatureCollection={type:"FeatureCollection",features:e.features.map((function(e,t){return Ul(Ul({},e),{},{properties:Ul(Ul({},e.properties),{},{_id:e.id,_links:e._links,_permissions:e._permissions}),id:t+1})}))},this.spaceImageryListItems=e.features.map((function(e,n){return{index:n+1,id:e.id,thumbnail:"".concat(e._links.thumbnail,"?api_key=").concat(t.planetApiKey),item_type:e.properties.item_type,acquired:new Date(e.properties.acquired),cloud_cover:e.properties.cloud_cover,hover:!1,visible:!1,bbox:Object(c["bbox"])(e)}})),this.mapbox.getSource(zl).setData(this.spaceImageryFeatureCollection)},initSpaceImageryGeoJsonLayers:function(){var e=this;this.planetRasterLayers={},this.hoveredSpaceImageryId=null,this.mapbox.addSource(zl,{type:"geojson",data:null}),this.mapbox.addLayer({id:Hl,type:"line",source:zl,paint:Kl}),this.mapbox.addLayer({id:Wl,type:"fill",source:zl,paint:{"fill-color":"transparent"}}),this.mapbox.on("mousemove",Wl,(function(t){t.features.length>0&&e.setHoveredSpaceImageryFeature(t.features[0].id)})),this.mapbox.on("mouseleave",Wl,(function(){e.clearHoveredSpaceImageryFeature()})),this.mapbox.on("click",Wl,(function(t){if(e.selectedMouseTool===e.SELECT){var n=e.mapbox.queryRenderedFeatures(t.point).filter((function(e){return e.source===zl})),i=n[0];if(i){var o=i.properties._id;e.toggleImageryListItem(o),e.toggleImageryRasterLayer(o,i.properties.item_type)}}}))},createPlanetRasterLayer:function(e,t){var n="https://tiles{s}.planet.com/data/v1/".concat(e,"/").concat(t,"/{z}/{x}/{y}.png?api_key=").concat(this.planetApiKey);this.mapbox.addSource(t,{type:"raster",tiles:[1,2,3].map((function(e){return n.replace("{s}",e)}))}),this.mapbox.addLayer({id:t,type:"raster",source:t}),this.sortLayers()},clearPlanetRasterLayers:function(){var e=this;Object.keys(this.planetRasterLayers).forEach((function(t){e.mapbox.getLayer(t)&&e.mapbox.removeLayer(t),e.mapbox.getSource(t)&&e.mapbox.removeSource(t)}))},spaceImageryListHoveredItemChanged:function(e){null===e&&this.clearHoveredSpaceImageryFeature();var t=this.spaceImageryFeatureCollection.features.filter((function(t){return t.properties._id===e}))[0];t&&this.setHoveredSpaceImageryFeature(t.id)},setHoveredSpaceImageryFeature:function(e){this.hoveredSpaceImageryId&&(this.mapbox.setFeatureState({source:zl,id:this.hoveredSpaceImageryId},{hover:!1}),this.toggleSpaceImageryItemHover(null,this.hoveredSpaceImageryId,!1)),this.hoveredSpaceImageryId=e,this.mapbox.setFeatureState({source:zl,id:this.hoveredSpaceImageryId},{hover:!0}),this.toggleSpaceImageryItemHover(null,this.hoveredSpaceImageryId,!0)},clearHoveredSpaceImageryFeature:function(){this.hoveredSpaceImageryId&&this.mapbox.setFeatureState({source:zl,id:this.hoveredSpaceImageryId},{hover:!1}),this.toggleSpaceImageryItemHover(null,this.hoveredSpaceImageryId,!1),this.hoveredSpaceImageryId=null},spaceImageryItemVisibleClick:function(e){var t=e.itemId,n=e.itemType;this.toggleImageryListItem(t),this.toggleImageryRasterLayer(t,n)},toggleImageryListItem:function(e){var t=this.spaceImageryListItems.filter((function(t){return t.id===e}))[0];t&&(t.visible=!t.visible)},toggleImageryRasterLayer:function(e,t){this.mapbox.getLayer(e)?(delete this.planetRasterLayers[e],this.mapbox.removeLayer(e),this.mapbox.removeSource(e)):(this.planetRasterLayers[e]=e,this.createPlanetRasterLayer(t,e))},spaceImageryItemMouseOver:function(e){var t=e.itemId,n=e.itemIndex;this.toggleSpaceImageryItemHover(t,null,!0),this.toggleSpaceImageryGeoJsonHover(n,!0)},spaceImageryItemMouseOut:function(e){var t=e.itemId,n=e.itemIndex;this.toggleSpaceImageryItemHover(t,null,!1),this.toggleSpaceImageryGeoJsonHover(n,!1)},toggleSpaceImageryItemHover:function(e,t,n){var i=this.spaceImageryListItems.filter((function(n){return n.id===e||n.index===t}))[0];i&&(i.hover=n)},toggleSpaceImageryGeoJsonHover:function(e,t){this.mapbox.setFeatureState({source:zl,id:e},{hover:t})},spaceImageryClearResultClick:function(){this.spaceImageryListItems=[],this.clearPlanetRasterLayers(),this.mapbox.getSource(zl).setData({type:"FeatureCollection",features:[]})}}},Yl=n("cbd3");function Xl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ql(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xl(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ec={actionTypeId:1,eventTypeId:12,id:null,parentId:null},tc={data:function(){return{legendItemsFlat:[],legendSelectedItem:null,legendItemsSearch:null,visibleProcess:!1,editingServiceLayerOptions:null,openLayerPopupVisible:!1}},computed:Ql(Ql({},Object(d["c"])("config",{getLayerOptions:Yt["E"],getSelectedIds:Yt["H"],getFeaturesByIds:Yt["p"],getLayerBounds:Yt["h"],gisLayerGetDataSetName:Yt["m"]})),{},{showLegend:function(){return void 0===this.options.legend||!!this.options.legend&&this.options.legend.visible},hideLayerEdit:function(){return this.options.hideLayerEdit||!1},hideLayerEnable:function(){return this.options.hideLayerEnable||!1},enableForSelect:function(){return this.options.enableForSelect||!1},allowDropBetweenGroup:function(){return!1!==this.options.allowDropBetweenGroup}}),methods:Ql(Ql(Ql({},Object(d["d"])("config",{setOption:wo["a"],setLayerMapboxLayers:gn["J"],initLegendStyleItems:gn["j"],setLayerLoading:gn["H"]})),Object(d["b"])("config",{loadLayerBounds:Xt["n"],loadFilterBuilderFields:Xt["t"]})),{},{handleLayerAdd:function(e){var t=this,n=null,i=null,o={componentType:"GisLayer",componentPos:this.layerConfigs[this.layerConfigs.length-1].componentPos+100,parentComponentId:this.componentId,options:Ql(Ql({},e),{},{enable:!0,visible:!0}),url:this.$route.params.childUrl};this.$store.dispatch("config/createComponent",o).then((function(e){return delete t.legendLayers[e],t.$store.dispatch("config/saveChanges")})).then((function(o){if(n=o[1].responseData[0].id,t.createMapLayer(n),e.dataSetName){var a={componentType:"DataSet",componentPos:0,parentComponentId:n,options:{dataSetName:e.dataSetName,defaultParam:{_config_is_geojson:!0}},url:t.$route.params.childUrl};t.$store.dispatch("config/createComponent",a).then((function(){return t.$store.dispatch("config/saveChanges")})).then((function(e){i=e[1].responseData[0].id;var n=Ql(Ql({},ec),{},{actionComponentId:i,eventComponentId:i});return t.$store.dispatch("uiConstructor/saveEventAction",n)})).then((function(){return t.$store.dispatch("config/setConstructorItemFields",{componentId:n,fields:[{name:"dataSetComponentId",value:i}]})})).then((function(){return t.$store.dispatch("config/checkComponentChanged",{componentId:n})})).then((function(){return t.$store.dispatch("config/saveChanges")})).then((function(){t.callComponentAction({componentId:i.toString(),actionName:"refreshData"})}))}}))},openTableClick:function(e){if(e){var t=this.legendLayers[e];if(t.cards&&t.cards.table){var n=t.cards.table;this.callComponentAction({componentId:n.componentId,actionName:"show"})}}},createMapLayer:function(e){var t=this.legendLayers[e],n={};n[e]=t},setParentLegendStatus:function(e,t){if(e.parentId!==e.id){var n=this.legendItemsFlat.find((function(t){return t.id===e.parentId})),i=this.legendItemsFlat.filter((function(t){return t.parentId===e.parentId&&t.id!==e.parentId}));n[t]=i.every((function(e){return!0===e[t]})),"visible"===t&&(n[t]?n["halfVisible"]=!1:n["halfVisible"]=i.some((function(e){return!0===e[t]||!0===e["halfVisible"]}))),this.setParentLegendStatus(n,t)}},createLayerBufferZone:function(e){var t=this,n=e.layerComponentId,o=e.bufferValues,a=this.getLayerOptions(n),s=a.dataSetComponentId;this.setLayerLoading({componentId:n,value:!0});var r={side:o.sideValue?o.zoneValue>0?"left":"right":"both",join:o.roundedValue?"round":"mitre"},l={radius_of_buffer:Math.abs(o.zoneValue),buffer_style_parameters:Object.entries(r).map((function(e){var t=Object(i["a"])(e,2),n=t[0],o=t[1];return"".concat(n,"=").concat(o)})).join(" "),component_id:n,is_union:o.unionValue||!1};"selected"===o.mode&&(l.ids=this.getSelectedIds(n));var c=a.parentId?a.parentId:this.componentId;this.datasetCreateBuffer({componentId:s,param:l}).then((function(e){var n=e[0].component_id;return t.$store.dispatch("config/loadComponent",{componentId:n,parentComponentId:c}).then((function(){return t.layerConfigs=[],t.layerConfigsFlat=[],t.fillLayerConfigs(t.layerItems,t.layerConfigs),t.createMapLayer(n),Object(X["c"])(Object({NODE_ENV:"production",VUE_APP_API_FILES_SERVICE:"https://files-service.rusgis.com/apiFiles",VUE_APP_API_SERVICE:"https://api.rusgis.com/api",VUE_APP_DATASET_SERVICE:"https://ds.rusgis.com/dataset",VUE_APP_DOWNLOAD_FILE_SERVICE:"https://files-service.rusgis.com/downloadFile",VUE_APP_GET_PORTRAIT_IMAGE_SERVICE:"https://files-service.rusgis.com/getPortraitImage",VUE_APP_INNER_TILE_SERVICES:"/tms,http://89.108.84.38:8101/tms,https://composite.rusgis.com",VUE_APP_JS_API:"true",VUE_APP_PROXY_SERVICE:"https://proxy.rusgis.com/proxy",VUE_APP_SHOW_DESIGNER_SERVICE:"https://reports.rusgis.com/showDesigner",VUE_APP_SHOW_REPORT_SERVICE:"https://reports.rusgis.com/showReport",VUE_APP_UPLOAD_FILE_SERVICE:"https://files-service.rusgis.com/uploadFile",VUE_APP_USER_ID:"500322",BASE_URL:"/"}).VUE_APP_UPDATE_SESSION,"NULL.NULL.UPDATE_SESSION",{})}))})).finally((function(){t.setLayerLoading({componentId:n,value:!1})}))},onAddLayerClick:function(e){var t=null;switch(e){case"onAddFolderClick":t="folder";break;case"onAddServiceClick":t="service";break;case"onAddVectorLayerClick":t="vector";break;case"onAddRasterLayerClick":t="raster";break;case"onOpenLayerClick":this.openLayerPopupVisible=!0;break;default:this.callEventAction(this.componentId,e)}this.setOption({componentId:this.componentId,optionName:"editingOptionsLayerComponentId",optionValue:t})},searchLayerItem:function(e){var t=this,n=e.layerComponentId,i=e.value,o=this.getLayerOptions(n);this.legendItemsSearch=new Promise((function(e){t.loadLayerDataFields({layerComponentId:n,gisComponentId:t.componentId}).then((function(n){var a=n.filter((function(e){return"text"===e.fieldtype_name||"varchar(256)"===e.fieldtype_name})),s=[];return a.forEach((function(e){s.push([e.name,"contains",i]),s.push("or")})),e(t.getDatasetData({componentId:o.dataSetComponentId,actionName:"getRequest",where:s,limit:5,offset:0,is_map:!0}))}))}))},onLayerFiltering:function(e){var t=e.layerId,n=e.param,i=this.legendLayers[t],o=this.layerConfigsFlat.find((function(e){return e.componentId===t})),a=this.legendItemsFlat.find((function(e){return e.id===t}));if(i&&o){this.filterLayerWithFilterPanel(i,o,n);var s=a.styleRules.some((function(e){return e.options.visible}));s&&i.mapboxMapLayer.setVisibility(!0),a.styleRules.forEach((function(e){e.options.visible||i.mapboxMapLayer.setStyleRuleVisibility(e.id,e.options.visible)}))}},onLayerFilterPanelLoaded:function(e){var t=e.filterPanelComponentConfig;this.filterPanelItems=[t]},filterLayerWithFilterPanel:function(e,t,n){var i,o=t.options;if(n.needParse)try{i=JSON.parse(n.where.replace(/\\\"/g,'"'))}catch(s){window.console.log("layer filter err")}else i=n.where;var a=Ql({},n);switch(delete a.where,o.type){case"vector":e.mapboxMapLayer.changeFilter({layerOptions:o,where:i,params:a}),["103745","103746"].includes(e.layerComponentId)&&e.mapboxMapLayer.setGeoJsonData(null,!0,!0);break;case"geojson":break}},onLayerClearGeoJson:function(e){var t=e.componentId,n=this.legendLayers[t];n.mapboxMapLayer&&n.mapboxMapLayer.setGeoJsonData(null,!0,!0)},moveToAllFeatures:function(e){var t=this,n=this.getLayerOptions(e),i=this.getLayerBounds(e);i?this.mapbox.fitBounds(i,{animate:!1,padding:50}):n.modelOrigin?this.mapbox.panTo(n.modelOrigin):(this.setLayerLoading({componentId:e,value:!0}),this.loadLayerBounds({layerComponentId:e}).then((function(e){t.mapbox.fitBounds(e,{animate:!1,padding:50})})).catch((function(){t.noBoundsNotify()})).finally((function(){t.setLayerLoading({componentId:e,value:!1})})))},moveToSelectedFeatures:function(e){var t=this,n=this.getSelectedIds(e),i=this.getLayerOptions(e);this.loadGeoJsons(e,n,i).then((function(e){var n=c["featureCollection"](e),i=c["bbox"](n);t.mapbox.fitBounds(i,{animate:!1,padding:50})}))},noBoundsNotify:function(){Object(Yl["a"])({message:"Для слоя не заданы границы",width:"auto"},"warning",3e3)}})};function nc(e,t,n,i){var o=e.map((function(e){var i=!1;"Point"!==e.geometry.type&&"MultiPoint"!==e.geometry.type&&"LineString"!==e.geometry.type&&"MultiLineString"!==e.geometry.type||(i=!0);var o=c["bbox"](e),a=c["point"]([o[0],o[1]]),s=c["point"]([o[0],o[1]+1]),r=c["point"]([o[0],o[1]]),l=c["point"]([o[0]+1,o[1]]),d=c["distance"](a,s,{units:"meters"}),u=c["distance"](r,l,{units:"meters"});if(i||n){if(Math.abs(o[1])>50&&Math.abs(o[3])>50){if(Math.abs(o[0])>80&&Math.abs(o[2])>80){var p=Math.abs(o[0])<130&&Math.abs(o[2])<130?Math.abs(o[0])/80:(270-Math.abs(o[0]))/80;return c["buffer"](e,Math.sqrt(p)*t,{units:"meters"})}return c["buffer"](e,t,{units:"meters"})}return c["buffer"](e,t*d/u,{units:"meters"})}return ic(e,t*d/u)}));return i?c["union"].apply(c,Object(a["a"])(o)):o}function ic(e,t){for(var n=[],i=c["rewind"](e),o="MultiPolygon"===i.geometry.type?i.geometry.coordinates[0][0]:i.geometry.coordinates[0],a=o.map((function(e){return{x:c["toMercator"](e)[0],y:c["toMercator"](e)[1]}})),s=0;s<a.length-1;s++){var r=a[s],l=a[s+1],d=s+2<a.length?a[s+2]:a[1],u=Math.atan2(l.y-r.y,l.x-r.x),p=Math.atan2(d.y-l.y,d.x-l.x),f=oc(r,t,u-Math.PI/2),h=oc(l,t,u-Math.PI/2),m=oc(l,t,p-Math.PI/2),g=oc(d,t,p-Math.PI/2),y=Object(F["a"])(f,h),v=Object(F["a"])(m,g),b=(v.b-y.b)/(y.k-v.k),_=y.k*b+y.b,C=c["point"]([b,_]);n.push(c["toWgs84"](C).geometry.coordinates)}return n.push(n[0]),c["polygon"]([n])}function oc(e,t,n){return{x:e.x+t*Math.cos(n),y:e.y+t*Math.sin(n)}}function ac(e,t,n){var i=8,o=6,a=new l.a.Point(e.x+o,e.y),s=n.unproject(a),r=s.distanceTo(t);return c["circle"]([t.lng,t.lat],r/1e3,{steps:i})}function sc(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=rc(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function rc(e,t){if(e){if("string"===typeof e)return lc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lc(e,t):void 0}}function lc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function cc(e){var t=[];switch(e.geometry.type){case"MultiPolygon":dc(e.geometry.coordinates,t);break;case"Polygon":e.geometry.type=uc(e.geometry.coordinates,t);break;default:t=e.geometry.coordinates}return e.geometry.coordinates=t,e}function dc(e,t){var n,i=sc(e);try{for(i.s();!(n=i.n()).done;){var o=n.value,a=[],s=uc(o,a);switch(s){case"Polygon":t.push(a);break;case"MultiPolygon":Array.prototype.push.apply(t,a);break}}}catch(r){i.e(r)}finally{i.f()}}function uc(e,t){var n,i="Polygon",o=0,a=sc(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;pc(s);var r=null;try{r=c["polygon"]([s])}catch(x){continue}var l=c["unkinkPolygon"](r);if(0===o)if(l.features.length>1){i="MultiPolygon",fc(l.features);var d,u=sc(l.features);try{for(u.s();!(d=u.n()).done;){var p=d.value;t.push(p.geometry.coordinates)}}catch(x){u.e(x)}finally{u.f()}}else t.push(s);else if("MultiPolygon"===i){var f,h=sc(l.features);try{for(h.s();!(f=h.n()).done;){var m,g=f.value,y=sc(t);try{for(y.s();!(m=y.n()).done;){var v=m.value;if(c["booleanContains"](c["polygon"](v),c["polygon"](g.geometry.coordinates))){Array.prototype.push.apply(v,g.geometry.coordinates);break}}}catch(x){y.e(x)}finally{y.f()}}}catch(x){h.e(x)}finally{h.f()}}else{var b,_=sc(l.features);try{for(_.s();!(b=_.n()).done;){var C=b.value;Array.prototype.push.apply(t,C.geometry.coordinates)}}catch(x){_.e(x)}finally{_.f()}}o++}}catch(x){a.e(x)}finally{a.f()}return i}function pc(e){var t=0;while(t<=e.length-3){var n=t+1;while(n<=e.length-2)e[t][0]===e[n][0]&&e[t][1]===e[n][1]?e.splice(n,1):n++;t++}}function fc(e,t){e.sort((function(e,n){var i=c["polygon"](e),o=c["polygon"](n),a=c["area"](i),s=c["area"](o);return t?s-a:a-s}))}function hc(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=mc(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function mc(e,t){if(e){if("string"===typeof e)return gc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?gc(e,t):void 0}}function gc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function yc(e){var t={units:"meters"},n=c["length"](e,t),i=c["along"](e,n/2,t);return i.geometry}function vc(e,t){var n,i,o,a=Number.MAX_VALUE,s=hc(e);try{for(s.s();!(o=s.n()).done;){var r=o.value;if("Polygon"===r.geometry.type){var l=c["polygonToLine"](r.geometry);i=c["nearestPointOnLine"](l.geometry,t)}else if("MultiPolygon"===r.geometry.type){var d,u=c["polygonToLine"](r.geometry),p=Number.MAX_VALUE,f=hc(u.features);try{for(f.s();!(d=f.n()).done;){var h=d.value,m=c["nearestPointOnLine"](h.geometry,t);m.properties.dist<p&&(i=m)}}catch(y){f.e(y)}finally{f.f()}}else if("Point"===r.geometry.type)n=r.geometry;else if("MultiPoint"===r.geometry.type){var g=r.geometry.coordinates.map((function(e){return c["point"](e)}));i=c["nearestPoint"](t,c["multiPoint"](g))}else i=c["nearestPointOnLine"](r.geometry,t);i&&i.properties.dist<a&&(n=i.geometry)}}catch(y){s.e(y)}finally{s.f()}return n}function bc(e,t){var n,i=null,o=c["nearestPointOnLine"](e,t),a=hc(e.coordinates);try{for(a.s();!(n=a.n()).done;){var s=n.value,r={type:"LineString",coordinates:s},l=c["nearestPointOnLine"](r,t);o.properties.dist===l.properties.dist&&(i=r)}}catch(d){a.e(d)}finally{a.f()}return i}function _c(e){var t=xc(e),n=Oc(t);return n}function Cc(e,t){var n,i=hc(t);try{for(i.s();!(n=i.n()).done;){var o=n.value,a=c["difference"](e,o);a&&(e=a)}}catch(s){i.e(s)}finally{i.f()}return e}function xc(e){for(var t=[],n=0;n<e.length;n++){var i,o=cc(e[n]),a=c["featureCollection"]([o]),s=hc(a.features);try{for(s.s();!(i=s.n()).done;){var r=i.value;t.push(r)}}catch(l){s.e(l)}finally{s.f()}}return t}function Oc(e){var t=Ic(e),n=Sc(t);return Lc(n)}function Ic(e){var t,n=[],i=hc(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;if("MultiPolygon"===o.geometry.type){var a,s=hc(o.geometry.coordinates);try{for(s.s();!(a=s.n()).done;){var r=a.value;n.push(c["polygon"](r))}}catch(l){s.e(l)}finally{s.f()}}else n.push(c["polygon"](o.geometry.coordinates))}}catch(l){i.e(l)}finally{i.f()}return n}function Sc(e){for(var t=[],n=0;n<e.length;n++)for(var i=n+1;i<e.length;i++){var o=c["intersect"](e[n],e[i]);o&&t.push(o)}return t}function Lc(e){var t=c["featureCollection"](Object(a["a"])(e)),n=c["combine"](t);return n}var Dc=n("6e35");function Pc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ec(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pc(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var wc="selectionFillPattern",Tc="selectionContextMenuFillPattern",jc="selectionGeoJson",kc={features:[],ids:[],not_ids:[]},Fc={data:function(){return{selectionByClickIndex:0,silentSelect:!1,clickedIds:{},clientSelectByPolygonOnEvent:null}},computed:Ec(Ec({},Object(d["c"])("config",{getGisOptions:Jt["z"],getActiveLegendLayerComponentId:Jt["d"],getLayerOptions:Yt["E"],isLayerVisible:Yt["kb"],getLayerSelectedIds:Yt["H"],getMapboxLayerIds:Yt["A"],getEnableLayers:Jt["m"]})),{},{allLayersSelectedFeatures:function(){var e=this,t=this.getAllSelected(this.componentId);return Object.entries(t).reduce((function(t,n){var o=Object(i["a"])(n,2),s=o[0],r=o[1],l=e.getLayerAllFeatures(s).filter((function(e){return r.includes(e.id)}));return[].concat(Object(a["a"])(t),Object(a["a"])(l||[]))}),[])},allLayersSelectedIds:function(){return Object.values(this.getAllSelected(this.componentId)).reduce((function(e,t){return e.concat(t)}),[])},defaultSelectionFillPaint:function(){return this.options.selectionFillPaint||Dc["g"]},defaultSelectionLinePaint:function(){return this.options.selectionLinePaint||Dc["h"]},defaultSelectionCirclePaint:function(){return this.options.selectionCirclePaint||Dc["f"]}}),methods:Ec(Ec({},Object(d["b"])("config",{gisClearSelection:Xa["b"],gisLayerLoadGeoJson:Xt["v"],setLayerSelectedIds:Xt["L"],gisLayerSelectFeatures:Xt["F"]})),{},{initSelectionFillPatterns:function(){this.mapbox.addImage(wc,Bc(1)),this.mapbox.addImage(Tc,Bc(2))},useSelectTool:function(e){var t,n=this,i=this.getGisOptions(this.componentId),o=i.selectInActiveLayer;return t=o?this.useSelectToolInActiveLayer(e):this.useSelectToolInEnabledLayers(e),t.then((function(t){return n.afterSelect(t,[e.lngLat.lng,e.lngLat.lat])}))},afterSelect:function(e,t){var n=this,i="onFeaturesSelect";if(e&&e[0]){var o=e[0].layer.metadata.layerComponentId;if(this.hasEventActionSubscribers(this.componentId,i)){var a=vc(e,t);this.callEventAction(this.componentId,i,{features:e,layerComponentId:o,nearestPoint:a})}var s=this.getLayerOptions(o),r=s.openCardOnLeftClick;r&&this.loadLayerChildComponents({layerComponentId:o}).then((function(){var t=n.getLayerOptions(o),i=t.cardComponentId;i&&n.callComponentAction({componentId:i,actionName:"show",is_new:!1,geojson:e[0],id:e[0].id})}))}else this.callEventAction(this.componentId,i,{features:[]})},useSelectToolInActiveLayer:function(e,t){var n=this.getGisOptions(this.componentId),i=n.activeLegendLayerComponentId,o=n.selectableLayerIds;if(!i||o&&!o.includes(i))return Promise.resolve();if(!this.isLayerVisible(i))return Promise.resolve();var a=this.getLayerOptions(i);switch(a.type){case"vector":case"geojson":case"wfs":return this.useSelectToolInVectorLayer(e,i,t);case"wms":return this.useSelectToolInWmsLayer(e,i)}},setSelectionGeometry:function(e,t){var n={},i=this.$store.getters["config/getComponentOptions"](e)[jc]||Object(Mt["a"])(kc,n);for(var o in i.ids=[],i.not_ids=[],t&&i.features.push(t),this.clickedIds)!0===this.clickedIds[o]?i.ids.push(parseInt(o)):!1===this.clickedIds[o]&&i.not_ids.push(parseInt(o));this.$store.commit("config/setComponentOption",{componentId:e,optionName:jc,optionValue:i})},useSelectToolInEnabledLayers:function(e){var t=this.getGisOptions(this.componentId),n=t.selectableLayerIds,i=n||this.getEnableLayers(this.componentId),o=this.queryRenderedFeatures(e.point,i);return this.selectFeatureFromFeaturesArray(o,e.originalEvent.ctrlKey,e.originalEvent.shiftKey)},useSelectToolInVectorLayer:function(e,t,n){var i=this.queryRenderedFeatures(e.point,[t]);return this.selectFeatureFromFeaturesArray(i,e.originalEvent.ctrlKey,e.originalEvent.shiftKey,n)},useSelectToolInWmsLayer:function(e,t){var n=this,i=ac(e.point,e.lngLat,this.mapbox);this.gisLayerLoadGeoJson({layerComponentId:t,_config_geojson:JSON.stringify(i),mode:"intersect"}).then((function(t){return n.selectFeatureFromFeaturesArray(t.features||[],e.originalEvent.ctrlKey,e.originalEvent.shiftKey)}))},useSelectWhileEditing:function(e,t){var n=this;this.silentSelect=!0,this.useSelectToolInActiveLayer(e,!0).then((function(){n.silentSelect=!1;var e=n.editingFeaturesIds,i=n.editingLayerSelectedFeaturesIds;e[0]&&i[0]&&e[0]===i[0]||(e[0]&&n.endEditFeature(!1),i[0]&&(n.editingFeatures=[],t===Wi?n.toggleMoveFeatureTools(t):t===Hi&&n.toggleEditFeatureTools(t)))}))},queryRenderedFeatures:function(e,t){var n=this,i=[[e.x-this.selectClickTolerance,e.y-this.selectClickTolerance],[e.x+this.selectClickTolerance,e.y+this.selectClickTolerance]],o=t.reduce((function(e,t){return e.push.apply(e,Object(a["a"])(n.getMapboxLayerIds(t))),e}),[]);return o=o.filter((function(e){return!!n.mapbox.getLayer(e)})),this.mapbox.queryRenderedFeatures(i,{layers:o})},selectFeatureFromFeaturesArray:function(e,t,n,i){if(!e||!e.length)return t||n||i||this.clearAllSelection(),Promise.resolve([]);t?(this.selectionByClickIndex++,this.selectionByClickIndex>=e.length&&(this.selectionByClickIndex=0)):this.selectionByClickIndex=0;var o=e[this.selectionByClickIndex];if(!o)return t||n||i||this.clearAllSelection(),Promise.resolve([]);var a=o.layer.metadata.layerComponentId;return this.gisLayerSelectFeatures({layerComponentId:a,features:[o],shiftKey:n||t}),this.callEventAction(a,"onSelectionChanged",Ec({},o.properties)),t||n||i||this.clearAllSelection([a]),Promise.resolve([o])},useSelectByPolygonTool:function(e){var t=this;this.mapboxDraw.deleteAll();var n=this.getActiveLegendLayerComponentId(this.componentId);if(n){var i=this.getLayerOptions(n),o=this.isLayerVisible(n);if(!(!o&&e.features.length<=0||!i.type)){var a=e.features[0];["geojson","vector","wfs"].includes(i.type)?(this.selectByPolygon(a,n,[],e.shiftKey),this.clearAllSelection([n])):"wms"===i.type&&(e.shiftKey||this.clearAllSelection(),this.loadFeaturesByGeoJson({geoJson:a,layerConfig:i,mode:"contains"}).then((function(e){t.setSelectedFeatures(n,e,!1)})))}}},loadFeaturesById:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e.dataSetComponentId;if(!n)return Promise.resolve();var i=e.mapboxMapLayer.getGeoJsonData().features.map((function(e){return e.id})),o=t.filter((function(e){return!i.includes(e)}));return o[0]?this.callComponentAction({componentId:n.toString(),actionName:"loadRecordsDirect",keys:o}).then((function(t){e.mapboxMapLayer.addFeaturesNoHistory(t.features)})):Promise.resolve()},loadFeaturesByParam:function(e,t){var n=e.dataSetComponentId;return n?this.callComponentAction({componentId:n.toString(),actionName:"loadRecordsByParam",param:t}).then((function(t){return e.mapboxMapLayer.addFeaturesNoHistory(t.features),t})):Promise.resolve()},useSelectByBufferZoneTool:function(e,t){var n=this;this.getActualSelectedFeatures().then((function(i){var o=nc(i,e,t,!0);n.setSelectionGeoJson({gisComponentId:n.componentId,geoJson:o}),n.useSelectByGeoJson(o,[],!1)}))},useCircleRadiusSelect:function(e,t){var n=[e.lng,e.lat];this.mapbox.snapMapDraw&&this.mapbox.snapMapDraw.point&&(n=this.mapbox.snapMapDraw.point);var i=c["circle"](n,t,{steps:45});this.useSelectByGeoJson(i,[],!1)},clearAllSelection:function(e){this.gisClearSelection({componentId:this.componentId,exceptLayerComponentIds:e}),this.clientSelectByPolygonOnEvent&&this.mapbox.off("moveend",this.clientSelectByPolygonOnEvent)},useSelectByGeoJson:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=this.getActiveLegendLayerComponentId(this.componentId);if(o){var a=this.getLayerOptions(o);["geojson","vector","wfs"].includes(a.type)?(this.clearAllSelection([o]),this.selectByPolygon(e,o,n,i)):"wms"===a.type&&(i||this.clearAllSelection(),this.loadFeaturesByGeoJson({geoJson:e,layerOptions:a}).then((function(e){var i=e.filter((function(e){return!n.includes(e.id)}));t.setSelectedFeatures(o,i,!1)})))}},loadFeaturesByGeoJson:function(e){var t=e.geoJson,n=e.layerConfig,i=e.mode,o=void 0===i?"contains":i;return this.layerDatasetRequest(n,t,o).then((function(e){var t=e.geoJsonData;return t.reduce((function(e,t){return t&&t.features&&e.push.apply(e,Object(a["a"])(t.features)),e}),[])}))},layerDatasetRequest:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"contains",o=e.dataSetComponentId;if(o)return new Promise((function(a){n.datasetRefreshData({componentId:o,_config_geojson:JSON.stringify(t),_config_select_mode:i}).then((function(t){var n=t.data;n&&Array.isArray(n.features)&&n.features.forEach((function(t){t.source="".concat(e.layerComponentId,"_loaded")})),a({geoJsonData:n,layerComponentId:e.componentId})})).catch((function(){a(null)}))}))},setSelectedFeatures:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.gisLayerSelectFeatures({layerComponentId:e,features:t,keepSelected:n})},selectByPolygon:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3?arguments[3]:void 0;this.clientSelectByPolygon(e,t,i,o);var a=c["bbox"](e),s=this.mapbox.getBounds();(a[0]<s.getWest()||a[1]<s.getSouth()||a[2]>s.getEast()||a[3]>s.getNorth())&&(this.clientSelectByPolygonOnEvent&&this.mapbox.off("moveend",this.clientSelectByPolygonOnEvent),this.clientSelectByPolygonOnEvent=function(){n.clientSelectByPolygon(e,t,i,o)},this.mapbox.on("moveend",this.clientSelectByPolygonOnEvent))},toggleSelectionMapboxLayers:function(e,t){var n=this.legendLayers[e];n.mapboxMapLayer.setSelectionLayersVisible(t)},clientSelectByPolygon:function(e,t,n,i){var o=c["bbox"](e),a=this.mapbox.project([o[0],o[1]]),s=this.mapbox.project([o[2],o[3]]),r=this.getMapboxLayerIds(t),l=this.mapbox.queryRenderedFeatures([a,s],{layers:r}),d={},u=i?this.getLayerSelectedIds(t):[],p=[];for(var f in l.forEach((function(t){var n=c["explode"](t).features,i=n.every((function(t){return c["booleanPointInPolygon"](t,e)})),o=d[t.id];o||(o={feature:t}),o.isIn=(void 0===o.isIn||o.isIn)&&i,d[t.id]=o})),d){var h=d[f];h.isIn&&!n.includes(h.feature.id)&&(u.push(h.feature.id),p.push(h.feature.properties))}this.setLayerSelectedIds({layerComponentId:t,ids:u}),this.$store.dispatch("config/setItemFields",{componentId:t,fields:[{name:"focusedData",value:p}]})},selectByFeatureId:function(e){var t=this,n=e.zoom,i=e.layerComponentId,o=e.param;this.mapboxReady.then((function(){var e=t.getLayerOptions(i),a=o.id;if(a||!(Object.keys(o).length<2)){var s=t.getLayerSelectedIds(i),r=Array.isArray(a)?a:[a],l=!0;r.forEach((function(e){s.includes(e)||(l=!1)})),l?t.moveMapToFeatures(i,r,n,t.locateBufferSize):a?(t.setLayerSelectedIds({layerComponentId:i,ids:r}),r.forEach((function(e){t.clickedIds[e]=!0})),t.setSelectionGeometry(i,null),t.moveMapToFeatures(i,r,n,t.locateBufferSize)):o&&Object.keys(o).length>0&&"vector"===e.type&&t.loadFeaturesByParam(i,o).then((function(n){var o=(n.features||[]).map((function(t){return t.id||t.properties[e.keyField]}));o&&o.length>0&&(t.setLayerVisible({componentId:i,visible:!0}),t.setLayerSelectedIds({layerComponentId:i,ids:o}),t.moveMapToFeatures(i,o))}))}}))}})};function Bc(e){var t=document.createElement("canvas");t.width=10,t.height=10;var n=t.getContext("2d");return n.strokeStyle="#3388ff",n.lineWidth=e,n.beginPath(),n.moveTo(2,2),n.lineTo(8,8),n.moveTo(2,8),n.lineTo(8,2),n.stroke(),n.getImageData(0,0,t.width,t.height)}var Mc="selectedAreaSource",Ac="selectedAreaLayer",Rc={"line-color":"#c378e2","line-width":2,"line-dasharray":[5,5]},Vc="selectedAreaCircleRadiusCenter",Gc={"circle-color":"#ffffff","circle-radius":4,"circle-stroke-width":2,"circle-stroke-color":"#c378e2"},$c={methods:{initSelectAreaSourceAndLayer:function(){this.mapbox.addSource(Mc,{type:"geojson",data:null}),this.mapbox.addLayer({id:Ac,type:"line",source:Mc,paint:Rc,filter:["all",["==",["geometry-type"],"Polygon"]]}),this.mapbox.addLayer({id:Vc,type:"circle",source:Mc,paint:Gc,filter:["all",["==",["geometry-type"],"Point"]]})},moveBufferSelectionLayersToFront:function(){this.mapbox.moveLayer(Ac),this.mapbox.moveLayer(Vc)},useSelectAreaByBufferZoneTool:function(e,t,n){var i=nc(e,t,n,!0);this.mapbox.getSource(Mc).setData(i),this.clearAllSelection(),this.dispatchSelectedArea(i),this.callEventAction(this.componentId,"onGeometryChanged",i)},useSelectAreaByRadiusTool:function(e,t){var n=[e.lng,e.lat];this.mapbox.snapMapDraw&&this.mapbox.snapMapDraw.point&&(n=this.mapbox.snapMapDraw.point);var i=c["circle"](n,t,{steps:45}),o=c["featureCollection"]([i,c["point"](n)]);this.mapbox.getSource(Mc).setData(o),this.clearAllSelection(),this.dispatchSelectedArea(i),this.callEventAction(this.componentId,"onGeometryChanged",i)},useSelectAreaTool:function(e){var t=c["feature"](e.features[0].geometry);this.mapbox.getSource(Mc).setData(t),this.mapboxDraw.deleteAll(),this.dispatchSelectedArea(t),this.callEventAction(this.componentId,"onGeometryChanged",t)},dispatchSelectedArea:function(e){this.$store.dispatch("config/setItemFields",{componentId:this.componentId,fields:[{name:"selectedData.selectedArea",value:e}]})}}},Nc=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"object-form"},[n("div",{staticClass:"object-form__content"},[n("div",{staticClass:"object-form__title"},[e.loading?n("div",[n("DxLoadIndicator",{attrs:{visible:e.loading}})],1):n("div",[n("div",{staticClass:"object-form__title-text",style:e.titleWidth},[e._v("\n          "+e._s(e.objectLayerName)+"\n        ")]),n("div",{staticClass:"object-form__title-buttons"},[e.clickedFeaturesCount?n("span",{staticClass:"object-form__title-buttons-pointer",style:e.leftArrowStyle,on:{click:function(t){return e.$emit("leftArrowClick")}}},[n("i",{staticClass:"core core-115-arrow-left"})]):e._e(),e.clickedFeaturesCount?n("span",[e._v(" "+e._s(e.selectionByClickIndex+1)+"/"+e._s(e.clickedFeaturesCount)+" ")]):e._e(),e.clickedFeaturesCount?n("span",{staticClass:"object-form__title-buttons-pointer",style:e.rightArrowStyle,on:{click:function(t){return e.$emit("rightArrowClick")}}},[n("i",{staticClass:"core core-117-arrow-right"})]):e._e(),e.clickedFeaturesCount?n("div",{staticClass:"separator"}):e._e(),n("span",{staticClass:"object-form__title-buttons-pointer",on:{click:function(t){return e.$emit("closeClick")}}},[n("i",{staticClass:"core core-057-close"})])]),n("div",{staticClass:"object-form__title-layer-name"},[n("span",[e._v(e._s(e.objectId))]),e.identificationCoordinates?n("span",[n("DxSelectBox",{attrs:{dataSource:e.coordinateTypes,valueExpr:"value",displayExpr:"text"},on:{opened:e.selectBoxOpened,valueChanged:function(t){return e.$emit("coordinateTypeChanged",e.coordinateType)}},model:{value:e.coordinateType,callback:function(t){e.coordinateType=t},expression:"coordinateType"}}),e._v("\n            "+e._s(e.identificationCoordinates)+"\n          ")],1):e._e()])])]),n("DxScrollView",{style:e.scrollViewHeight},[e.rawHtmlProperties?n("div",{staticClass:"object-form__desc"},[n("div",{domProps:{innerHTML:e._s(e.rawHtmlProperties)}})]):n("div",{staticClass:"object-form__desc"},e._l(e.arrayProperties,(function(t,i){return n("div",{key:i},[n("div",{staticClass:"object-form__desc-key"},[e._v(e._s(t.key))]),"boolean"===typeof t.value?n("div",{staticClass:"object-form__desc-value"},[n("DxCheckBox",{attrs:{value:t.value,readOnly:!0}})],1):n("div",{staticClass:"object-form__desc-value"},[e._v("\n            "+e._s(t.value||0===t.value?t.value:"-")+"\n          ")])])})),0)])],1)])},Uc=[],zc=n("ee80"),Hc=n.n(zc),Wc={name:"GisObjectIDForm",mixins:[yt["a"]],components:{DxLoadIndicator:$e.a,DxScrollView:ie.a,DxCheckBox:Hc.a,DxSelectBox:nt.a},props:{objectLayerName:String,objectId:String,identificationCoordinates:String,arrayProperties:Array,rawHtmlProperties:String,clickedFeaturesCount:Number,selectionByClickIndex:Number,loading:Boolean},data:function(){return{coordinateType:"lngLatDec",coordinateTypes:[{value:"lngLatDec",text:"Десятичные градусы"},{value:"lngLatDeg",text:"Градусы, минуты, секунды"},{value:"meters",text:"EPSG:3857"}]}},computed:{leftArrowStyle:function(){return this.selectionByClickIndex?{color:"#839499"}:{color:"#dadfe1"}},rightArrowStyle:function(){return this.selectionByClickIndex!==this.clickedFeaturesCount-1?{color:"#839499"}:{color:"#dadfe1"}},titleWidth:function(){return this.clickedFeaturesCount?{width:"150px"}:{width:"250px"}},scrollViewHeight:function(){return this.identificationCoordinates?this.objectId?{height:"calc(100% - 100px)"}:{height:"calc(100% - 82px)"}:this.objectId?{height:"calc(100% - 54px)"}:{height:"calc(100% - 36px)"}}}},Kc=Wc,qc=(n("e3b6"),Object(le["a"])(Kc,Nc,Uc,!1,null,"fbf95cc0",null)),Jc=qc.exports,Zc={PARCEL:1,BLOCK:2,DISTRICT:3,OKTMO:4,REALTY:5,TER_ZONE:6,BORDER:7,OMS:9,ZOUIT:10,FOREST:12,RED_LINE:13,PARCEL_SCHEME:15,FREE_ZONE:16},Yc=[null,"Участок","Квартал","Район","Округ","ОКС","Территориальная зона","Граница",null,"ОМС","ЗОУИТ",null,"Лесничества и лесопарки","Красные линии",null,"Схемы расположения ЗУ","Свободные экономические зоны"],Xc={"01":"Ранее учтённый","05":"Временный (новый)","06":"Учтённый","07":"Архивный","08":"Аннулированный","УС":"Условный","АУС":"Архивный условный"},Qc={"СВОБОДНЫЕ_ЗЕМЛИ":"Свободные земли","003002000000":"Земли населённых пунктов","003001000000":"Земли сельскохозяйственного назначения","003008000000":"Категория не установлена","003004000000":"Земли особо охраняемых территорий и объектов","003005000000":"Земли лесного фонда","003003000000":"Земли промышленности и иного спецназначения","003006000000":"Земли водного фонда","003007000000":"Земли запаса"},ed={"000":"Площадь","001":"Площадь застройки","002":"Общая площадь","003":"Общая площадь без лоджии","004":"Общая площадь с лоджией","005":"Жилая площадь","007":"Основная площадь","008":"Декларированная площадь","009":"Уточненная площадь","010":"Фактическая площадь","011":"Вспомогательная площадь","012":"Площадь помещений общего пользования без лоджии","013":"Площадь помещений общего пользования с лоджией","014":"Прочие технические помещения без лоджии","015":"Прочие технические помещения с лоджией","020":"Застроенная площадь","021":"Незастроенная площадь","022":"Значение площади отсутствует"},td={building:"Здание",construction:"Сооружение",incomplete:"Объект незавершенного строительства"},nd={21801e7:"Территориальные зоны",21801001e4:"Жилая зона",21801002e4:"Общественно-деловая зона",21801003e4:"Производственная зона, зона инженерной и транспортной инфраструктур",21801004e4:"Зона сельскохозяйственного использования",21801005e4:"Зона рекреационного назначения",21801006e4:"Зона особо охраняемых территорий",21801007e4:"Зона специального назначения",21801008e4:"Зона размещения военных объектов",21801009e4:"Иная зона"},id={21802e7:"Зоны с особыми условиями использования территории",21802001e4:"Зона охраны природных объектов",218020010001:"Территория особо охраняемого природного объекта",218020010002:"Охранная зона особо охраняемого природного объекта",218020010003:"Водоохранная зона",218020010004:"Прибрежная защитная полоса",218020010005:"Зона санитарной охраны источников водоснабжения и водопроводов питьевого назначения",218020010006:"Особо ценные земли",21802002e4:"Зона охраны искусственных объектов",218020020001:"Территория объекта культурного наследия",218020020002:"Зона охраны объекта культурного наследия",218020020003:"Охранная зона геодезического пункта",218020020004:"Охранная зона стационарного пункта наблюдений за состоянием окружающей природной среды",218020020005:"Охранная зона транспорта",218020020006:"Охранная зона инженерных коммуникаций",218020020007:"Охранная зона линий и сооружений связи и линий и сооружений радиофикации",218020020008:"Придорожная полоса",21802003e4:"Зоны защиты населения",218020030001:"Запретная зона при военном складе",218020030002:"Запретный район при военном складе",218020030003:"Загрязненные земли",218020030004:"Охранная зона загрязненных земель",218020030005:"Санитарно-защитная зона предприятий, сооружений и иных объектов",218020030006:"Санитарный разрыв (санитарная полоса отчуждения)",218020030007:"Зона ограничения от передающего радиотехнического объекта",218020030008:"Район падения отделяющихся частей ракет",21802004e4:"Прочие зоны с особыми условиями использования территории",218020040001:"Зона публичного сервитута",218020040002:"Зона резервирования земель",218020040003:"Горный отвод",218020040004:"Пригородная зона",218020040005:"Зеленая зона",218020040006:"Особая экономическая зона",218020040007:"Пограничная зона",218020040008:"Территория традиционного природопользования",21802005e4:"Иные зоны с особыми условиями использования территории",218020050001:"Иная зона с особыми условиями использования территории"},od="https://pkk.rosreestr.ru/api/features";function ad(e,t){var n={text:"".concat(e,"+").concat(t),limit:40,skip:0,tolerance:8,imPoint:!0},o="".concat(od,"?").concat(Object.entries(n).map((function(e){var t=Object(i["a"])(e,2),n=t[0],o=t[1];return"".concat(n,"=").concat(o)})).join("&"));return fetch(o).then((function(e){if(!e.ok)throw e;return e.json()})).then((function(e){return e.results.filter((function(e){return e.type!==Zc.BORDER})).sort((function(e,t){return e.type===Zc.REALTY?-1:t.type===Zc.REALTY?1:0}))}))}function sd(e){var t="".concat(od,"/").concat(e.type,"/").concat(e.attrs.id);return fetch(t).then((function(e){if(!e.ok)throw e;return e.json()}))}function rd(e){var t=e.type,n=e.attrs;switch(t){case 2:delete n.address;break;case 5:switch(n.oks_name=n.name,n.oks_area_value=n.area_value,delete n.name,delete n.rayon,delete n.area_value,n.oks_type){case"building":n.element_construct_wall=n.element_construct?n.element_construct.wall:"",delete n.height,delete n.volume,delete n.depth;break;case"construction":delete n.proj_app,delete n.floors,delete n.underground_floors,delete n.year_built,delete n.year_used;break;case"incomplete":delete n.floors,delete n.underground_floors,delete n.year_built,delete n.year_used;break}break;case 6:n.subtype=nd[n.subtype],delete n.rayon;break;case 10:n.subtype=id[n.subtype],delete n.rayon;break}return n.type=Yc[e.type],n.area_type&&(n.area_type=ed[n.area_type]),n.oks_type&&(n.oks_type=td[n.oks_type],delete n.area_type),n.statecd&&(n.statecd=Xc[n.statecd]),n.category_type&&(n.category_type=Qc[n.category_type]),e.stat&&Object.entries(e.stat).forEach((function(e){Object.entries(e[1]).forEach((function(t){"dates"===t[0]?n["".concat(e[0],"_").concat(t[0])]=t[1].adate||"":n["".concat(e[0],"_").concat(t[0])]=t[1]}))})),{id:n.id,type:e.type,properties:n,extent:e.extent}}function ld(e){var t=e.bbox,n=e.x,o=e.y,a=e.width,s=e.height,r=e.url,l=e.layers,c=e.version,d=e.format,u=e.token,p=e.info_format,f=void 0===p?"application/json":p,h={service:"WMS",request:"GetFeatureInfo",layers:l,format:d,version:c,width:a,height:s,bbox:t,srs:"EPSG:3857",crs:"EPSG:3857",query_layers:l,info_format:f};"1.3.0"===c?(h.i=n,h.j=o):(h.x=n,h.y=o);var m="?";-1!==r.indexOf("?")&&(m="&");var g="".concat(r).concat(m).concat(Object.entries(h).map((function(e){var t=Object(i["a"])(e,2),n=t[0],o=t[1];return"".concat(n,"=").concat(encodeURIComponent(o))})).join("&")),y=new Headers;return u&&y.set("Authorization","Basic "+u),fetch("".concat("https://proxy.rusgis.com/proxy","?url=").concat(g),{method:"GET",headers:y}).then((function(e){if(!e.ok)throw e;return"application/json"===f?e.json():e.text()}))}var cd=n("ec14");function dd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ud(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dd(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var pd="#072833",fd={components:{GisObjectIDForm:Jc},data:function(){return{objectProperties:null,identificationFeature:null,loadIdentification:!1,objectIdentificationVisible:!1,refinedObjectLayerName:null,clickedFeaturesCount:0,pkkResults:[],arrayProperties:[],rawHtmlProperties:"",decimalCoordinates:"",degreeCoordinates:"",metersCoordinates:"",identificationCoordinates:"",coordinateType:"lngLatDec",identificationPoint:null,isPkkObject:!1}},computed:ud(ud({},Object(d["c"])("config",{getActiveLegendLayerComponentId:Jt["d"],getLayerOptions:Yt["E"],isLayerVisible:Yt["kb"],isLayerHalfVisible:Yt["W"],getMapboxLayerIds:Yt["A"],isScanex:Yt["eb"],getLayerIdByProperty:Jt["q"],getAllLayerIdsByProperty:Jt["f"]})),{},{activeLegendLayerComponentId:function(){return this.getActiveLegendLayerComponentId(this.componentId)},activeLegendLayerOptions:function(){return this.getLayerOptions(this.activeLegendLayerComponentId)},objectId:function(){if(!this.objectProperties)return"";if(this.objectProperties.id)return this.objectProperties.id.toString();var e=Object.entries(this.objectProperties).filter((function(e){return e[0].toLowerCase().includes("id")&&e[1]}));return e.length?e[0][1]:void 0},objectLayerName:function(){return this.refinedObjectLayerName||this.activeLegendLayerOptions.text||""},pkkComponentId:function(){var e=this;return this.getAllLayerIdsByProperty(this.componentId,"text","Публичная кадастровая карта").filter((function(t){return"pkk"===e.getLayerOptions(t).type}))[0]},activeLegendLayerHalfVisible:function(){return this.isLayerHalfVisible(this.activeLegendLayerComponentId)}}),watch:{activeLegendLayerComponentId:function(){this.resetIdentification()},activeLegendLayerHalfVisible:function(){this.activeLegendLayerHalfVisible||this.resetIdentification()},objectProperties:function(){var e=this,t="Публичная кадастровая карта"!==this.activeLegendLayerOptions.text?this.activeLegendLayerComponentId:this.pkkComponentId;if(t&&this.objectProperties||this.isPkkObject){var n=this.isPkkObject?Object(X["c"])("getData",{dataset_code:"GKN.DSPARCELPKK",_config_dataset:"CONNECTIONS.DSDATASET_FIELD"}):this.gisLayerLoadDataFields({layerComponentId:t,gisComponentId:this.componentId});n.then((function(t){Array.isArray(t)&&t.length>0?e.arrayProperties=t.filter((function(e){return e.is_visiblecard})).map((function(t){var n=Object.entries(e.objectProperties).filter((function(e){return t.name===e[0]}));if(!n.length)return null;var i="timestamp without time zone"!==t.fieldtype_name?n[0][1]:new Date(n[0][1]).toLocaleDateString();return{key:t.caption||t.name,value:i}})).filter((function(e){return e})).filter((function(e){return!["the_geom","geojson","id"].includes(e.key)})):e.arrayProperties=Object.entries(e.objectProperties).filter((function(e){return e[1]})).map((function(e){return{key:e[0],value:e[1]}})).filter((function(e){return!["the_geom","geojson","id"].includes(e.key)})).filter((function(e){return Array.isArray(e.value)?e.value.length||0:"string"===typeof e.value?"null"!==e.value.toLowerCase()?e.value.length:0:null!==e.value&&void 0!==e.value}))})),this.isPkkObject=!1}else this.arrayProperties=[]}},methods:ud(ud(ud({},Object(d["d"])("config",{setIdentificationMapboxSourceId:Zt["q"],setIdentificationMapboxSourceLayer:Zt["r"],setIdentificationMapboxGeoJson:Zt["p"],setIdentificationMapboxFeatureId:Zt["o"],clearMapboxIdentification:Zt["c"],setIdentificationPkkObjectId:Zt["s"],setActiveLegendLayerComponentId:Zt["h"]})),Object(d["b"])("config",{loadFeatureData:Xt["s"],gisLayerLoadDataFields:Xt["r"],setLayerVisible:Xt["N"]})),{},{resetIdentification:function(){this.rawHtmlProperties=null,this.identificationFeature=null,this.refinedObjectLayerName=null,this.objectProperties=null,this.objectIdentificationVisible=!1,this.loadIdentification=!1,this.clearIdentificationLayer(),this.clearPkkIdentificationLayer(),this.identificationPoint&&this.identificationPoint.remove()},clearIdentificationLayer:function(){this.clearMapboxIdentification({gisComponentId:this.componentId})},clearPkkIdentificationLayer:function(){this.setIdentificationPkkObjectId({gisComponentId:this.componentId,identificationPkkObjectId:null})},handleLeftArrowClick:function(){this.selectionByClickIndex&&(this.selectionByClickIndex--,this.setPkkFeature())},handleRightArrowClick:function(){this.selectionByClickIndex<this.clickedFeaturesCount-1&&(this.selectionByClickIndex++,this.setPkkFeature())},useIdentificationTool:function(e){var t=this;if(this.clearIdentificationLayer(),this.clickedFeaturesCount=0,this.identificationFeature=null,this.refinedObjectLayerName=null,this.objectProperties=null,this.getCoordinatesOnClick&&this.setIdentificationCoordinates(e.lngLat),this.activeLegendLayerHalfVisible){if("Публичная кадастровая карта"===this.activeLegendLayerOptions.text)return this.selectionByClickIndex=0,void this.usePkkIdentification(e);if(!this.activeLegendLayerOptions.group)switch(e.originalEvent.ctrlKey?this.selectionByClickIndex++:this.selectionByClickIndex=0,this.loadIdentification=!0,this.activeLegendLayerOptions.type){case"geojson":case"vector":case"wfs":this.loadIdentificationFormDataVector(e,this.activeLegendLayerOptions,this.selectionByClickIndex).then((function(e){e&&(t.objectProperties=e[0])})).catch((function(){t.hideObjectIDForm(),Object(Yl["a"])({message:"Ошибка выполнения запроса. Сохраните объект и попробуйте снова",width:"auto"},"error",3e3)})).finally((function(){t.loadIdentification=!1}));break;case"wms":this.activeLegendLayerOptions.dataSetComponentId?this.loadIdentificationFormDataWmsInner(e,this.activeLegendLayerOptions,this.selectionByClickIndex).then((function(e){t.setObjectIdentification({data:e})})):this.loadIdentificationFormDataWmsGeoServer(e,this.activeLegendLayerOptions).then((function(e){if(e){var n=e.data,i=e.rawData;t.setObjectIdentification({data:n,rawData:i})}else t.resetIdentification()}));break;case"pkk":this.loadIdentificationFormDataArcGis(e,this.activeLegendLayerOptions).then((function(e){t.setObjectIdentification({data:e})}))}}},usePkkIdentification:function(e){var t=this;this.loadIdentification=!0,ad(e.lngLat.lat,e.lngLat.lng).then((function(e){if(t.clickedFeaturesCount=e.length,t.clickedFeaturesCount){t.objectIdentificationVisible=!0;var n=e.map((function(e){return sd(e).then((function(e){return e.feature?rd(e.feature):e}))}));return Promise.all(n)}return new Promise((function(e){return e(null)}))})).then((function(e){t.setObjectIdentification({data:e})})).catch((function(){t.hideObjectIDForm(),Object(Yl["a"])({message:"Сервис публичной кадастровой карты недоступен"},"error",3e3)}))},setIdentificationCoordinates:function(e){this.identificationPoint&&this.identificationPoint.remove(),this.identificationPoint=new l.a.Marker({color:pd}).setLngLat(e).addTo(this.mapbox),this.decimalCoordinates=e.lat+" "+e.lng,this.degreeCoordinates=this.convertDDToDMS(e.lat,!1)+" "+this.convertDDToDMS(e.lng,!0);var t=c["point"]([e.lng,e.lat]);this.metersCoordinates=c["toMercator"](t).geometry.coordinates[1]+" "+c["toMercator"](t).geometry.coordinates[0],this.coordinateTypeChanged(this.coordinateType),this.objectIdentificationVisible=!0},coordinateTypeChanged:function(e){switch(this.coordinateType=e,e){case"lngLatDec":this.identificationCoordinates=this.decimalCoordinates;break;case"lngLatDeg":this.identificationCoordinates=this.degreeCoordinates;break;case"meters":this.identificationCoordinates=this.metersCoordinates;break}},convertDDToDMS:function(e,t){var n=0|(e<0?e=-e:e),i=0|e%1*60,o=(0|60*e%1*6e3)/100,a=e<0?t?"з. д.":"ю. ш.":t?"в. д.":"с. ш.";return n+"°"+i+"'"+o+"'' "+a},loadIdentificationFormDataVector:function(e,t,n){var i=this.getLayerFeaturesInPoint(t.layerComponentId,e.point);if(i.length){this.objectIdentificationVisible=!0;var o=t.keyField,a=n%i.length,r=i[a],l=r.id||r.properties[o];this.setIdentificationMapboxSourceId({gisComponentId:this.componentId,identificationMapboxSourceId:r.source}),this.setIdentificationMapboxSourceLayer({gisComponentId:this.componentId,identificationMapboxSourceLayer:r.sourceLayer}),this.setIdentificationMapboxFeatureId({gisComponentId:this.componentId,identificationMapboxFeatureId:l});var c=t.dataSetComponentId,d=t.identifyGeometryProperties;return d||!c||"wfs"===t.type?Promise.resolve(r):this.loadFeatureData(Object(s["a"])({layerComponentId:t.layerComponentId},o,l))}return Promise.resolve(null)},getLayerFeaturesInPoint:function(e,t){var n=[[t.x-this.selectClickTolerance,t.y-this.selectClickTolerance],[t.x+this.selectClickTolerance,t.y+this.selectClickTolerance]];return this.mapbox.queryRenderedFeatures(n,{layers:this.getMapboxLayerIds(e)})},loadIdentificationFormDataWmsInner:function(e,t,n){var i=this,o=ac(e.point,e.lngLat,this.mapbox);return this.loadFeatureData({layerComponentId:t.layerComponentId,geoJson:o,mode:"intersect"}).then((function(e){if(i.setIdentificationMapboxGeoJson({gisComponentId:i.componentId,identificationMapboxGeoJson:e}),e.length){i.objectIdentificationVisible=!0;var t=n%e.length;return e[t]}}))},loadIdentificationFormDataWmsGeoServer:function(e,t){var n=this,i=this.mapbox.getCanvas(),o=t.url||t.wmsUrl||"",a=this.isScanex(t.layerComponentId),s=this.mapbox.getBounds().toArray().map((function(e){return c["toMercator"](c["point"](e)).geometry.coordinates})).toString();return ld({bbox:s,x:e.point.x,y:e.point.y,width:i.offsetWidth,height:i.offsetHeight,url:o,layers:t.layers,version:a?"1.3.0":t.version,format:a?t.format:"application/json",token:t.token||null,info_format:"application/json"}).then((function(e){var t=e;if(a)return n.objectIdentificationVisible=!0,n.setIdentificationMapboxGeoJson({gisComponentId:n.componentId,identificationMapboxGeoJson:t}),{rawData:t};if(e&&e.features.length){n.objectIdentificationVisible=!0;var i=e.features[0];return i.geometry?(t=c["toWgs84"](i),n.setIdentificationMapboxGeoJson({gisComponentId:n.componentId,identificationMapboxGeoJson:t}),{data:t}):Promise.resolve(null)}return Promise.resolve(null)})).catch((function(){n.hideObjectIDForm(),Object(Yl["a"])({message:"Сервис ".concat(o," недоступен")},"warning",3e3)}))},loadIdentificationFormDataArcGis:function(e,t){var n=this,i=t.dpi||96,o=this.mapbox.getCanvas(),a="".concat(o.offsetWidth,",").concat(o.offsetHeight,",").concat(i),s=this.mapbox.getBounds().toArray().map((function(e){return e.join(",")})).join(",");return Object(cd["b"])({layers:t.layers||"",url:t.url,arcGisToken:t.arcGisToken,geometry:"".concat(e.lngLat.lng,",").concat(e.lngLat.lat),mapExtent:s,imageDisplay:a}).then((function(e){return n.setIdentificationMapboxGeoJson({gisComponentId:n.componentId,identificationMapboxGeoJson:e}),n.objectIdentificationVisible=!0,e})).catch((function(){n.hideObjectIDForm(),Object(Yl["a"])({message:"Сервис ".concat(t.url," недоступен")},"warning",3e3)}))},useIdentificationRequestTool:function(e){var t=this;this.getPkkProperties(e).then((function(n){if(t.clickedFeaturesCount=0,t.selectionByClickIndex=0,n)t.setPkkFeatureBySearch(n);else{var i=e.split("/");"1"===i[5]?(i[5]="5",t.getPkkProperties(i.join("/")).then((function(e){e?t.setPkkFeatureBySearch(e):t.hideObjectIDForm()}))):t.hideObjectIDForm()}}))},getPkkProperties:function(e){var t=this;return fetch(e).then((function(e){if(!e.ok)throw e;return e.json()})).then((function(e){if(e.feature)return rd(e.feature)})).catch((function(){t.hideObjectIDForm(),Object(Yl["a"])({message:"Сервис ".concat(e," недоступен")},"error",3e3)}))},setPkkFeatureBySearch:function(e){if(this.identificationCoordinates="",this.identificationPoint&&this.identificationPoint.remove(),e.extent){var t=[c["toWgs84"]([e.extent.xmin,e.extent.ymin]),c["toWgs84"]([e.extent.xmax,e.extent.ymax])];this.mapbox.fitBounds(t,{animate:!1,padding:50})}else Object(Yl["a"])({message:"У объекта недвижимости с кадастровым номером ".concat(e.id,' отсутствуют координаты характерных точек границ (объект "без границ")'),width:"auto"},"warning",3e3);this.loadIdentification=!0,this.isPkkObject=!0,this.objectIdentificationVisible=!0,this.setObjectIdentification({data:[e]})},hideObjectIDForm:function(){this.loadIdentification=!1,this.objectIdentificationVisible=!1,this.identificationPoint&&this.identificationPoint.remove(),this.clearPkkIdentificationLayer()},setObjectIdentification:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t){var n,i,o,a,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.data,i=t.rawData,this.rawHtmlProperties=null,n||i){e.next=5;break}return this.getCoordinatesOnClick?(this.loadIdentification=!1,this.clearIdentificationLayer(),this.clearPkkIdentificationLayer()):this.resetIdentification(),e.abrupt("return");case 5:Array.isArray(n)?(o=[],a=[],n.forEach((function(e,t){if(e.properties.util_code){var n={_config_dataset:"GKN.DSUSECLASSIFIER",classcode:e.properties.util_code};o.push(Object(X["c"])("getData",n)),a.push(t)}})),o.length?Promise.all(o).then((function(e){e.forEach((function(e,t){n[a[t]].properties.util_code=e[0].name})),s.pkkResults=n,s.setPkkFeature()})):(this.pkkResults=n,this.setPkkFeature())):(this.clearPkkIdentificationLayer(),i?this.rawHtmlProperties=i:this.objectProperties=n.properties,this.loadIdentification=!1);case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),setPkkFeature:function(){if(this.clearPkkIdentificationLayer(),this.pkkResults.length){var e=this.pkkResults[this.selectionByClickIndex];this.setIdentificationPkkObjectId({gisComponentId:this.componentId,identificationPkkObjectId:e.id}),this.refinedObjectLayerName=Yc[e.type],this.objectProperties=e.properties}this.loadIdentification=!1}})},hd=n("77223"),md=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-base-map-button",attrs:{title:e.caption}},[e.iconUrl?n("img",{attrs:{src:e.iconUrl}}):n("i",{staticClass:"far fa-map"})])},gd=[],yd={props:{caption:String,iconUrl:String}},vd=yd,bd=(n("c291"),Object(le["a"])(vd,md,gd,!1,null,null,null)),_d=bd.exports,Cd=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-base-map-list"},e._l(e.items,(function(t,i){return n("GisBaseMapListItem",{key:i,attrs:{caption:t.caption,selected:e.getItemSelected(t),iconUrl:t.iconUrl},nativeOn:{click:function(n){return e.handleItemClick(t)}}})})),1)},xd=[],Od=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-base-map-list-item"},[n("div",{staticClass:"gis-base-map-list-item__icon",class:{"gis-base-map-list-item__icon_selected":e.selected}},[e.iconUrl?n("img",{attrs:{src:e.iconUrl}}):n("i",{staticClass:"far fa-map"})]),n("div",{staticClass:"gis-base-map-list-item__caption",class:{"gis-base-map-list-item__caption_selected":e.selected}},[e._v("\n    "+e._s(e.caption)+"\n  ")])])},Id=[],Sd={props:{iconUrl:String,caption:String,selected:{type:Boolean,default:!1}}},Ld=Sd,Dd=(n("7dc9"),Object(le["a"])(Ld,Od,Id,!1,null,null,null)),Pd=Dd.exports,Ed={components:{GisBaseMapListItem:Pd},props:{selectedBaseMapId:String,items:Array},methods:{getItemSelected:function(e){return e.componentId===this.selectedBaseMapId},handleItemClick:function(e){this.$emit("itemClick",e)}}},wd=Ed,Td=(n("d206"),Object(le["a"])(wd,Cd,xd,!1,null,null,null)),jd=Td.exports;function kd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Fd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kd(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Bd=4,Md="Базовая карта: ",Ad="Текстовый слой: ",Rd={BASE_MAP_NAME:Md,TEXT_MAP_NAME:Ad,components:{GisBaseMapButton:_d,GisBaseMapList:jd},data:function(){return{layersListVisible:{baseMapListVisible:!1,baseTextMapListVisible:!1},yandexMap:null,yandexPromise:null}},computed:Fd(Fd({},Object(d["c"])("config",{getBaseMapListItems:Jt["i"],getBaseTextMapListItems:Jt["j"],getActiveBaseMapLayerComponentId:Jt["b"],getActiveBaseTextMapLayerComponentId:Jt["c"]})),{},{baseMapListItems:function(){var e=this.getBaseMapListItems(this.componentId);return e},baseMapTextListItems:function(){return this.getBaseTextMapListItems(this.componentId)},baseMapSelectedComponentId:function(){return this.getActiveBaseMapLayerComponentId(this.componentId)},baseTextMapSelectedComponentId:function(){return this.getActiveBaseTextMapLayerComponentId(this.componentId)},baseMapListSelectedItem:function(){var e=this.baseMapSelectedComponentId;return this.getBaseMapListItems(this.componentId).find((function(t){return t.componentId===e}))||{}},baseTextMapListSelectedItem:function(){var e=this.baseTextMapSelectedComponentId;return this.getBaseTextMapListItems(this.componentId).find((function(t){return t.componentId===e}))||{}},isYandexBaseMap:function(){return this.baseMapListSelectedItem&&this.baseMapListSelectedItem.type&&"yandex"===this.baseMapListSelectedItem.type.split("#")[0]}}),watch:{baseMapListSelectedItem:{handler:function(){this.isYandexBaseMap?this.handleYandexBaseMap(this.baseMapListSelectedItem):(this.yandexMap&&(this.yandexMap.destroy(),this.yandexMap=null),this.mapbox&&this.mapbox.scrollZoom.enable(this)),this.mapbox&&(this.isYandexBaseMap?(this.mapbox.dragRotate.disable(),this.mapbox.touchZoomRotate.disable(),this.mapbox.touchPitch.disable()):(this.mapbox.dragRotate.enable(),this.mapbox.touchPitch.enable(),this.mapbox.touchZoomRotate.enable()))},immediate:!0}},mounted:function(){this.$refs.baseMapList&&this.resizeList(this.$el,this.$refs.baseMapList)},methods:{getBaseMapCaption:function(e,t){return e?e.componentId?t+e.caption:e.caption:""},resizeList:function(e,t){var n=56,i=e.offsetHeight-n;i<t.offsetHeight&&(t.style.height="".concat(i,"px"))},handleBaseMapListItemClick:function(e,t){var n="config/".concat(t?Xa["r"]:Xa["q"]);this.$store.dispatch(n,{gisComponentId:this.componentId,layerComponentId:e.componentId}),this.layersListVisible.baseMapListVisible=!1,this.layersListVisible.baseTextMapListVisible=!1},handleBaseMapButtonClick:function(e,t){var n=this;this.layersListVisible[e]=!this.layersListVisible[e],this.layersListVisible[e]&&this.$nextTick((function(){n.resizeList(n.$el,t)}))},handleYandexBaseMap:function(e){var t=this,n=e.type;if(this.yandexMap?this.yandexMap.setType(n):this.yandexPromise||(this.yandexPromise=hd["a"].load("https://api-maps.yandex.ru/2.1/?lang=ru_RU").then((function(e){var i=[t.mapbox.getCenter().lat,t.mapbox.getCenter().lng],o=t.mapbox.getZoom()+1;t.yandexMap=new e.Map(t.$refs.yandexMap,{center:i,zoom:o,type:n,controls:[]},{avoidFractionalZoom:!1})})).catch((function(e){return window.console.log("Failed to load Yandex Maps",e)})).finally((function(){t.yandexPromise=null}))),this.selectedMouseTool===oo){var i=Math.round(this.mapbox.getZoom())>Bd?Math.round(this.mapbox.getZoom()):Bd;this.mapbox.setZoom(i),this.mapbox.scrollZoom.disable()}}}},Vd=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.visible?n("div",{staticClass:"gis-documents-snapshot"},[n("DxToolbar",{scopedSlots:e._u([{key:"snapshotButtonTemplate",fn:function(){return[n("DxButton",{attrs:{type:"default",text:e.snapshotButtonText,disabled:e.getSnapshotFromPage||e.imageLayersLoading,template:e.imageLayersLoading?"loadIndicatorContent":"content"},on:{click:e.getFileName},scopedSlots:e._u([{key:"loadIndicatorContent",fn:function(){return[n("div",[n("DxLoadIndicator",{staticClass:"gis-documents-snapshot__load-indicator",attrs:{visible:!0}})],1)]},proxy:!0}],null,!1,1103520799)})]},proxy:!0}],null,!1,2709684677)},[n("DxToolbarItem",{attrs:{location:"center",template:"snapshotButtonTemplate"}})],1)],1):e._e()},Gd=[],$d={name:"GisDocumentsSnapshot",components:{DxToolbar:xs["DxToolbar"],DxToolbarItem:xs["DxItem"],DxButton:st.a,DxLoadIndicator:$e.a},data:function(){return{fileName:""}},props:{visible:Boolean,snapshotButtonText:String,imageLayersLoading:{type:Boolean,default:!1},getSnapshotFromPage:{type:Boolean,default:!1}},methods:{getFileName:function(){this.imageLayersLoading||(this.fileName="снимок_от_"+(new Date).toLocaleDateString()+"_"+(new Date).toLocaleTimeString([],{timeStyle:"short"}),this.$emit("apply",this.fileName))}}},Nd=$d,Ud=(n("e3a8"),Object(le["a"])(Nd,Vd,Gd,!1,null,null,null)),zd=Ud.exports,Hd=function e(t){Object(ta["a"])(this,e),Object(s["a"])(this,"id",null),Object(s["a"])(this,"name",""),Object(s["a"])(this,"code",void 0),Object(s["a"])(this,"short",void 0),Object(s["a"])(this,"src",""),Object(s["a"])(this,"iwidth",600),Object(s["a"])(this,"iheight",400),Object(s["a"])(this,"is_layer",!1),this.id=t.id,this.name=t.name,this.code=t.code,this.short=t.short,this.src=t.src,this.iwidth=t.iwidth,this.iheight=t.iheight,this.is_layer=t.is_layer};function Wd(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Kd(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function Kd(e,t){if(e){if("string"===typeof e)return qd(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qd(e,t):void 0}}function qd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Jd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Zd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jd(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Yd=4e4,Xd=722,Qd=4,eu=100,tu=9,nu=3,iu=3,ou=600,au=400,su="report",ru="document",lu="Сделать снимок",cu="Снимок для документа",du="NO_BASE_MAP",uu="CONNECTIONS.DSCALCREP",pu={components:{GisDocumentsSnapshot:zd},data:function(){return{snapshotButtonText:lu,snapshotForDocumentUploadParams:null,horizontalPanelHeight:0,verticalPanelWidth:0,snapshotSize:{width:600,height:400},docName:"",docFileName:"",docId:"",snapshotHref:"",imgGuid:"",reportFeatureProperties:null,reportFeatureLayerComponentId:null,reportImageData:[],selectedReportImageDataIndex:0,reportImageFileGuids:{},getSnapshotFromPage:!1,isXml:!1,imageLayersLoading:!1,reportImageLayerComponentIds:{},savedVisibleLegendLayerComponentIds:[],savedActiveBaseMapLayerComponentId:null,savedActiveBaseTextLayerComponentId:null,savedLayerComponentsId:[],imageLayers:{},reportimageId:0,reportId:0}},computed:Zd(Zd({},Object(d["c"])("config",{getLayerOptions:Yt["E"],getVisibleLayers:Jt["K"],getNoParentVisibleLayers:Jt["y"],getActiveBaseMapLayerComponentId:Jt["b"],getActiveBaseTextMapLayerComponentId:Jt["c"],getDataSetName:Yt["m"]})),{},{showReportUrl:function(){return this.options.showReportUrl||"https://reports.rusgis.com/showReport"},showDesignerUrl:function(){return this.options.showDesignerUrl||"https://reports.rusgis.com/showDesigner"},downloadUrl:function(){return this.options.downloadUrl||"https://files-service.rusgis.com/downloadFile"},uploadUrl:function(){return this.options.uploadUrl||"https://files-service.rusgis.com/uploadFile"},reportzipUrl:function(){return this.options.reportzipUrl||"https://files-service.rusgis.com/apiFiles"}}),methods:Zd(Zd(Zd({},Object(d["b"])("config",{loadFeatureData:Xt["s"],loadLayerComponent:Xa["l"],setLayerVisible:Xt["N"],setLegendLayersVisible:Xa["v"],setLegendNoParentLayersVisible:Xa["w"],setActiveBaseMapLayerComponentId:Xa["q"],setActiveBaseTextLayerComponentId:Xa["r"],gisLayerLoadReportImageLegend:Xt["x"],restoreLayersVisible:Xa["p"]})),Object(d["d"])("config",{setReportLayerComponentId:Zt["D"],setReportFeatureId:Zt["C"],setGisDownloadLink:Zt["k"],setReportCreatingState:Zt["A"]})),{},{useSnapshotForReportTool:function(){var e=this,t=this.getAllSelected(this.componentId),n=Object.keys(t)[0],i=t[n][0],o=this.getLayerOptions(n),a=o.keyField;this.loadFeatureData(Object(s["a"])({layerComponentId:n},a,i)).then((function(t){e.reportFeatureProperties=t[0],e.reportFeatureLayerComponentId=n,e.reportListVisible=!0,e.setReportLayerComponentId({gisComponentId:e.componentId,reportLayerComponentId:n}),e.setReportFeatureId({gisComponentId:e.componentId,reportFeatureId:i})}))},handleSnapshotForReport:function(e,t,n,i,o,a){this.cancelEditing(),this.setMapTool({name:di}),this.snapshotButtonText=lu,this.snapshotMode=su,this.snapshotSize={width:e||ou,height:t||au},this.docName=n,this.docFileName=i,this.docId=o,this.isXml=a,this.getPanels(),this.selectedReportImageDataIndex=0,this.imgGuid="",this.reportImageFileGuids={},this.getSnapshotFromPage=!1,this.reportId=o,this.reportListVisible=!1,this.snapshotVisible=!0,this.imageLayersLoading=!1,this.savedLayerComponentsId=[],this.imageLayers={},this.reportImageLayerComponentIds={},this.loadReportImageData(o),this.savedVisibleLegendLayerComponentIds=this.getVisibleLayers(this.componentId),this.savedActiveBaseMapLayerComponentId=this.getActiveBaseMapLayerComponentId(this.componentId),this.savedActiveBaseTextLayerComponentId=this.getActiveBaseTextMapLayerComponentId(this.componentId),this.calcReportPromise=this.reportCalcRequest()},reportCalcRequest:function(){this.reportImageData=[];var e={_config_dataset:uu,name:this.docFileName,object_id:this.reportFeatureProperties.id,object_guids:[this.reportFeatureProperties.guid],user:this.userId,component_id:this.reportFeatureLayerComponentId,dataset_code:this.getDataSetName(this.reportFeatureLayerComponentId)},t=this.reportFeatureProperties.cnum;return t&&(e.cnum=t),this.calcReportAbortController=new AbortController,Object(X["c"])("getData",e,this.calcReportAbortController)},selectFrameForSnapshot:function(e){var t=this,n=e.file_id,i=e.guid_link,o=e.width,a=e.height,s=e.pos;this.mapboxReady.then((function(){t.cancelEditing(),t.setMapTool({name:di}),t.snapshotButtonText=cu,t.snapshotMode=ru,t.snapshotForDocumentUploadParams={id:n,pos:s,guid_link:i},t.snapshotSize={width:o||ou,height:a||au},t.getPanels(),t.reportListVisible=!1,t.snapshotVisible=!0}))},getPanels:function(){var e=this;setTimeout((function(){var t=e.mapbox.getCanvas(),n=t.offsetHeight,i=t.offsetWidth;e.horizontalPanelHeight=(n-e.snapshotSize.height)/2,e.verticalPanelWidth=(i-e.snapshotSize.width)/2}))},getResizedCanvas:function(e,t,n){var i=this.mapbox.getCanvas(),o=document.createElement("canvas"),a=document.createElement("canvas");o.width=i.width,o.height=i.height,a.width=i.width,a.height=i.height;var s=0,r=0,l=i.width,c=i.height;this.snapshotVisible&&(o.width=t.width,o.height=t.height,l=t.width*i.width/i.offsetWidth,c=t.height*i.height/i.offsetHeight,s=(i.width-l)/2,r=(i.height-c)/2,i.offsetHeight<t.height&&(c=i.height,r=0),i.offsetWidth<t.width&&(l=i.width,s=0));var d=this.snapshotVisible?t.width:i.width,u=this.snapshotVisible?t.height:i.height;n&&(s=n.startPos.x<n.lastPos.x?n.startPos.x*i.width/i.offsetWidth:n.lastPos.x*i.width/i.offsetWidth,r=n.startPos.y<n.lastPos.y?n.startPos.y*i.height/i.offsetHeight:n.lastPos.y*i.height/i.offsetHeight,l=Math.abs(n.lastPos.x-n.startPos.x)*i.width/i.offsetWidth,d=Math.abs(n.lastPos.x-n.startPos.x)*i.width/i.offsetWidth,c=Math.abs(n.lastPos.y-n.startPos.y)*i.height/i.offsetHeight,u=Math.abs(n.lastPos.y-n.startPos.y)*i.height/i.offsetHeight,o.width=Math.abs(n.lastPos.x-n.startPos.x)*i.width/i.offsetWidth,o.height=Math.abs(n.lastPos.y-n.startPos.y)*i.height/i.offsetHeight);var p=o.getContext("2d");p.fillStyle="#fff",p.fillRect(0,0,o.width,o.height);var f=a.getContext("2d");if(e.length===tu){for(var h=i.width/iu,m=i.height/nu+eu+24,g=0;g<tu/3;++g)for(var y=0;y<tu/3;++y)f.drawImage(e[3*g+y],y*i.width/iu,g*i.height/nu,h,m);p.drawImage(a,s,r,l,c,0,0,d,u)}return p.drawImage(i,s,r,l,c,0,0,d,u),o},getYandexTiles:function(){var e=this.mapbox.getCanvas(),t=[],n=Math.round(this.yandexMap.getZoom()),i=this.baseMapListSelectedItem.type.split("#")[1].slice(0,3),o=e.offsetWidth,a=e.offsetHeight,s=this.yandexMap.getCenter()[0],r=this.yandexMap.getCenter()[1],l=this.yandexMap.getBounds()[0][1],c=this.yandexMap.getBounds()[1][1];l>0&&c<0&&(c=360+c);var d=(this.yandexMap.getBounds()[1][0]-this.yandexMap.getBounds()[0][0])/e.offsetHeight,u=(c-l)/e.offsetWidth,p=(Yd-(100+80*Math.pow(a/Xd,2))*(Xd-a))/Math.pow(n,5),f=(2*Yd-150*(Xd-a))/Math.pow(n,5),h=a/nu+eu,m=a/nu-eu/2-p,g=a/nu+eu/2+f,y=s-d*eu/2,v=r-u*o/iu,b=s+d*m,_=r+u*o/iu,C=s-d*g,x=Math.floor(o/iu),O=Math.floor(h);v>180&&(v-=360),_>180&&(_-=360),v<-180&&(v+=360),_<-180&&(_+=360);var I="".concat(x,",").concat(O),S=[];S.push("".concat(v,",").concat(b)),S.push("".concat(r,",").concat(b)),S.push("".concat(_,",").concat(b)),S.push("".concat(v,",").concat(y)),S.push("".concat(r,",").concat(y)),S.push("".concat(_,",").concat(y)),S.push("".concat(v,",").concat(C)),S.push("".concat(r,",").concat(C)),S.push("".concat(_,",").concat(C));for(var L=0;L<tu;++L)t.push(new Image),t[L].crossOrigin="Anonymous",t[L].src="https://static-maps.yandex.ru/1.x/?lang=ru_RU&ll=".concat(S[L],"&size=").concat(I,"&z=").concat(n,"&l=").concat(i);return t},loadReportImageData:function(e){var t=this;this.reportImageData=[];var n={_config_dataset:"CONFIG.DSREPORTIMAGE",report_id:e};return Object(X["c"])("getData",n).then((function(e){Array.isArray(e)&&(t.reportImageData=e.map((function(e){return new Hd(e)})),t.reportImageData.length>0&&t.applySelectedReportImageData())}))},applySelectedReportImageData:function(){var e=this.reportImageData[this.selectedReportImageDataIndex]||{};switch(e.code){case"GIS":e.is_layer?this.useGisReportImage(e):this.restoreLayersVisibility(),this.getSnapshotFromPage=!1,this.setSnapshotSize();break;case"PAGE":this.usePageReportImage();break}},useGisReportImage:function(e){e.is_layer?this.loadReportImageLayerComponentIds(e.id):this.restoreLayersVisibility(),this.getSnapshotFromPage=!1,this.setSnapshotSize()},usePageReportImage:function(){this.reportFeatureProperties&&this.reportFeatureProperties.guid||(this.selectedReportImageDataIndex++,this.applySelectedReportImageData()),this.getSnapshotFromPage=!0},loadReportImageLayerComponentIds:function(e){var t=this;this.imageLayersLoading=!0;var n={_config_dataset:"CONFIG.DSREPORTIMAGELAYER",reportimage_id:e};return Object(X["c"])("getData",n).then((function(e){Array.isArray(e)&&e.length>0?t.setLegendLayersVisible({componentId:t.componentId,legendLayersVisible:!1}).then((function(){return t.setLegendNoParentLayersVisible({componentId:t.componentId,legendLayersVisible:!1})})).then((function(){t.setLayersVisibleState(e)})):t.restoreLayersVisibility()})).catch((function(){t.restoreLayersVisibility()})).finally((function(){t.imageLayersLoading=!1}))},setLayersVisibleState:function(e){var t=this;e&&(e.forEach((function(e){var n=e.component_id.toString();t.loadLayerComponent({gisComponentId:t.componentId,layerComponentId:n}).then((function(e){if(e){var i=t.getLayerOptions(n),o=i.baseMap,a=i.baseTextMap;o?t.setActiveBaseMapLayerComponentId({gisComponentId:t.componentId,layerComponentId:n}):a?t.setActiveBaseTextLayerComponentId({gisComponentId:t.componentId,layerComponentId:n}):t.setLayerVisible({componentId:n,visible:!0})}}))})),this.imageLayersLoading=!1)},restoreLayersVisibility:function(){this.restoreLayersVisible({componentId:this.componentId,layerComponentIds:this.savedVisibleLegendLayerComponentIds}),this.setActiveBaseMapLayerComponentId({gisComponentId:this.componentId,layerComponentId:this.savedActiveBaseMapLayerComponentId}),this.setActiveBaseTextLayerComponentId({gisComponentId:this.componentId,layerComponentId:this.savedActiveBaseTextLayerComponentId})},setSnapshotSize:function(){this.snapshotSize.width=this.reportImageData[this.selectedReportImageDataIndex].iwidth||ou,this.snapshotSize.height=this.reportImageData[this.selectedReportImageDataIndex].iheight||au,this.getPanels()},changeSelectedReportImage:function(e){this.selectedReportImageDataIndex=e,this.applySelectedReportImageData()},hidePopupSelectSnapshot:function(){this.getSnapshotFromPage=!1,this.moveToEmptyReportImage()},featureImageListApplyClick:function(e){if(Array.isArray(this.reportImageData)){var t=this.reportImageData[this.selectedReportImageDataIndex];if(t){t.src="".concat(this.downloadUrl,"?guid=").concat(e,"&_config_dataset=PAGES.DSPAGE");var n=t.short;n&&(this.reportImageFileGuids[n]=e),this.moveToEmptyReportImage()}}},createSnapshotButtonClick:function(e){var t=this;if(this.imageLayersLoading=!0,this.reportImageData[this.selectedReportImageDataIndex]&&"PAGE"===this.reportImageData[this.selectedReportImageDataIndex].code)return Object(Us["a"])("Пожалуйста выберите изображение из снимков для отчета.","Не выбран снимок"),void(this.imageLayersLoading=!1);var n=[];if(this.snapshotHref="",this.yandexMap){n=this.getYandexTiles();var i=0;n.forEach((function(o){o.onload=function(){i++,i===tu&&t.createSnapshot(n,e)}}))}else this.createSnapshot(n,e)},createSnapshot:function(e,t){var n=this,i=new Promise((function(t){n.getResizedCanvas(e,n.snapshotSize).toBlob((function(e){t(e)}),"image/png")})),o=null,s=null;Array.isArray(this.reportImageData)&&this.reportImageData[this.selectedReportImageDataIndex]&&(s=this.reportImageData[this.selectedReportImageDataIndex],o=s.short,this.saveLayerComponentIdForReportImage(o)),i.then((function(e){return n.uploadSnapshotFile(t,e,n.createSnapshotUploadParams())})).then((function(e){var t="".concat(n.downloadUrl,"?guid=").concat(e.guid,"&_config_dataset=PAGES.DSPAGE");switch(n.snapshotMode){case su:s.src=t,o&&(n.reportImageFileGuids[o]=e.guid),n.moveToEmptyReportImage(),n.imageLayers[s.id]=[];var i=n.getVisibleLayers(n.componentId),r=n.getNoParentVisibleLayers(n.componentId);[].concat(Object(a["a"])(i),Object(a["a"])(r)).forEach((function(t){"tmpLayer"!==t&&n.gisLayerLoadReportImageLegend({layerComponentId:t,reportImageGuid:e.guid,reportImageId:s.id}).then((function(e){(e||[]).forEach((function(e){n.imageLayers[s.id].push(e)}))}))}));break;case ru:n.callEventAction(n.componentId,"onSnapshotSaved",e);break}})).catch((function(e){window.console.error(e)})).finally((function(){return n.imageLayersLoading=!1}))},makeSnapshots:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t,n){var i,o,a,s,r,l,c,d=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i={},t.mainLayerComponentId&&(this.setLayerVisible({componentId:t.mainLayerComponentId,visible:!0}),this.setLayerSelectedIds({layerComponentId:t.mainLayerComponentId,ids:[t.featureId]})),o=Wd(t.snapshots),e.prev=3,o.s();case 5:if((a=o.n()).done){e.next=11;break}return s=a.value,e.next=9,this.makeSnapshot(t.layerComponentIds,s,i);case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](3),o.e(e.t0);case 16:return e.prev=16,o.f(),e.finish(16);case 19:return r=Object.keys(this.imageLayers),e.next=22,this.createReportImageLegendHeader(t.reportId).then((function(e){return d.createReportImageLegend(e,r)}));case 22:return n.guids=i,l=Zd(Zd({id:t.reportId},n),{},{_config_dataset:"CONNECTIONS.DSREPORT"}),e.next=26,Object(X["c"])("updateData",l);case 26:c=JSON.stringify(i,null,2),document.body.innerHTML='<div id="resultguid">['.concat(c,"]</div>");case 28:case"end":return e.stop()}}),e,this,[[3,13,16,19]])})));function t(t,n){return e.apply(this,arguments)}return t}(),makeSnapshot:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t,n,i){var o,a,s,r,l,c,d,u,p,f,h=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:o=n.imag_id,a=Wd(t);try{for(a.s();!(s=a.n()).done;)r=s.value,this.isValidLayer(r)&&this.setLayerVisible({componentId:r,visible:!1})}catch(m){a.e(m)}finally{a.f()}if(n.c){l=Wd(n.c);try{for(l.s();!(c=l.n()).done;)d=c.value,this.isValidLayer(d)&&this.setLayerVisible({componentId:d,visible:!0})}catch(m){l.e(m)}finally{l.f()}}return u=this.calculateExtent(n.e,n.wh),this.mapbox.fitBounds(u),this.snapshotVisible=!0,p={width:n.wh[0],height:n.wh[1]},e.next=10,this.makeSnapshotOnIdle(o,p);case 10:f=e.sent,f&&(i[o]=f),this.imageLayers[o]=[],n.c.forEach((function(e){h.gisLayerLoadReportImageLegend({layerComponentId:e,reportImageGuid:f,reportImageId:o}).then((function(e){(e||[]).forEach((function(e){h.imageLayers[o].push(e)}))}))}));case 14:case"end":return e.stop()}}),e,this)})));function t(t,n,i){return e.apply(this,arguments)}return t}(),calculateExtent:function(e,t){var n=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2],i=this.mapbox.getContainer(),o=i.offsetWidth,a=i.offsetHeight,s=o/t[0]*(e[1][0]-e[0][0]),r=a/t[1]*(e[1][1]-e[0][1]),l=[[n[0]-s/2,n[1]-r/2],[n[0]+s/2,n[1]+r/2]];return l},isValidLayer:function(e){var t=this.getLayerOptions(e),n=!!t.legendStyleItems;return n||window.console.error("Компонент ".concat(e," не является слоем")),n},getSnapshotsLayersIds:function(e){var t,n={},i=Wd(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;if(o.c){var a,s=Wd(o.c);try{for(s.s();!(a=s.n()).done;){var r=a.value;n[r]||(n[r]=r)}}catch(l){s.e(l)}finally{s.f()}}}}catch(l){i.e(l)}finally{i.f()}return Object.values(n)},makeSnapshotOnIdle:function(e,t){var n=this;return new Promise((function(i){n.onIdle=function(){setTimeout((function(){n.saveSnapshotToServer("snapshot",e,t).then((function(e){i(e.guid)})),n.onIdle=null}),500)}}))},saveSnapshotToServer:function(e,t,n){var i=this,o=[],a=new Promise((function(e){var t=i.getResizedCanvas(o,n);t.toBlob((function(t){e(t)}),"image/png")}));return a.then((function(t){return i.uploadSnapshotFile(e,t,i.createSnapshotUploadParams())}))},createSnapshotUploadParams:function(){var e=null;switch(this.snapshotMode){case su:Array.isArray(this.reportImageData)&&this.reportImageData[this.selectedReportImageDataIndex]?e={guid_link:this.reportImageData[this.selectedReportImageDataIndex].short}:e.guid_link="SnapshotForReport";break;case ru:e=this.snapshotForDocumentUploadParams;break}return e},saveLayerComponentIdForReportImage:function(e){var t=this.getVisibleLayers(this.componentId),n=this.getNoParentVisibleLayers(this.componentId),i=this.getActiveBaseMapLayerComponentId(this.componentId),o=this.getActiveBaseTextMapLayerComponentId(this.componentId);this.reportImageLayerComponentIds[e]=[].concat(Object(a["a"])(t),Object(a["a"])(n)),i&&i!==du&&this.reportImageLayerComponentIds[e].push(i),o&&o!==du&&this.reportImageLayerComponentIds[e].push(o)},moveToEmptyReportImage:function(){var e=this.reportImageData.findIndex((function(e){return!e.src}));e>-1&&e!==this.selectedReportImageDataIndex&&this.changeSelectedReportImage(e)},reportImagePanelApplyClick:function(){var e=this;this.setReportCreatingState({gisComponentId:this.componentId,reportCreatingState:!0});var t=Object.keys(this.imageLayers),n=null;this.calcReportPromise.then((function(e){e&&e[0]&&(n=e[0].r_report_id)})).finally((function(){t.length>0?e.createReportImageLegendHeader(e.reportId).then((function(n){return e.createReportImageLegend(n,t)})).then((function(t){e.openReport(n,t)})).catch((function(){e.openReport(n)})):e.openReport(n)}))},createReportImageLegendHeader:function(e){var t={_config_dataset:"CONFIG.DSREPORTIMAGELEGENDHEADER",report_id:e,_config_user_id:this.userId,state_id:null,ac_ids:null,act_ids:null};return Object(X["c"])("insertData",t).then((function(e){if(Array.isArray(e)&&e.length>0)return e[0].id;throw"Не удалось создать CONFIG.DSREPORTIMAGELEGENDHEADER"}))},createReportImageLegend:function(e,t){var n=this,i=[];return t.forEach((function(t){n.imageLayers[t].forEach((function(t){i.push(Zd(Zd({},t),{},{reportimagelegendheader_id:e,_config_user_id:n.userId,_config_dataset:"CONFIG.DSREPORTIMAGELEGEND"}))}))})),Object(X["c"])("insertData",i).then((function(){return e}))},openReport:function(e,t){var n=this,i=Zd(Zd({report_id:e,legend_id:t||null,name:this.docFileName},this.reportImageFileGuids),{},{guids:this.reportImageFileGuids,layerIds:this.reportImageLayerComponentIds,object_id:this.reportFeatureProperties.id,object_guids:[this.reportFeatureProperties.guid],user:this.userId,component_id:this.reportFeatureLayerComponentId,dataset_code:this.getDataSetName(this.reportFeatureLayerComponentId)}),o=this.reportFeatureProperties.cnum;o&&(i.cnum=o);var a=Zd({_config_dataset:"CONNECTIONS.DSREPORT"},i);Object(X["c"])("insertData",a).then((function(){if(n.isXml&&o){var t=Object(Y["c"])({paramName:"params",_config_url:n.showReportUrl,name:n.docFileName,report_id:e});Object(X["b"])(n.reportzipUrl,null,{params:encodeURIComponent(o),url:t},"REPORTZIP").then((function(e){n.setGisDownloadLink({gisComponentId:n.componentId,downloadLink:encodeURI("".concat(n.downloadUrl,"?guid=").concat(e.guid,"&_config_dataset=").concat(e._config_dataset,"&random=").concat((new Date).getTime()))})}))}n.setReportCreatingState({gisComponentId:n.componentId,reportCreatingState:!1}),n.showReport(Zd({_config_url:n.showReportUrl,name:n.docFileName},i)).then((function(e){window.console.log(e)}))}))},uploadSnapshotFile:function(e,t,n){var i=new FormData;i.append("files[]",new File([t],e+".jpeg"));var o=Zd({_config_dataset:"PAGE.DSPAGE",_config_user_id:this.userId,name:e,extension:"jpeg"},n);return i.append("param",JSON.stringify(o)),fetch(this.uploadUrl,{method:"POST",body:i}).then((function(e){return e.json()}))},getMapSnapshot:function(e){var t=this,n=document.createElement("a");document.body.appendChild(n),n.style.display="none",n.download="снимок_от_"+(new Date).toLocaleDateString()+"_"+(new Date).toLocaleTimeString([],{timeStyle:"short"})+".jpg";var i=[];if(this.yandexMap){if(!e){var o=Math.round(this.mapbox.getZoom())>Qd?Math.round(this.mapbox.getZoom()):Qd;this.mapbox.setZoom(o)}this.$nextTick((function(){i=t.getYandexTiles();var o=0;i.forEach((function(a){a.onload=function(){o++,o===tu&&(n.href=t.getResizedCanvas(i,t.snapshotSize,e).toDataURL("image/jpg"),n.click(),window.URL.revokeObjectURL(t.getResizedCanvas(i,t.snapshotSize,e).toDataURL("image/jpg")))}}))}))}else n.href=this.getResizedCanvas(i,this.snapshotSize,e).toDataURL("image/jpg"),n.click(),window.URL.revokeObjectURL(this.getResizedCanvas(i,this.snapshotSize,e).toDataURL("image/jpg"));document.body.removeChild(n)},hideReportList:function(){this.reportListVisible=!1,this.reportFeatureProperties=null,this.reportFeatureLayerComponentId=null,this.setReportLayerComponentId({gisComponentId:this.componentId,reportLayerComponentId:null}),this.setReportFeatureId({gisComponentId:this.componentId,reportFeatureId:null})},hideDocumentsSnapshot:function(){this.getSnapshotFromPage=!1,this.snapshotVisible=!1,this.reportFeatureProperties=null,this.reportFeatureLayerComponentId=null,this.restoreLayersVisibility(),this.setReportLayerComponentId({gisComponentId:this.componentId,reportLayerComponentId:null}),this.setReportFeatureId({gisComponentId:this.componentId,reportFeatureId:null}),this.calcReportAbortController&&this.calcReportAbortController.abort()}}),created:function(){window.addEventListener("resize",this.getPanels)},destroyed:function(){window.removeEventListener("resize",this.getPanels)}},fu=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-scale-panel"},[n("div",{staticClass:"gis-scale-panel__scale",on:{click:e.handleScaleClick}},[e._v("\n    "+e._s(e.scale)+"\n  ")]),n("i",{staticClass:"fas fa-circle"}),n("div",[e._v(e._s(e.coordinates))]),n("GisCopyright",{attrs:{gisComponentId:e.gisComponentId}})],1)},hu=[],mu=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.allVisibleLayersCopyright.length||e.baseMapSelectedCopyright?n("div",{staticClass:"copyright",attrs:{id:"copyrightBlock"},on:{click:e.toggleBlockVisible}},[n("i",{staticClass:"core core-information"}),n("DxPopover",{attrs:{visible:e.blockVisible,width:200,position:"top",target:"#copyrightBlock"}},[n("div",{staticClass:"copyright__list"},[e.baseMapSelectedCopyright?n("div",{staticClass:"copyright__link",domProps:{innerHTML:e._s(e.baseMapSelectedCopyright.toString())}}):e._e(),e._l(e.allVisibleLayersCopyright,(function(t){return n("div",{staticClass:"copyright__link",domProps:{innerHTML:e._s(t.toString())}})}))],2)])],1):e._e()},gu=[],yu=n("adbc"),vu=n.n(yu);function bu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bu(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Cu={name:"GisCopyright",components:{DxPopover:vu.a},data:function(){return{blockVisible:!1}},props:{gisComponentId:String},computed:_u(_u({},Object(d["c"])("config",{getActiveBaseMapLayerComponentId:Jt["b"],getOptions:Jt["z"],getVisibleLayers:Jt["K"]})),{},{baseMapSelectedComponentId:function(){return this.getActiveBaseMapLayerComponentId(this.gisComponentId)},baseMapSelectedCopyright:function(){return this.getOptions(this.baseMapSelectedComponentId).copyright},allVisibleLayers:function(){return this.getVisibleLayers(this.gisComponentId)},allVisibleLayersCopyright:function(){var e=this,t=[];return this.allVisibleLayers.forEach((function(n){e.getOptions(n).copyright&&t.push(e.getOptions(n).copyright)})),t}}),methods:{toggleBlockVisible:function(){this.blockVisible=!this.blockVisible}}},xu=Cu,Ou=(n("4173"),Object(le["a"])(xu,mu,gu,!1,null,null,null)),Iu=Ou.exports,Su={name:"MapScalePanel",components:{GisCopyright:Iu},props:{scale:{type:String,default:"1:1"},coordinates:{type:String,default:"0, 0"},gisComponentId:String},methods:{handleScaleClick:function(){this.$emit("scaleClick")}}},Lu=Su,Du=(n("9df88"),Object(le["a"])(Lu,fu,hu,!1,null,null,null)),Pu=Du.exports,Eu=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-scale-list"},[n("div",{staticClass:"gis-scale-list__text-box"},[n("DxNumberBox",{attrs:{placeholder:"Задать масштаб...",value:e.value,minValue:100},on:{valueChanged:e.handleValueChanged}})],1),e._l(e.items,(function(t,i){return n("GisScaleListItem",{key:i,attrs:{text:"1:"+t},nativeOn:{click:function(n){return e.handleItemClick(t)}}})}))],2)},wu=[],Tu=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-scale-list-tem"},[e._v("\n  "+e._s(e.text)+"\n")])},ju=[],ku={props:{text:String}},Fu=ku,Bu=(n("c1d2"),Object(le["a"])(Fu,Tu,ju,!1,null,null,null)),Mu=Bu.exports,Au={components:{DxNumberBox:pt.a,GisScaleListItem:Mu},props:{value:Number},data:function(){return{items:[500,1e3,2500,5e3,1e4,25e3,5e4,1e5,25e4,5e5,1e6]}},methods:{handleItemClick:function(e){this.$emit("itemClick",e)},handleValueChanged:function(e){var t=e.value;this.$emit("valueChanged",t)}}},Ru=Au,Vu=(n("74eb"),Object(le["a"])(Ru,Eu,wu,!1,null,null,null)),Gu=Vu.exports,$u=39.3701,Nu=96,Uu=99,zu={components:{GisScalePanel:Pu,GisScaleList:Gu},data:function(){var e=this;return{extentStory:[],extentNumber:-1,mapScale:"",scaleValue:0,setScaleFromList:!1,scaleListVisible:!1,mouseLngLat:{lng:0,lat:0},debounceFunc:Object(Y["a"])(200,(function(t){e.mouseLngLat=t}))}},computed:{scale:function(){return"Масштаб 1:".concat(this.mapScale.toLocaleString())},coordinates:function(){return"".concat(this.mouseLngLat.lat.toFixed(6),", ").concat(this.mouseLngLat.lng.toFixed(6))},moveNextExtentDisabled:function(){return this.extentNumber===this.extentStory.length-1},movePrevExtentDisabled:function(){return 0===this.extentNumber}},methods:{refreshScaleValues:function(){this.mapScale=this.getMapScale(),this.scaleValue=this.mapScale},getMapScale:function(){var e=this.mapbox.getBounds(),t=this.mapbox.getCanvas(),n={width:t.offsetWidth,height:t.offsetHeight},i=e.getNorthEast(),o=e.getNorthWest(),a=i.distanceTo(o);return Math.floor(Math.abs(a)/n.width*$u*Nu)},changeScale:function(e){var t=this.mapbox.getCanvas(),n={width:t.offsetWidth,height:t.offsetHeight},i=e*n.width/($u*Nu),o=e*n.height/($u*Nu),a=Math.min(o,i),s=this.mapbox.getCenter(),r=s.toBounds(a/2);this.blockScaleTextChange=!0,this.mapbox.fitBounds(r,{animate:!1}),this.blockScaleTextChange=!1},handleScaleListItemClick:function(e){this.scaleValue=e},handleScaleListValueChanged:function(e){e&&e!==this.mapScale&&(this.scaleListVisible=!1,this.setScaleFromList=!0,this.scaleValue=e,this.mapScale=e,this.changeScale(e))},setMouseLngLatDebounce:function(e){this.debounceFunc(e)},moveToSelectedObjects:function(){var e=c["featureCollection"](this.allLayersSelectedFeatures),t=c["bbox"](e);this.mapbox.fitBounds(t,{animate:!1,padding:50})},moveToNextExtent:function(){this.extentNumber++,this.moveToExtent()},moveToPreviousExtent:function(){--this.extentNumber,this.moveToExtent()},moveToExtent:function(){var e=this.extentStory[this.extentNumber],t=e.extentString;if(t){var n=JSON.parse(t);this.mapbox.fitBounds(n,{animate:!1},{fitBoundsExtentStory:!0}),e.mapScale&&(this.scaleValue=e.mapScale,this.mapScale=e.mapScale)}},moveMapToUserPosition:function(){var e=this;navigator.geolocation.getCurrentPosition((function(t){var n=t.coords?t.coords.longitude:"",i=t.coords?t.coords.latitude:"";n&&i?e.mapbox.setCenter([n,i]):window.console.warn("Некорректное определение координат. Долгота: ".concat(n,", широта: ").concat(i,"."))}),(function(e){window.console.warn("ERROR(".concat(e.code,"): ").concat(e.message))}))},saveBoundsToLocalStorage:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.saveToLocalStorageTimeoutId&&(clearTimeout(this.saveToLocalStorageTimeoutId),this.saveToLocalStorageTimeoutId=null),this.saveToLocalStorageTimeoutId=setTimeout((function(){if(e.options.mapGroupName){var n=e.mapbox.getBounds(),i=n.toArray(),o=JSON.stringify(i),a=e.extentStory[e.extentNumber]||{};if(t&&localStorage.setItem(e.options.mapGroupName,o),o&&o!==a.extentString){e.extentStory.length=e.extentNumber+1,e.extentStory.length>Uu&&e.extentStory.shift();var s=null;(e.setScaleFromList||a.mapScale===e.mapScale)&&(s=e.mapScale),e.extentStory.push({extentString:o,mapScale:s}),e.setScaleFromList=!1,e.extentNumber=e.extentStory.length-1}}}),500)},fitBoundsInitial:function(e){var t=this;this.options.mapGroupName&&setTimeout((function(){var n=localStorage.getItem(t.options.mapGroupName);e?t.fitBoundsFromLocalStorage(e):n?t.fitBoundsFromLocalStorage(n):t.fitBoundsByUserData()}),200)},fitBoundsFromLocalStorage:function(e){var t="string"===typeof e?JSON.parse(e):e;this.mapbox.fitBounds(t,{animate:!1},{fitBoundsFromLocalStorage:!0})},fitBoundsByUserData:function(){var e=this,t={_config_dataset:"BASE.PRGETBOUNDBYUSERID"};Object(X["c"])("getData",t).then((function(t){if(t.length&&t[0].bbox){var n=t[0].bbox.split("(")[1].split(")")[0].split(","),i=n.map((function(e){return c["toWgs84"](c["point"](e.split(" "))).geometry.coordinates}));e.mapbox.fitBounds(i,{animate:!1},{fitBoundsFromLocalStorage:!0})}}))}}},Hu={data:function(){return{currentMeasurePopup:null,currentDistance:0,currentArea:0,isMeasuring:!1}},methods:{initMeasurePopups:function(){this.currentMeasurePopup=new l.a.Popup({className:"gis__tooltip hidden",closeButton:!1,closeOnClick:!1,anchor:"bottom-left",offset:[20,-20]}).setLngLat(this.mouseLngLat).setHTML("<div>м</div>").addTo(this.mapbox)},toggleMeasureDistanceTooltip:function(){var e=this.mapboxDraw.getAll(),t=e.features;this.isMeasuring,1===t.length&&(this.isMeasuring=!0),t.length>1&&t[1].geometry.coordinates.length&&(this.mapboxDraw.delete(t[0].id),this.currentMeasurePopup.addClassName("hidden"),this.isMeasuring=!0)},handleMeasuringDistance:function(e){var t=this.mapboxDraw.getAll(),n=t.features,i=n[0].geometry.coordinates;if(i.length>1){var o=c["lineString"](i);this.currentDistance=c["length"](o,{units:"meters"}).toFixed(2),this.currentMeasurePopup.removeClassName("hidden"),this.currentMeasurePopup.setLngLat(e),this.currentMeasurePopup.setHTML("<div>".concat(this.currentDistance," м</div>"))}else this.currentMeasurePopup.addClassName("hidden"),this.currentDistance=0},handleMeasured:function(){this.isMeasuring=!1},toggleMeasureAreaTooltip:function(){var e=this.mapboxDraw.getAll(),t=e.features;this.isMeasuring,t[0].geometry.coordinates[0].length<3?this.isMeasuring=!1:(1===t.length&&4===t[0].geometry.coordinates[0].length&&(this.isMeasuring=!0),t.length>1&&3===t[1].geometry.coordinates[0].length&&(this.mapboxDraw.delete(t[0].id),this.currentMeasurePopup.addClassName("hidden")))},handleMeasuringArea:function(e){var t=this.mapboxDraw.getAll(),n=t.features,i=n.length?n[0].geometry.coordinates:[];if(i.length&&i[0].length>3){var o=c["polygon"](i);this.currentArea=c["area"](o).toFixed(2),this.currentMeasurePopup.removeClassName("hidden"),this.currentMeasurePopup.setLngLat(e);var a="",s=1e6,r=1e3;a=this.currentArea<s?this.formatThousands(Math.floor(this.currentArea))+" кв. м":this.formatThousands(Math.floor(this.currentArea/s*r)/r)+" кв. км",this.currentMeasurePopup.setHTML("<div>".concat(a,"</div>"))}else this.currentMeasurePopup.addClassName("hidden"),this.currentArea=0},hideMeasurePopup:function(){this.currentMeasurePopup.addClassName("hidden")},formatThousands:function(e){return e.toLocaleString("ge").replace(",",".")}}},Wu=n("499e"),Ku=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-tmp-layer-panel"},[n("div",{staticClass:"gis-tmp-layer-panel__head",class:{"gis-tmp-layer-panel__head_selected":e.selected},on:{click:e.$listeners.headClick}},[e._m(0),n("div",{staticClass:"gis-tmp-layer-panel__head-text"},[e._v("\n      Косметический слой\n    ")]),n("div",{staticClass:"gis-legend-item-alternative__buttons"},[n("GisLegendItemButton",{attrs:{text:e.edit?"Отключить редактирование косметического слоя":"Включить редактирование косметического слоя",active:e.edit,iconCss:"core core-083-edit"},on:{activeChanged:e.handleTmpLayerEdit}}),n("GisLegendItemButton",{attrs:{active:e.visible,text:e.visible?"Скрыть косметический слой":"Показать косметический слой",iconCss:"core core-081-no-visible",activeIconCss:"core core-082-visible"},on:{activeChanged:e.visibleButtonActiveChanged}}),n("GisLegendItemButton",{ref:"buttonPanelButton",attrs:{active:e.buttonPanelVisible,text:e.buttonPanelVisible?"Скрыть панель дополнительных инструментов":"Показать панель дополнительных инструментов",iconCss:"core core-074-3dots"},on:{activeChanged:function(t){e.buttonPanelVisible=t}}}),n("DxPopover",{ref:"buttonPanelPopover",attrs:{visible:e.buttonPanelVisible,position:"right",closeOnOutsideClick:!0,container:e.popoverContainer},on:{hidden:function(t){e.buttonPanelVisible=!1},disposing:function(t){e.buttonPanelVisible=!1}}},[n("GisTmpLayerButtonPanel",{attrs:{gisComponentId:e.gisComponentId,popoverContainer:e.popoverContainer},on:{fitToTmpLayer:e.$listeners.fitToTmpLayer,openTmpStyles:e.openTmpStyles}})],1)],1)]),e.tmpLayerData&&e.tmpLayerData[0]?n("GisTmpLayerList",{staticClass:"gis-tmp-layer-panel__list",attrs:{tmpLayerData:e.tmpLayerData},on:{itemClick:e.$listeners.itemClick,itemDeleteClick:e.$listeners.itemDeleteClick}}):e._e()],1)},qu=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-tmp-layer-panel__head-icon"},[n("div",{staticClass:"gis-tmp-layer-panel__head-icon-dot"})])}],Ju=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-tmp-layer-list"},[n("DxScrollView",{ref:"scrollView"},[n("div",e._l(e.items,(function(t,i){return n("GisTmpLayerListItem",e._b({key:i,on:{deleteClick:function(n){return e.$listeners.itemDeleteClick(t)}},nativeOn:{click:function(n){return e.$listeners.itemClick(t)}}},"GisTmpLayerListItem",t,!1))})),1)])],1)},Zu=[],Yu=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-tmp-layer-list-item"},[n("div",{staticClass:"gis-tmp-layer-list-item__type"},[e._v("\n    "+e._s(e.type)+"\n  ")]),e.area?n("div",{staticClass:"gis-tmp-layer-list-item__area"},[e._v("\n    "+e._s(e.displayArea)+"\n  ")]):e._e(),e.length?n("div",{staticClass:"gis-tmp-layer-list-item__length"},[e._v("\n    "+e._s(e.displayLength)+"\n  ")]):e._e(),e.coordinate?n("div",{staticClass:"gis-tmp-layer-list-item__coordinate"},[e._v("\n    "+e._s(e.displayCoordinate)+"\n  ")]):e._e(),n("GisLegendItemButton",{staticClass:"gis-tmp-layer-list-item__button",attrs:{disabled:!1,iconCss:"core core-057-close",text:"Удалить объект"},on:{activeChanged:e.deleteClick}})],1)},Xu=[],Qu=n("1a37"),ep={components:{GisLegendItemButton:Qu["a"]},props:{type:String,area:null,length:null,coordinate:null,bbox:null},computed:{displayArea:function(){var e=1e6,t=1e3;return this.area<e?"".concat(Math.floor(this.area)," кв. м"):"".concat(Math.floor(this.area/e*t)/t," кв. км")},displayLength:function(){var e=10;return"".concat(Math.floor(this.length*e)/e," м")},displayCoordinate:function(){var e=1e6;return Object(a["a"])(this.coordinate).reverse().map((function(t){return Math.floor(t*e)/e})).join(" ")}},methods:{deleteClick:function(){this.$emit("deleteClick")}}},tp=ep,np=(n("03f4"),Object(le["a"])(tp,Yu,Xu,!1,null,null,null)),ip=np.exports,op=n("8919"),ap=n("e747"),sp=n("7fd5"),rp={Point:{type:"Точка",coordinate:!0},MultiPoint:{type:"Мультиточка",coordinate:!0},LineString:{type:"Линия",length:!0},MultiLineString:{type:"Мультилиния",length:!0},Polygon:{type:"Полигон",area:!0},MultiPolygon:{type:"Мультиполигон",area:!0}},lp={components:{DxScrollView:ie.a,GisTmpLayerListItem:ip},props:{tmpLayerData:Array},computed:{items:function(){return this.tmpLayerData.map((function(e){var t,n=rp[e.geometry.type];if(n.coordinate){var i=Object(sp["a"])(e,150,{units:"meters"});t=Object(Wu["a"])(i)}else t=Object(Wu["a"])(e);return{id:e.id,type:n.type,area:!!n.area&&Object(op["a"])(e),length:!!n.length&&Object(ap["a"])(e,{units:"meters"}),coordinate:!!n.coordinate&&e.geometry.coordinates,bbox:t}}))}},watch:{tmpLayerData:function(){this.$refs.scrollView&&this.$refs.scrollView.instance.update()}}},cp=lp,dp=Object(le["a"])(cp,Ju,Zu,!1,null,null,null),up=dp.exports,pp=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-tmp-layer-button-panel"},[n("GisLegendItemButton",{staticClass:"gis-tmp-layer-button-panel__button",attrs:{iconCss:"core core-104-tune",text:"Настройки слоя",disabled:!1,active:!1},on:{activeChanged:e.$listeners.openTmpStyles}}),n("GisLegendItemButton",{ref:"moveToLayerButton",staticClass:"gis-tmp-layer-button-panel__button",attrs:{iconCss:"core core-055-arrows-inside",text:"Приблизить к слою",disabled:!1,active:e.moveToLayerPanelVisible},on:{activeChanged:function(t){e.moveToLayerPanelVisible=!e.moveToLayerPanelVisible}}}),n("GisLegendItemButton",{ref:"exportButton",staticClass:"gis-tmp-layer-button-panel__button",attrs:{iconCss:"core core-071-download",text:"Экспорт",disabled:!1,active:e.exportPanelVisible},on:{activeChanged:function(t){e.exportPanelVisible=!e.exportPanelVisible}}}),n("DxPopover",{ref:"moveToLayerPanelPopover",attrs:{visible:e.moveToLayerPanelVisible,position:"bottom",closeOnOutsideClick:!0,container:e.popoverContainer},on:{hidden:function(t){e.moveToLayerPanelVisible=!1},disposing:function(t){e.moveToLayerPanelVisible=!1}}},[n("GisLegendMoveToLayerPanel",{attrs:{layerComponentId:e.layerComponentId,popupContainer:e.popoverContainer},on:{moveToAllFeatures:function(t){return e.$listeners.fitToTmpLayer("all")},moveToSelectedFeatures:function(t){return e.$listeners.fitToTmpLayer("selected")}}})],1),n("DxPopover",{ref:"exportPanelPopover",attrs:{visible:e.exportPanelVisible,position:"bottom",closeOnOutsideClick:!0,container:e.popoverContainer},on:{hidden:function(t){e.exportPanelVisible=!1},disposing:function(t){e.exportPanelVisible=!1}}},[n("GisLegendExportPanel",{attrs:{gisComponentId:e.gisComponentId,layerComponentId:e.layerComponentId,popupContainer:e.popoverContainer}})],1)],1)},fp=[],hp=n("7209"),mp=n("b039"),gp=n("e34a"),yp={components:{DxPopover:vu.a,GisLegendItemButton:Qu["a"],GisLegendMoveToLayerPanel:hp["a"],GisLegendExportPanel:mp["a"]},props:{gisComponentId:null,popoverContainer:null},data:function(){return{layerComponentId:gp["a"].componentId,moveToLayerPanelVisible:!1,exportPanelVisible:!1}},mounted:function(){this.$refs.moveToLayerButton&&this.$refs.moveToLayerPanelPopover.instance.option("target",this.$refs.moveToLayerButton.$el),this.$refs.exportButton&&this.$refs.exportPanelPopover.instance.option("target",this.$refs.exportButton.$el)}},vp=yp,bp=(n("c87a"),Object(le["a"])(vp,pp,fp,!1,null,null,null)),_p=bp.exports,Cp={name:"GisTmpLayerPanel",components:{DxPopover:vu.a,GisTmpLayerList:up,GisTmpLayerButtonPanel:_p,GisLegendItemButton:Qu["a"]},props:{tmpLayerData:Array,selected:Boolean,visible:Boolean,edit:Boolean,gisComponentId:null,popoverContainer:null},data:function(){return{buttonPanelVisible:!1}},mounted:function(){this.$refs.buttonPanelPopover.instance.option("target",this.$refs.buttonPanelButton.$el)},methods:{openTmpStyles:function(){this.buttonPanelVisible=!1,this.$emit("openTmpStyles")},handleTmpLayerEdit:function(e){e&&this.$emit("handleTmpLayerVisible",e),this.$emit("handleTmpLayerEdit",e)},visibleButtonActiveChanged:function(e){this.$emit("handleTmpLayerVisible",e)}}},xp=Cp,Op=(n("00c1"),Object(le["a"])(xp,Ku,qu,!1,null,null,null)),Ip=Op.exports,Sp=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"gis-popup-edit-tmp-style",attrs:{animation:null,visible:e.visible,shading:!1,resizeEnabled:!0,title:"Редактирование слоя «Косметический слой»",position:e.popupPosition,width:700,height:"auto",maxHeight:e.popupMaxHeight,minHeight:290,toolbarItems:e.toolbarItems,container:e.popupContainer},on:{shown:e.onShown,hidden:e.close},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:"Редактирование слоя «Косметический слой»",showCloseButton:!0},on:{closeClick:e.close}})]},proxy:!0}])},[n("div",{staticClass:"gis-popup-edit-tmp-style__content"},[e.showContent?n("div",{staticClass:"gis-popup-edit-tmp-style__wrapper"},[n("DxScrollView",[n("div",[n("GisStyleItem",{attrs:{title:"Полигон",component:"GisTmpPolygonStyleForm",isOpen:!0,deleteButton:!1,componentOptions:{fillFields:e.stylesByType.polygon,strokeFields:e.stylesByType.polygonStroke},popupContainer:e.popupContainer}}),n("GisStyleItem",{attrs:{title:"Линия",component:"GisTmpLineStyleForm",isOpen:!1,deleteButton:!1,componentOptions:{fields:e.stylesByType.line},popupContainer:e.popupContainer}}),n("GisStyleItem",{attrs:{title:"Точка",component:"GisTmpPointStyleForm",isOpen:!1,deleteButton:!1,componentOptions:{fields:e.stylesByType.point},popupContainer:e.popupContainer}})],1)])],1):e._e()])])},Lp=[],Dp={name:"GisPopupEditTmpStyle",components:{DxPopup:_e.a,DxScrollView:ie.a,PopupTitleTemplate:Ce["a"],GisStyleItem:De["a"]},props:{visible:Boolean,popupContainer:null},data:function(){var e=this;return{showContent:!1,toolbarItems:[{toolbar:"bottom",location:"center",widget:"dxButton",options:{text:"Сохранить",type:"success",onClick:function(){e.apply()}}},{toolbar:"bottom",location:"center",widget:"dxButton",options:{text:"Отменить",onClick:function(){e.$emit("hidden")}}}],stylesByType:{},styles:null}},computed:{popupPosition:function(){return{at:"top",my:"top",offset:"0, 36",of:this.popupContainer}}},methods:{popupMaxHeight:function(){return.9*window.innerHeight},close:function(){this.showContent=!1,this.styles=[],this.stylesByType={},this.$emit("hidden")},onShown:function(){this.getStyles(),this.showContent=!0,this.$emit("shown")},getStyles:function(){var e=this;this.styles=JSON.parse(localStorage.getItem("tmpLayerStyles")),this.styles.forEach((function(t){var n=t.type;switch(n){case"fill":e.stylesByType.polygon=t;break;case"circle":e.stylesByType.point=t;break;case"line":t.filter[1][2][1].includes("Polygon")?e.stylesByType.polygonStroke=t:e.stylesByType.line=t;break}}))},apply:function(){localStorage.setItem("tmpLayerStyles",JSON.stringify(this.styles)),this.$emit("apply")}}},Pp=Dp,Ep=(n("680a"),Object(le["a"])(Pp,Sp,Lp,!1,null,null,null)),wp=Ep.exports;function Tp(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function jp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tp(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tp(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var kp=[{type:"fill",paint:{"fill-color":"#2222bd","fill-opacity":.3},filter:["all",["in",["geometry-type"],["literal",["Polygon","MultiPolygon"]]]],layout:{visibility:"visible"},maxzoom:24,minzoom:0},{type:"line",paint:{"line-color":"#2222bd","line-width":2,"line-opacity":1,"line-translate":[0,0]},filter:["all",["in",["geometry-type"],["literal",["Polygon","MultiPolygon"]]]],layout:{visibility:"visible"},maxzoom:24,minzoom:0},{type:"line",paint:{"line-color":"#2222bd","line-width":2,"line-opacity":1,"line-translate":[0,0]},filter:["all",["in",["geometry-type"],["literal",["LineString","MultiLineString"]]]],layout:{visibility:"visible"},maxzoom:24,minzoom:0},{type:"circle",paint:{"circle-color":"#fff","circle-radius":4,"circle-opacity":1,"circle-stroke-color":"#2222bd","circle-stroke-width":2,"circle-stroke-opacity":1},filter:["all",["in",["geometry-type"],["literal",["Point","MultiPoint"]]]],layout:{visibility:"visible"},maxzoom:24,minzoom:0}],Fp={components:{GisTmpLayerPanel:Ip,GisPopupEditTmpStyle:wp},data:function(){return{editTmpStylePopupVisible:!1}},computed:{showTmpLayer:function(){return this.options.showTmpLayer||!1},tmpLayerEdit:function(){return this.getEditingLayerComponentId(this.componentId)===gp["a"].componentId},tmpLayerSelected:function(){return this.getActiveLegendLayerComponentId(this.componentId)===gp["a"].componentId},tmpLayerData:function(){return this.getLayerAllFeatures(gp["a"].componentId)},tmpLayerVisible:function(){return this.isLayerVisible(gp["a"].componentId)}},watch:{tmpLayerSelected:function(e){this.setLayerEnable({componentId:gp["a"].componentId,enable:e})}},methods:{createTmpLayer:function(){var e=localStorage.getItem("tmpLayerStyles");e?e=JSON.parse(e):(e=kp,localStorage.setItem("tmpLayerStyles",JSON.stringify(e))),gp["a"].options.mapboxLayers=e;var t=jp({id:gp["a"].componentId,layerComponentId:gp["a"].componentId,specialSortLayer:"legendSpecialSortLayer"},gp["a"]);this.addNoParentLayerComponent({gisComponentId:this.componentId,layerConfig:t})},handleTmpLayerEdit:function(e){this.selectedMouseTool!==this.SELECT&&this.handleToolbarButtonActiveStateChanged({buttonName:this.SELECT}),this.toggleLayerEdit(gp["a"].componentId,e)},handleTmpLayerVisible:function(e){this.setLayerVisible({componentId:gp["a"].componentId,visible:e}),!e&&this.tmpLayerEdit&&this.handleTmpLayerEdit(e)},moveTmpLayer:function(){this.legendLayers[gp["a"].componentId].mapboxMapLayer.move(!0)},moveSelectionTmpLayer:function(){this.legendLayers[gp["a"].componentId].mapboxMapLayer.moveSelectionLayers()},exportAllTmpLayerClick:function(e){var t=this.getLayerAllFeatures(gp["a"].componentId);t[0]&&this.exportTmpLayerData({features:t,type:"FeatureCollection"},e)},exportSelectedTmlLayerClick:function(e){var t=this.getLayerSelectedIds(gp["a"].componentId),n=this.getLayerAllFeatures(gp["a"].componentId).filter((function(e){return t.includes(e.id)}));n[0]&&this.exportTmpLayerData({features:n,type:"FeatureCollection"},e)},exportTmpLayerData:function(e,t){var n=this;Object(X["b"])("https://files-service.rusgis.com/apiFiles",null,{_config_filetype:t,geojson:e}).then((function(e){var t=new Date,i="Выгрузка_косметический_слой_от_".concat(t.toLocaleDateString(),"_").concat(t.toLocaleTimeString([],{timeStyle:"short"}));n.downloadLink="".concat("https://files-service.rusgis.com/downloadFile","?guid=").concat(e.guid,"&_config_dataset=").concat(e._config_dataset,"&filename=").concat(i)}))},fitToTmpLayer:function(e){var t=this.getLayerAllFeatures(gp["a"].componentId);if("selected"===e){var n=this.getLayerSelectedIds(gp["a"].componentId);t=t.filter((function(e){return n.includes(e.id)}))}if(t[0]){var i=Object(Wu["a"])({features:t,type:"FeatureCollection"});this.mapbox.fitBounds(i,{animate:!1,padding:50})}},tmpLayerListItemClick:function(e){this.mapbox.fitBounds(e.bbox,{animate:!1,padding:50})},tmpLayerListItemDeleteClick:function(e){this.deleteLayerFeatures({layerComponentId:gp["a"].componentId,features:[e]})},tmpLayerPanelClick:function(){this.setActiveLegendLayerComponentId({gisComponentId:this.componentId,layerComponentId:gp["a"].componentId})},openTmpStyles:function(){this.editTmpStylePopupVisible=!0},setTmpStyles:function(){this.editTmpStylePopupVisible=!1;var e=localStorage.getItem("tmpLayerStyles");gp["a"].options.mapboxLayers=JSON.parse(e),this.setLayerMapboxLayers({layerComponentId:gp["a"].componentId,layerStyles:gp["a"].options.mapboxLayers})}}},Bp=(n("ee1d"),"#072833"),Mp="#8bc540",Ap={data:function(){return{markers:[],geocodePoint:"",point:null,popup:null,markerIndex:0,allAddresses:[],padding:0}},methods:{setGeocodeCoordinates:function(e){this.geocodePoint=e[1]+" "+e[0],this.point&&this.point.remove();var t=document.createElement("div");t.style.width="10px",t.style.height="10px",t.style.backgroundColor=Bp,t.style.borderRadius="5px",t.style.border="solid #fff",this.point=new l.a.Marker({element:t}).setLngLat(e).addTo(this.mapbox)},handleCoordinatesChanged:function(e){var t=this;if(e&&this.validateLatLng({value:e})){var n=e.split(" "),i=[Number(n[1]),Number(n[0])],o="".concat(n[1]," ").concat(n[0]);this.handleRemoveMarker();var a={_configYandex:"coord",_config_dataset:"BASE.DSYANDEXGEOLOC",_config_is_geojson:!0,_lonlat:o};Object(X["c"])("getData",a).then((function(e){var n=null;if(t.allAddresses=[],e)if(t.allAddresses=e.features.map((function(e){return{address:e.properties.address,coordinates:e.geometry.coordinates}})),e.bounds)n=e.bounds;else if(1!==e.features.length){t.padding=300;var i=c["featureCollection"](e.features);n=c["bbox"](i)}else n=t.getEmptyPointBbox(e.features[0].geometry.coordinates.join(" "));else n=t.getEmptyPointBbox(o);t.handleMarker(n,t.allAddresses,"reverse")})),Number.isNaN(i[0])||Number.isNaN(i[1])||this.setGeocodeCoordinates(i)}else this.allAddresses=[],this.handleRemovePoint(),this.handleRemoveMarker()},getEmptyPointBbox:function(e){var t=c["point"](e.split(" ").map((function(e){return parseFloat(e)}))),n=c["buffer"](t,300,{units:"meters"});return c["bbox"](n)},validateLatLng:function(e){var t=e.value;if(!t)return!0;var n=t.split(" ");if(2!==n.length)return!1;if(isNaN(n[0])||isNaN(n[1]))return!1;var i=parseFloat(n[1]);if(i<-180||i>180)return!1;var o=parseFloat(n[0]);return!(o<-90||o>90)},handleMarker:function(e,t,n){var i=this;this.mapbox.fitBounds(e,{animate:!1,padding:this.padding}),this.padding=0,this.markers.length||(t.length&&"direct"===n?this.markers.push(new l.a.Marker({color:Bp}).setLngLat(t[0]).addTo(this.mapbox)):t.forEach((function(e){var t=new l.a.Marker({color:Mp}).setLngLat(e.coordinates).addTo(i.mapbox),n=t.getElement();n.addEventListener("mouseenter",(function(){i.popup&&i.popup.remove(),i.popup=new l.a.Popup({closeButton:!1,anchor:"top"}).setLngLat(e.coordinates).setHTML("<div>".concat(e.address,"</div>")).addTo(i.mapbox),i.markers.length&&(i.markers[i.markerIndex].getElement().querySelectorAll("g")[2].style.fill=Mp),n.querySelectorAll("g")[2].style.fill=Bp})),n.addEventListener("mouseleave",(function(){i.popup&&i.popup.remove(),n.querySelectorAll("g")[2].style.fill=Mp})),i.markers.push(t)})))},handleMarkerPopup:function(e){var t=this;this.popup&&this.popup.remove(),this.popup=new l.a.Popup({closeButton:!1,anchor:"top"}).setLngLat(e.coordinates).setHTML("<div>".concat(e.address,"</div>")).addTo(this.mapbox),this.markers.forEach((function(n,i){var o=n.getElement();n._lngLat.lng===e.coordinates[0]&&n._lngLat.lat===e.coordinates[1]?(o.querySelectorAll("g")[2].style.fill=Bp,t.markerIndex=i):o.querySelectorAll("g")[2].style.fill=Mp}))},handleRemoveMarker:function(){this.markers.length&&(this.markers.forEach((function(e){e.remove()})),this.markers=[]),this.popup&&this.popup.remove()},handleRemovePoint:function(){this.point&&this.point.remove()},handleRemoveAddresses:function(){this.geocodePoint="",this.allAddresses=[]}}},Rp=(n("4f7f"),n("5484"));function Vp(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Gp(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function Gp(e,t){if(e){if("string"===typeof e)return $p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$p(e,t):void 0}}function $p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var Np={data:function(){var e=this;return{chartLayerData:{},chartLayer:null,popups:[],handleChartsDebounce:Object(Y["a"])(500,(function(){e.mapbox.isMoving()||!e.mapbox.loaded()?e.mapbox.once("idle",(function(){e.drawCharts()})):e.drawCharts()}))}},computed:{updateTime:function(){var e=0,t=0,n="";this.forEachChartLayer((function(i,o,a){t++;var s=a.timeStamp;s&&s>e&&(e=s),n+=Up(o.filterValue)}));var i=e?(e*t).toString():t.toString();return i+=n,i}},watch:{updateTime:function(){this.handleCharts()},editingLegendLayerId:function(){this.handleCharts()}},methods:{getRandomColor:function(){for(var e="0123456789ABCDEF",t="#",n=0;n<6;n++)t+=e[Math.floor(16*Math.random())];return t},handleCharts:function(){this.handleChartsDebounce()},drawCharts:function(){var e=this,t=this.chartLayer;this.chartLayer=null;var n=0;this.editingLegendLayerId||this.forEachChartLayer((function(){return n++,n})),n?(this.chartLayer=new Rp["a"](this.mapbox),this.chartLayer.init(),this.$nextTick((function(){var n=[];e.forEachChartLayer((function(t,i,o){n.push(e.drawChartLayer(t,o))})),Promise.all(n).then((function(){return e.finishDraw(e.chartLayer,t)}))}))):this.finishDraw(null,t)},finishDraw:function(e,t){e?this.setMapDiagram({gisComponentId:this.componentId,mapDiagramData:{sources:e.sources,layers:e.layers}}):this.setMapDiagram({gisComponentId:this.componentId,mapDiagramData:null}),t&&setTimeout((function(){t.dispose()}),200)},forEachChartLayer:function(e){var t,n=this.getVisibleLayers(this.componentId),i=Vp(n);try{for(i.s();!(t=i.n()).done;){var o=t.value,a=this.getLayerOptions(o);if(!a.group&&this.isLayerVisible(o)&&a.mapboxLayers){var s,r=Vp(a.mapboxLayers);try{for(r.s();!(s=r.n()).done;){var l=s.value;if("chart"===l.type&&e(o,a,l))return}}catch(c){r.e(c)}finally{r.f()}}}}catch(c){i.e(c)}finally{i.f()}},drawChartLayer:function(e,t){var n=this,i=this.getLayerOptions(e),o=this.getMapboxLayerConfigs(e).map((function(e){return e.id})),s=this.mapbox.queryRenderedFeatures(null,{layers:o})||[],r=s.map((function(e){return e.id})),l=Object(a["a"])(new Set(r)),c=l.map((function(e){return s.find((function(t){return t.id===e}))})),d=t.layout["chart-size-attribute"];if(d){var u=i.filterValue;if(this.chartLayerData[e]&&Up(this.chartLayerData[e].filterValue)===Up(u))return this.chartLayer.draw(c,t,this.chartLayerData[e].summaries),Promise.resolve();this.chartLayerData[e]={filterValue:u,summaries:{}};var p=u||[],f=Rp["a"].parseAttributes(d),h=f.map((function(e){return{selector:e,summaryType:"max"}}));return this.loadLayerChildComponents({layerComponentId:e}).then((function(){return n.getDatasetStatistics({componentId:i.dataSetComponentId,where:p,statisticsRequest:h})})).then((function(i){i.summaries.forEach((function(t,i){return n.chartLayerData[e].summaries[f[i]]={max:t}})),n.chartLayer.draw(c,t,n.chartLayerData[e].summaries)}))}return this.chartLayer.draw(c,t,null),Promise.resolve()}}};function Up(e){return e?zp(e):""}function zp(e){var t="";if(Array.isArray(e)){var n,i=Vp(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;t+=zp(o)}}catch(a){i.e(a)}finally{i.f()}}else t=e.toString();return t}function Hp(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Wp(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function Wp(e,t){if(e){if("string"===typeof e)return Kp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Kp(e,t):void 0}}function Kp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var qp={mutate:!0},Jp={methods:{addPartToSelectedObject:function(e){var t=this,n=null;this.getLayerFeaturesForEdit(this.editingLayerId).then((function(i){var o=i[0],a={};switch(Object(Mt["a"])(o,a),a.geometry.type){case"LineString":case"MultiLineString":n=t.addPartToLineGeoJson(a,e);break;case"Polygon":case"MultiPolygon":n=t.addPartToSelectedPolygon(a,e);break}n&&(n.id||(n.id=a.id),t.editLayerFeatures({layerComponentId:t.editingLayerId,features:[n]}))}))},addPartToLineGeoJson:function(e,t){var n=t[0],i=[];switch(e.geometry.type){case"LineString":i.push(e.geometry.coordinates);break;case"MultiLineString":i=e.geometry.coordinates;break}switch(n.geometry.type){case"LineString":i.push(n.geometry.coordinates);break;case"MultiLineString":var o,a=Hp(n.geometry.coordinates);try{for(a.s();!(o=a.n()).done;){var s=o.value;i.push(s)}}catch(r){a.e(r)}finally{a.f()}break}return e.geometry.coordinates=i,e.geometry.type="MultiLineString",e},addPartToSelectedPolygon:function(e,t){var n=this;e=this.getUnkinkPolygon(e);var i=this.getUnkinkPolygon(t[0]);c["rewind"](e,qp);var o=e.geometry,a=o.type,s=o.coordinates,r=null;if("MultiPolygon"===a){var l=0;i.geometry.coordinates[0].forEach((function(e){var t=n.coordinateInPolygonRingIndex(e,s.map((function(e){return e[0]})));t>0&&(l=t)})),r=c["polygon"](s[l])}else r=e;c["rewind"](r,qp);var d=this.turfTransformationSimplify(i,r,"intersect"),u=null;if(d){c["rewind"](i,qp),c["rewind"](d,qp),c["truncate"](i,qp),c["truncate"](d,qp);var p=Math.floor(c["area"](i)),f=Math.floor(c["area"](d));p===f?(u=this.addHoleToGeoJson(e,i),u||(u=e,this.addPartToGeoJson(u,i))):(u=e,this.addPartToGeoJson(u,i))}else u=e,this.addPartToGeoJson(u,i);return c["rewind"](u,qp),u},getUnkinkPolygon:function(e){var t=[];switch(e.geometry.type){case"MultiPolygon":this.unkinkMultiPolygon(e.geometry.coordinates,t);break;case"Polygon":e.geometry.type=this.unkinkPolygon(e.geometry.coordinates,t);break;default:t=e.geometry.coordinates}return e.geometry.coordinates=t,e},unkinkMultiPolygon:function(e,t){var n,i=Hp(e);try{for(i.s();!(n=i.n()).done;){var o=n.value,a=[],s=this.unkinkPolygon(o,a);switch(s){case"Polygon":t.push(a);break;case"MultiPolygon":Array.prototype.push.apply(t,a);break}}}catch(r){i.e(r)}finally{i.f()}},unkinkPolygon:function(e,t){var n,i="Polygon",o=0,a=Hp(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;this.removeDuplicates(s);var r=null;try{r=c["polygon"]([s])}catch(x){continue}var l=c["unkinkPolygon"](r);if(0===o)if(l.features.length>1){i="MultiPolygon",this.sortGeoJsonByArea(l.features);var d,u=Hp(l.features);try{for(u.s();!(d=u.n()).done;){var p=d.value;t.push(p.geometry.coordinates)}}catch(x){u.e(x)}finally{u.f()}}else t.push(s);else if("MultiPolygon"===i){var f,h=Hp(l.features);try{for(h.s();!(f=h.n()).done;){var m,g=f.value,y=Hp(t);try{for(y.s();!(m=y.n()).done;){var v=m.value;if(c["booleanContains"](c["polygon"](v),c["polygon"](g.geometry.coordinates))){Array.prototype.push.apply(v,g.geometry.coordinates);break}}}catch(x){y.e(x)}finally{y.f()}}}catch(x){h.e(x)}finally{h.f()}}else{var b,_=Hp(l.features);try{for(_.s();!(b=_.n()).done;){var C=b.value;Array.prototype.push.apply(t,C.geometry.coordinates)}}catch(x){_.e(x)}finally{_.f()}}o++}}catch(x){a.e(x)}finally{a.f()}return i},removeDuplicates:function(e){var t=0;while(t<=e.length-3){var n=t+1;while(n<=e.length-2)e[t][0]===e[n][0]&&e[t][1]===e[n][1]?e.splice(n,1):n++;t++}},sortGeoJsonByArea:function(e,t){e.sort((function(e,n){var i=c["polygon"](e),o=c["polygon"](n),a=c["area"](i),s=c["area"](o);return t?s-a:a-s}))},addPartToGeoJson:function(e,t){switch(e.geometry.type+"-"+t.geometry.type){case"MultiPolygon-MultiPolygon":var n,i=Hp(t.geometry.coordinates);try{for(i.s();!(n=i.n()).done;){var o=n.value;e.geometry.coordinates.push(o)}}catch(l){i.e(l)}finally{i.f()}break;case"MultiPolygon-Polygon":e.geometry.coordinates.push(t.geometry.coordinates);break;case"Polygon-MultiPolygon":e.geometry.type="MultiPolygon",e.geometry.coordinates=[e.geometry.coordinates];var a,s=Hp(t.geometry.coordinates);try{for(s.s();!(a=s.n()).done;){var r=a.value;e.geometry.coordinates.push(r)}}catch(l){s.e(l)}finally{s.f()}break;case"Polygon-Polygon":e.geometry.type="MultiPolygon",e.geometry.coordinates=[e.geometry.coordinates],e.geometry.coordinates.push(t.geometry.coordinates);break;default:break}},addHoleToGeoJson:function(e,t){var n=!1,i=e.geometry,o=i.type,a=i.coordinates;switch(o){case"Polygon":n=this.addHoleToPolygon(e,t);break;case"MultiPolygon":for(var s=0;s<a.length;++s){var r=a[s],l=c["polygon"](r),d=this.addHoleToPolygon(l,t);if(d){a[s]=d.geometry.coordinates,n=e;break}}break}return c["rewind"](e,qp),n},addHoleToPolygon:function(e,t){var n=!1;c["rewind"](e,qp),c["truncate"](e,qp);var i=this.turfTransformationSimplify(e,t,"intersect");if(i){c["rewind"](i,qp),c["truncate"](i,qp);var o=Math.floor(c["area"](t)),a=Math.floor(c["area"](i));o===a&&(n=c["difference"](e,t))}return n},turfTransformationSimplify:function(e,t,n,i){var o="found non-noded intersection between LINESTRING",a=null,s=5,r=0,l={tolerance:1e-6,mutate:!0};while(null===a&&r<s)try{switch(n){case"intersect":a=c["intersect"](e,t);break;case"union":a=c["union"](e,t);break;case"difference":a=c["difference"](e,t);break}r=s}catch(d){-1!==d.message.indexOf(o)?(i?c["simplify"](e,l):c["simplify"](t,l),r++,l.tolerance*=10):r=s}return a},removePartTool:function(e){var t=this;this.getEditingFeatures().then((function(n){t.removeFeaturePart(e,n[0])}))},removeFeaturePart:function(e,t){var n={};Object(Mt["a"])(t,n);var i,o=n.geometry,a=[e.lngLat.lng,e.lngLat.lat],s=e.point,r=c["point"](a),l=o.type,d=o.coordinates,u=!1,p=null;switch(l){case"Polygon":i=this.coordinateInPolygonRingIndex(a,d),i>0&&(d.splice(i,1),u=!0),p=1;break;case"MultiPolygon":this.sortGeoJsonByArea(d);for(var f=0;f<d.length;f++){var h=d[f];if(i=this.coordinateInPolygonRingIndex(a,h),i>0){h.splice(i,1),u=!0;break}if(0===i&&d.length>1){d.splice(f,1),u=!0;break}}p=2;break;case"LineString":break;case"MultiLineString":if(1==n.geometry.coordinates.length)return;for(var m=0;m<n.geometry.coordinates.length;m++){var g=n.geometry.coordinates[m],y=c["lineString"](g);this.pointInGeoJson(r,s,y,this.mapbox)&&(d.splice(m,1),p=1,u=!0)}break}p&&u&&(n.geometry.coordinates=d,this.editLayerFeatures({layerComponentId:this.editingLayerId,features:[n]}))},coordinateInPolygonRingIndex:function(e,t){for(var n,i,o=c["point"](e),a=t.length-1;a>=0;--a)if(n=t[a],i=n.length>1?c["polygon"]([n]):c["polygon"](n),c["booleanPointInPolygon"](o,i))return a;return-1},pointInGeoJson:function(e,t,n,i){var o=!1;if("FeatureCollection"===n.type){var a,s=Hp(n.features);try{for(s.s();!(a=s.n()).done;){var r=a.value;if(o=this.pointInGeoJson(e,t,r,i),o)return o}}catch(p){s.e(p)}finally{s.f()}return o}var l={lng:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]},d=ac(t,l,i),u=c["lineIntersect"](d,n);return o=u.features.length>0,o}}},Zp=n("cd1f"),Yp=n("e7d7"),Xp=n("1040"),Qp=n("b87d"),ef=n("f6bf"),tf=n("60dc"),nf=n("3f5e"),of=n("0745");function af(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=sf(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function sf(e,t){if(e){if("string"===typeof e)return rf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?rf(e,t):void 0}}function rf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var lf=function(){function e(){Object(ta["a"])(this,e)}return Object(na["a"])(e,null,[{key:"convertFeatureGeometry",value:function(e,t){var n={};Object(Mt["a"])(e,n);var i=n.geometry,o=null;switch(t){case"Point":o=this.convertToPoint(i);break;case"MultiPoint":o=this.convertToMultiPoint(i);break;case"LineString":o=this.convertToLineString(i);break;case"MultiLineString":o=this.convertToMultiLineString(i);break;case"Polygon":o=this.convertToPolygon(i);break;case"MultiPolygon":o=this.convertToMultiPolygon(i);break}return n.geometry=o,n}},{key:"convertToPoint",value:function(e){var t=this.getUnkinkPolygon(e),n=t.coordinates,i=[];switch(t.type){case"MultiPoint":i=n[0];break;case"LineString":i=n[0];break;case"Polygon":i=n[0][0];break;case"MultiLineString":i=n[0][0];break;case"MultiPolygon":i=n[0][0][0];break}return i[0]?{type:"Point",coordinates:i}:e}},{key:"convertToMultiPoint",value:function(e){var t=this.getUnkinkPolygon(e),n=t.coordinates,i=[];switch(t.type){case"Point":i=[n];break;case"LineString":i=n;break;case"Polygon":var o,a=af(n);try{for(a.s();!(o=a.n()).done;){var s=o.value;i=i.concat(s)}}catch(g){a.e(g)}finally{a.f()}break;case"MultiLineString":var r,l=af(n);try{for(l.s();!(r=l.n()).done;){var c=r.value;i=i.concat(c)}}catch(g){l.e(g)}finally{l.f()}break;case"MultiPolygon":var d,u=af(n);try{for(u.s();!(d=u.n()).done;){var p,f=d.value,h=af(f);try{for(h.s();!(p=h.n()).done;){var m=p.value;i=i.concat(m)}}catch(g){h.e(g)}finally{h.f()}}}catch(g){u.e(g)}finally{u.f()}break}return i[0]?{type:"MultiPoint",coordinates:i}:e}},{key:"convertToLineString",value:function(e){var t=this.getUnkinkPolygon(e),n=t.coordinates,i=[];switch(t.type){case"Point":i=Object(of["a"])(n,this._circleRadius,this._circleOptions).geometry.coordinates[0],i.splice(0,1);break;case"MultiPoint":1===n.length?(i=Object(of["a"])(n[0],this._circleRadius,this._circleOptions).geometry.coordinates[0],i.splice(0,1)):(i=n,this._completePart(i,i[0],2));break;case"MultiLineString":i=n[0];break;case"Polygon":i=n[0],i.splice(i.length-1,1);break;case"MultiPolygon":i=n[0][0],i.splice(i.length-1,1);break;default:window.console.log("unknown type")}return i[0]?{type:"LineString",coordinates:i}:e}},{key:"convertToMultiLineString",value:function(e){var t=this.getUnkinkPolygon(e),n=t.coordinates,i=[];switch(t.type){case"Point":i=Object(of["a"])(n,this._circleRadius,this._circleOptions).geometry.coordinates,i[0].splice(0,1);break;case"MultiPoint":1===n.length?(i=Object(of["a"])(n[0],this._circleRadius,this._circleOptions).geometry.coordinates,i[0].splice(0,1)):(i=[n],this._completePart(i,i[0],2));break;case"LineString":i=[n];break;case"Polygon":var o,a=af(n);try{for(a.s();!(o=a.n()).done;){var s=o.value;s.splice(s.length-1,1),i.push(s)}}catch(f){a.e(f)}finally{a.f()}break;case"MultiPolygon":var r,l=af(n);try{for(l.s();!(r=l.n()).done;){var c,d=r.value,u=af(d);try{for(u.s();!(c=u.n()).done;){var p=c.value;p.splice(p.length-1,1),i.push(p)}}catch(f){u.e(f)}finally{u.f()}}}catch(f){l.e(f)}finally{l.f()}break;default:window.console.log("unknown type")}return i[0]?{type:"MultiLineString",coordinates:i}:e}},{key:"convertToPolygon",value:function(e){var t=e,n=t.coordinates,i=[],o=[];switch(t.type){case"Point":i=Object(of["a"])(n,this._circleRadius,this._circleOptions).geometry.coordinates;break;case"MultiPoint":1===n.length?i=Object(of["a"])(n[0],this._circleRadius,this._circleOptions).geometry.coordinates:(i=[n],this._completePart(i,i[0],3));break;case"LineString":this._completePart(n,n[0],3),i=[n];break;case"MultiLineString":var a,s=af(n);try{for(s.s();!(a=s.n()).done;){var r=a.value;r.length>2&&(r.push(r[0]),o.push(Object(Zp["j"])([r])))}}catch(g){s.e(g)}finally{s.f()}this.sortGeoJsonByArea(o,!0);for(var l=0;l<o.length-1;l++)for(var c=l+1;c<o.length;)Object(Yp["a"])(o[l],o[c])?(o[l]=this.turfTransformationSimplify(o[l],o[c],"difference"),o.splice(c,1)):c++;var d,u=af(o);try{for(u.s();!(d=u.n()).done;){var p=d.value;i.push(p.geometry.coordinates)}}catch(g){u.e(g)}finally{u.f()}break;case"MultiPolygon":i=n[0];break;case"Multipoint":this._completePart(n,n[0],3);var f,h=af(n);try{for(h.s();!(f=h.n()).done;){var m=f.value;i[0].push(m)}}catch(g){h.e(g)}finally{h.f()}break}return i[0]?{type:"Polygon",coordinates:i}:e}},{key:"convertToMultiPolygon",value:function(e){var t=e,n=t.coordinates,i=[];switch(t.type){case"Point":i=[Object(of["a"])(n,this._circleRadius,this._circleOptions).geometry.coordinates];break;case"MultiPoint":1===n.length?i=[Object(of["a"])(n[0],this._circleRadius,this._circleOptions).geometry.coordinates]:(i=[[n]],this._completePart(i,i[0][0],3));break;case"LineString":i=[[n]],this._completePart(i,i[0][0],3);break;case"MultiLineString":i=[n];break;case"Polygon":i=[n];break}return i[0]?{type:"MultiPolygon",coordinates:i}:e}},{key:"getUnkinkPolygon",value:function(e){var t=[];switch(e.type){case"MultiPolygon":this._unkinkMultiPolygon(e.coordinates,t);break;case"Polygon":e.type=this._unkinkPolygon(e.coordinates,t);break;default:t=e.coordinates}return e.coordinates=t,e}},{key:"_unkinkMultiPolygon",value:function(e,t){var n,i=af(e);try{for(i.s();!(n=i.n()).done;){var o=n.value,a=[],s=this._unkinkPolygon(o,a);switch(s){case"Polygon":t.push(a);break;case"MultiPolygon":Array.prototype.push.apply(t,a);break}}}catch(r){i.e(r)}finally{i.f()}}},{key:"_unkinkPolygon",value:function(e,t){var n,i="Polygon",o=0,a=af(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;this._removeDuplicates(s);var r=null;try{r=Object(Zp["j"])([s])}catch(C){continue}var l=Object(Xp["a"])(r);if(0===o)if(l.features.length>1){i="MultiPolygon",this.sortGeoJsonByArea(l.features);var c,d=af(l.features);try{for(d.s();!(c=d.n()).done;){var u=c.value;t.push(u.geometry.coordinates)}}catch(C){d.e(C)}finally{d.f()}}else t.push(s);else if("MultiPolygon"===i){var p,f=af(l.features);try{for(f.s();!(p=f.n()).done;){var h,m=p.value,g=af(t);try{for(g.s();!(h=g.n()).done;){var y=h.value;if(Object(Yp["a"])(Object(Zp["j"])(y),Object(Zp["j"])(m.geometry.coordinates))){Array.prototype.push.apply(y,m.geometry.coordinates);break}}}catch(C){g.e(C)}finally{g.f()}}}catch(C){f.e(C)}finally{f.f()}}else{var v,b=af(l.features);try{for(b.s();!(v=b.n()).done;){var _=v.value;Array.prototype.push.apply(t,_.geometry.coordinates)}}catch(C){b.e(C)}finally{b.f()}}o++}}catch(C){a.e(C)}finally{a.f()}return i}},{key:"sortGeoJsonByArea",value:function(e,t){e.sort((function(e,n){var i=Object(Zp["j"])(e),o=Object(Zp["j"])(n),a=Object(op["a"])(i),s=Object(op["a"])(o);return t?s-a:a-s}))}},{key:"_removeDuplicates",value:function(e){var t=0;while(t<=e.length-3){var n=t+1;while(n<=e.length-2)e[t][0]===e[n][0]&&e[t][1]===e[n][1]?e.splice(n,1):n++;t++}}},{key:"_completePart",value:function(e,t,n){while(e.length<n)e.push(t)}},{key:"turfTransformationSimplify",value:function(e,t,n,i){var o="found non-noded intersection between LINESTRING",a=5,s={tolerance:1e-6,mutate:!0},r=null,l=0;while(null===r&&l<a)try{switch(n){case"intersect":r=Object(nf["a"])(e,t);break;case"union":r=Object(tf["a"])(e,t);break;case"difference":r=Object(ef["a"])(e,t);break}l=a}catch(c){-1!==c.message.indexOf(o)?(i?Object(Qp["a"])(e,s):Object(Qp["a"])(t,s),l++,s.tolerance*=10):l=a}return r}}]),e}();Object(s["a"])(lf,"_circleOptions",{steps:10,units:"kilometers"}),Object(s["a"])(lf,"_circleRadius",.5);var cf={data:function(){return{showCoordinatesEditor:!1,coordEditorFeature:null}},watch:{editingLayerSelectedFeaturesIds:function(){this.updateCoordinateEditor()}},methods:{updateCoordinateEditor:function(){var e=this;this.editingLayerSelectedFeaturesIds[0]?this.getEditingFeatures().then((function(t){e.coordEditorFeature=t[0],e.$refs.coordinatesEditor&&e.$refs.coordinatesEditor.refresh()})):(this.coordEditorFeature=null,this.$refs.coordinatesEditor&&this.$refs.coordinatesEditor.refresh())},onCoordinatesEditorClose:function(){this.showCoordinatesEditor=!1,this.handleToolbarButtonActiveStateChanged({buttonName:di})},onGeometryCoordinatesChange:function(e){var t=e.feature,n=e.isNew,i=this.editingLayerId;n?this.addFeatures([t],!1):this.editLayerFeatures({layerComponentId:i,features:[t]})},changeGeometryType:function(e){var t=this;this.getEditingFeatures().then((function(n){var i=e.replace("changeType","");if(n[0].geometry.type!==i){var o=lf.convertFeatureGeometry(n[0],i);t.editLayerFeatures({layerComponentId:t.editingLayerId,features:[o]})}}))}}},df=n("5a3e");function uf(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=pf(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function pf(e,t){if(e){if("string"===typeof e)return ff(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ff(e,t):void 0}}function ff(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function hf(e){var t=c["featureCollection"](Object(a["a"])(e)),n=c["convex"](t);return n}function mf(e){var t=gf(e),n=yf(t);return n}function gf(e){for(var t=[],n=0;n<e.length;n++){var i,o=cc(e[n]),a=c["featureCollection"]([o]),s=uf(a.features);try{for(s.s();!(i=s.n()).done;){var r=i.value;t.push(r)}}catch(l){s.e(l)}finally{s.f()}}return t}function yf(e){var t=vf(e),n=bf(t);return n}function vf(e){var t,n=[],i=uf(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;if("MultiPolygon"===o.geometry.type){var a,s=uf(o.geometry.coordinates);try{for(s.s();!(a=s.n()).done;){var r=a.value;n.push(c["polygon"](r))}}catch(l){s.e(l)}finally{s.f()}}else n.push(c["polygon"](o.geometry.coordinates))}}catch(l){i.e(l)}finally{i.f()}return n}function bf(e){var t=c["union"].apply(c,Object(a["a"])(e));return t}function _f(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Cf(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function Cf(e,t){if(e){if("string"===typeof e)return xf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xf(e,t):void 0}}function xf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Of(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function If(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Of(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Of(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Sf={data:function(){return{}},computed:{editingLayerId:function(){return this.getEditingLayerComponentId(this.componentId)},editingLayerOptions:function(){return this.getLayerOptions(this.editingLayerId)},editGeomTypes:function(){return this.editingLayerOptions&&this.editingLayerOptions.geomTypes},editingLayerSelectedFeaturesIds:function(){return this.editingLayerId?this.getLayerSelectedIds(this.editingLayerId):[]},editingFeaturesIds:function(){return this.editingLayerId?this.getLayerEditingIds(this.editingLayerId):[]},saveDisabled:function(){return!this.editingLayerId||this.editingLayerId===gp["a"].componentId||!this.isLayerHasChanges(this.editingLayerId)},undoDisabled:function(){return!(this.editingLayerId&&this.canUndo(this.editingLayerId))},redoDisabled:function(){return!(this.editingLayerId&&this.canRedo(this.editingLayerId))}},methods:{getEditingFeatures:function(){return this.getLayerFeaturesForEdit(this.editingLayerId)},getLayerFeaturesForEdit:function(e){var t=this,n=this.getLayerOptions(e),i=this.getLayerEditingIds(e),o=this.getLayerSelectedIds(e),s=[],r=[];return i[0]?(r=this.getLayerAllFeatures(e).filter((function(e){return i.includes(e.id)})),s=i.filter((function(e){return!r.find((function(t){return t.id===e}))}))):(r=this.getLayerAllFeatures(e).filter((function(e){return o.includes(e.id)})),s=o.filter((function(e){return!r.find((function(t){return t.id===e}))}))),s[0]?this.loadGeoJsons(e,s,n).then((function(n){return t.setLayerFeatures({layerComponentId:e,features:n}),[].concat(Object(a["a"])(n),Object(a["a"])(r))})):Promise.resolve(r)},loadGeoJsons:function(e,t,n){var i=this,o=t.map((function(t){return i.gisLayerLoadGeoJson(Object(s["a"])({layerComponentId:e},n.keyField,t)).then((function(e){var t=e.features[0];return t.id=t.properties[n.keyField],t}))}));return Promise.all(o)},editFeatures:function(e){var t=this,n=this.editingLayerId;n&&(this.editLayerFeatures({layerComponentId:n,features:e}),this.setLayerEditingIds({componentId:this.editingLayerId,ids:e.map((function(e){return e.id}))}),this.updateCoordinateEditor(),setTimeout((function(){t.saveVisibleFeatures()}),100))},endEditFeature:function(e){var t=this.editingLayerId;if(t){var n=this.getLayerEditingIds(t);n&&n[0]&&(e&&this.setLayerSelectedIds({layerComponentId:t,ids:n}),this.mapboxDraw.deleteAll(),this.setLayerEditingIds({componentId:t,ids:[]}))}},addFeatures:function(e,t){var n=this,i=this.editingLayerOptions,o=this.editingLayerId;if(e.forEach((function(e){e.properties||(e.properties={}),e.properties.id||(e.properties.id=e.id),n.activeSubstractTool&&n.substractFeatures(n.editingLayerId,e)})),this.mapboxDraw.deleteAll(),o===gp["a"].componentId)return this.addLayerFeatures({layerComponentId:o,features:e}),this.setLayerSelectedIds({layerComponentId:o,ids:e.map((function(e){return e.id}))}),void setTimeout((function(){n.saveVisibleFeatures()}),100);var a=i.dataSetComponentId;if(a){if(a=a.toString(),i.singleFeature){this.addLayerFeatures({layerComponentId:o,features:e}),this.setLayerSelectedIds({layerComponentId:o,ids:e.map((function(e){return e.id}))});var s,r=i.mapboxMapLayer.getGeoJsonData();if(!i.singleFeatureEventOnly&&(!r||!r.features||!r.features[0]))return;s=r&&r.features&&r.features[0]?r.features[0]:e[0];var l=If(If({},s),{},{geometry:e[0].geometry});return this.callEventAction(i.layerComponentId,"onGeometryChanged",{geojson:l}),i.singleFeatureEventOnly?this.callComponentAction({componentId:a,actionName:"updateSingleFeature",feature:l}):this.callComponentAction({componentId:a,actionName:"saveFeatureGeometry",feature:l}),void this.saveVisibleFeatures()}var c=e[0],d=this.getLayerRights(i.layerComponentId).showCard,u=i.showInsertCard&&(!t||t&&i.showCardOnPaste)&&d;u?(this.loadLayerChildComponents({layerComponentId:o}).then((function(){n.callEventAction(o,"onAfterInsert",{geojson:If({},c)})})),this.onAddFeaturesServer(o,e,null).then((function(){n.setLayerSelectedIds({layerComponentId:o,ids:e.map((function(e){return e.id}))}),n.saveVisibleFeatures()}))):this.loadLayerDataFields({layerComponentId:o,gisComponentId:this.componentId}).then((function(t){n.addLayerFeatures({layerComponentId:o,features:e}),n.setLayerSelectedIds({layerComponentId:o,ids:e.map((function(e){return e.id}))})}))}},deleteSelectedFeatures:function(){var e=this;this.getEditingFeatures().then((function(t){e.deleteFeaturesDialog(e.editingLayerId,t)}))},deleteFeaturesDialog:function(e,t){var n=this;if(e===gp["a"].componentId)return this.deleteLayerFeatures({layerComponentId:e,features:t}),void this.setLayerSelectedIds({layerComponentId:e,ids:[]});if(this.hardDelete){var i=Object(Us["c"])({showTitle:!1,messageHtml:'<div style="font-size:16px; text-align: center">Удалить выбранные объекты?</div>',buttons:[{text:"Да",type:"danger",onClick:function(){n.deleteFeaturesSurely(e,t)}},{text:"Нет"}]});i.show()}else this.deleteFeaturesSurely(e,t)},deleteFeaturesSurely:function(e,t){var n=this;if(this.hardDelete){var i=t.map((function(e){return e.id}));this.deleteFeaturesFromServer(e,i).then((function(){var t,o=_f(i);try{for(o.s();!(t=o.n()).done;){var a=t.value;n.removeChange({layerComponentId:e,key:a})}}catch(s){o.e(s)}finally{o.f()}n.saveVisibleFeatures()})).then((function(i){window.console.log(i),n.deleteLayerFeatures({layerComponentId:e,features:t}),n.setLayerSelectedIds({layerComponentId:e,ids:[]})}))}else this.deleteLayerFeatures({layerComponentId:e,features:t}),this.setLayerSelectedIds({layerComponentId:e,ids:[]})},addNewIntersectionFeature:function(){var e=this;this.getActualSelectedFeatures().then((function(t){var n,i=_c(t),o=_f(i.features);try{for(o.s();!(n=o.n()).done;){var a=n.value;"MultiPoint"!==a.geometry.type&&(a.id=(new u["a"]).toString(),a.properties={},e.addFeatures([a]))}}catch(s){o.e(s)}finally{o.f()}}))},addNewUnionFeature:function(){var e=this;this.getActualSelectedFeatures().then((function(t){var n=mf(t);n.id=(new u["a"]).toString(),n.properties={},e.addFeatures([n])}))},addConvexHullFeature:function(){var e=this;this.getActualSelectedFeatures().then((function(t){var n=hf(t);n.id=(new u["a"]).toString(),n.properties={id:n.id},e.addFeatures([n])}))},substractFeatures:function(e,t){var n=this.getVisibleFeaturesForLayer(e),i=Cc(t,n);t.geometry=i.geometry},addFeatureByBufferZone:function(e,t,n){var i=this;this.getActualSelectedFeatures().then((function(o){var a=nc(o,e,t,n);Array.isArray(a)?i.addFeatures(a.map((function(e){return If(If({},e),{},{id:(new u["a"]).toString(),properties:{}})}))):(a.id=(new u["a"]).toString(),a.properties={},i.addFeatures([a]))}))},_addEssentialProperties:function(e,t,n){var i,o=e.mapboxLayers,a=[],s=_f(o);try{for(s.s();!(i=s.n()).done;){var r=i.value;r.filter&&r.filter[0]&&(a=a.concat(df["a"].getUsedAttributes(r.filter,t)))}}catch(u){s.e(u)}finally{s.f()}var l,c=_f(a);try{for(c.s();!(l=c.n()).done;){var d=l.value;void 0===n.properties[d.name]&&(n.properties[d.name]=df["a"].getDefaultFieldValue(d))}}catch(u){c.e(u)}finally{c.f()}}}};function Lf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Df(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lf(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lf(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pf={methods:Df(Df({},Object(d["b"])("config",{loadFeatureData:Xt["s"]})),{},{sliceSelectedObject:function(e,t){var n=this;return this.crosses(e.geometry,t.geometry).then((function(i){if(i){var o={_config_dataset:"CONFIG.PRPOSTGIS_ST_EXEC",st:"st_split",input:t.geometry,blade:e.geometry};return Object(X["c"])("getData",o).then((function(e){if(e[0]&&e[0].prop&&e[0].prop.geometries&&e[0].prop.geometries[0]){var i=e[0].prop.geometries,o=i[0];n.editLayerFeatures({layerComponentId:n.editingLayerId,features:[Df(Df({},t),{},{geometry:o})]});var a=n.getLayerOptions(n.editingLayerId),r=a.keyField;n.editingLayerId!==gp["a"].componentId?n.loadFeatureData(Object(s["a"])({layerComponentId:n.editingLayerId},r,t.id)).then((function(e){n.addSplittedFeatures(i,e[0]||{},r)})).catch((function(){n.addSplittedFeatures(i,{},r)})):n.addSplittedFeatures(i,{},r)}}))}return null}))},crosses:function(e,t){var n={_config_dataset:"CONFIG.PRPOSTGIS_ST_EXEC",st:"st_crosses",g1:e,g2:t};return Object(X["c"])("getData",n).then((function(e){return e[0]&&e[0].prop&&1===e[0].prop.result}))},addSplittedFeatures:function(e,t,n){for(var i=[],o=1;o<e.length;++o){var a=e[o],r=(new u["a"]).toString();i.push({type:"Feature",id:r,properties:Df(Df({},t),{},Object(s["a"])({},n||"id",r)),geometry:a})}this.addFeatures(i,!0)}})},Ef=(n("4917"),n("2b0e")),wf=n("b0f7"),Tf=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-constructor-tooltip-container"},[e.componentId?n("ContainerItem",{attrs:{cssStyle:e.itemConfig.cssStyle,componentId:e.componentId,componentType:e.itemConfig.componentType}}):e._e()],1)},jf=[],kf=n("95d4");function Ff(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Bf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ff(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ff(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Mf={name:"GisConstructorTooltipContainer",components:{ContainerItem:kf["a"]},props:{componentId:String},computed:Bf(Bf({},Object(d["c"])("config",{getItem:Eo["b"]})),{},{itemConfig:function(){return this.getItem(this.componentId)}})},Af=Mf,Rf=Object(le["a"])(Af,Tf,jf,!1,null,null,null),Vf=Rf.exports;n("f576");function Gf(e,t){var n=t;return n=n.replace("гггг",e.getFullYear()),n=n.replace("мм",Nf(e.getMonth(),2)),n=n.replace("м",e.getMonth()),n=n.replace("дд",Nf(e.getDate(),2)),n=n.replace("д",e.getDate()),n=n.replace("ЧЧ",Nf(e.getHours(),2)),n=n.replace("Ч",e.getHours()),n=n.replace("ММ",Nf(e.getMinutes(),2)),n=n.replace("М",e.getMinutes()),n=n.replace("СС",Nf(e.getSeconds(),2)),n=n.replace("С",e.getSeconds()),n}function $f(e,t){for(var n=0,i=".",o="",a=t.length-1;a>=0&&"0"===t[a];a--);for(a>=0&&(i=t[a],n=t.length-a-1),a--;a>=0&&"#"===t[a];a--);a>=0&&(o=t[a]);var s=e.toFixed(n),r="",l="";if(0==n)r=s,i="";else{var c=s.split(".");r=c[0],l=c[1]}return r=r.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1".concat(o)),"".concat(r).concat(i).concat(l)}function Nf(e,t){return e.toString().padStart(t,0)}function Uf(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=zf(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function zf(e,t){if(e){if("string"===typeof e)return Hf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Hf(e,t):void 0}}function Hf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Wf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Kf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wf(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wf(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qf=function e(t,n,i){Object(ta["a"])(this,e),Object(s["a"])(this,"eventName",void 0),Object(s["a"])(this,"mapboxLayerId",void 0),Object(s["a"])(this,"handlerFunction",void 0),this.eventName=t,this.mapboxLayerId=n,this.handlerFunction=i},Jf=Ef["default"].extend(Vf),Zf={components:{GisConstructorTooltipContainer:Vf},data:function(){return{handlers:[],tooltipPopup:new l.a.Popup({closeOnMove:!1,closeOnClick:!1,closeButton:!1,className:"gis-alternative__tooltip",maxWidth:"600px"}),constructorTooltipComponent:null,featureByTooltip:null,fireEventTimeoutId:null}},computed:Kf(Kf({},Object(d["c"])("config",{getLayerOptions:Yt["E"],getLayerTooltipPosition:Yt["N"],getLayerTooltipExpression:Yt["M"],getLayerTooltipComponentId:Yt["L"],getLayerHoverEnable:Yt["t"]})),{},{hoverLayerOptions:function(){var e=this,t=this.getVisibleLayers(this.componentId);return t.filter((function(t){return e.getTooltipEnable(t)||e.getHoverStyleEnable(t)})).map((function(t){return e.loadLayerChildComponents({layerComponentId:t}),e.getLayerOptions(t)})).filter((function(t){return e.getTooltipEnableAfterLoading(t)||e.getHoverStyleEnableAfterLoading(t)}))},tooltipFeatureId:function(){if(!this.featureByTooltip)return null;var e=this.featureByTooltip.layer.metadata.layerComponentId,t=this.featureByTooltip.id||this.featureByTooltip.properties.id;return"".concat(e,"_").concat(t)}}),watch:{hoverLayerOptions:function(){this.refreshMapEvents()},tooltipFeatureId:function(){var e=this;this.fireEventTimeoutId&&(clearTimeout(this.fireEventTimeoutId),this.fireEventTimeoutId=null),this.fireEventTimeoutId=setTimeout((function(){e.featureByTooltip&&e.callFeatureTooltipShowEventAction({layerComponentId:e.featureByTooltip.layer.metadata.layerComponentId,featureData:e.featureByTooltip.properties})}),100)}},methods:Kf(Kf(Kf({},Object(d["b"])("config",{loadLayerChildComponents:Xt["p"],callFeatureTooltipShowEventAction:Xt["b"]})),Object(d["d"])("config",{setLayerHoverIds:gn["D"]})),{},{getTooltipEnable:function(e){return"none"!==this.getLayerTooltipPosition(e)},getHoverStyleEnable:function(e){return this.getLayerHoverEnable(e)},getTooltipEnableAfterLoading:function(e){return this.getTooltipEnable(e.layerComponentId)&&(this.getLayerTooltipExpression(e.layerComponentId)||this.getLayerTooltipComponentId(e.layerComponentId))},getHoverStyleEnableAfterLoading:function(e){return this.getHoverStyleEnable(e.layerComponentId)},refreshMapEvents:function(){var e,t=Uf(this.handlers);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.mapbox.off(n.eventName,n.mapboxLayerId,n.handlerFunction)}}catch(p){t.e(p)}finally{t.f()}this.handlers=[];var i,o=Uf(this.hoverLayerOptions);try{for(o.s();!(i=o.n()).done;){var a,s=i.value,r=this.getMapboxLayerIds(s.layerComponentId),l=this.getMouseMoveHandler(r,s),c=this.getMouseLeaveHandler(r,s),d=Uf(r);try{for(d.s();!(a=d.n()).done;){var u=a.value;this.mapbox.on("mousemove",u,l),this.handlers.push(new qf("mousemove",u,l)),this.mapbox.on("mouseleave",u,c),this.handlers.push(new qf("mouseleave",u,c))}}catch(p){d.e(p)}finally{d.f()}}}catch(p){o.e(p)}finally{o.f()}},getMouseLeaveHandler:function(e,t){var n=this,i=function(i){n.getTooltipEnableAfterLoading(t)&&n.onFeatureLeaveTooltip(i,e,t),n.getHoverStyleEnableAfterLoading(t)&&n.onFeatureLeaveStyle(i,e,t)};return i.bind(this),i},getMouseMoveHandler:function(e,t){var n=this,i=function(i){var o=n.mapbox.queryRenderedFeatures(i.point,{layers:e})[0];o&&(n.getTooltipEnableAfterLoading(t)&&n.onFeatureHoverTooltip(i,o,t),n.getHoverStyleEnableAfterLoading(t)&&n.onFeatureHoverStyle(i,o,t))};return i.bind(this),i},onFeatureHoverTooltip:function(e,t,n){var i=this,o=n.tooltipExpression,a=n.tooltipComponentId;if(t){this.setTooltipContent(a,o,t);var s=this.calculateTooltipPosition(t,n,[e.lngLat.lng,e.lngLat.lat],e.point);this.tooltipPopup.setLngLat(s),this.tooltipPopup.removeClassName("gis-alternative__tooltip_hidden"),this.tooltipPopup.isOpen()||setTimeout((function(){i.tooltipPopup.addTo(i.mapbox)}),1),this.featureByTooltip=t}else this.featureByTooltip=null},onFeatureLeaveTooltip:function(e,t){var n=this.mapbox.queryRenderedFeatures(e.point,{layers:t})[0];this.featureByTooltip=n||null,this.tooltipPopup.addClassName("gis-alternative__tooltip_hidden")},onFeatureHoverStyle:function(e,t,n){this.setLayerHoverIds({componentId:n.layerComponentId,ids:[t.id]})},onFeatureLeaveStyle:function(e,t,n){this.setLayerHoverIds({componentId:n.layerComponentId,ids:[]})},calculateTooltipPosition:function(e,t,n,i){var o,a,s=3;if("Point"===e.geometry.type)a=e.geometry.coordinates,o=this.mapbox.project(a),o.y-=s,a=this.mapbox.unproject(o);else if("center"===t.tooltipPosition)if("LineString"===e.geometry.type)a=yc(e.geometry).coordinates;else if("MultiLineString"===e.geometry.type){var r=bc(e.geometry,n);a=yc(r).coordinates}else a=c["centroid"](e).geometry.coordinates;else o=i,o.y-=s,a=this.mapbox.unproject(o);return a},generateTooltipContent:function(e,t){var n=this.replaceMacros(e,t);return n=this.replaceFieldValues(n,t),n},replaceMacros:function(e,t){var n,i=e,o=/formatNumber\((.+?),&#39;([^<>]+?)&#39;\)/g;n=o.exec(i);while(n){var a=this.replaceFieldValues(n[1],t,!0);i=i.replace(n[0],this.formatNumber(a,n[2])),n=o.exec(i)}var s=/formatDate\((.+?),&#39;([^<>]+?)&#39;\)/g;n=s.exec(i);while(n){var r=this.replaceFieldValues(n[1],t,!0);i=i.replace(n[0],this.formatDate(r,n[2])),n=s.exec(i)}return i},replaceFieldValues:function(e,t,n){var i,o,a=e,s=0,r=0,l='<span class="dx-variable"',c=/<\/span>.?<\/span>/;s=a.indexOf(l);while(s>=0){if(r=Yf(a,c,s),!(r>0))break;var d=a.indexOf(">[",s),u=a.indexOf("]<",s);u>d&&(i=a.substring(d+2,u),o=this.getAttrDisplayValue(t.properties[i],n),a=a.substring(0,s)+o+a.substring(r),r=s+o.length),s=a.indexOf('<span class="dx-variable"',r)}return a},formatDate:function(e,t){var n=new Date(Date.parse(e));return Gf(n,t)},formatNumber:function(e,t){var n=parseFloat(e);return $f(n,t)},getAttrDisplayValue:function(e,t){var n;return null==e?n="":e instanceof Date?t?n=e.toString():(n=e.toLocalString("ru-RU"),e.getHours()+e.getMinutes()+e.getSeconds()===0&&(n=n.slice(0,10))):n=e instanceof Number?t?e.toString():e.toFixed(2):e.toString(),n},setTooltipContent:function(e,t,n){e?(this.constructorTooltipComponent?this.constructorTooltipComponent.componentId=e:this.constructorTooltipComponent=new Jf({store:wf["a"],propsData:{componentId:e}}).$mount(),this.tooltipPopup.setDOMContent(this.constructorTooltipComponent.$el)):(this.constructorTooltipComponent&&(this.constructorTooltipComponent.componentId=null),this.tooltipPopup.setHTML("<div>".concat(this.generateTooltipContent(t,n),"</div>")))}})};function Yf(e,t,n){var i=e.substring(n||0),o=i.match(t);return o?o.index+(n||0)+o[0].length:-1}var Xf=n("588d"),Qf=n("b930"),eh=n("6060");function th(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=nh(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function nh(e,t){if(e){if("string"===typeof e)return ih(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ih(e,t):void 0}}function ih(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function oh(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ah(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oh(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oh(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}l.a.accessToken="pk.eyJ1IjoiYnVyb3Z5YSIsImEiOiJjanVucnE3bHMweHRlM3pvNXAycXllaHl5In0.ytKUDnITJq8JScaXHW3qzQ";var sh=["GisLayer","GisGroupLayer"],rh="snappingSource",lh="videoSource",ch="videoLayer",dh="Delete",uh=[Ui,zi,Hi,Wi],ph=[di,pi,hi,fi,yi,ui,so,vi,bi,_i,Pi,Ti,ji,Hi,Wi,Ai,Ri,Vi,Gi,Ki,qi,Ji,Zi,Yi,Xi,Qi,eo,to,oo,po,fo,mo,Ni],fh=4,hh={"mapbox-gl-draw-cold":{data:{type:"FeatureCollection",features:[]},type:"geojson"},"mapbox-gl-draw-hot":{data:{type:"FeatureCollection",features:[]},type:"geojson"}};t["a"]={mixins:[Q["a"],Rd,tc,Fc,$c,fd,Zl,pu,zu,Hu,Fp,Ap,Np,Jp,cf,Sf,al,Pf,Zf],components:{DxDrawer:te.a,DxScrollView:ie.a,GisContextMenu:de,GisContextMenuItem:ge,GisPopupEditLayerStyle:sn,GisPopupEditLayerTooltip:On,GisToolbar:Ao,GisLayerList:Xo,SnapshotDraw:fs,GisDocumentSnapshotPanel:bs,GisReportList:Ps,GisReportImgPanel:Ms,GisPopupSelectSnapshot:or,GisCoordinatesEditor:Gr},data:function(){var e,t=this;return{SELECT:di,apiKey:null,mouseTools:[].concat(ph),activeSubstractTool:!1,drawCreateHandlers:{},selectedMouseTool:di,layerConfigs:[],layerConfigsFlat:[],showFeatureContextMenu:!1,featureContextMenuPosition:{top:0,left:0},editLayerConfig:{},saveToLocalStorageTimeoutId:null,toolbarValues:(e={},Object(s["a"])(e,mi,10),Object(s["a"])(e,gi,!1),Object(s["a"])(e,yi,3),Object(s["a"])(e,Fi,10),Object(s["a"])(e,Bi,!1),Object(s["a"])(e,Mi,!1),e),playingVideo:!1,reportListVisible:!1,snapshotVisible:!1,clipboard:{Line:[],Polygon:[],Point:[]},boxZoom:null,perimeterPopups:[],isFullScreen:!1,popoverContainer:null,filterPanelItems:[],legendVisible:!1,spaceImageryPanelVisible:!1,onIdle:null,handleStyleChange:Object(Y["a"])(500,(function(){t.mapbox.isMoving()||!t.mapbox.loaded()?t.mapbox.once("idle",(function(){t.onIdle&&t.onIdle()})):t.onIdle&&t.onIdle()}))}},computed:ah(ah({},Object(d["c"])("config",{getMapboxStyle:Jt["w"],getGisOptions:Jt["z"],getEditingLayerComponentId:Jt["l"],getStyleFormLayerComponentId:Jt["D"],getActiveSnapTool:Jt["e"],getVisibleFeatures:Jt["J"],getLayerOptions:Yt["E"],getLayerAllFeatures:Yt["d"],getFeaturesByIds:Yt["p"],getLayerEditingIds:Yt["n"],getChildLayerComponentIds:Yt["k"],getTablePanelLayerComponentId:Jt["E"],getFilterPanelLayerComponentId:Jt["n"],getAllSelected:Jt["h"],getAllPopupComponentConfigs:Jt["g"],getBounds:Jt["k"],isFilterButtonVisible:Yt["U"],isLayerHasChanges:Yt["P"],isLayerVisible:Yt["kb"],getLayerChanges:Yt["j"],canUndo:Yt["b"],canRedo:Yt["a"],getMapboxLayerIds:Yt["A"],getLayerRights:Yt["G"],getMapboxLayerConfigs:Yt["z"],getTimelineVisible:Jt["G"],getGltfLayers:Jt["p"],getUrlsToken:Jt["I"],getRights:Jt["B"]})),{},{styleFormLayerComponentId:function(){return this.getStyleFormLayerComponentId(this.componentId)},tooltipFormLayerComponentId:function(){return this.getTooltipFormLayerComponentId(this.componentId)},bounds:function(){return this.getBounds(this.componentId)},popupComponentConfigs:function(){return this.getAllPopupComponentConfigs(this.componentId)},downloadLink:function(){return this.getGisOptions(this.componentId).downloadLink},mapboxStyle:function(){return this.getMapboxStyle(this.componentId)},items:function(){return this.options.items||[]},itemConfigs:function(){var e=this;return this.items.map((function(t){return e.$store.getters["config/getItem"](t)})).filter((function(e){return e}))},leftButtonItems:function(){var e=this;return this.itemConfigs.filter((function(e){return"Button"===e.componentType})).map((function(t){return{componentId:t.componentId,options:e.$store.getters["config/getComponentOptions"](t.componentId)||{}}})).filter((function(e){return"before"===e.options.locate}))},rightButtonItems:function(){var e=this;return this.itemConfigs.filter((function(e){return"Button"===e.componentType})).map((function(t){return{componentId:t.componentId,options:e.$store.getters["config/getComponentOptions"](t.componentId)||{}}})).filter((function(e){return"before"!==e.options.locate}))},contextMenuConstructorItems:function(){var e=this;return this.itemConfigs.filter((function(e){return"ContextMenuItem"===e.componentType})).map((function(t){return{componentId:t.componentId,options:e.$store.getters["config/getComponentOptions"](t.componentId)||{}}}))},images:function(){return this.options.images||[]},hardDelete:function(){return this.options.hardDelete||!1},historyLength:function(){return this.options.historyLength||void 0},showSpaceImageryPanel:function(){return void 0===this.options.spaceImagery||!!this.options.spaceImagery&&this.options.spaceImagery.visible},showToolbar:function(){return void 0===this.options.toolbar||!!this.options.toolbar&&this.options.toolbar.visible},selectClickTolerance:function(){return this.options.selectClickTolerance||5},snapTolerance:function(){return this.options.snapTolerance||8},snapZoom:function(){return this.options.snapZoom||12},showEditPolygonArea:function(){return!!this.options.showEditPolygonArea},getCoordinatesOnClick:function(){return this.options.getCoordinatesOnClick||!1},locateBufferSize:function(){return this.options.locateBufferSize||.15},needResizeInterval:function(){return!0===this.options.needResizeInterval},visibleTools:function(){return ah({save:!0,buffer:!0,select:!0,history:!0,measure:!0,snapping:!0,sliceGeom:!0,rectangleSelect:!0,polygonSelect:!0,circleSelect:!0,bufferZoneSelect:!0,circleRadiusSelect:!0,gotoCurrentPosition:!0,gotoExtent:!0,gotoSelectedObjects:!0,gotoPreviousExtent:!0,gotoNextExtent:!0,perimeterMeasure:!0,addFeature:!0,addPoint:!0,addLine:!0,addPolygon:!0,addBufferZone:!0,addIntersectionObject:!0,addUnionObject:!0,addConvexHull:!0,addSubstractAll:!0,editFeature:!0,editVertexes:!0,editMove:!0,deleteFeature:!0,part:!0,removePart:!0,changeType:!0,bufferCopy:!0,bufferPaste:!0,toggleLegend:!0,toggleSpaceImageryPanel:!1,snapshotForReport:!0,mapSnapshot:!0,scale:!0,objectIdentification:!1,geocoder:!0,fullScreenMode:!0,coordinates:!0,searchPoint:!0},this.options.visibleTools)},selectAreaMode:function(){return this.options.selectAreaMode||!1},featureContextMenuEnabled:function(){return!1!==this.options.featureContextMenuEnabled},toolbarButtonsDisabled:function(){var e;return e={},Object(s["a"])(e,mi,!this.allLayersSelectedIds.length),Object(s["a"])(e,Fi,!this.editingLayerId||!this.editingLayerSelectedFeaturesIds.length||this.editGeomTypes&&!this.editGeomTypes.includes("Polygon")),Object(s["a"])(e,Pi,!this.editingLayerId||this.editGeomTypes&&!this.editGeomTypes.includes("Point")),Object(s["a"])(e,Ti,!this.editingLayerId||this.editGeomTypes&&!this.editGeomTypes.some((function(e){return e.includes("Line")}))),Object(s["a"])(e,ji,!this.editingLayerId||this.editGeomTypes&&!this.editGeomTypes.includes("Polygon")),Object(s["a"])(e,Ii,!this.allLayersSelectedIds.length),Object(s["a"])(e,Si,!(this.copiedFeatures&&this.copiedFeatures.length)),Object(s["a"])(e,Di,0===this.editingLayerSelectedFeaturesIds.length),Object(s["a"])(e,Hi,1!==this.editingLayerSelectedFeaturesIds.length),Object(s["a"])(e,Wi,0===this.editingLayerSelectedFeaturesIds.length),Object(s["a"])(e,_i,!Object.keys(this.getAllSelected(this.componentId)).length),Object(s["a"])(e,Ai,!(this.editingLayerId&&this.editingLayerSelectedFeaturesIds.length<=1)),Object(s["a"])(e,Ri,!(this.editingLayerId&&this.allLayersSelectedIds.length>1)),Object(s["a"])(e,Vi,!(this.editingLayerId&&this.allLayersSelectedIds.length>1)),Object(s["a"])(e,Gi,!(this.editingLayerId&&this.allLayersSelectedIds.length>1)),Object(s["a"])(e,Ki,1!==this.editingLayerSelectedFeaturesIds.length),Object(s["a"])(e,qi,1!==this.editingLayerSelectedFeaturesIds.length),Object(s["a"])(e,Ji,1!==this.editingLayerSelectedFeaturesIds.length),Object(s["a"])(e,$i,!(this.editingLayerId&&this.selectedMouseTool===ji&&["geojson","vector"].includes(this.editingLayerOptions.type))),Object(s["a"])(e,lo,this.movePrevExtentDisabled),Object(s["a"])(e,co,this.moveNextExtentDisabled),Object(s["a"])(e,xi,this.undoDisabled),Object(s["a"])(e,Oi,this.redoDisabled),Object(s["a"])(e,Ci,this.saveDisabled),Object(s["a"])(e,no,!Object.keys(this.getAllSelected(this.componentId)).length),Object(s["a"])(e,ro,!this.editingLayerSelectedFeaturesIds.length),Object(s["a"])(e,Ni,!(this.editingLayerId&&this.editingLayerSelectedFeaturesIds.length>0)),e},showContextMenu:function(){return!1!==this.options.showContextMenu},userId:function(){var e=this.$store.getters["session/userData"]||{};return e.userId||"500322"},objectContextMenu:function(){return"boolean"!==typeof this.options.objectContextMenu||this.options.objectContextMenu},copiedFeatures:function(){var e,t,n=this;return this.editingLayerId?this.editGeomTypes?(e=[]).concat.apply(e,Object(a["a"])(this.editGeomTypes.map((function(e){return n.clipboard[e]})))):(t=[]).concat.apply(t,Object(a["a"])(Object.values(this.clipboard))):null},pasteButtonMessage:function(){return null===this.copiedFeatures?"Выберите слой на редактирование":this.copiedFeatures.length?"Объектов доступных для вставки: ".concat(this.copiedFeatures.length):"В буфере нет объектов доступных для вставки в редактируемый слой"},legendLayerEditable:function(){return this.legendSelectedItem&&this.legendSelectedItem.edit},loadPanelOptions:function(){return{message:"Операция выполняется. Пожалуйста подождите.",shading:!0,shadingColor:"rgba(255, 255, 255, 0.8)"}},topPanelStyle:function(){return{top:0,width:"100%",height:this.horizontalPanelHeight+"px"}},rightPanelStyle:function(){return{top:this.horizontalPanelHeight+"px",right:0,width:this.verticalPanelWidth+"px",height:this.snapshotSize.height+"px"}},bottomPanelStyle:function(){return{bottom:0,width:"100%",height:this.horizontalPanelHeight+"px"}},leftPanelStyle:function(){return{top:this.horizontalPanelHeight+"px",left:0,width:this.verticalPanelWidth+"px",height:this.snapshotSize.height+"px"}},reportGroupId:function(){return this.options&&this.options.hasOwnProperty("reportGroupId")?this.options.reportGroupId:5},useFilterBuilder:function(){return this.getGisOptions(this.componentId).useFilterBuilder},urlsToken:function(){return this.getUrlsToken(this.componentId)},isTimelineVisible:function(){return this.getTimelineVisible(this.componentId)},gltfLayers:function(){return this.getGltfLayers(this.componentId)},rights:function(){return this.getRights(this.componentId)}}),watch:{mapboxStyle:function(e){for(var t={},n=0,i=Object.keys(hh);n<i.length;n++){var o=i[n];t[o]=this.mapbox.getSource(o)&&this.mapbox.getSource(o)._data}if(Object.values(t)[0]){var a={};Object(Mt["a"])(hh,a);for(var s=0,r=Object.keys(a);s<r.length;s++){var l=r[s];a[l].data=t[l]}e.sources=ah(ah({},e.sources),a),this.mapboxDraw.options.styles.forEach((function(t){e.layers.push(t)}))}this.mapbox.setStyle(e),this.handleStyleChange()},gltfLayers:function(e){var t=this;e.forEach((function(e){e&&(t.isLayerVisible(e.id)?t.mapbox.getLayer(e.id)||t.mapbox.addLayer(e):t.mapbox.getLayer(e.id)&&t.mapbox.removeLayer(e.id))}))},bounds:function(e){Array.isArray(e)&&4===e.length&&(this.mapbox.fitBounds(e,{animate:!1}),this.setBounds({gisComponentId:this.componentId,bounds:null}))},selectedMouseTool:function(){if(this.selectedMouseTool===oo&&this.isYandexBaseMap){var e=Math.round(this.mapbox.getZoom())>fh?Math.round(this.mapbox.getZoom()):fh;this.mapbox.setZoom(e),this.mapbox.scrollZoom.disable()}else this.mapbox&&this.mapbox.scrollZoom.enable(this)},snapshotVisible:function(){if(this.snapshotVisible&&this.yandexMap){var e=Math.round(this.mapbox.getZoom())>fh?Math.round(this.mapbox.getZoom()):fh;this.mapbox.setZoom(e),this.mapbox.scrollZoom.disable()}else this.mapbox&&this.mapbox.scrollZoom.enable(this)}},created:function(){this.mapbox=null,this.legendLayers={},this.loadingImages={}},mounted:function(){var e=this;this.popoverContainer=this.$el,this.initMapbox(),this.initDrawCreateHandlers(),setTimeout((function(){e.mapbox.resize({fitBoundsFromLocalStorage:!0})}),200),this.saveBoundsToLocalStorage(!1),this.needResizeInterval&&(this.resizeInterval=setInterval((function(){if(e.$refs.mapContainer){var t=e.mapbox.getCanvas(),n=t.getBoundingClientRect(),i=Math.floor(n.width),o=Math.floor(n.height),a=e.$refs.mapContainer.getBoundingClientRect(),s=Math.floor(a.width),r=Math.floor(a.height);i===s&&o===r||e.mapbox.resize()}}),2e3)),this.$el.requestFullscreen||this.$el.webkitrequestFullscreen||this.$el.mozRequestFullscreen||(this.visibleTools.fullScreenMode=!1)},updated:function(){this.isFullScreen=!!document.fullscreenElement},beforeDestroy:function(){this.resizeInterval&&clearInterval(this.resizeInterval)},methods:ah(ah(ah({},Object(d["d"])("config",{initGisOptions:Zt["d"],setBounds:Zt["i"],setOption:wo["a"],setTablePanelLayerComponentId:Zt["K"],setFilterPanelLayerComponentId:Zt["m"],setEditingLayerComponentId:Zt["l"],setStyleFormLayerComponentId:Zt["J"],setActiveSnapTool:Zt["I"],setSnapPoint:Zt["H"],setVisibleFeatures:Zt["M"],setSelectionGeoJson:Zt["G"],setMapDiagram:Zt["x"],clearLayerFeatures:gn["d"],setLayerFeatures:gn["v"],addLayerFeatures:gn["a"],editLayerFeatures:gn["h"],deleteLayerFeatures:gn["g"],undoEdit:gn["Q"],redoEdit:gn["m"],removeChange:gn["n"],clearChanges:gn["c"],replaceChangeKey:gn["p"],setLayerEditingIds:gn["s"],selectByFeaturesProperties:gn["q"],setGisDownloadLink:Zt["k"]})),Object(d["b"])("config",{loadImageData:Xa["k"],setMapbox:Xt["K"],loadChildLayerComponents:Xa["g"],loadVisibleLayers:Xa["o"],loadLocalStorageVisibleLayers:Xa["n"],loadLayerChildComponents:Xt["p"],loadGisLayerCardComponentId:Xt["o"],addNoParentLayerComponent:Xa["a"],setExpanded:Xt["I"],setLayerEnable:Xt["H"],loadLayerDataFields:Xt["r"],getDatasetData:Qf["h"],datasetCreateBuffer:Qf["a"],datasetRefreshData:Qf["o"],datasetSaveData:Qf["q"],datasetSaveGeometry:Qf["r"],datasetDeleteData:Qf["d"],getDatasetStatistics:Qf["i"],exportLayerData:Xt["k"]})),{},{initMapbox:function(){var e=this;this.mapbox=new l.a.Map(ah(ah({container:this.$refs.mapContainer,preserveDrawingBuffer:!0,boxZoom:!1},this.options.mapboxOptions),{},{style:{version:8,sources:{},layers:[],glyphs:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},transformRequest:function(t,n){if(["Tile","Image"].includes(n)){var i,o=!gh(t);if(o)i=e.apiKey?e.apiKey:Object(eh["a"])("token");else{var a=e.urlsToken.find((function(e){return t.includes(e.url)}));i=a?"Basic "+a.token:null}if(i)return{url:o?"".concat(t,"&_config_user_id=").concat(e.userId):t,headers:{Authorization:"".concat(i)}}}}})),(this.options.mapboxOptions.dragRotate||this.options.mapboxOptions.pitchWithRotate)&&this.mapbox.addControl(new l.a.NavigationControl({showZoom:!1}),"bottom-right"),this.removeMapboxLogo(),this.mapboxReady=new Promise((function(t){e.mapbox.on("load",(function(){e.onMapboxLoaded(),t()}))})),this.mapbox.on("click",function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(n){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.showFeatureContextMenu=!1,e.setSelectionGeoJson({gisComponentId:e.componentId,geoJson:null}),t.t0=e.selectedMouseTool,t.next=t.t0===di?5:t.t0===Wi||t.t0===Hi?7:t.t0===po?9:t.t0===vi?11:t.t0===bi?13:t.t0===yi?15:t.t0===qi?22:t.t0===fo?24:26;break;case 5:return e.useSelectTool(n),t.abrupt("break",26);case 7:return e.useSelectWhileEditing(n,e.selectedMouseTool),t.abrupt("break",26);case 9:return e.useIdentificationTool(n),t.abrupt("break",26);case 11:return e.toggleMeasureDistanceTooltip(),t.abrupt("break",26);case 13:return e.toggleMeasureAreaTooltip(),t.abrupt("break",26);case 15:if(!e.selectAreaMode){t.next=20;break}return e.useSelectAreaByRadiusTool(n.lngLat,e.toolbarValues[yi]),t.abrupt("return");case 20:e.useCircleRadiusSelect(n.lngLat,e.toolbarValues[yi]);case 21:return t.abrupt("break",26);case 22:return e.removePartTool(n),t.abrupt("break",26);case 24:return e.handleCoordinatesChanged(n.lngLat.lat+" "+n.lngLat.lng),t.abrupt("break",26);case 26:e.options.video&&(e.playingVideo=!e.playingVideo,e.playingVideo?e.mapbox.getSource(lh).play():e.mapbox.getSource(lh).pause()),i=ah(ah({},n.lngLat),{},{tool:e.selectedMouseTool}),e.objectProperties&&(i.objectProperties=e.objectProperties),e.callLayerItemClickEvents(n),e.callEventAction(e.componentId,"onMapClick",i);case 31:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.mapbox.on("mousedown",(function(t){e.showFeatureContextMenu=!1,e.selectedMouseTool!==so&&e.selectedMouseTool!==oo||e.handleBoxZoomStart(t)})),this.mapbox.on("mouseup",(function(t){e.selectedMouseTool!==so&&e.selectedMouseTool!==oo||e.boxZoom&&e.handleBoxZoomEnd(t)})),this.mapbox.on("draw.create",(function(t){e.handleDrawCreate(t)})),this.mapbox.on("draw.delete",(function(){e.handleDrawDelete()})),this.mapbox.on("draw.update",(function(t){e.handleDrawUpdate(t)})),this.mapbox.on("contextmenu",(function(t){e.handleContextMenu(t)})),this.mapbox.on("zoomend",(function(){e.blockScaleTextChange||e.refreshScaleValues()})),this.mapbox.on("mousemove",this.onMouseMove),this.mapbox.on("move",(function(){if(e.yandexMap){var t=e.mapbox.getCenter(),n=e.mapbox.getZoom(),i=[t.lat,t.lng];e.yandexMap.setCenter(i),e.yandexMap.setZoom(n+1)}})),this.mapbox.on("moveend",(function(t){t.fitBoundsFromLocalStorage||t.fitBoundsExtentStory||(e.handleCharts(),e.saveVisibleFeatures(),e.saveBoundsToLocalStorage())})),this.mapbox.on("styleimagemissing",(function(t){var n=t.id;e.loadMissingImage(n)})),this.mapbox.getCanvas().addEventListener("keyup",(function(t){e.handleKeyUp(t)})),this.initMeasurePopups()},loadMissingImage:function(e){var t=this;this.loadImageData({gisComponentId:this.componentId,imageName:e}).then((function(n){n?t.loadingImages[n.name]||(t.loadingImages[n.name]=!0,t.mapbox.loadImage("".concat(n.url,"&_config_dataset=PAGES.DSPAGE"),(function(e,i){e?window.console.log(e):t.mapbox.hasImage(n.name)||t.mapbox.addImage(n.name,i)}))):window.console.log("Не удалось получить информацию по изображению ".concat(e))}))},removeMapboxLogo:function(){var e=this.$el.querySelector(".mapboxgl-ctrl-logo");e&&e.parentElement&&e.parentElement.remove()},setUserData:function(e){this.$store.commit("session/setUserData",e)},setApiKey:function(e){this.apiKey=e},initDrawCreateHandlers:function(){var e=this;[fi,ui,hi,pi].forEach((function(t){e.drawCreateHandlers[t]=function(t){e.selectAreaMode?e.useSelectAreaTool(t):e.useSelectByPolygonTool(t)}})),[vi,bi].forEach((function(t){e.drawCreateHandlers[t]=function(){return e.handleMeasured()}})),[Pi,Ei,wi,Ti,ji,Ai].forEach((function(t){e.drawCreateHandlers[t]=function(t){return e.addFeatures(t.features)}})),[Ki].forEach((function(t){e.drawCreateHandlers[t]=function(t){return e.addPartToSelectedObject(t.features)}})),[Ni].forEach((function(t){e.drawCreateHandlers[t]=function(t){e.getEditingFeatures().then((function(n){n.forEach((function(n){e.sliceSelectedObject(t.features[0],n)}))}))}}))},addLegendLayersToMap:function(e){var t=this;e.forEach((function(e){var n=t.getLayerOptions(e);n.group&&t.addLegendLayersToMap(t.getChildLayerComponentIds(e)),t.setMapbox({componentId:e,mapbox:t.mapbox})}))},onMouseMove:function(e){if(this.getActiveSnapTool(this.componentId)&&this.mapbox.getZoom()>=this.snapZoom&&this.getSnap(e),this.selectedMouseTool!==so&&this.selectedMouseTool!==oo||this.boxZoom&&this.handleBoxZoom(e),this.setMouseLngLatDebounce(e.lngLat),this.isMeasuring)switch(this.selectedMouseTool){case vi:this.handleMeasuringDistance(e.lngLat);break;case bi:this.handleMeasuringArea(e.lngLat);break}if(this.showEditPolygonArea&&this.editingLayerId)if(this.selectedMouseTool===Hi){var t=this.mapboxDraw.getSelectedPoints().features[0];if(t){var n=t.geometry.coordinates,i=new l.a.LngLat(n[0],n[1]);this.handleMeasuringArea(i)}else this.hideMeasurePopup()}else this.selectedMouseTool===ji&&this.handleMeasuringArea(e.lngLat)},onLayerDataRefreshing:function(e){var t=e.data,n=e.layerId,i=this.legendLayers[n];t||(t={features:[],type:"FeatureCollection"}),i.mapboxMapLayer.setGeoJsonData(t,!0),i.refreshDataResolver&&i.refreshDataResolver(t),this.$emit("featureEdit",t)},onMapboxLoaded:function(){var e,t=this;this.createTmpLayer();var n=null;Object.entries(this.$route.query).forEach((function(e){var o=Object(i["a"])(e,2),a=o[0],s=o[1],r=a.replace("Gis_","");r===t.componentId&&(n=JSON.parse(s))})),n?this.loadFromConfig(n):this.loadChildLayerComponents({componentId:this.componentId,gisComponentId:this.componentId,loadComponentId:this.options.linkedGisComponentId||null}).then((function(){return t.initGisOptions({componentId:t.componentId}),t.loadVisibleLayers({gisComponentId:t.componentId})})).then((function(){return t.loadLocalStorageVisibleLayers({gisComponentId:t.componentId})})),this.initSpaceImageryGeoJsonLayers(),this.initSelectionFillPatterns(),this.initSelectAreaSourceAndLayer(),this.mapboxDraw=new f.a({displayControlsDefault:!1,controls:{},modes:(e={simple_select:f.a.modes.simple_select},Object(s["a"])(e,E.NAME,E),Object(s["a"])(e,U.NAME,U),Object(s["a"])(e,k.NAME,k),Object(s["a"])(e,A.NAME,A),Object(s["a"])(e,G.NAME,G),Object(s["a"])(e,K.NAME,K),Object(s["a"])(e,_.NAME,_),Object(s["a"])(e,Z.NAME,Z),e)}),this.mapbox.addControl(this.mapboxDraw),!1===this.options.mapboxOptions.doubleClickZoom&&this.mapbox.doubleClickZoom.disable(),this.fitBoundsInitial(n&&n.mapExtent),this.options.video&&(this.mapbox.addSource(lh,{type:"video",urls:Array.isArray(this.options.video.urls)?this.options.video.urls:[],coordinates:Array.isArray(this.options.video.coordinates)?this.options.video.coordinates:[]}),this.mapbox.addLayer({id:ch,type:"raster",source:lh})),this.playingVideo=!0,this.legendItemsFlat.filter((function(e){return e.edit})).forEach((function(e){t.toggleLayerEdit(e,!0)}))},setGisState:function(e){var t=this,n=e.layerComponentIds,i=e.tablePanelLayerComponentId,o=e.filterPanelLayerComponentId,s=Object(a["a"])(n);return e.mainLayerComponentId&&s.push(e.mainLayerComponentId),this.loadLayersById(s).then((function(){t.initGisOptions({componentId:t.componentId}),i&&t.isTableButtonVisible(i)&&t.setTablePanelLayerComponentId({gisComponentId:t.componentId,layerComponentId:i}),o&&t.isFilterButtonVisible(o)&&t.setFilterPanelLayerComponentId({gisComponentId:t.componentId,layerComponentId:o})}))},loadFromConfig:function(e){var t=this;if(e.makeSnapshot&&e.reportId){var n={id:e.reportId,_config_dataset:"CONNECTIONS.DSREPORT"};Object(X["c"])("getData",n).then((function(n){e=ah(ah({},e),t.createGisConfig(n[0])),t.setGisState(e).then((function(){t.makeSnapshots(e,n[0].prop)}))}))}else e.layerComponentIds&&this.setGisState(e)},createGisConfig:function(e){var t,n={},i=e.prop.screenshot_data.args.snapshots,o=th(i);try{for(o.s();!(t=o.n()).done;){var a=t.value;if(a.c)for(var s=0;s<a.c.length;s++)a.c[s]=a.c[s].toString()}}catch(r){o.e(r)}finally{o.f()}return n.mainLayerComponentId=e.prop.component_id,n.featureId=e.prop.object_id,n.layerComponentIds=this.getSnapshotsLayersIds(i),n.mapExtent=i[0].e,n.snapshots=i,n},loadLayersById:function(e){var t=this,n=[];return e.forEach((function(e){var i=e.toString(),o=t.loadLayerComponent({gisComponentId:t.componentId,layerComponentId:i,addNoParentLayerToLegend:!0}).then((function(){var e=t.getLayerOptions(i),n=e.baseMap,o=e.baseTextMap,a=e.group,s=e.visible;if(n&&s)t.setActiveBaseMapLayerComponentId({gisComponentId:t.componentId,layerComponentId:i});else if(o&&s)t.setActiveBaseTextLayerComponentId({gisComponentId:t.componentId,layerComponentId:i});else if(!n&&!o){var r=new Promise((function(e){a?t.setExpanded({layerComponentId:i,expanded:!0}).then((function(){e()})):e()}));r.then((function(){t.setLayerVisibleAndEnabled(e)}))}}));n.push(o)})),Promise.all(n)},setLayerVisibleAndEnabled:function(e){var t=this,n=e.layerComponentId,i=e.group,o=e.items;this.setLayerVisible({componentId:n,visible:!0}),this.setOption({componentId:n,optionName:"enable",optionValue:!0}),i&&o.forEach((function(e){t.setOption({componentId:e,optionName:"enable",optionValue:!0})}))},sortLayers:function(){var e=this,t=function t(n,i){e.legendItemsFlat.filter((function(e){return e.parentId===n&&e.id!==n})).sort((function(e,t){return(e.pos||0)-(t.pos||0)})).forEach((function(e){i.push(e),t(e.id,i)}))},n=[];this.legendItemsFlat.filter((function(e){return e.id===e.parentId})).sort((function(e,t){return(e.pos||0)-(t.pos||0)})).forEach((function(e){n.push(e),t(e.id,n)})),n.forEach((function(t,n){var i=e.legendLayers[t.id];i&&(i.mapboxMapLayer.move(),i.mapboxMapLayer.setPos(n))})),this.moveSpaceImageryLayersToFront(),this.moveBufferSelectionLayersToFront(),this.drawLayers&&0!==this.drawLayers.length||(this.drawLayers=this.mapbox.getStyle().layers.filter((function(e){return 0===e.id.indexOf("gl-draw-")}))),this.drawLayers.forEach((function(t){e.mapbox.moveLayer(t.id)}))},fillLayerConfigs:function(e,t,n){var i=this;e.map((function(e){return ah(ah({},i.$store.getters["config/getItem"](e)),{},{options:i.$store.getters["config/getComponentOptions"](e)||{}})})).sort((function(e,t){return(e.componentPos||0)-(t.componentPos||0)})).forEach((function(e){if(e)if(sh.includes(e.componentType)){var o=e.options||{},a=o.items||[],s=ah(ah({},e),{},{options:ah(ah({},o),{},{items:[],cards:{}}),gis:i});i.fillLayerConfigs(a,s.options.items,s),t.push(s),"GisLayer"===s.componentType&&i.layerConfigsFlat.push(s)}else n&&e.layerComponentRole&&(n.options.cards[e.layerComponentRole]=e),i.$refs.dxLoadPanel&&i.$refs.dxLoadPanel.instance.hide()}))},setVisibleChildren:function(e){var t=this;e.forEach((function(e){var n=e.options.items;if(!1===e.options.multiple&&n){var i=n.find((function(e){return e.options.visible}));i||(n[0].options.visible=!0,i=n[0]),n.forEach((function(e){e.options.visible&&e.componentId!==i.componentId&&(e.options.visible=!1),e.options.items.length&&t.setVisibleChildren(e.options.items)}))}}))},handleToolbarButtonClick:function(e){var t=e.buttonName,n=e.value,i=e.callback;switch(t){case mi:this.selectAreaMode?this.useSelectAreaByBufferZoneTool(this.allLayersSelectedFeatures,this.toolbarValues[mi],!0):this.useSelectByBufferZoneTool(this.toolbarValues[mi],!0);break;case Fi:this.addFeatureByBufferZone(this.toolbarValues[Fi],!0,this.toolbarValues[Mi]);break;case Ri:this.addNewIntersectionFeature();break;case Vi:this.addNewUnionFeature();break;case Gi:this.addConvexHullFeature();break;case $i:this.activeSubstractTool=!this.activeSubstractTool;break;case _i:this.getPerimeter();break;case Ii:this.copyFeatures();break;case Si:this.pasteFeatures();break;case Di:this.deleteSelectedFeatures();break;case ao:this.changeScale(n);break;case no:this.useSnapshotForReportTool();break;case io:this.getMapSnapshot(this.boxZoom);break;case xi:this.useUndoTool();break;case Oi:this.useRedoTool();break;case Ci:this.saveChangesToServer(t,i);break;case Zi:case Yi:case Xi:case Qi:case eo:case to:this.changeGeometryType(t);break}},useUndoTool:function(){var e=null;[Hi,Wi,Ki,qi].includes(this.selectedMouseTool)&&(e=this.selectedMouseTool,this.handleToolbarButtonActiveStateChanged({buttonName:di})),this.undoEdit({layerComponentId:this.editingLayerId}),this.updateCoordinateEditor(),e&&this.handleToolbarButtonActiveStateChanged({buttonName:e})},useRedoTool:function(){var e=null;[Hi,Wi,Ki,qi].includes(this.selectedMouseTool)&&(e=this.selectedMouseTool,this.handleToolbarButtonActiveStateChanged({buttonName:di})),this.redoEdit({layerComponentId:this.editingLayerId}),this.updateCoordinateEditor(),e&&this.handleToolbarButtonActiveStateChanged({buttonName:e})},handleToolbarButtonActiveStateChanged:function(e){var t=e.buttonName;switch(uh.includes(t)||this.endEditFeature(!0),this.currentMeasurePopup.addClassName("hidden"),this.perimeterPopups.length&&(this.perimeterPopups.forEach((function(e){e.remove()})),this.perimeterPopups=[]),this.mouseTools.includes(t)&&(this.selectedMouseTool=t,this.resetIdentification()),t){case li:this.toggleLegend();break;case ci:this.toggleSpaceImagery();break;case di:case po:case yi:case so:this.selectionByClickIndex=0,this.toggleDrawerTool("simple_select",t);break;case ro:this.moveToSelectedObjects();break;case oo:this.toggleDrawerTool("simple_select",t);break;case lo:this.moveToPreviousExtent();break;case co:this.moveToNextExtent();break;case uo:this.moveMapToUserPosition();break;case ui:case Ti:case vi:this.toggleDrawerTool(k.NAME,t);break;case pi:this.toggleDrawerTool(G.NAME,t);break;case hi:case ji:case bi:this.toggleDrawerTool(A.NAME,t);break;case fi:this.toggleDrawerTool(E.NAME,t);break;case Pi:this.toggleDrawerTool(U.NAME,t);break;case Ei:break;case wi:break;case Ui:case zi:this.getActiveSnapTool(this.componentId)===t?(this.setActiveSnapTool({gisComponentId:this.componentId,snappingTool:null}),this.mapbox.snapMapDraw=null):(this.setActiveSnapTool({gisComponentId:this.componentId,snappingTool:t}),this.mapbox.snapMapDraw={type:"vertex",distance:this.snapTolerance},this.saveVisibleFeatures());break;case Hi:this.toggleEditFeatureTools(t);break;case Wi:this.toggleMoveFeatureTools(t);break;case Ki:this.toogleAddPartFeatureTools(t);break;case qi:this.toggleDrawerTool("simple_select",t);break;case fo:this.toggleDrawerTool("simple_select",t);break;case ho:this.toggleFullScreen();break;case Ai:this.showCoordinatesEditor=!0;break;case Ni:this.toggleDrawerTool(k.NAME,t);break}},toggleFullScreen:function(){document.fullscreenElement?document.exitFullscreen():this.$el.requestFullscreen().catch((function(e){alert("Error attempting to enable full-screen mode: ".concat(e.message," (").concat(e.name,")"))}))},toggleDrawerTool:function(e){this.mapboxDraw.deleteAll(),this.mapboxDraw.changeMode(e),!1===this.options.mapboxOptions.doubleClickZoom&&this.mapbox.doubleClickZoom.disable()},toogleAddPartFeatureTools:function(e){var t=this;this.getEditingFeatures().then((function(n){switch(n[0].geometry.type){case"LineString":case"MultiLineString":t.toggleDrawerTool(k.NAME,e);break;case"Polygon":case"MultiPolygon":t.toggleDrawerTool(A.NAME,e);break}}))},toggleEditFeatureTools:function(){var e=this;this.getEditingFeatures().then((function(t){e.setLayerEditingIds({componentId:e.editingLayerId,ids:t.map((function(e){return e.id}))}),e.editFeaturePoints(t[0]),e.saveVisibleFeatures()}))},toggleMoveFeatureTools:function(){var e=this;this.getEditingFeatures().then((function(t){var n=t.map((function(e){return e.id}));e.setLayerEditingIds({componentId:e.editingLayerId,ids:n});var i=t.map((function(e){var t=ah({},e);return t.geometry&&t.geometry.crs&&delete t.geometry.crs,t}));e.mapboxDraw.deleteAll(),e.mapboxDraw.set({type:"FeatureCollection",features:i}),e.mapboxDraw.changeMode(Z.NAME,{featureIds:n}),e.saveVisibleFeatures()}))},editFeaturePoints:function(e){this.mapboxDraw.deleteAll(),"Point"===e.geometry.type?this.mapboxDraw.changeMode(_.NAME,{geojson:e}):this.mapboxDraw.changeMode(K.NAME,{geojson:e})},setEditMoveMode:function(e){var t=e.map((function(e){var t=ah({},e);return t.geometry&&t.geometry.crs&&delete t.geometry.crs,t}));this.mapboxDraw.deleteAll(),this.mapboxDraw.set({type:"FeatureCollection",features:t});var n=t.map((function(e){return e.id}));this.mapboxDraw.changeMode(Z.NAME,{featureIds:n})},toggleLegend:function(){window.console.warn("toggleLegend not implemented")},toggleSpaceImagery:function(){window.console.warn("toggleSpaceImagery not implemented")},toggleLayerTextVisible:function(e,t){var n=this.legendLayers[e];n.mapboxMapLayer.setTextVisibility(t)},toggleLayerVisible:function(e,t){var n=this;t||this.setSelectedFeatures(e,[],!1);var i=this.legendItemsFlat.filter((function(t){return t.parentId===e&&t.id!==e}));i.forEach((function(e){e.visible=t,e.styleRules&&e.styleRules.forEach((function(e){return e.options.visible=t})),n.toggleLayerVisible(e.id,t)}));var o=this.legendLayers[e];o&&(t&&"wfs"===o.type&&this.getWFSData(o),o.visible=t,o.mapboxMapLayer.setVisibility(t))},getWFSData:function(e){var t=this,n=e.mapboxMapLayer.getGeoJsonData();if(!n.features.length){var o=e.layerComponentId,a=this.layerConfigsFlat.find((function(e){return o===e.componentId}));if(a){var s=this.legendItemsFlat.find((function(e){return o===e.id}));s.loading=!0;var r=a.options||{},l=r.url||"",c={service:"wfs",request:"GetFeature",version:r.version||"2.0.0",outputFormat:"application/json",typeName:r.typeName||""};if(r.maxFeatures){var d=+c.version.split(".")[0],u="maxFeatures";d>1&&(u="count"),c[u]=r.maxFeatures}var p=Object.entries(c).map((function(e){var t=Object(i["a"])(e,2),n=t[0],o=t[1];return"".concat(n,"=").concat(o)})).join("&"),f="".concat(l,"?").concat(p);fetch(f).then((function(e){if(!e.ok)throw e;return e.json()})).then((function(e){t.onLayerDataRefreshing({data:e,layerId:o})})).catch((function(){Object(Yl["a"])({message:"Сервис ".concat(l," недоступен"),width:"auto"},"error",3e3)})).finally((function(){s.loading=!1}))}}},toggleLayerEdit:function(e,t){this.endEditFeature(!0),t?this.setEditingLayerComponentId({gisComponentId:this.componentId,layerComponentId:e}):this.setEditingLayerComponentId({gisComponentId:this.componentId,layerComponentId:null})},getLayerSavedOptions:function(e){var t=localStorage.getItem(e);return t?JSON.parse(t):{}},cancelEditing:function(){if(this.editingLayerId){this.endEditFeature(!0);var e=this.legendLayers[this.editingLayerId];this.toggleLayerEdit(e,!1)}},handleDrawDelete:function(){switch(this.selectedMouseTool){case vi:case bi:this.currentMeasurePopup.addClassName("hidden"),this.handleMeasured();break}},handleDrawCreate:function(e){this.selectedMouseTool&&this.drawCreateHandlers[this.selectedMouseTool]&&this.drawCreateHandlers[this.selectedMouseTool](e)},handleDrawUpdate:function(e){this.editFeatures(e.features)},handleKeyUp:function(e){if(e.key===dh)switch(this.selectedMouseTool){case Hi:this.mapboxDraw.trash();break}},handleBoxZoomStart:function(e){this.mapbox.dragPan.disable(),this.boxZoom={startPos:e.point}},handleBoxZoom:function(e){if(this.boxZoom){this.boxZoom.element||this.createBoxZoom(this.boxZoom.startPos),this.boxZoom.lastPos=e.point;var t=Math.min(this.boxZoom.lastPos.x,this.boxZoom.startPos.x),n=Math.max(this.boxZoom.lastPos.x,this.boxZoom.startPos.x),i=Math.min(this.boxZoom.lastPos.y,this.boxZoom.startPos.y),o=Math.max(this.boxZoom.lastPos.y,this.boxZoom.startPos.y);this.boxZoom.element.style.transform="translate(".concat(t,"px, ").concat(i,"px)"),this.boxZoom.element.style.width="".concat(Math.abs(n-t),"px"),this.boxZoom.element.style.height="".concat(Math.abs(o-i),"px")}},createBoxZoom:function(e){var t=this.mapbox.getContainer(),n=document.createElement("div");n.classList.add("mapboxgl-boxzoom"),n.style.transform="translate(".concat(e.x,"px, ").concat(e.y,"px)"),n.addEventListener("mousemove",this.recalculationPoint),this.boxZoom.element=n,t.appendChild(n),document.addEventListener("mouseup",this.handleBoxZoomEnd)},recalculationPoint:function(e){var t={x:this.boxZoom.lastPos.x+e.movementX,y:this.boxZoom.lastPos.y+e.movementY};this.handleBoxZoom({point:t})},handleBoxZoomEnd:function(e){document.removeEventListener("mouseup",this.handleBoxZoomEnd),this.boxZoom.lastPos||this.boxZoom.element?(this.boxZoom.lastPos=e.point||this.boxZoom.lastPos,this.boxZoom.element.removeEventListener("mousemove",this.recalculationPoint),this.boxZoom.element.remove(),mh(this.boxZoom.startPos,this.boxZoom.lastPos)<this.selectClickTolerance||(this.selectedMouseTool===so?this.mapbox.fitScreenCoordinates(this.boxZoom.startPos,this.boxZoom.lastPos,this.mapbox.getBearing()):this.getMapSnapshot(this.boxZoom)),this.boxZoom=null):this.boxZoom=null},getActualSelectedFeatures:function(){var e=[],t=this.getAllSelected(this.componentId);for(var n in t)e.push(this.getLayerFeaturesForEdit(n));return Promise.all(e).then((function(e){return e.reduce((function(e,t){return e.concat(t)}),[])}))},handleContextMenu:function(e){if(this.isMeasuring)switch(this.selectedMouseTool){case vi:this.handleMeasuringDistance(e.lngLat);break;case bi:this.handleMeasuringArea(e.lngLat);break}var t,n=e.point,i=5,o=[[n.x-i,n.y-i],[n.x+i,n.y+i]],a=this.mapbox.queryRenderedFeatures(o),s=this.getAllSelected(this.componentId),r=null,l=th(a);try{for(l.s();!(t=l.n()).done;){var c=t.value;if(c.layer.metadata){var d=s[c.layer.metadata.layerComponentId];if(d&&d.includes(c.id)){r=c;break}}}}catch(u){l.e(u)}finally{l.f()}r&&this.layerSelectionRightClick(ah(ah({},e),{},{layerId:r.layer.metadata.layerComponentId,featureProperties:r.properties}))},layerSelectionRightClick:function(e){var t=this.getLayerRights(e.layerId).showCard;t&&(this.lastContextMenuFeature=e.featureProperties,this.lastContextMenuLayerId=e.layerId,this.objectContextMenu?this.showFeatureContextMenu=!0:this.handleOpenCardClick(),this.featureContextMenuPosition={left:"".concat(e.point.x,"px"),top:"".concat(e.point.y,"px")})},moveMapToFeatures:function(e,t,n){var i=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.15,s=this.getLayerOptions(e),r=this.getLayerAllFeatures(e).filter((function(e){return t.includes(e.id)})),l=t.filter((function(e){return!r.find((function(t){return t.id===e}))}));this.loadGeoJsons(e,l,s).then((function(e){var t=[].concat(Object(a["a"])(r),Object(a["a"])(e)),s={type:"FeatureCollection",features:t};if(n){var l=c["center"](s);i.mapbox.jumpTo({zoom:n,center:l.geometry.coordinates,animate:!1})}else{var d=c["buffer"](s,o),u=c["bbox"](d);i.mapbox.fitBounds(u,{animate:!1})}}))},handleOpenCardClick:function(){var e=this,t=this.lastContextMenuFeature;t?this.lastContextMenuLayerId&&(this.loadGisLayerCardComponentId({layerComponentId:this.lastContextMenuLayerId}).then((function(n){n&&e.callComponentAction(ah(ah({},t||{}),{},{componentId:n,actionName:"show"}))})),this.showFeatureContextMenu=!1):this.showFeatureContextMenu=!1},handleContextMenuItemClick:function(e){this.callEventAction(e,"onClick",{}),this.showFeatureContextMenu=!1},stopPropagation:function(e){e.stopPropagation()},getPerimeter:function(){var e=this;this.getActualSelectedFeatures().then((function(e){var t=[];return e.forEach((function(e){var n=e.geometry.coordinates,i=yh(n),o=c["pointOnFeature"](e).geometry.coordinates;t.push({perimeter:i,lngLat:o})})),t})).then((function(t){t.forEach((function(t){var n=new l.a.Popup({className:"gis__tooltip",closeButton:!1,closeOnClick:!1}).setLngLat(t.lngLat).setHTML("<div>".concat(t.perimeter.toFixed()," м</div>")).addTo(e.mapbox);e.perimeterPopups.push(n)}))}))},copyFeatures:function(){var e=this;Object.keys(this.clipboard).forEach((function(t){e.clipboard[t]=[]})),this.getActualSelectedFeatures().then((function(t){t.forEach((function(t){var n=t.geometry.type.replace("Multi","").replace("String","");e.clipboard[n].push(t)}))}))},pasteFeatures:function(){var e=this.copiedFeatures.map((function(e){var t={};return Object(Mt["a"])(e,t),t.id=(new u["a"]).toString(),t.properties.id=t.id,t}));this.addFeatures(e,!0)},saveChangesToServer:function(e,t){var n=this;this.endEditFeature(!0),t({buttonName:e,state:{loading:!0}}),this.saveLayerToServer(this.editingLayerId).then((function(){n.clearChanges({layerComponentId:n.editingLayerId}),n.saveVisibleFeatures()})).finally((function(){return t({buttonName:e,state:{loading:!1}})}))},saveLayerToServer:function(e){var t=this.getLayerChanges(e),n=[];if(t.added[0]){var i=this.getFeaturesByIds(e,t.added);n.push(this.addFeaturesToServer(e,i))}if(t.deleted[0]&&n.push(this.deleteFeaturesFromServer(e,t.deleted)),t.edited[0]){var o=this.getFeaturesByIds(e,t.edited);n.push(this.updateFeaturesToServer(e,o))}return Promise.all(n)},updateFeaturesToServer:function(e,t){var n=this,i=this.getLayerOptions(e),o=t.map((function(e){return n.datasetSaveGeometry({componentId:i.dataSetComponentId,feature:e})}));return Promise.all(o)},addFeaturesToServer:function(e,t){var n=this,i=this.getLayerOptions(e),o=t.map((function(e){var t=ah({geojson:e},e.properties);return delete t.the_geom,t}));return i.defaultValues&&(o=o.map((function(e){return ah(ah({},e),i.defaultValues)}))),this.datasetSaveData({componentId:i.dataSetComponentId,row_data:o,is_new:!0}).then((function(i){return i.forEach((function(i,o){n.replaceChangeKey({layerComponentId:e,keyOld:t[o].id,keyNew:i.id,properties:i}),t[o].id=i.id,t[o].properties.id=i.id})),i}))},deleteFeaturesFromServer:function(e,t){var n=this,i=this.getLayerOptions(e),o=[];return t.forEach((function(e){var t;t=i.deleteObject?n.datasetDeleteData({componentId:i.dataSetComponentId,id:e}):n.datasetSaveGeometry({componentId:i.dataSetComponentId,properties:{id:e}}),o.push(t)})),Promise.all(o)},onAddFeaturesServer:function(e,t,n){var i=this,o=this.getLayerOptions(e);t||(t=this.getFeaturesByIds(e,n));var a=t.map((function(t){return new Promise((function(n){Xf["b"].$once("".concat(Xf["a"],".").concat(t.id),(function(a){o.blockPropertiesUpdate||(t.properties=ah({},a),t.id=t.properties.id,i.addLayerFeatures({layerComponentId:e,features:[t]}),i.removeChange({layerComponentId:e,key:t.id}),i.setLayerSelectedIds({layerComponentId:e,ids:[t.id]})),n()}))}))}));return Promise.all(a)},getVisibleFeaturesForLayer:function(e){var t=this.getMapboxLayerIds(e),n=this.mapbox.queryRenderedFeatures(null,{layers:t});return n},saveVisibleFeatures:function(){if(this.getActiveSnapTool(this.componentId)&&this.mapbox.getZoom()>=this.snapZoom){this.visibleFeatures=[];var e=this.getMapboxStyle(this.componentId),t=this.mapbox.queryRenderedFeatures(null,{layers:e.layers.map((function(e){return e.id}))}),n=t.filter((function(e){return e.id&&![rh].includes(e.source)}));this.setVisibleFeatures({gisComponentId:this.componentId,visibleFeatures:n})}},getSnap:function(e){var t,n=this.getActiveSnapTool(this.componentId);if(n){var i=this.getVisibleFeatures(this.componentId);switch(n){case Ui:t=zr(e.lngLat,i,this.mapbox,null);break;case zi:t=Hr(e.lngLat,i,this.mapbox,null);break}}t&&t.distance<this.snapTolerance?this.mapbox.snapMapDraw.point=t.lngLat:this.mapbox.snapMapDraw.point=null,this.setSnapPoint({gisComponentId:this.componentId,lngLat:this.mapbox.snapMapDraw.point})},changeEditingFeaturesByHistory:function(e){var t=e.operationType,n=e.operationFeature,i=e.undo;if(this.editingFeatures.length){var o=-1,a={};switch(this.editingFeatures.forEach((function(e,t){e.id===n.id&&(Object(Mt["a"])(n,a),o=t)})),t){case"add":i?-1!==o&&this.mapboxDraw.delete([n.id]):this.mapboxDraw.add(a);break;case"delete":i?this.mapboxDraw.add(a):this.mapboxDraw.delete([n.id]);break;case"edit":this.mapboxDraw.add(a);break}}},repaint:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.mapbox&&this.mapbox.resize();case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),setMapTool:function(e){var t=e.name;t&&this.handleToolbarButtonActiveStateChanged({buttonName:t})},updateLegend:function(e){e&&e.type&&("geojson"!==e.type&&"vector"!==e.type||e.mapboxLayers&&Array.isArray(e.mapboxLayers)||(e.mapboxLayers=this.setMapboxLayers()),this.handleLayerAdd(e))},setMapboxLayers:function(){var e=Math.random().toString(36).substr(2,9);return[{id:"".concat(e,"_0"),source:e,type:"line",paint:{"line-color":"red","line-width":2,"line-opacity":1,"line-translate":[0,0]},layout:{visibility:"visible"},maxzoom:24,minzoom:0}]},getVisibleMapboxLegendLayerIds:function(){var e=[];return Object.values(this.legendLayers).filter((function(e){return e.visible})).forEach((function(t){e.push.apply(e,Object(a["a"])(t.mapboxMapLayer.getLayerIds()))})),e},getEnabledMapboxLegendLayerIds:function(){var e=[];return Object.values(this.legendLayers).filter((function(e){return e.visible&&e.enable})).forEach((function(t){e.push.apply(e,Object(a["a"])(t.mapboxMapLayer.getLayerIds()))})),e},getSelectedMapboxLegendLayerId:function(){var e=this,t=[];return Object.values(this.legendLayers).filter((function(t){return t.layerComponentId===e.legendSelectedItem.id})).forEach((function(e){t.push.apply(t,Object(a["a"])(e.mapboxMapLayer.getLayerIds()))})),t},callLayerItemClickEvents:function(e){var t=this,n=this.getVisibleLayers(this.componentId),i=this.queryRenderedFeatures(e.point,n),o=i.map((function(e){return e&&e.layer&&e.layer.metadata&&e.layer.metadata.layerComponentId?e.layer.metadata.layerComponentId:null})).filter((function(e){return e}));o.forEach((function(e){var n=i.filter((function(t){return t&&t.layer&&t.layer.metadata&&t.layer.metadata.layerComponentId===e})),o=c["featureCollection"](n),a=c["bbox"](o);t.callEventAction(e,"onItemClick",{bbox:a,features:n})}))},setMapPosition:function(e){var t=e.bbox;return this.mapbox.fitBounds(t),Promise.resolve()},exportSelectedFeatures:function(){var e=this,t=this.$store.getters["session/userData"]||{},n=this.getLayerOptions(this.lastContextMenuLayerId),i=n.text,o=new Date,a="Выгрузка_".concat(i.replace(/\s/g,"_"),"_от_").concat(o.toLocaleDateString(),"_").concat(o.toLocaleTimeString([],{timeStyle:"short"}));this.showFeatureContextMenu=!1,this.exportLayerData({layerComponentId:this.lastContextMenuLayerId,selected:!0,url:"https://files-service.rusgis.com/apiFiles",format:"geojson",epsg:4326,exportUserId:t.userId||"500322"}).then((function(t){e.setGisDownloadLink({gisComponentId:e.componentId,downloadLink:"".concat("https://files-service.rusgis.com/downloadFile","?guid=").concat(t.guid,"&_config_dataset=").concat(t._config_dataset,"&filename=").concat(a)})}))}})};function mh(e,t){var n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}function gh(e){var t="/tms,http://89.108.84.38:8101/tms,https://composite.rusgis.com".split(",");return!t.some((function(t){return 0===e.indexOf(t)}))}function yh(e){var t=0;return e.forEach((function(n,i){if(2!==n.length)t+=yh(n);else if(i<e.length-1){var o=c["point"](e[i]),a=c["point"](e[i+1]);t+=c["distance"](o,a,{units:"meters"})}})),t}},"3fdc":function(e,t,n){},"3fe4":function(e,t,n){"use strict";var i=n("c955"),o=n.n(i);o.a},4173:function(e,t,n){"use strict";var i=n("eb66"),o=n.n(i);o.a},4223:function(e,t,n){"use strict";var i=n("feff"),o=n.n(i);o.a},"44aa":function(e,t,n){},"44d3":function(e,t,n){"use strict";var i=n("92c0"),o=n.n(i);o.a},"45a0":function(e,t,n){},"46f2":function(e,t,n){"use strict";var i=n("987e"),o=n.n(i);o.a},"47a9":function(e,t,n){},"486a":function(e,t,n){},"4a5c":function(e,t,n){},"4d04":function(e,t,n){"use strict";var i=n("7b59"),o=n.n(i);o.a},5271:function(e,t,n){},"53c0":function(e,t,n){"use strict";var i=n("45a0"),o=n.n(i);o.a},5443:function(e,t,n){"use strict";var i=n("93ae"),o=n.n(i);o.a},5484:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return DiagramCanvasLayer}));var core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("3b2b"),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("ac6a"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("ac4d"),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("8a81"),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es6_string_iterator__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("5df3"),core_js_modules_es6_string_iterator__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es6_string_iterator__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("1c4c"),core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("6b54"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es6_reflect_construct__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("2397"),core_js_modules_es6_reflect_construct__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es6_reflect_construct__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("7f7f"),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("a481"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_9__),core_js_modules_es6_array_fill__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("6c7b"),core_js_modules_es6_array_fill__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(core_js_modules_es6_array_fill__WEBPACK_IMPORTED_MODULE_10__),C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("d4ec"),C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("257e"),C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_get__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("45eb"),C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("bee2"),C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("262e"),C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("99de"),C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("7e84"),C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("ade3"),_CanvasMapLayer__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("2419"),_utils_common__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("bc2f"),_turf_turf__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("595b"),_turf_turf__WEBPACK_IMPORTED_MODULE_21___default=__webpack_require__.n(_turf_turf__WEBPACK_IMPORTED_MODULE_21__),mapbox_gl__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("e192"),mapbox_gl__WEBPACK_IMPORTED_MODULE_22___default=__webpack_require__.n(mapbox_gl__WEBPACK_IMPORTED_MODULE_22__);function _createForOfIteratorHelper(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"===typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,i=Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_17__["a"])(e);if(t){var o=Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_17__["a"])(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_16__["a"])(this,n)}}function _isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var BAR_WIDTH=20,MIN_SIZE=15,DiagramCanvasLayer=function(_CanvasMapLayer){Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_15__["a"])(DiagramCanvasLayer,_CanvasMapLayer);var _super=_createSuper(DiagramCanvasLayer);function DiagramCanvasLayer(e){var t;return Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_11__["a"])(this,DiagramCanvasLayer),t=_super.call(this,e),Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_18__["a"])(Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__["a"])(t),"pointFeatureCollection",{features:[],type:"FeatureCollection"}),Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_18__["a"])(Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__["a"])(t),"summaries",null),Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_18__["a"])(Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__["a"])(t),"style",null),Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_18__["a"])(Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__["a"])(t),"angleOrigin",0),Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_18__["a"])(Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__["a"])(t),"angleDirection",1),Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_18__["a"])(Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__["a"])(t),"fillOpacity",1),Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_18__["a"])(Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__["a"])(t),"borderStyle","none"),Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_18__["a"])(Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__["a"])(t),"mouseMoveDebounce",Object(_utils_common__WEBPACK_IMPORTED_MODULE_20__["a"])(1e3,(function(e){t.onMouseStop(e)}))),Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_18__["a"])(Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__["a"])(t),"mouseMoveClosePopup",Object(_utils_common__WEBPACK_IMPORTED_MODULE_20__["b"])(800,(function(e,n){t.tryClosePopup(e,n)}))),Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_18__["a"])(Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__["a"])(t),"onMouseMoveBinded",t.onMouseMove.bind(Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__["a"])(t))),Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_18__["a"])(Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__["a"])(t),"popup",new mapbox_gl__WEBPACK_IMPORTED_MODULE_22___default.a.Popup({closeButton:!1,closeOnClick:!1})),e.on("mousemove",t.onMouseMoveBinded),t}return Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_14__["a"])(DiagramCanvasLayer,null,[{key:"parseAttributes",value:function(e){var t,n=[];while(null!=(t=this.attributeRegex.exec(e)))n.push(t[1]);return n}}]),Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_14__["a"])(DiagramCanvasLayer,[{key:"draw",value:function(e,t,n){if(e[0]&&t){var i=document.getElementById(this.elementId);this.ctx=i.getContext("2d"),this.style=t,this.summaries=n,this.pointFeatureCollection.features=[],this.style.paint["border-color"]||(this.style.paint["border-color"]="#000000"),this.ctx.strokeStyle=this.formatAlfaColor(this.style.paint["border-color"],this.style.paint["border-opacity"]),this.ctx.lineWidth=this.style.paint["border-width"]||0,this.angleOrigin=Math.PI*this.style.layout["piechart-corner"]/180,this.angleDirection="anticlockwise"===this.style.layout["piechart-direction"]?-1:1,this.fillOpacity=this.style.paint["fill-opacity"]||1,this.borderStyle=this.style.paint["border-style"]||"none","dash"===this.borderStyle?this.ctx.setLineDash([2*this.ctx.lineWidth,this.ctx.lineWidth]):"dot"===this.borderStyle?this.ctx.setLineDash([this.ctx.lineWidth,this.ctx.lineWidth+1.5]):"longDash"===this.borderStyle&&this.ctx.setLineDash([3*this.ctx.lineWidth,this.ctx.lineWidth]);var o,a=_createForOfIteratorHelper(e);try{for(a.s();!(o=a.n()).done;){var s=o.value;this.drawDiagram(s)}}catch(r){a.e(r)}finally{a.f()}}}},{key:"drawDiagram",value:function(e){var t=this.getSize(e),n=this.getTuples(e),i=n.some((function(e){return e.value>0}));if(i){t<MIN_SIZE&&(t=MIN_SIZE);var o=this.getPoint(e),a=this.mapbox.project(o),s={type:"Feature",geometry:{type:"Point",coordinates:o},point:a,size:t,tuples:n};this.pointFeatureCollection.features.push(s);var r=n.reduce((function(e,t){return e+(t.value||0)}),0),l=this.style.layout["chart-type"];"pie"===l?this.drawPie(t,a,n,r):"bar"===l&&this.drawBars(t,a,n,r)}}},{key:"drawPie",value:function(e,t,n,i){var o,a=e/2,s=this.ctx,r=this.angleOrigin,l=_createForOfIteratorHelper(n);try{for(l.s();!(o=l.n()).done;){var c=o.value,d=this.angleDirection*(c.value/i)*2*Math.PI;s.fillStyle=this.formatAlfaColor(c.fillColor,this.fillOpacity),s.beginPath(),s.moveTo(t.x,t.y),s.arc(t.x,t.y,a,r,r+d,this.angleDirection<0),s.lineTo(t.x,t.y),s.fill(),"none"!==this.borderStyle&&s.stroke(),r+=(this.counterClockwise?-1:1)*d}}catch(u){l.e(u)}finally{l.f()}}},{key:"drawBars",value:function(e,t,n,i){var o=this.ctx,a=BAR_WIDTH;a*n.length>e&&(a=e/n.length);var s,r=t.x-e/2,l=t.y+e/2,c=n.length>1?(e-a*n.length)/n.length-1:0,d=_createForOfIteratorHelper(n);try{for(d.s();!(s=d.n()).done;){var u=s.value,p=u.value/i*e;o.fillStyle=this.formatAlfaColor(u.fillColor,this.fillOpacity),o.fillRect(r,l-p,a,p),"none"!==this.borderStyle&&o.strokeRect(r,l-p,a,p),r+=a+c}}catch(f){d.e(f)}finally{d.f()}}},{key:"getSize",value:function getSize(feature){var size=this.style.layout["chart-size-px"],sizeExpr="attr"===this.style.layout["chart-size"]?this.style.layout["chart-size-attribute"]:null;if(sizeExpr)try{var attrs=DiagramCanvasLayer.parseAttributes(sizeExpr),numerator=sizeExpr,denominator=sizeExpr,_iterator4=_createForOfIteratorHelper(attrs),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var attr=_step4.value,value=feature.properties[attr];numerator=numerator.replace("[".concat(attr,"]"),value||0),denominator=denominator.replace("[".concat(attr,"]"),this.summaries[attr].max||0)}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}size=eval(denominator)?size*eval(numerator)/eval(denominator):0}catch(err){window.console.error(err)}return size}},{key:"getPoint",value:function(e){var t,n,i=e.geometry;switch(i.type){case"Point":t=i.coordinates;break;case"MultiPoint":case"LineString":t=i.coordinates[0];break;case"Polygon":n=_turf_turf__WEBPACK_IMPORTED_MODULE_21__["centroid"](i),t=n.geometry.coordinates;break;case"MultiLineString":t=i.coordinates[0][0];break;case"MultiPolygon":n=_turf_turf__WEBPACK_IMPORTED_MODULE_21__["centroid"](i),t=n.geometry.coordinates;break}return t}},{key:"getTuples",value:function(e){var t=[];if(this.style.layout["chart-attrs"]){var n,i=_createForOfIteratorHelper(this.style.layout["chart-attrs"]);try{for(i.s();!(n=i.n()).done;){var o=n.value,a=e.properties[o.name];Object(_turf_turf__WEBPACK_IMPORTED_MODULE_21__["isNumber"])(a)&&a>=0&&t.push({name:o.caption||o.name,value:a,fillColor:o.color||"#ffffff"})}}catch(s){i.e(s)}finally{i.f()}}return t}},{key:"dispose",value:function(){Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_get__WEBPACK_IMPORTED_MODULE_13__["a"])(Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_17__["a"])(DiagramCanvasLayer.prototype),"dispose",this).call(this),this.mapbox.off("mousemove",this.onMouseMoveBinded),this.removePopup()}},{key:"onMouseMove",value:function(e){this.mouseMoveDebounce(e),this.mouseMoveClosePopup(e,this.popupTimestamp)}},{key:"tryClosePopup",value:function(e,t){t&&this.popupTimestamp===t&&!this.isMouseInside(this.popupFeature,e)&&this.removePopup()}},{key:"isMouseInside",value:function(e,t){var n=e.point,i=e.size,o=Math.pow(n.x-t.point.x,2)+Math.pow(n.y-t.point.y,2);return o<i*i/4}},{key:"onMouseStop",value:function(e){var t=[e.lngLat.lng,e.lngLat.lat];if(!this.disposed&&this.pointFeatureCollection.features[0]){var n=_turf_turf__WEBPACK_IMPORTED_MODULE_21__["nearestPoint"](t,this.pointFeatureCollection);if(this.isMouseInside(n,e)){var i=this.generateDiagramInfo(n);this.popup.setLngLat(n.geometry.coordinates).setHTML(i).addTo(this.mapbox),this.popupFeature=n,this.popupTimestamp=(new Date).getTime()}else this.popup&&this.removePopup()}}},{key:"removePopup",value:function(){this.popupTimestamp=null,this.popup&&this.popup.remove()}},{key:"generateDiagramInfo",value:function(e){var t,n="",i=_createForOfIteratorHelper(e.tuples);try{for(i.s();!(t=i.n()).done;){var o=t.value;n+="<tr>\n      <td><div style='background-color:".concat(o.fillColor,";'></div></td>\n      <td>").concat(o.name,"</td>\n      <td>").concat(o.value,"</td>\n      </tr>")}}catch(a){i.e(a)}finally{i.f()}return'<table class="diagram-layer-tooltip">'.concat(n,"</table>")}}]),DiagramCanvasLayer}(_CanvasMapLayer__WEBPACK_IMPORTED_MODULE_19__["a"]);Object(C_Users_Documents_Projects_platform_js_api_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_18__["a"])(DiagramCanvasLayer,"attributeRegex",new RegExp(/\[(\w+)\]/g))},"56dd":function(e,t,n){"use strict";var i=n("f5a6"),o=n.n(i);o.a},5709:function(e,t,n){},5846:function(e,t,n){"use strict";var i=n("5c0b"),o=n.n(i);o.a},"58c6":function(e,t,n){},"5ab5":function(e,t,n){},"5b43":function(e,t,n){"use strict";var i=n("71ae"),o=n.n(i);o.a},"5ba4":function(e,t,n){},"5c0b":function(e,t,n){},"5c46":function(e,t,n){"use strict";t["a"]={props:{popupContainer:null},methods:{selectBoxOpened:function(e){var t=e.component;this.popupContainer&&t._popup.option("container",this.popupContainer)}}}},"5cae":function(e,t,n){"use strict";var i=n("47a9"),o=n.n(i);o.a},"5ef3":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"gis-popup-add-layer",attrs:{animation:null,visible:e.visible,shading:!1,resizeEnabled:!0,title:"Новый слой",position:e.popupPosition,width:600,height:"auto",maxHeight:e.popupMaxHeight,minHeight:300,toolbarItems:e.toolbarItems,container:e.popupContainer},on:{shown:function(t){return e.$emit("shown")}},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:"Новый слой",showCloseButton:!0},on:{closeClick:function(t){return e.$emit("hidden")}}})]},proxy:!0},{key:"contentTemplate",fn:function(){return[n("GisAddLayerFrom",{ref:"gisAddLayerForm",attrs:{popupContainer:e.popupContainer},on:{change:function(t){e.layersOptions=t}}})]},proxy:!0}])})},o=[],a=n("53ca"),s=n("d736"),r=n.n(s),l=n("25aa"),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxTabPanel",{attrs:{items:e.tabs,deferRendering:!1,focusStateEnabled:!1},scopedSlots:e._u([{key:"options",fn:function(){return[n("DxScrollView",[n("div",{staticClass:"gis-add-layer-form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Наименование")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{on:{valueChanged:e.onFieldChange},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Тип сервиса")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{dataSource:e.serviceTypeDataSource,displayExpr:"text",valueExpr:"value"},on:{opened:e.selectBoxOpened,valueChanged:e.onFieldChange},model:{value:e.serviceType,callback:function(t){e.serviceType=t},expression:"serviceType"}})],1)]),"wms"===e.serviceType?n("GisAddWMS",{attrs:{popupContainer:e.popupContainer},on:{change:e.onFormChange}}):"tile"===e.serviceType?n("GisAddTileLayer",{attrs:{popupContainer:e.popupContainer},on:{change:e.onFormChange}}):"geojson"===e.serviceType?n("GisAddGeoJson",{attrs:{popupContainer:e.popupContainer},on:{change:e.onFormChange}}):e._e()],1)])]},proxy:!0},{key:"style",fn:function(){return[n("GisGeoJsonStyle",{ref:"gisGeojsonStyle",attrs:{layers:e.layerStyles,layerComponentId:e.generateId(),popupContainer:e.popupContainer},on:{loaded:e.onStyleFormChange}})]},proxy:!0}])})},d=[],u=(n("8e6e"),n("ac6a"),n("cadf"),n("456d"),n("6b54"),n("7f7f"),n("ade3")),p=n("5c46"),f=n("0187"),h=n("b6eb"),m=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-add-geojson"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Источник данных")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{on:{valueChanged:function(t){return e.$emit("change",{dataSetName:e.dataSetName})}},model:{value:e.dataSetName,callback:function(t){e.dataSetName=t},expression:"dataSetName"}})],1)])])},g=[],y=n("e614"),v=n.n(y),b={name:"GisAddGeoJson",components:{DxTextBox:v.a},data:function(){return{dataSetName:null}},mounted:function(){this.$emit("change",{dataSetName:this.dataSetName})}},_=b,C=(n("d6ef"),n("2877")),x=Object(C["a"])(_,m,g,!1,null,null,null),O=x.exports,I=n("1efe"),S=n("049d"),L=n.n(S),D=n("f806"),P=n.n(D),E=n("5a1f"),w=n.n(E);function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){Object(u["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k={name:"GisAddLayerFrom",mixins:[p["a"]],components:{GisAddWMS:f["a"],GisAddTileLayer:h["a"],GisAddGeoJson:O,DxSelectBox:L.a,DxTabPanel:P.a,DxScrollView:w.a,GisGeoJsonStyle:I["a"]},data:function(){return{layerStyles:[{type:"circle",options:{paint:{"circle-radius":5,"circle-color":"#d2c6b0","circle-opacity":.54,"circle-stroke-color":"#867e6e","circle-stroke-width":2,"circle-stroke-opacity":.54},maxzoom:18,minzoom:3,filter:""}}],serviceTypeDataSource:[{value:"wms",text:"WMS OGC"},{value:"tile",text:"Тайловый слой"},{value:"geojson",text:"GeoJSON"}],name:"Новый слой",serviceType:null,layerOptions:null}},computed:{tabs:function(){var e=[{title:"Параметры",template:"options"}];return"geojson"===this.serviceType&&e.push({title:"Стиль",template:"style"}),e}},methods:{onFieldChange:function(){this.layerOptions=j(j({},this.layerOptions),{},{text:this.name,type:this.serviceType}),this.$emit("change",this.layerOptions)},onFormChange:function(e){"geojson"===this.serviceType&&this.layerOptions&&this.layerOptions.mapboxLayers?this.layerOptions=j(j({},this.layerOptions),e):this.layerOptions=j(j({},e),{},{text:this.name,type:this.serviceType}),this.$emit("change",this.layerOptions)},onStyleFormChange:function(){var e=this;this.$refs.gisGeojsonStyle.getLayersStyles().then((function(t){e.layerOptions.mapboxLayers=t,e.$emit("change",e.layerOptions)}))},resetForm:function(){this.name="Новый слой",this.serviceType=null,this.layerOptions=null},generateId:function(){return Math.random().toString(36).substr(2,9)}},mounted:function(){this.$emit("change",this.layerOptions)}},F=k,B=(n("ee30"),Object(C["a"])(F,c,d,!1,null,null,null)),M=B.exports,A=n("a045"),R={name:"GisPopupAddLayer",components:{DxPopup:r.a,GisAddLayerFrom:M,PopupTitleTemplate:l["a"]},props:{visible:Boolean,popupContainer:null},data:function(){var e=this;return{toolbarItems:[{toolbar:"bottom",location:"center",widget:"dxButton",options:{text:"Сохранить",type:"success",onClick:function(){e.apply()}}},{toolbar:"bottom",location:"center",widget:"dxButton",options:{text:"Отменить",onClick:function(){e.$emit("hidden")}}}],popupPosition:{at:"top",my:"top",offset:"0, 36"},layersOptions:null}},methods:{popupMaxHeight:function(){return.9*window.innerHeight},apply:function(){var e={};Object(A["a"])(this.layersOptions,e),this.deleteEmptyProperties(e),this.$refs.gisAddLayerForm.resetForm(),this.$emit("apply",e)},deleteEmptyProperties:function(e){for(var t in e)"object"===Object(a["a"])(e[t])?this.deleteEmptyProperties(e[t]):""!==e[t]&&null!==e[t]&&void 0!==e[t]||delete e[t]}}},V=R,G=(n("01f0"),Object(C["a"])(V,i,o,!1,null,null,null));t["a"]=G.exports},"5fe3":function(e,t,n){"use strict";var i=n("b189"),o=n.n(i);o.a},6014:function(e,t,n){"use strict";var i=n("e6a0"),o=n.n(i);o.a},"609c":function(e,t,n){},"610b":function(e,t,n){"use strict";var i=n("58c6"),o=n.n(i);o.a},"61a1":function(e,t,n){"use strict";var i=n("f8aa"),o=n.n(i);o.a},"62b3":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.cssClass,attrs:{title:e.text},on:{click:e.handleClick,contextmenu:e.handleContextMenu,mouseenter:function(t){return e.$emit("mouseenter")},mouseleave:function(t){return e.$emit("mouseleave")}}},[e.loadIndicator?n("DxLoadIndicator",{staticClass:"gis-toolbar-button__load-indicator",attrs:{height:16,width:16,visible:!0}}):n("i",{class:e.iconCss}),e.label?n("div",{staticClass:"gis-toolbar-button__wrapper"},[n("div",{staticClass:"gis-toolbar-button__label"},[e._v("\n      "+e._s(e.label)+"\n    ")])]):e._e(),n("DxPopover",{ref:"mode",attrs:{visible:e.contextMenuVisible,container:e.popoverContainer,position:"bottom",closeOnOutsideClick:e.closeModeOnOutsideClick},on:{hidden:function(t){return e.$emit("modeHidden")}}},[e._t("default")],2)],1)},o=[],a=n("86ba"),s="gis-toolbar-button",r={mixins:[a["a"]],data:function(){return{CLASS:s}},mounted:function(){this.$refs.mode.instance.option("target",this.$el)}},l=r,c=(n("9251"),n("2877")),d=Object(c["a"])(l,i,o,!1,null,null,null);t["a"]=d.exports},6391:function(e,t,n){"use strict";var i=n("0405"),o=n.n(i);o.a},"63d5":function(e,t,n){"use strict";var i=n("c634"),o=n.n(i);o.a},"63ed":function(e,t,n){},6530:function(e,t,n){"use strict";var i=n("4a5c"),o=n.n(i);o.a},6657:function(e,t,n){},"680a":function(e,t,n){"use strict";var i=n("a0a1"),o=n.n(i);o.a},6819:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"epsg-list",attrs:{width:800,height:600,visible:e.visible,container:e.popupContainer,shading:!1,resizeEnabled:!0},on:{shown:e.onShown,hidden:function(t){return e.$emit("hidden")}},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:"Выбрать систему координат",showCloseButton:!0},on:{closeClick:function(t){return e.$emit("hidden")}}})]},proxy:!0},{key:"content",fn:function(){return[n("div",{staticClass:"epsg-list__content"},[n("DxDataGrid",{ref:"dataGrid",staticClass:"data-grid",attrs:{allowColumnResizing:!0,height:"100%",columnResizingMode:"widget",keyExpr:"id",hoverStateEnabled:!0,rowAlternationEnabled:!0,showColumnLines:!1,dataSource:e.dataSource,selectedRowKeys:e.selectedRowKeys},on:{selectionChanged:function(t){return e.selectRow(t.selectedRowsData[0])},toolbarPreparing:e.onToolbarPreparing}},[n("DxExport",{attrs:{allowExportSelectedData:!0,enabled:!0}}),n("DxSearchPanel",{attrs:{visible:!0}}),n("DxSelection",{attrs:{mode:"single"}}),n("DxColumnChooser",{attrs:{enabled:!0}}),n("DxColumnFixing",{attrs:{enabled:!0}}),n("DxPager",{attrs:{infoText:"Страница {0} из {1} • Всего {2} элементов",showInfo:!0}}),n("DxColumn",{attrs:{visibleIndex:10,caption:"EPSG",width:90,dataField:"srid",dataType:"number"}}),n("DxColumn",{attrs:{visibleIndex:200,caption:"Регион",width:70,dataField:"region",dataType:"string"}}),n("DxColumn",{attrs:{visibleIndex:400,caption:"Описание системы",dataField:"auth_name",dataType:"string"}})],1)],1)]},proxy:!0},{key:"toolbarButton",fn:function(){return[n("DxButton",{attrs:{text:"Выбрать",type:"success"},on:{click:e.apply}})]},proxy:!0}])},[n("DxToolbarItem",{attrs:{toolbar:"bottom",location:"center",template:"toolbarButton"}})],1)},o=[],a=(n("6762"),n("2fdb"),n("097d"),n("d736")),s=n("6191"),r=n.n(s),l=n("25aa"),c=n("d30a"),d=n("bf8c"),u="GKN_HISTORY.DSSPATIAL_REF_SYS",p={name:"EpsgList",components:{DxPopup:a["DxPopup"],PopupTitleTemplate:l["a"],DxToolbarItem:a["DxToolbarItem"],DxButton:r.a,DxDataGrid:c["DxDataGrid"],DxExport:c["DxExport"],DxSearchPanel:c["DxSearchPanel"],DxSelection:c["DxSelection"],DxColumnChooser:c["DxColumnChooser"],DxColumnFixing:c["DxColumnFixing"],DxPager:c["DxPager"],DxColumn:c["DxColumn"]},props:{visible:Boolean,popupContainer:null},data:function(){return{dataSource:[],selectedItem:null}},computed:{selectedRowKeys:function(){return this.selectedItem?[this.selectedItem.id]:[]}},methods:{onShown:function(){this.dataSource.length||this.refreshData(),this.$emit("shown")},onToolbarPreparing:function(e){var t=this,n=e.toolbarOptions,i={widget:"dxButton",location:"before",name:"refresh",options:{focusStateEnabled:!1,icon:"refresh",hint:"Обновить",onClick:function(){t.refreshData()}}},o=n.items;o.push(i)},refreshData:function(){var e=this;this.$refs.dataGrid.instance.beginCustomLoading(),Object(d["c"])("getData",{_config_dataset:u}).then((function(t){e.dataSource=t,e.selectRow(t[0])})).finally((function(){e.$refs.dataGrid.instance.endCustomLoading()}))},selectRow:function(e){var t=(e||{}).id,n=this.$refs.dataGrid.instance.getVisibleRows().map((function(e){return e.key}));this.selectedItem=e||null,!t&&0!==t||n.includes(t)||this.$refs.dataGrid.instance.navigateToRow(t)},apply:function(){this.$emit("apply",this.selectedItem),this.$emit("hidden")}}},f=p,h=(n("cf6b"),n("2877")),m=Object(h["a"])(f,i,o,!1,null,null,null);t["a"]=m.exports},"6a44":function(e,t,n){},"6a49":function(e,t,n){"use strict";var i=n("9b0d"),o=n.n(i);o.a},"6acc":function(e,t,n){"use strict";var i=n("d576"),o=n.n(i);o.a},"6ad3":function(e,t,n){"use strict";n.d(t,"f",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"i",(function(){return a})),n.d(t,"j",(function(){return s})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return l})),n.d(t,"a",(function(){return c})),n.d(t,"h",(function(){return d})),n.d(t,"k",(function(){return u})),n.d(t,"g",(function(){return p})),n.d(t,"e",(function(){return f})),n.d(t,"l",(function(){return h}));var i=[{value:"Polygon",text:"Полигон"},{value:"Line",text:"Линия"},{value:"Point",text:"Точка"}],o=[{value:"pie",text:"Круговая"},{value:"bar",text:"Гистограмма"}],a=[{value:0,text:"Восток"},{value:90,text:"Север"},{value:180,text:"Запад"},{value:270,text:"Юг"}],s=[{value:"clockwise",text:"По часовой"},{value:"anticlockwise",text:"Против часовой"}],r=[{value:"above",text:"Над центроидом"},{value:"around",text:"Вокруг центроида"},{value:"inside",text:"Внутри полигона"}],l=[{value:"fixed",text:"Фиксированный"},{value:"attr",text:"Из атрибута"}],c=[{value:"none",text:"Без обводки"},{value:"solid",text:"Сплошная"},{value:"dash",text:"Прерывистая"},{value:"dot",text:"Точечная"},{value:"longDash",text:"Удлинённо-прерывистая"}],d=[{value:"solid",text:"Сплошная"},{value:"dashed",text:"Прерывистая"}],u=[{value:"point",text:"В точке"},{value:"line",text:"Вдоль линии"},{value:"line-center",text:"В центре линии"}],p=[{value:"auto",text:"По направлению к позиции привязки"},{value:"left",text:"По левому краю"},{value:"center",text:"По центру"},{value:"right",text:"По правому краю"}],f={line:{caption:"Линия",isOpen:!0,componentType:"GisLineStyleForm",options:{paint:{"line-color":"#d2c6b0","line-width":4,"line-opacity":1,"line-dasharray":null,"line-translate":[0,0]},layout:{},geometry:["Line"]}},fill:{caption:"Полигон",isOpen:!0,componentType:"GisPolygonStyleForm",options:{paint:{"fill-color":"#d2c6b0","fill-pattern":null,"fill-opacity":1,"line-color":"#958661","line-width":4,"line-opacity":1,"line-dasharray":null},layout:{},geometry:["Polygon"]}},circle:{caption:"Круг",isOpen:!0,componentType:"GisCircleStyleForm",options:{paint:{"circle-radius":5,"circle-color":"#d2c6b0","circle-opacity":1,"circle-stroke-color":"#867e6e","circle-stroke-width":2,"circle-stroke-opacity":1},layout:{},geometry:["Point"]}},image:{caption:"Изображение",isOpen:!0,componentType:"GisImageStyleForm",options:{layout:{"icon-image":null,"icon-size":1},paint:{},geometry:["Point"]}},text:{caption:"Подпись",isOpen:!0,componentType:"GisTextStyleForm",options:{layout:{attrs:[],"text-field":null,"text-size":12,"symbol-placement":"point","text-justify":"center","text-offset":[0,0]},paint:{"text-color":"#000000","text-opacity":1,"text-halo-color":null,"text-halo-width":null,"text-halo-blur":null},geometry:null}},chart:{caption:"Картограмма",isOpen:!0,componentType:"GisChartStyleForm",options:{layout:{"chart-attrs":[],"chart-type":"pie","piechart-corner":0,"piechart-direction":"clockwise","chart-position":"above","chart-size":"fixed","chart-size-px":50},paint:{"fill-opacity":1,"border-style":"none","border-opacity":1,"border-color":"#fff","border-width":2},geometry:null}}},h={line:{paint:{"line-color":null,"line-width":null,"line-dasharray":null,"line-opacity":null,"line-translate":null},layout:{}},fill:{paint:{"fill-color":null,"fill-pattern":null,"fill-opacity":null,"line-color":null,"line-width":null,"line-dasharray":null,"line-opacity":null},layout:{}},circle:{paint:{"circle-radius":null,"circle-color":null,"circle-opacity":null,"circle-stroke-color":null,"circle-stroke-width":null,"circle-stroke-opacity":null},layout:{}},image:{layout:{"icon-image":null,"icon-size":null},paint:{}},text:{layout:{"text-field":null,"text-size":null,"symbol-placement":null,"text-justify":null},paint:{"text-color":null,"text-opacity":null}},chart:{layout:{attrs:[]}}}},"6f19":function(e,t,n){},"6fce":function(e,t,n){"use strict";var i=n("2c6b"),o=n.n(i);o.a},"71ae":function(e,t,n){},7209:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-legend-move-to-layer-panel"},[n("DxButton",{staticClass:"gis-legend-move-to-layer-panel__button",attrs:{stylingMode:"text",type:"success",text:"Приблизить ко всем"},on:{click:e.moveToAllFeatures}}),n("DxButton",{staticClass:"gis-legend-move-to-layer-panel__button",attrs:{stylingMode:"text",type:"success",text:"Приблизить к выбранным",disabled:e.hasSelectedIds},on:{click:e.moveToSelectedFeatures}})],1)},o=[],a=(n("8e6e"),n("ac6a"),n("cadf"),n("456d"),n("ade3")),s=n("2f62"),r=n("6191"),l=n.n(r),c=n("5c46"),d=n("eec1");function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f={mixins:[c["a"]],components:{DxButton:l.a},props:{layerComponentId:String},computed:p(p({},Object(s["c"])("config",{getLayerSelectedIds:d["H"]})),{},{hasSelectedIds:function(){return!this.getLayerSelectedIds(this.layerComponentId).length}}),methods:{moveToAllFeatures:function(){this.$emit("moveToAllFeatures")},moveToSelectedFeatures:function(){this.$emit("moveToSelectedFeatures")}}},h=f,m=(n("0da7"),n("2877")),g=Object(m["a"])(h,i,o,!1,null,null,null);t["a"]=g.exports},"746d":function(e,t,n){},"74eb":function(e,t,n){"use strict";var i=n("d3cd"),o=n.n(i);o.a},7511:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-login-form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Логин")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{value:e.login},on:{valueChanged:function(t){return e.emitChanges("login",t.value)}}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Пароль")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{mode:"password",value:e.password},on:{valueChanged:function(t){return e.emitChanges("password",t.value)}}})],1)])])},o=[],a={name:"GisLoginForm",props:{login:String,password:String},methods:{emitChanges:function(e,t){var n={login:this.login,password:this.password};n[e]=t,this.$emit("authorizationDataChange",n)}}},s=a,r=(n("8664"),n("2877")),l=Object(r["a"])(s,i,o,!1,null,null,null);t["a"]=l.exports},7539:function(e,t,n){"use strict";var i=n("c1b9"),o=n.n(i);o.a},"754d":function(e,t,n){"use strict";var i=n("fcc6"),o=n.n(i);o.a},"7b59":function(e,t,n){},"7bbd":function(e,t,n){"use strict";var i=n("04d3"),o=n.n(i);o.a},"7bc7":function(e,t,n){},"7c29":function(e,t,n){},"7c61":function(e,t,n){},"7cb4":function(e,t,n){"use strict";var i=n("8182"),o=n.n(i);o.a},"7dc9":function(e,t,n){"use strict";var i=n("609c"),o=n.n(i);o.a},"7e8b":function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return r}));var i={features:[{type:"Feature",properties:{text:"Текст"},geometry:{coordinates:[[[132.4492,43.6357],[132.546,43.6357],[132.546,43.563],[132.4492,43.563],[132.4492,43.6357]]],type:"Polygon"},id:"7d8b9b1f14f4079f81940c8605f77a76"}],type:"FeatureCollection"},o={features:[{type:"Feature",properties:{text:"Текст"},geometry:{coordinates:[[132.546,43.6357],[132.4492,43.563]],type:"LineString"},id:"8224dab5ef594045b28c4223f2be5d47"}],type:"FeatureCollection"},a={features:[{type:"Feature",properties:{text:"Текст"},geometry:{coordinates:[132.4976,43.59935],type:"Point"},id:"73ba1220612547d0ba33c4442c9ba89e"}],type:"FeatureCollection"},s=[i,o,a],r={features:s.map((function(e){return e.features[0]})),type:"FeatureCollection"}},"7ece":function(e,t,n){"use strict";var i=n("e836"),o=n.n(i);o.a},8036:function(e,t,n){},"80b2":function(e,t,n){"use strict";var i=n("a982"),o=n.n(i);o.a},"80c1":function(e,t,n){"use strict";var i=n("d7c4"),o=n.n(i);o.a},8167:function(e,t,n){"use strict";var i=n("e7e8"),o=n.n(i);o.a},8182:function(e,t,n){},"81a7":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{attrs:{visible:e.visible,toolbarItems:e.popupToolbarItems,width:500,height:400,shading:!1,container:e.popupContainer},on:{shown:e.onShown},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("div",{staticClass:"gis-filter-popup__title"},[n("div",{staticClass:"gis-filter-popup__title-text",attrs:{title:e.title}},[e._v("\n        "+e._s(e.title)+"\n      ")]),n("div",{staticClass:"gis-filter-popup__title-close-button",on:{click:function(t){return e.$emit("hidden")}}},[n("i",{staticClass:"core core-057-close"})])])]},proxy:!0}])},[n("DxDataGrid",{attrs:{height:"100%",dataSource:e.dataSource},on:{toolbarPreparing:e.dataGridToolbarPreparing,selectionChanged:e.dataGridSelectionChanged}},[n("DxSearchPanel",{attrs:{visible:!0}}),n("DxSelection",{attrs:{mode:"single"}}),n("DxColumn",{attrs:{dataField:"name",caption:"Название"}}),n("DxColumn",{attrs:{dataField:"createdate",caption:"Дата",dataType:"date"}})],1)],1)},o=[],a=(n("8e6e"),n("ac6a"),n("cadf"),n("456d"),n("ade3")),s=n("2f62"),r=n("9841"),l=n("eec1"),c=n("d30a"),d=n.n(c),u=n("d736"),p=n.n(u);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m={components:{DxDataGrid:d.a,DxPopup:p.a,DxColumn:c["DxColumn"],DxSearchPanel:c["DxSearchPanel"],DxSelection:c["DxSelection"]},props:{title:String,visible:Boolean,layerComponentId:String,popupContainer:null},data:function(){var e=this;return{popupToolbarItems:[{toolbar:"bottom",location:"center",widget:"dxButton",options:{text:"Применить",type:"success",onClick:function(){e.applyClick()}}},{toolbar:"bottom",location:"center",widget:"dxButton",options:{text:"Отменить",onClick:function(){e.$emit("hidden")}}}],selectedFilter:null}},computed:h(h({},Object(s["c"])("config",{getFilters:l["s"]})),{},{dataSource:function(){return this.getFilters(this.layerComponentId)}}),methods:h(h({},Object(s["b"])("config",{loadLayerFilters:r["w"],deleteFilter:r["j"],refreshFilters:r["B"]})),{},{onShown:function(){this.loadDataSource(),this.$emit("shown")},loadDataSource:function(){this.loadLayerFilters({layerComponentId:this.layerComponentId})},dataGridToolbarPreparing:function(e){var t=this,n=e.toolbarOptions.items;n.push({widget:"dxButton",options:{icon:"refresh",onClick:function(){t.refreshFilters({layerComponentId:t.layerComponentId})}},location:"before"}),n.push({widget:"dxButton",options:{icon:"trash",type:"danger",onClick:function(){t.deleteSelectedFilter()}},location:"before"})},dataGridSelectionChanged:function(e){var t=e.component.getSelectedRowsData();this.selectedFilter=t[0]},applyClick:function(){this.$emit("applyClick",this.selectedFilter)},deleteSelectedFilter:function(){this.selectedFilter&&this.deleteFilter({layerComponentId:this.layerComponentId,filterId:this.selectedFilter.id})}})},g=m,y=(n("94fa"),n("2877")),v=Object(y["a"])(g,i,o,!1,null,null,null);t["a"]=v.exports},8372:function(e,t,n){},"84a9":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-toolbar-button-group"},[e._t("default")],2)},o=[],a=(n("ac6a"),{mounted:function(){this.$slots.default&&this.$slots.default.filter((function(e){return!!e.componentInstance})).forEach((function(e,t,n){var i=e.componentInstance;i&&(0===t&&(i.first=!0),t===n.length-1&&(i.last=!0))}))}}),s=a,r=(n("56dd"),n("2877")),l=Object(r["a"])(s,i,o,!1,null,null,null);t["a"]=l.exports},"84cb":function(e,t,n){"use strict";var i=n("efe2"),o=n.n(i);o.a},"85b7":function(e,t,n){"use strict";var i=n("06dd"),o=n.n(i);o.a},8664:function(e,t,n){"use strict";var i=n("ec12"),o=n.n(i);o.a},"86ba":function(e,t,n){"use strict";var i=n("ade3"),o=(n("c5f6"),n("4f34")),a=n.n(o),s=n("adbc"),r=n.n(s);t["a"]={components:{DxLoadIndicator:a.a,DxPopover:r.a},data:function(){return{first:!1,last:!1}},props:{active:Boolean,disabled:Boolean,iconCss:String,loadIndicator:Boolean,text:String,label:[String,Number],contextMenuVisible:Boolean,popoverContainer:null,closeModeOnOutsideClick:{type:Boolean,default:!0}},computed:{cssClass:function(){var e;return e={},Object(i["a"])(e,this.CLASS,!0),Object(i["a"])(e,"".concat(this.CLASS,"_active"),this.active),Object(i["a"])(e,"".concat(this.CLASS,"_disabled"),this.disabled),Object(i["a"])(e,"".concat(this.CLASS,"_first"),this.first),Object(i["a"])(e,"".concat(this.CLASS,"_last"),this.last),e}},methods:{handleClick:function(){this.disabled||this.$emit("click",{targetComponent:this})},handleContextMenu:function(e){e.preventDefault(),this.disabled||this.$emit("contextMenu")}}}},"875f":function(e,t,n){},88301:function(e,t,n){"use strict";var i=n("af90"),o=n.n(i);o.a},"8b63":function(e,t,n){},"8cb6":function(e,t,n){"use strict";var i=n("c7db"),o=n.n(i);o.a},"8e4b":function(e,t,n){"use strict";var i=n("5ba4"),o=n.n(i);o.a},"8f37":function(e,t,n){},"8fa7":function(e,t,n){"use strict";var i=n("96e4"),o=n.n(i);o.a},9161:function(e,t,n){"use strict";var i=n("e06a"),o=n.n(i);o.a},9251:function(e,t,n){"use strict";var i=n("cb6e"),o=n.n(i);o.a},"927b":function(e,t,n){"use strict";var i=n("dbaa"),o=n.n(i);o.a},"92c0":function(e,t,n){},9341:function(e,t,n){},"9341d":function(e,t,n){"use strict";var i=n("ecb4"),o=n.n(i);o.a},"93ae":function(e,t,n){},"94fa":function(e,t,n){"use strict";var i=n("bb94"),o=n.n(i);o.a},"94fe":function(e,t,n){},9606:function(e,t,n){"use strict";var i=n("7c29"),o=n.n(i);o.a},"960e":function(e,t,n){},"96e4":function(e,t,n){},"987e":function(e,t,n){},"98c6":function(e,t,n){},"98cc":function(e,t,n){},"98dc":function(e,t,n){},99442:function(e,t,n){},99444:function(e,t,n){"use strict";var i=n("5271"),o=n.n(i);o.a},"998b":function(e,t,n){"use strict";var i=n("1d1c"),o=n.n(i);o.a},"9a60":function(e,t,n){},"9b0d":function(e,t,n){},"9cb5":function(e,t,n){},"9df88":function(e,t,n){"use strict";var i=n("d43c"),o=n.n(i);o.a},"9e3b":function(e,t,n){"use strict";var i=n("0061"),o=n.n(i);o.a},"9f3f":function(e,t,n){"use strict";var i=n("ff59"),o=n.n(i);o.a},a0a1:function(e,t,n){},a420:function(e,t,n){"use strict";var i=n("960e"),o=n.n(i);o.a},a445:function(e,t,n){},a502:function(e,t,n){"use strict";var i=n("17ff"),o=n.n(i);o.a},a55a:function(e,t,n){"use strict";var i=n("5709"),o=n.n(i);o.a},a690:function(e,t,n){"use strict";var i=n("303d"),o=n.n(i);o.a},a783:function(e,t,n){},a982:function(e,t,n){},abf5:function(e,t,n){},aeef:function(e,t,n){"use strict";var i=n("6f19"),o=n.n(i);o.a},af90:function(e,t,n){},b039:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-legend-export-panel"},[n("div",{staticClass:"gis-legend-export-panel__field"},[n("div",{staticClass:"gis-legend-export-panel__label"},[e._v("\n      Формат\n    ")]),n("DxSelectBox",{staticClass:"gis-legend-export-panel__value",attrs:{dataSource:e.formats,placeholder:"Формат"},on:{opened:e.selectBoxOpened},model:{value:e.selectedFormat,callback:function(t){e.selectedFormat=t},expression:"selectedFormat"}})],1),n("div",{staticClass:"gis-legend-export-panel__field"},[n("div",{staticClass:"gis-legend-export-panel__label"},[e._v("\n      EPSG\n    ")]),n("DxTextBox",{staticClass:"gis-legend-export-panel__value",attrs:{value:e.epsgName,placeholder:"EPSG"}},[n("DxTextBoxButton",{attrs:{location:"after",name:"insert"}},[n("DxButtonOptions",{attrs:{focusStateEnabled:!1,icon:"dx-icon dx-icon-more",hint:"Выбрать систему координат",onClick:e.openEpsgList}})],1)],1),n("EpsgList",{attrs:{visible:e.epsgListVisible,popupContainer:e.popupContainer},on:{shown:function(t){e.epsgListVisible=!0},hidden:function(t){e.epsgListVisible=!1},apply:e.setEpsg}})],1),n("div",{staticClass:"gis-legend-export-panel__bottom-panel"},[n("DxButton",{staticClass:"gis-legend-export-panel__button",attrs:{stylingMode:"text",type:"success",text:"Экспорт всех объектов слоя"},on:{click:function(t){return e.exportClick(!1)}}}),n("DxButton",{staticClass:"gis-legend-export-panel__button",attrs:{stylingMode:"text",type:"success",text:"Экспорт выбранных объектов слоя"},on:{click:function(t){return e.exportClick(!0)}}})],1)])},o=[],a=(n("8e6e"),n("ac6a"),n("cadf"),n("456d"),n("a481"),n("6762"),n("2fdb"),n("ade3")),s=n("2f62"),r=n("049d"),l=n.n(r),c=n("e614"),d=n("6191"),u=n.n(d),p=n("5c46"),f=n("6819"),h=n("e3b7"),m=n("7a47"),g=n("9841"),y=n("eec1"),v=n("bf8c"),b=n("e34a");function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x={mixins:[p["a"]],components:{DxButton:u.a,DxSelectBox:l.a,DxTextBox:c["DxTextBox"],DxTextBoxButton:c["DxButton"],DxButtonOptions:c["DxOptions"],EpsgList:f["a"]},props:{gisComponentId:String,layerComponentId:String},data:function(){return{selectedFormat:"shp",formats:["geojson","dxf","shp","kml","tab","mif/mid","txt","xls","csv","wkt","xlsx"],epsg:4326,epsgName:"EPSG: 4326",epsgListVisible:!1}},computed:C(C({},Object(s["c"])("config",{getGisOptions:h["z"],getLayerOptions:y["E"],getLayerAllFeatures:y["d"],getLayerSelectedIds:y["H"]})),{},{layerName:function(){return this.getLayerOptions(this.layerComponentId).text}}),methods:C(C(C({},Object(s["d"])("config",{setGisDownloadLink:m["k"]})),Object(s["b"])("config",{exportData:g["k"]})),{},{openEpsgList:function(){this.epsgListVisible=!0},setEpsg:function(e){this.epsg=e.srid,this.epsgName="".concat(e.auth_name,": ").concat(e.srid)},exportClick:function(e){var t,n,i=this,o=new Date;if(this.layerComponentId===b["a"].componentId){var a=this.getLayerAllFeatures(b["a"].componentId);if(e){var s=this.getLayerSelectedIds(b["a"].componentId);a=a.filter((function(e){return s.includes(e.id)}))}t="Выгрузка_косметический_слой_от_".concat(o.toLocaleDateString(),"_").concat(o.toLocaleTimeString([],{timeStyle:"short"})),a[0]&&(n=Object(v["b"])("https://files-service.rusgis.com/apiFiles",null,{_config_filetype:this.selectedFormat,geojson:{features:a,type:"FeatureCollection"},epsg:this.epsg}))}else{t="Выгрузка_".concat(this.layerName.replace(/\s/g,"_"),"_от_").concat(o.toLocaleDateString(),"_").concat(o.toLocaleTimeString([],{timeStyle:"short"}));var r=this.$store.getters["session/userData"]||{};n=this.exportData({layerComponentId:this.layerComponentId,selected:e,url:"https://files-service.rusgis.com/apiFiles",format:this.selectedFormat,epsg:this.epsg,exportUserId:r.userId||"500322"})}n&&n.then((function(e){i.setGisDownloadLink({gisComponentId:i.gisComponentId,downloadLink:"".concat("https://files-service.rusgis.com/downloadFile","?guid=").concat(e.guid,"&_config_dataset=").concat(e._config_dataset,"&filename=").concat(t)})}))}})},O=x,I=(n("4223"),n("2877")),S=Object(I["a"])(O,i,o,!1,null,null,null);t["a"]=S.exports},b0d10:function(e,t,n){"use strict";var i=n("fa83"),o=n.n(i);o.a},b189:function(e,t,n){},b1c1:function(e,t,n){},b2a9:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxDrawer",{ref:"identificationDrawer",staticClass:"gis-alternative",style:e.cssStyle,attrs:{position:"right",openedStateMode:"shrink",opened:e.objectIdentificationVisible},scopedSlots:e._u([{key:"template",fn:function(){return[n("GisObjectIDForm",{attrs:{objectLayerName:e.objectLayerName,objectId:e.objectId,identificationCoordinates:e.identificationCoordinates,arrayProperties:e.arrayProperties,rawHtmlProperties:e.rawHtmlProperties,clickedFeaturesCount:e.clickedFeaturesCount,selectionByClickIndex:e.selectionByClickIndex,loading:e.loadIdentification,popupContainer:e.popoverContainer},on:{closeClick:e.resetIdentification,leftArrowClick:e.handleLeftArrowClick,rightArrowClick:e.handleRightArrowClick,coordinateTypeChanged:e.coordinateTypeChanged}})]},proxy:!0}])},[n("div",{staticClass:"gis-alternative__drawer-content"},[n("div",{ref:"mapContainer",staticClass:"gis-alternative__map-container"},[e.isYandexBaseMap?n("div",{ref:"yandexMap",staticClass:"gis-alternative__yandex-map"}):e._e()]),n("GisOverlayContainer",{staticClass:"gis-alternative__overlay",attrs:{itemsConfigs:e.overlayPanelItems}}),n("div",{staticClass:"gis-alternative__controls"},[n("div",{staticClass:"gis-alternative__top-panel"},[e.topLeftPanelItems.length?n("div",{staticClass:"gis-alternative__top-left-panel"},e._l(e.topLeftPanelItems,(function(e,t){return n("ContainerItem",{key:t,attrs:{componentId:e.componentId,componentType:e.componentType,cssStyle:e.cssStyle}})})),1):e._e(),e.showToolbar&&!e.snapshotVisible?n("GisToolbar",{staticClass:"gis-alternative__toolbar",attrs:{legendButtonActive:e.legendVisible,spaceImageButtonActive:e.spaceImageryPanelVisible,buttonValues:e.toolbarValues,buttonDisabled:e.toolbarButtonsDisabled,visibleTools:e.visibleTools,leftButtonItems:e.leftButtonItems,rightButtonItems:e.rightButtonItems,activeMouseTool:e.selectedMouseTool,geocodePoint:e.geocodePoint,allAddresses:e.allAddresses,validateLatLng:e.validateLatLng,pasteButtonMessage:e.pasteButtonMessage,isFullScreen:e.isFullScreen,popoverContainer:e.popoverContainer,activeLegendLayer:e.editingLayerOptions,gisComponentId:e.componentId},on:{setGeocodeCoordinates:e.setGeocodeCoordinates,handleMarker:e.handleMarker,handleMarkerPopup:e.handleMarkerPopup,handleRemoveMarker:e.handleRemoveMarker,handleRemovePoint:e.handleRemovePoint,handleRemoveAddresses:e.handleRemoveAddresses,handleCoordinatesChanged:e.handleCoordinatesChanged,buttonValueChanged:function(t){e.toolbarValues[t.name]=t.value},buttonActiveStateChanged:e.handleToolbarButtonActiveStateChanged,buttonClick:e.handleToolbarButtonClick,useIdentificationRequestTool:e.useIdentificationRequestTool,resetIdentification:e.resetIdentification}}):e._e(),e.topRightPanelItems.length?n("div",{staticClass:"gis-alternative__top-right-panel"},e._l(e.topRightPanelItems,(function(e,t){return n("ContainerItem",{key:t,attrs:{componentId:e.componentId,componentType:e.componentType,cssStyle:e.cssStyle}})})),1):e._e()],1),n("div",{staticClass:"gis-alternative__controls-content"},[e.showLegend||e.showTmpLayer?n("div",{class:e.legendClassList},[n("GisLegendAlternative",{staticClass:"gis-alternative__legend-layers",attrs:{legendItems:e.legendItemsFlat,legendItemsSearch:e.legendItemsSearch,visible:e.legendVisible,useAddLayerMenu:e.options.useAddLayerMenu,visibleProcess:e.visibleProcess,popoverContainer:e.popoverContainer,gisComponentId:e.componentId,rights:e.rights},on:{layerAdd:e.handleLayerAdd,addLayerClick:e.onAddLayerClick,createBufferZone:e.createLayerBufferZone,searchLayerItem:e.searchLayerItem,selectSearchItem:e.selectByFeatureId,moveToAllFeatures:e.moveToAllFeatures,moveToSelectedFeatures:e.moveToSelectedFeatures}},[e.showTmpLayer?n("GisTmpLayerPanel",{staticClass:"gis-alternative__tmp-layer-panel",attrs:{tmpLayerData:e.tmpLayerData,selected:e.tmpLayerSelected,visible:e.tmpLayerVisible,edit:e.tmpLayerEdit,gisComponentId:e.componentId,popoverContainer:e.popoverContainer},on:{handleTmpLayerVisible:e.handleTmpLayerVisible,handleTmpLayerEdit:e.handleTmpLayerEdit,fitToTmpLayer:e.fitToTmpLayer,itemClick:e.tmpLayerListItemClick,itemDeleteClick:e.tmpLayerListItemDeleteClick,headClick:e.tmpLayerPanelClick,openTmpStyles:e.openTmpStyles}}):e._e()],1)],1):e._e(),n("GisFilterPanel",{class:e.filterPanelClassList,attrs:{name:e.filterPanelLayerName},on:{closeButtonClick:function(t){e.filterPanelVisible=!1}}},[e.filterPanelItems.length?e._l(e.filterPanelItems,(function(e,t){return n("ContainerItem",{key:t,attrs:{componentId:e.componentId,componentType:e.componentType,cssStyle:e.cssStyle}})})):e._e()],2),n("div",{staticClass:"gis-alternative__filter-and-table"},[!e.useFilterBuilder&&e.filterPanelLayerComponentId?n("GisCustomFilterPanel",{staticClass:"gis-alternative__custom-filter-panel",attrs:{layerComponentId:e.filterPanelLayerComponentId,popupContainer:e.popoverContainer}}):e._e(),e.tablePanelLayerComponentId?n("GisCustomTablePanel",{staticClass:"gis-alternative__custom-table-panel",attrs:{layerComponentId:e.tablePanelLayerComponentId,popupContainer:e.popoverContainer}}):e._e()],1),e.showSpaceImageryPanel?n("GisSpaceImageryPanel",{class:e.spaceImageryPanelClassList,attrs:{activeMouseTool:e.selectedMouseTool,aoiGeoJson:e.spaceImageryAOI,planetUrl:e.planetUrl,planetApiKey:e.planetApiKey,listItems:e.spaceImageryListItems,popupContainer:e.popoverContainer},on:{buttonActiveStateChanged:e.spaceImageryPanelButtonStateChanged,planetDataLoaded:e.spaceImageryDataLoaded,hoveredItemChanged:e.spaceImageryListHoveredItemChanged,itemVisibleClick:e.spaceImageryItemVisibleClick,itemMouseOver:e.spaceImageryItemMouseOver,itemMouseOut:e.spaceImageryItemMouseOut,clearResultClick:e.spaceImageryClearResultClick}}):e._e()],1),e.options.showTimeline&&e.isTimelineVisible?n("GisTimelineSlider",{staticClass:"gis-alternative__timeline-slider",attrs:{gisComponentId:e.componentId}}):e._e()],1),n("div",{directives:[{name:"show",rawName:"v-show",value:e.layersListVisible.baseTextMapListVisible,expression:"layersListVisible.baseTextMapListVisible"}],ref:"baseTextMapList",staticClass:"gis-alternative__base-map-list text-map",class:{"gis-alternative__base-map-list_report-mode":e.snapshotVisible}},[n("DxScrollView",[n("GisBaseMapList",{attrs:{selectedBaseMapId:e.baseTextMapSelectedComponentId,items:e.baseMapTextListItems},on:{itemClick:function(t){return e.handleBaseMapListItemClick(t,!0)}}})],1)],1),!1!==e.visibleTools.selectTextBaseMap?n("GisBaseMapButton",{staticClass:"gis-alternative__base-map-button text-map",class:{"gis-alternative__base-map-button_report-mode":e.snapshotVisible},attrs:{caption:e.getBaseMapCaption(e.baseTextMapListSelectedItem,e.$options.TEXT_MAP_NAME),iconUrl:e.baseTextMapListSelectedItem.iconUrl||null},nativeOn:{click:function(t){return e.handleBaseMapButtonClick("baseTextMapListVisible",e.$refs.baseTextMapList)}}}):e._e(),n("div",{directives:[{name:"show",rawName:"v-show",value:e.layersListVisible.baseMapListVisible,expression:"layersListVisible.baseMapListVisible"}],ref:"baseMapList",staticClass:"gis-alternative__base-map-list",class:{"gis-alternative__base-map-list_report-mode":e.snapshotVisible}},[n("DxScrollView",[n("GisBaseMapList",{attrs:{selectedBaseMapId:e.baseMapSelectedComponentId,items:e.baseMapListItems},on:{itemClick:function(t){return e.handleBaseMapListItemClick(t,!1)}}})],1)],1),!1!==e.visibleTools.selectBaseMap?n("GisBaseMapButton",{staticClass:"gis-alternative__base-map-button",class:{"gis-alternative__base-map-button_report-mode":e.snapshotVisible},attrs:{caption:e.getBaseMapCaption(e.baseMapListSelectedItem,e.$options.BASE_MAP_NAME),iconUrl:e.baseMapListSelectedItem.iconUrl||null},nativeOn:{click:function(t){return e.handleBaseMapButtonClick("baseMapListVisible",e.$refs.baseMapList)}}}):e._e(),n("GisScalePanel",{staticClass:"gis-alternative__scale-panel",class:{"gis-alternative__scale-panel_report-mode":e.snapshotVisible},attrs:{coordinates:e.coordinates,scale:e.scale,gisComponentId:e.componentId},on:{scaleClick:function(t){e.scaleListVisible=!e.scaleListVisible}}}),n("GisScaleList",{directives:[{name:"show",rawName:"v-show",value:e.scaleListVisible,expression:"scaleListVisible"}],staticClass:"gis-alternative__scale-list",class:{"gis-alternative__scale-list_report-mode":e.snapshotVisible},attrs:{value:e.scaleValue||100},on:{itemClick:e.handleScaleListItemClick,valueChanged:e.handleScaleListValueChanged}}),e.featureContextMenuEnabled?n("GisContextMenu",{directives:[{name:"show",rawName:"v-show",value:e.showFeatureContextMenu,expression:"showFeatureContextMenu"}],staticClass:"gis-alternative__context-menu",staticStyle:{padding:"0","z-index":"0","border-radius":"50%","box-shadow":"none",background:"none"},style:e.addStylesContentMenu},[n("GisRoundContextMenu",[e._l(e.contextMenuItems,(function(t,i){return[n("GisRoundContextMenuItem",{key:i,attrs:{item:t,index:i},on:{selectItem:e.selectItem}})]}))],2)],1):e._e(),n("GisPopupEditLayerStyle",{attrs:{gisComponentId:e.componentId,popupContainer:e.popoverContainer}}),n("GisPopupEditLayerTooltip",{attrs:{gisComponentId:e.componentId,popupContainer:e.popoverContainer}}),n("GisPopupEditTmpStyle",{attrs:{visible:e.editTmpStylePopupVisible,popupContainer:e.popoverContainer},on:{hidden:function(t){e.editTmpStylePopupVisible=!1},shown:function(t){e.editTmpStylePopupVisible=!0},apply:e.setTmpStyles}}),e.showCoordinatesEditor?n("GisCoordinatesEditor",{ref:"coordinatesEditor",attrs:{gisModule:this,editFeature:e.coordEditorFeature,geometryTypes:e.editGeomTypes,popupContainer:e.popoverContainer},on:{close:e.onCoordinatesEditorClose,change:e.onGeometryCoordinatesChange}}):e._e(),n("GisReportList",{attrs:{visible:e.reportListVisible,reportGroupId:e.reportGroupId},on:{shown:function(t){e.reportListVisible=!0},hidden:e.hideReportList,apply:e.handleSnapshotForReport}}),e.reportFeatureProperties?n("GisPopupSelectSnapshot",{attrs:{featureGuid:e.reportFeatureProperties?e.reportFeatureProperties.guid||"":null,visible:e.getSnapshotFromPage,snapshotDataSetName:e.options.snapshotDataSetName},on:{shown:function(t){e.getSnapshotFromPage=!0},hidden:e.hidePopupSelectSnapshot,apply:e.featureImageListApplyClick}}):e._e(),n("GisDocumentsSnapshot",{attrs:{visible:e.snapshotVisible,snapshotButtonText:e.snapshotButtonText,imageLayersLoading:e.imageLayersLoading,getSnapshotFromPage:e.getSnapshotFromPage},on:{shown:function(t){e.snapshotVisible=!0},apply:e.createSnapshotButtonClick}}),e.snapshotVisible?n("SnapshotDraw",{attrs:{gisModule:this,popupContainer:e.popoverContainer}}):e._e(),e.snapshotVisible?n("GisDocumentSnapshotPanel",{attrs:{panelStyle:e.topPanelStyle}}):e._e(),e.snapshotVisible?n("GisDocumentSnapshotPanel",{attrs:{panelStyle:e.rightPanelStyle}}):e._e(),e.snapshotVisible?n("GisReportImgPanel",{attrs:{docName:e.docName,featureGuid:e.reportFeatureProperties?e.reportFeatureProperties.guid||"":null,reportImageData:e.reportImageData,selectedIndex:e.selectedReportImageDataIndex,gisComponentId:e.componentId},on:{changeSelectedSnapshot:e.changeSelectedReportImage,apply:e.reportImagePanelApplyClick,hidden:e.hideDocumentsSnapshot}}):e._e(),e.snapshotVisible?n("GisDocumentSnapshotPanel",{attrs:{panelStyle:e.bottomPanelStyle}}):e._e(),e.snapshotVisible?n("GisDocumentSnapshotPanel",{attrs:{panelStyle:e.leftPanelStyle}}):e._e(),n("iframe",{style:{visibility:"hidden",display:"none"},attrs:{src:e.downloadLink}}),n("GisAddServicePopup",{attrs:{gisComponentId:e.componentId,popupContainer:e.popoverContainer}}),n("GisVectorLayerPopup",{attrs:{gisComponentId:e.componentId,popupContainer:e.popoverContainer}}),n("GisFolderPopup",{attrs:{gisComponentId:e.componentId,popupContainer:e.popoverContainer}}),n("GisRasterLayerPopup",{attrs:{gisComponentId:e.componentId,popupContainer:e.popoverContainer}}),n("GisOpenLayerPopup",{attrs:{gisComponentId:e.componentId,visible:e.openLayerPopupVisible,popupContainer:e.popoverContainer},on:{shown:function(t){e.openLayerPopupVisible=!0},hidden:function(t){e.openLayerPopupVisible=!1}}}),n("SimpleInvisibleComponentContainer",{staticClass:"gis-alternative__invisible-items",attrs:{icon:"far fa-window-restore",items:e.popupComponentConfigs}})],1)])},o=[],a=(n("8e6e"),n("ac6a"),n("cadf"),n("456d"),n("53ca")),s=(n("a481"),n("ade3")),r=(n("55dd"),n("95d4")),l=n("3ce8"),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxSortable",{attrs:{filter:".gis-legend-item-alternative__content",handle:".gis-legend-item-alternative__text",allowDropInsideItem:!0,allowReordering:!0,dropFeedbackMode:"indicate"},on:{dragEnd:e.onDragEnd,dragMove:e.onDragMove,reorder:e.onReorder}},[n("div",{staticClass:"gis-legend-alternative"},[n("div",{staticClass:"gis-legend-alternative__top-panel"},[n("DxTextBox",{staticClass:"gis-legend-alternative__search",attrs:{value:e.legendLayerSearchValue,mode:"search",valueChangeEvent:"input",placeholder:"Поиск..."},on:{valueChanged:e.searchTextBoxValueChanged}}),n("div",{staticClass:"gis-legend-alternative__common-buttons"},[!e.rights.removeLayer||e.jsApi||e.userIsGuest?e._e():[e.deleteProcess?n("DxLoadIndicator",{staticClass:"gis-legend-alternative__load-indicator",attrs:{visible:!0}}):n("GisLegendItemButton",{staticClass:"gis-legend-alternative__common-buttons-items",attrs:{text:"Удалить выбранный слой",iconCss:"fas fa-trash",disabled:!e.activeLegendLayerComponentId},on:{activeChanged:e.deleteLayerButtonClick}})],e.visibleProcess?n("DxLoadIndicator",{staticClass:"gis-legend-alternative__load-indicator",attrs:{visible:!0}}):n("GisLegendItemButton",{staticClass:"gis-legend-alternative__common-buttons-items",attrs:{active:e.legendLayersAllVisible||e.legendLayersSomeVisible,iconCss:"core core-081-no-visible",text:e.legendLayersAllVisible||e.legendLayersSomeVisible?"Скрыть все слои":"Показать все слои",activeIconCss:e.legendLayersVisibleIconCss},on:{activeChanged:e.legendLayersAllVisibleActiveChange}}),n("GisLegendItemButton",{ref:"addLayerButtonRef",staticClass:"gis-legend-alternative__common-buttons-items",style:{visibility:!e.rights.addLayer||e.jsApi||e.userIsGuest?"hidden":"visible"},attrs:{text:"Добавить слой",iconCss:"fas fa-plus-circle"},on:{activeChanged:e.toggleAddLayerMenu}})],2)],1),e._t("default"),n("div",{staticClass:"gis-legend-alternative__tree"},[n("DxScrollView",{ref:"scrollView",attrs:{showScrollbar:"onScroll",useNative:!1},on:{scroll:e.onScroll}},[n("div",{staticClass:"gis-legend-alternative__tree-inner"},e._l(e.items,(function(t){return n("GisLegendItemAlternative",{key:t,attrs:{componentId:t,parentComponentId:e.gisComponentId,selectedId:null,dxScrollView:null,legendVisible:e.visible}})})),1),n("DxPopover",{ref:"dxPopoverLegendItemPanel",attrs:{visible:!!e.popupMenuLayerComponentId,animation:null,position:"right",closeOnOutsideClick:e.onLayerMenuOutsideClick,container:e.popoverContainer,target:e.popupMenuLayerTargetElement}},[n("GisLegendItemPanel",{staticClass:"gis-legend-item-alternative__panel",attrs:{layerComponentId:e.popupMenuLayerComponentId,popoverContainer:e.popoverContainer,legendItemsSearch:e.legendItemsSearch},on:{searchLayerItem:e.handleSearchLayerItem,selectSearchItem:e.handleSelectSearchItem,buttonClick:e.handleLegendPanelButtonClick,createBufferZone:e.handleCreateBufferZone,moveToAllFeatures:e.$listeners.moveToAllFeatures,moveToSelectedFeatures:e.$listeners.moveToSelectedFeatures}})],1),n("DxTooltip",{ref:"iconTooltipRef",attrs:{deferRendering:!0},scopedSlots:e._u([{key:"content",fn:function(){return[n("div",{staticClass:"gis-legend-item-alternative__tooltip-content"},[e.tooltipUrl?n("img",{attrs:{src:e.tooltipUrl},on:{load:function(t){return e.tooltipImageLoaded(t)}}}):n("i",{class:e.legendItemCurrent&&e.legendItemCurrent.iconCss||"core core-091-layer",style:{color:e.legendItemCurrent&&e.legendItemCurrent.iconColor}})])]},proxy:!0}])})],1)],1),n("DxPopover",{ref:"addLayerMenuRef",attrs:{visible:e.addLayerMenuVisible,closeOnOutsideClick:!0,container:e.popoverContainer},on:{hidden:function(t){e.addLayerMenuVisible=!1},disposing:function(t){e.addLayerMenuVisible=!1}}},[n("GisAddLayerMenu",{on:{addLayerClick:e.onAddLayerClick}})],1),n("GisPopupAddLayer",{attrs:{visible:e.addLayerPopupVisible,popupContainer:e.popoverContainer},on:{shown:function(t){e.addLayerPopupVisible=!0},hidden:function(t){e.addLayerPopupVisible=!1},apply:e.handleLayerAdd}})],2)])},d=[],u=(n("551c"),n("2f62")),p=n("4f34"),f=n.n(p),h=n("adbc"),m=n.n(h),g=n("4344"),y=n.n(g),v=n("5a1f"),b=n.n(v),_=n("0342"),C=n.n(_),x=n("e614"),O=n.n(x),I=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-legend-item-alternative",attrs:{"data-id":e.componentId,"data-parent-id":e.parentComponentId,"data-pos":e.componentPos}},[n("div",{staticClass:"gis-legend-item-alternative__wrapper",style:e.folderIndication||e.folderIndicationStyle},[n("div",{staticClass:"gis-legend-item-alternative__content",class:e.contentHoverActiveClass,on:{click:e.contentClick}},[n("div",{staticClass:"gis-legend-item-alternative__icon",on:{mouseenter:e.handleLegendIconEnter,mouseleave:e.handleLegendIconLeave,click:function(t){return e.toggleExpandClick(!e.layerOptions.expanded)}}},[e.showLegendStyleItems?n("div",{staticClass:"gis-legend-item-alternative__icon",class:e.iconActiveClass,on:{click:function(t){return t.stopPropagation(),e.toggleStyleList(t)}}},[n("i",{staticClass:"core core-extern-layer",style:e.iconColorStyle})]):e.iconUrl&&!e.iconError?n("img",{attrs:{src:e.iconUrl},on:{load:e.iconLoaded,error:e.handleIconError}}):e.layerOptions.iconCss?n("i",{class:e.iconCss,style:e.iconColorStyle}):n("i",{staticClass:"core core-091-layer",style:e.iconColorStyle})]),n("div",{ref:"textRef",staticClass:"gis-legend-item-alternative__text",attrs:{title:e.layerOptions.text},on:{mouseenter:function(t){e.hover=!0},mouseleave:function(t){e.hover=!1},dblclick:e.contentDblClick}},[e._v("\n        "+e._s(e.layerOptions.text)+"\n      ")]),n("div",{staticClass:"gis-legend-item-alternative__buttons"},[e.layerOptions.loading?n("DxLoadIndicator",{staticClass:"gis-legend-item-alternative__load-indicator",attrs:{visible:!0}}):e._e(),e.layerOptions.filterId||e.layerOptions.filterValue?n("div",{staticClass:"gis-legend-item-alternative__filter-indicator"},[e._m(0),n("div",{staticClass:"gis-legend-item-alternative__filter-indicator-line"})]):e._e(),e.showEditButton?n("GisLegendItemButton",{attrs:{active:e.editing,iconCss:"core core-083-edit",text:e.editing?"Отключить редактирование слоя":"Включить редактирование слоя"},on:{activeChanged:e.editClick}}):e._e(),e.showEnableButton?n("GisLegendItemButton",{attrs:{active:e.layerOptions.enable,iconCss:"core core-076-lock",activeIconCss:"core core-077-unlock",text:e.layerOptions.enable?"Отключить доступность выделения":"Включить доступность выделения"},on:{activeChanged:e.toggleEnable}}):e._e(),e.showTextButton?n("GisLegendItemButton",{attrs:{active:e.layerOptions.textVisible,iconCss:"core core-054-text",text:e.layerOptions.textVisible?"Скрыть подписи":"Показать подписи"},on:{activeChanged:e.toggleTextVisible}}):e._e(),e.showVisibleButton?n("GisLegendItemButton",{attrs:{active:e.visible||e.halfVisible,iconCss:"core core-081-no-visible",activeIconCss:e.visibleButtonIconCss,text:e.visibleButtonText},on:{activeChanged:e.toggleVisible}}):e._e(),n("GisLegendItemButton",{style:e.legendItemBtnVisibilityStyle,attrs:{active:e.moreButtonActive,iconCss:"core core-074-3dots",text:e.moreButtonActive?"Скрыть панель дополнительных инструментов":"Показать панель дополнительных инструментов",disabled:!1},nativeOn:{click:function(t){return e.moreButtonClick(t)}}})],1)])]),[e.showLegendStyleItems&&e.layerOptions.styleListExpanded?n("div",{staticClass:"gis-legend-item-alternative__style-list",style:e.folderIndication||e.folderIndicationStyle},e._l(e.legendStyleItemIds,(function(t){return n("GisLegendStyleItem",{key:t,attrs:{legendStyleItemId:t,layerComponentId:e.componentId,images:e.images,expanded:!1}})})),1):e._e()],[e.layerOptions.group&&e.items&&e.items.length>0&&e.layerOptions.expanded&&e.expandEnabled?n("div",{staticClass:"gis-legend-item-alternative__children"},e._l(e.items,(function(t){return n("GisLegendItemAlternative",{key:t,attrs:{folderIndication:e.folderIndicationStyle,componentId:t,parentComponentId:e.componentId,images:e.images,selectedId:null,dxScrollView:e.dxScrollView}})})),1):e._e()]],2)},S=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-legend-item-alternative__filter-indicator-icon"},[n("i",{staticClass:"fas fa-filter"})])}],L=n("1a37"),D=n("3281"),P=n("b93b"),E=n("750b"),w={name:"GisLegendItemAlternative",components:{DxLoadIndicator:f.a,GisLegendItemButton:L["a"],GisLegendStyleItem:D["a"]},props:{componentId:String,parentComponentId:String,selectedId:String,dxScrollView:null,legendItem:Object,folderIndication:Object},computed:{folderIndicationStyle:function(){return{borderLeft:"3px solid ".concat(this.layerOptions.iconColor)}},expandEnabled:function(){return void 0===this.layerOptions.expandEnabled||this.layerOptions.expandEnabled},iconCss:function(){var e=this.layerOptions.iconCss||(this.layerOptions.group?"core core-092-folder":"core core-091-layer"),t=this.layerOptions.iconExpandedCss||(this.layerOptions.group?"core core-093-folder-opened":"core core-091-layer");return this.layerOptions.expanded&&this.expandEnabled?t:e},iconColorStyle:function(){return{color:this.layerOptions.iconColor||(this.layerOptions.group?"#ecc849":"#cdd1d9")}},legendItemBtnVisibilityStyle:function(){return{visibility:this.layerOptions.group?"hidden":"visible"}},iconActiveClass:function(){return{"gis-legend-item-alternative__icon-active":this.layerOptions.styleListExpanded}},contentHoverActiveClass:function(){return{"gis-legend-item-alternative__content_active":this.active,"gis-legend-item-alternative__content_hover":this.hover}}},setup:function(e,t){var n=Object(E["e"])(!1),i=Object(P["a"])(e,t.root.$store),o=i.componentPos,a=i.layerOptions,s=i.active,r=i.editing,l=i.editClick,c=i.toggleVisible,d=i.showVisibleButton,u=i.visible,p=i.halfVisible,f=i.toggleEnable,h=i.toggleTextVisible,m=i.showEnableButton,g=i.showTextButton,y=i.showEditButton,v=i.moreButtonClick,b=i.moreButtonActive,_=i.iconUrl,C=i.legendStyleItemIds,x=i.iconLoaded,O=i.handleIconError,I=i.iconError,S=i.reloadIcon,L=i.visibleButtonIconCss,D=i.visibleButtonText,w=i.showLegendStyleItems,T=i.textRef,j=i.items,k=i.handleLegendIconEnter,F=i.handleLegendIconLeave,B=i.toggleExpandClick,M=i.toggleStyleList,A=i.contentClick,R=i.contentDblClick,V=i.images;return{componentPos:o,layerOptions:a,active:s,editing:r,editClick:l,toggleVisible:c,showVisibleButton:d,visible:u,halfVisible:p,toggleEnable:f,toggleTextVisible:h,showEnableButton:m,showTextButton:g,showEditButton:y,moreButtonClick:v,moreButtonActive:b,iconUrl:_,legendStyleItemIds:C,iconLoaded:x,handleIconError:O,iconError:I,reloadIcon:S,visibleButtonIconCss:L,visibleButtonText:D,showLegendStyleItems:w,hover:n,textRef:T,items:j,handleLegendIconEnter:k,handleLegendIconLeave:F,toggleExpandClick:B,toggleStyleList:M,contentClick:A,contentDblClick:R,images:V}}},T=w,j=(n("46f2"),n("2877")),k=Object(j["a"])(T,I,S,!1,null,null,null),F=k.exports,B=n("bbfd"),M=n("1d3c"),A=n("df21"),R=n("5ef3");function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $=".gis-legend-item-alternative",N={name:"GisLegend",mixins:[B["a"]],components:{DxLoadIndicator:f.a,DxPopover:m.a,DxTooltip:y.a,DxScrollView:b.a,DxSortable:C.a,GisLegendItemAlternative:F,GisLegendItemButton:L["a"],DxTextBox:O.a,GisAddLayerMenu:A["a"],GisPopupAddLayer:R["a"],GisLegendItemPanel:M["a"]},props:{useAddLayerMenu:Boolean,legendItems:Array,legendItemsSearch:Promise,visible:Boolean,visibleProcess:Boolean,popoverContainer:null,rights:Object},computed:G(G({},Object(u["c"])("session",{userIsGuest:"userIsGuest"})),{},{jsApi:function(){return"true"}}),methods:{onReorder:function(e){this.handleReorder(e,$)},onDragMove:function(e){this.handleDragMove(e,$)},onDragEnd:function(e){this.handleDragEnd(e,$)}}},U=N,z=(n("6530"),Object(j["a"])(U,c,d,!1,null,"6e87c0b2",null)),H=z.exports,W=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticStyle:{"border-radius":"50%"}},[e._t("default")],2)},K=[],q={name:"GisRoundContextMenu"},J=q,Z=Object(j["a"])(J,W,K,!1,null,null,null),Y=Z.exports,X=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"round-menu"},[n("div",{staticClass:"round-menu-item",class:[null!==e.item.methods?"round-menu-item-hover":"","round-menu-item-"+e.index],attrs:{title:e.item.text}},[n("div",{class:e.item.iconCss,on:{click:function(t){return e.$emit("selectItem",e.item.methods)}}})])])},Q=[],ee=(n("c5f6"),{props:{item:[Array,Object],index:Number},name:"GisRoundContextMenuItem"}),te=ee,ne=(n("e36dc"),Object(j["a"])(te,X,Q,!1,null,null,null)),ie=ne.exports,oe=n("36ac"),ae=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"gis-vector-layer-popup",attrs:{visible:e.visible,container:e.popupContainer,shading:!1,resizeEnabled:!0,animation:null,width:500,height:"auto",maxHeight:"80%",minHeight:350},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:e.isNew?"Создать векторный слой":"Редактировать векторный слой",showCloseButton:!0},on:{closeClick:e.onFormHidden}})]},proxy:!0},{key:"content",fn:function(){return[n("div",{staticClass:"gis-vector-layer-popup__content"},[n("CardTabsBase",{staticClass:"gis-vector-layer-popup__card-tabs",attrs:{items:e.cardTabs,selectedIndex:e.selectedTabIndex},on:{selectionChanged:function(t){e.selectedTabIndex=t}},scopedSlots:e._u([{key:"common",fn:function(){return[n("GisVectorLayerForm",{ref:"layerForm",attrs:{formValues:e.layerOptions,popupContainer:e.popupContainer,loadData:e.layerRights.loadData,isNew:e.isNew},on:{changed:function(t){e.layerOptions=Object.assign({},e.layerOptions,t)},downloadDocument:e.downloadDocument,clearLayer:e.clearLayer}})]},proxy:!0},{key:"fields",fn:function(){return[n("GisVectorLayerFieldsList",{attrs:{layerComponentId:e.layerComponentId,gisComponentId:e.gisComponentId,popupContainer:e.popupContainer,editFields:e.layerRights.editFields}})]},proxy:!0},{key:"access",fn:function(){return[n("AccessFormTemplate",{attrs:{creatorId:e.layerOptions.creator_id,componentTypeId:e.layerOptions.componenttype_id,componentId:e.layerOptions.id,dataSetName:e.dataSetName,creatorVisible:!0}})]},proxy:!0}])}),n("DxLoadPanel",{attrs:{visible:e.loadPanelVisible,container:".gis-vector-layer-popup__content"}},[n("DxLoadPanelPosition",{attrs:{my:"center",at:"center",of:".gis-vector-layer-popup__content"}})],1)],1)]},proxy:!0},{key:"applyButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,text:e.isNew?"Создать слой":"Сохранить",type:"success"},on:{click:e.apply}})]},proxy:!0}])},[n("DxToolbarItem",{attrs:{toolbar:"bottom",location:"center",template:"applyButton"}})],1)},se=[],re=(n("6b54"),n("3835")),le=(n("ffc1"),n("097d"),n("68b0")),ce=n("9841"),de=n("fe56"),ue=n("c22f"),pe=n("eec1"),fe=n("4787"),he=n("bf8c"),me=n("d736"),ge=n.n(me),ye=n("6191"),ve=n.n(ye),be=n("5bba"),_e=n.n(be),Ce=n("25aa"),xe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-vector-layer-form"},[n("DxScrollView",[n("div",{staticClass:"gis-vector-layer-form__wrapper"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Заголовок "),n("span",{staticClass:"gis-vector-layer-form__required"},[e._v("*")])]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{value:e.formValues.caption},on:{valueChanged:function(t){return e.onValueChanged({caption:t.value})}}},[n("DxValidator",{attrs:{validationGroup:"vectorLayerForm"}},[n("DxRequiredRule",{attrs:{type:"required",message:"Поле обязательно для заполнения"}})],1)],1)],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Копирайт")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{value:e.formValues.copyright},on:{valueChanged:function(t){return e.onValueChanged({copyright:t.value})}}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Описание")]),n("div",{staticClass:"dx-field-value"},[n("DxTextArea",{attrs:{value:e.formValues.comments,placeholder:"Описание слоя"},on:{valueChanged:function(t){return e.onValueChanged({comments:t.value})}}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Геометрия")]),n("div",{staticClass:"dx-field-value gis-vector-layer-form__buttons"},[n("div",{staticClass:"gis-vector-layer-form__toolbar"},[n("DxButton",{staticClass:"gis-vector-layer-form__button",attrs:{icon:"core core-add-point",hint:"Точечный слой",focusStateEnabled:!1,type:e.formValues.geomtypes&&e.formValues.geomtypes.includes("Point")?"success":"normal"},on:{click:function(t){return e.editGeomTypes("Point")}}}),n("DxButton",{staticClass:"gis-vector-layer-form__button",attrs:{icon:"core core-094-line",hint:"Линейный слой",focusStateEnabled:!1,type:e.formValues.geomtypes&&e.formValues.geomtypes.includes("Line")?"success":"normal"},on:{click:function(t){return e.editGeomTypes("Line")}}}),n("DxButton",{staticClass:"gis-vector-layer-form__button",attrs:{icon:"core core-034-add-poly-2",hint:"Полигональный слой",focusStateEnabled:!1,type:e.formValues.geomtypes&&e.formValues.geomtypes.includes("Polygon")?"success":"normal"},on:{click:function(t){return e.editGeomTypes("Polygon")}}})],1),n("div",{staticClass:"gis-vector-layer-form__clear"},[n("DxButton",{attrs:{visible:!e.isNew,text:"Очистить слой",type:"danger"},on:{click:e.clearLayer}})],1)])]),n("div",{staticClass:"gis-vector-layer-form__count-and-id"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Количество")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{staticClass:"gis-vector-layer-form__number-box",attrs:{value:e.formValues.layer_count},on:{valueChanged:function(t){return e.onValueChanged({layer_count:t.value})}}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"gis-vector-layer-form__id-label dx-field-label"},[e._v("ID")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{attrs:{value:e.formValues.id,readOnly:!0}})],1)])]),e.loadData?n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Данные")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{value:e.formValues.document_name}},[n("DxTextBoxButton",{attrs:{location:"after",name:"download"}},[n("DxButtonOptions",{attrs:{focusStateEnabled:!1,visible:!!e.formValues.document_name&&!!e.formValues.connection_dataset_code,icon:"fa fa-download",hint:"Загрузить данные",onClick:e.emitDownloadDocument}})],1),n("DxTextBoxButton",{attrs:{location:"after",name:"remove"}},[n("DxButtonOptions",{attrs:{focusStateEnabled:!1,visible:!!e.formValues.document_name,icon:"dx-icon dx-icon-close",hint:"Удалить данные",onClick:e.removeDocument}})],1),n("DxTextBoxButton",{attrs:{location:"after",name:"add"}},[n("DxButtonOptions",{attrs:{focusStateEnabled:!1,icon:"dx-icon dx-icon-more",hint:"Выбрать данные",onClick:e.showDocumentList}})],1)],1)],1)]):e._e(),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Класс")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{value:e.formValues.dataset_code}},[n("DxTextBoxButton",{attrs:{location:"after",name:"remove"}},[n("DxButtonOptions",{attrs:{focusStateEnabled:!1,visible:!!e.formValues.dataset_code,icon:"dx-icon dx-icon-close",hint:"Удалить класс",onClick:e.removeDataSet}})],1),n("DxTextBoxButton",{attrs:{location:"after",name:"add"}},[n("DxButtonOptions",{attrs:{focusStateEnabled:!1,icon:"dx-icon dx-icon-more",hint:"Выбрать класс",onClick:e.showDataSetList}})],1)],1)],1)])])]),n("DataSetsList",{attrs:{visible:e.dataSetsListVisible,popupContainer:e.popupContainer},on:{shown:function(t){e.dataSetsListVisible=!0},hidden:function(t){e.dataSetsListVisible=!1},apply:function(t){return e.onValueChanged({dataset_code:t})}}}),n("DocumentList",{attrs:{visible:e.documentListVisible,popupContainer:e.popupContainer,accept:".csv, .zip, .wkt, .geojson, .json, .kml, .dxf, .gml, .txt, .gxt, .xml, .rss, .georss, .bna, .dgn, .xlsx, .xls, .sxf, .dwg"},on:{shown:function(t){e.documentListVisible=!0},hidden:function(t){e.documentListVisible=!1},apply:function(t){return e.onValueChanged({document_name:t.name,document_id:t.id,guid_link:t.guid})}}})],1)},Oe=[],Ie=(n("6762"),n("2fdb"),n("2909")),Se=n("b8f5"),Le=n.n(Se),De=n("7ea3"),Pe=n.n(De),Ee=n("0db8"),we=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"data-set-list",attrs:{width:880,height:600,visible:e.visible,container:e.popupContainer,shading:!1,resizeEnabled:!0},on:{shown:e.onShown,hidden:function(t){return e.$emit("hidden")}},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:"Загрузить в слой данные из класса",showCloseButton:!0},on:{closeClick:function(t){return e.$emit("hidden")}}})]},proxy:!0},{key:"content",fn:function(){return[n("div",{staticClass:"data-sets-list__content"},[n("div",{staticClass:"data-sets-list__lookup"},[n("DxLookup",{attrs:{valueExpr:"id",applyValueMode:"instantly",displayExpr:"fullname",multiline:!1,width:205,dataSource:e.connectionsDataSource},on:{valueChanged:e.refreshGrid},model:{value:e.connection_id,callback:function(t){e.connection_id=t},expression:"connection_id"}})],1),n("div",{staticClass:"data-sets-list__grid"},[n("DxDataGrid",{ref:"dataGrid",staticClass:"data-grid",attrs:{allowColumnResizing:!0,dataSource:e.dataGridDataSource,allowColumnReordering:!0,hoverStateEnabled:!0,height:"100%",width:"100%",columnResizingMode:"widget",rowAlternationEnabled:!0,showColumnLines:!1,keyExpr:"dataset_code",selectedRowKeys:e.selectedRowKeys},on:{selectionChanged:function(t){return e.selectRow(t.selectedRowKeys[0])},toolbarPreparing:e.onToolbarPreparing}},[n("DxExport",{attrs:{ignoreExcelErrors:!0,excelWrapTextEnabled:!0,enabled:!0,excelFilterEnabled:!0,allowExportSelectedData:!0}}),n("DxSearchPanel",{attrs:{visible:!0}}),n("DxSelection",{attrs:{mode:"single"}}),n("DxColumnChooser",{attrs:{enabled:!0}}),n("DxColumnFixing",{attrs:{enabled:!0}}),n("DxPager",{attrs:{infoText:"Страница {0} из {1} • Всего {2} элементов",showInfo:!0}}),n("DxColumn",{attrs:{dataType:"number",dataField:"id",caption:"ID",visibleIndex:100,width:60}}),n("DxColumn",{attrs:{dataType:"number",dataField:"state_id",caption:"Состояние записи",visibleIndex:100,width:100,visible:!1}}),n("DxColumn",{attrs:{dataType:"string",dataField:"guid",caption:"Гуид",visibleIndex:101,width:100,visible:!1}}),n("DxColumn",{attrs:{dataType:"string",dataField:"numversion",caption:"Версия",visibleIndex:101,width:100,visible:!1}}),n("DxColumn",{attrs:{dataType:"string",dataField:"name",caption:"Название",visibleIndex:200,width:200}}),n("DxColumn",{attrs:{dataType:"number",dataField:"pos",caption:"Поз.",visibleIndex:500,width:50,visible:!1}}),n("DxColumn",{attrs:{dataType:"string",dataField:"caption",caption:"Заголовок",visibleIndex:1e3}}),n("DxColumn",{attrs:{dataType:"string",dataField:"creator",caption:"Создатель",visibleIndex:1e3,width:100,visible:!1}}),n("DxColumn",{attrs:{dataType:"datetime",dataField:"createdate",caption:"Дата создания",visibleIndex:1e3,width:140,visible:!1}}),n("DxColumn",{attrs:{dataType:"string",dataField:"dataset_code",caption:"Код с БД",visibleIndex:1100,width:100,visible:!1}}),n("DxColumn",{attrs:{dataType:"string",dataField:"tablename_full",caption:"Таблица",visibleIndex:1100,width:140,visible:!1}}),n("DxColumn",{attrs:{dataType:"datetime",dataField:"modifydate",caption:"Дата редактирования",visibleIndex:1100,width:100,visible:!1}})],1)],1)])]},proxy:!0},{key:"toolbarButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,text:"Выбрать",type:"success"},on:{click:e.apply}})]},proxy:!0}])},[n("DxToolbarItem",{attrs:{toolbar:"bottom",location:"center",template:"toolbarButton"}})],1)},Te=[],je=n("d30a"),ke=n("07e0"),Fe=n.n(ke),Be="CONNECTIONS.DSCONNECTIONS",Me="CONNECTIONS.DSDATASET",Ae={name:"DataSetsList",props:{visible:Boolean,popupContainer:null},components:{DxPopup:me["DxPopup"],PopupTitleTemplate:Ce["a"],DxToolbarItem:me["DxToolbarItem"],DxDataGrid:je["DxDataGrid"],DxExport:je["DxExport"],DxSearchPanel:je["DxSearchPanel"],DxSelection:je["DxSelection"],DxColumnChooser:je["DxColumnChooser"],DxColumnFixing:je["DxColumnFixing"],DxPager:je["DxPager"],DxColumn:je["DxColumn"],DxLookup:Fe.a,DxButton:ve.a},data:function(){return{selectedDataSet:null,dataGridDataSource:[],connection_id:2,connectionsDataSource:[]}},computed:{selectedRowKeys:function(){return this.selectedDataSet?[this.selectedDataSet]:[]}},methods:{onShown:function(){var e=this;this.connectionsDataSource.length||(this.$refs.dataGrid.instance.beginCustomLoading(),Object(he["c"])("getData",{_config_dataset:Be}).then((function(t){e.connectionsDataSource=t,e.refreshGrid()})).catch((function(){return e.$refs.dataGrid.instance.endCustomLoading()}))),this.$emit("shown")},refreshGrid:function(){var e=this;this.$refs.dataGrid.instance.beginCustomLoading(),Object(he["c"])("getData",{_config_dataset:Me,connection_id:this.connection_id}).then((function(t){e.dataGridDataSource=t,e.selectRow((t[0]||{}).dataset_code)})).finally((function(){return e.$refs.dataGrid.instance.endCustomLoading()}))},selectRow:function(e){var t=this.$refs.dataGrid.instance.getVisibleRows().map((function(e){return e.key}));this.selectedDataSet=e,e&&!t.includes(e)&&this.$refs.dataGrid.instance.navigateToRow(e)},onToolbarPreparing:function(e){var t=this,n=e.toolbarOptions,i=n.items,o={widget:"dxButton",location:"after",name:"refresh",options:{focusStateEnabled:!1,hint:"Обновить",icon:"refresh",onClick:function(){t.refreshGrid()}}};i.splice(0,0,o)},apply:function(){this.$emit("apply",this.selectedDataSet),this.$emit("hidden")}}},Re=Ae,Ve=(n("cab6"),Object(j["a"])(Re,we,Te,!1,null,null,null)),Ge=Ve.exports,$e=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"documents-list-popup",attrs:{width:1200,minWidth:1150,height:650,visible:e.visible,container:e.popupContainer,shading:!1,resizeEnabled:!0},on:{shown:e.onShown,hidden:function(t){return e.$emit("hidden")}},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:"Загрузить данные",showCloseButton:!0},on:{closeClick:function(t){return e.$emit("hidden")}}})]},proxy:!0},{key:"content",fn:function(){return[n("div",{staticClass:"documents-list-popup__content"},[n("div",{staticClass:"documents-list-popup__directories"},[n("DxToolbar",{staticClass:"documents-list-popup__toolbar",scopedSlots:e._u([{key:"refreshButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,icon:"refresh",hint:"Обновить"},on:{click:e.refreshDirectoriesList}})]},proxy:!0},{key:"insertButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,icon:"plus",hint:"Добавить папку",type:"default"},on:{click:e.openDirectoryForm}})]},proxy:!0},{key:"deleteButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,icon:"trash",hint:"Удалить папку",type:"danger"},on:{click:e.deleteDirectory}})]},proxy:!0},{key:"search",fn:function(){return[n("DxTextBox",{attrs:{value:e.searchString,mode:"search",valueChangeEvent:"input",placeholder:"Поиск..."},on:{input:e.onSearch}})]},proxy:!0}])},[n("DxToolbarItem",{attrs:{location:"before",name:"refresh",template:"refreshButton"}}),n("DxToolbarItem",{attrs:{location:"before",name:"insert",template:"insertButton"}}),n("DxToolbarItem",{attrs:{location:"before",name:"delete",template:"deleteButton"}}),n("DxToolbarItem",{attrs:{location:"after",name:"search",template:"search"}})],1),n("DxTreeView",{ref:"treeView",staticClass:"documents-list-popup__tree-view",attrs:{dataSource:e.visibleDirectoriesDataSource,dataStructure:"plain",rootValue:null,parentIdExpr:"parent_id",keyExpr:"id",selectionMode:"single",height:"100%",width:"100%",focusStateEnabled:!1,expandAllEnabled:!0,selectNodesRecursive:!1,displayExpr:"caption",selectByClick:!0,selectedExpr:"selected"},on:{itemClick:e.itemClick}}),n("DxLoadPanel",{attrs:{visible:e.loadPanelVisible,container:".documents-list-popup__tree-view"}},[n("DxLoadPanelPosition",{attrs:{my:"center",at:"center",of:".documents-list-popup__tree-view"}})],1),n("DirectoryForm",{attrs:{visible:e.directoryFormVisible,popupContainer:e.popupContainer,value:e.directoryNameForSave},on:{shown:function(t){e.directoryFormVisible=!0},hidden:function(t){e.directoryFormVisible=!1},apply:e.saveDirectory}})],1),n("div",{staticClass:"documents-list-popup__grids"},[n("DocumentsList",{staticClass:"documents-list-popup__documents-list",attrs:{parentId:e.selectedDirectory?e.selectedDirectory.id:null,popupContainer:e.popupContainer,accept:e.accept},on:{selectionChanged:function(t){e.selectedDocument=t}}}),n("DocumentAttributesList",{staticClass:"documents-list-popup__document-attributes-list",attrs:{guidLink:e.selectedDocument?e.selectedDocument.guid:null,epsg:e.selectedDocument?e.selectedDocument.epsg:null,popupContainer:e.popupContainer},on:{setEpsg:e.setEpsg}})],1)])]},proxy:!0},{key:"applyButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,text:"Выбрать",type:"success"},on:{click:e.apply}})]},proxy:!0}])},[n("DxPopupToolbarItem",{attrs:{toolbar:"bottom",location:"center",template:"applyButton"}})],1)},Ne=[],Ue=(n("7f7f"),n("7514"),n("2824")),ze=n.n(Ue),He=n("d158"),We=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"directory-form",attrs:{width:600,height:"auto",visible:e.visible,container:e.popupContainer,shading:!1},on:{shown:function(t){return e.$emit("shown")}},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:e.value?"Редактировать название папки":"Добавить папку",showCloseButton:!0},on:{closeClick:function(t){return e.$emit("hidden")}}})]},proxy:!0},{key:"content",fn:function(){return[n("div",{staticClass:"directory-form__form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Название "),n("span",{staticClass:"directory-form__required"},[e._v("*")])]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{model:{value:e.name,callback:function(t){e.name=t},expression:"name"}},[n("DxValidator",{attrs:{validationGroup:"directory"}},[n("DxRequiredRule",{attrs:{type:"required",message:"Поле обязательно для заполнения"}})],1)],1)],1)])])]},proxy:!0},{key:"toolbarButton",fn:function(){return[n("DxButton",{attrs:{text:"Сохранить",type:"success"},on:{click:e.apply}})]},proxy:!0}])},[n("DxToolbarItem",{attrs:{toolbar:"bottom",location:"center",template:"toolbarButton"}})],1)},Ke=[],qe=n("4fac"),Je={name:"DirectoryForm",components:{DxPopup:me["DxPopup"],PopupTitleTemplate:Ce["a"],DxToolbarItem:me["DxToolbarItem"],DxButton:ve.a,DxTextBox:O.a,DxValidator:Ee["DxValidator"],DxRequiredRule:Ee["DxRequiredRule"]},props:{visible:Boolean,popupContainer:null,value:String},data:function(){return{name:this.value}},watch:{value:function(){this.name=this.value}},methods:{apply:function(){var e=qe["a"].getGroupConfig("directory");if(e){var t=e.validate();if(!t.isValid)return}this.$emit("apply",this.name)}}},Ze=Je,Ye=(n("b7d6"),Object(j["a"])(Ze,We,Ke,!1,null,null,null)),Xe=Ye.exports,Qe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"documents-list"},[n("DxDataGrid",{ref:"dataGrid",staticClass:"data-grid",attrs:{selectedRowKeys:e.selectedRowKeys,keyExpr:"id",wordWrapEnabled:!1,allowColumnResizing:!0,allowColumnReordering:!0,importExcel:!1,height:"100%",columnResizingMode:"widget",hoverStateEnabled:!0,rowAlternationEnabled:!0,showColumnLines:!1,dataSource:e.dataSource},on:{selectionChanged:function(t){return e.selectRow(t.selectedRowsData[0])},contentReady:e.onContentReady,toolbarPreparing:e.onToolbarPreparing},scopedSlots:e._u([{key:"userAvatarWithNameCellTemplate",fn:function(e){var t=e.data;return[n("UserAvatarWithNameCellTemplate",{attrs:{options:Object.assign({},t,{column:Object.assign({},t.column,{fioField:"creator_name"})})}})]}}])},[n("DxSearchPanel",{attrs:{visible:!0}}),n("DxSelection",{attrs:{mode:"single"}}),n("DxColumnChooser",{attrs:{enabled:!0}}),n("DxColumnFixing",{attrs:{enabled:!0}}),n("DxPager",{attrs:{infoText:"Страница {0} из {1} • Всего {2} элементов",showInfo:!0,showPageSizeSelector:!0}}),n("DxRemoteOperations",{attrs:{sorting:!0,filtering:!0,paging:!0,summary:!0}}),n("DxPaging",{attrs:{pageSize:20}}),n("DxColumn",{attrs:{dataType:"number",dataField:"id",sortOrder:"desc",caption:"ID",width:55}}),n("DxColumn",{attrs:{dataType:"string",dataField:"name",caption:"Документ"}}),n("DxColumn",{attrs:{dataType:"datetime",dataField:"createdate",caption:"Дата импорта",width:115}}),n("DxColumn",{attrs:{dataType:"string",dataField:"state_name",caption:"Состояние",visible:!1,width:120}}),n("DxColumn",{attrs:{dataType:"number",dataField:"filesize",caption:"Размер, кбайт",visibleIndex:4e3,width:80}}),n("DxColumn",{attrs:{dataType:"number",dataField:"page_id",caption:"page_id",visible:!1,width:140}}),n("DxColumn",{attrs:{dataType:"number",dataField:"creator_id",caption:"Создатель",cellTemplate:"userAvatarWithNameCellTemplate",visibleIndex:400,width:180,visible:!1}})],1),n("LoadDocumentForm",{attrs:{parentId:e.parentId,visible:e.loadDocumentFormVisible,popupContainer:e.popupContainer,accept:e.accept},on:{shown:function(t){e.loadDocumentFormVisible=!0},hidden:function(t){e.loadDocumentFormVisible=!1},apply:e.onFileUploaded}})],1)},et=[],tt=(n("28a5"),n("c920")),nt=n("3922"),it=n("2ed7"),ot=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"load-document-form",attrs:{width:400,height:"auto",visible:e.visible,container:e.popupContainer,shading:!1},on:{shown:e.onShown,hidden:e.onHidden},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:"Загрузка документов",showCloseButton:!0},on:{closeClick:e.onHidden}})]},proxy:!0},{key:"content",fn:function(){return[n("div",{staticClass:"directory-form__form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Кодировка")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{hint:"Кодировка файла",valueExpr:"name",displayExpr:"name",dataSource:e.encodingNames},model:{value:e.documentOptions.encoding_name,callback:function(t){e.$set(e.documentOptions,"encoding_name",t)},expression:"documentOptions.encoding_name"}})],1)]),n("DxFileUploader",{ref:"fileUploader",staticClass:"load-document-form__file-uploader",attrs:{uploadUrl:e.uploadUrl,accept:e.accept,uploadMode:"useButtons"},on:{valueChanged:e.onFileUploaderValueChanged,uploaded:e.onUploaded}})],1)]},proxy:!0},{key:"toolbarButton",fn:function(){return[n("DxButton",{attrs:{disabled:e.applyButtonDisabled,focusStateEnabled:!1,text:"Загрузить",type:"success"},on:{click:e.uploadFile}})]},proxy:!0}])},[n("DxToolbarItem",{attrs:{toolbar:"bottom",location:"center",template:"toolbarButton"}})],1)},at=[],st=n("049d"),rt=n.n(st),lt=n("81f7"),ct=n.n(lt);function dt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ut(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dt(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var pt="CONNECTIONS.DSENCODINGNAME",ft="PAGES.DSPAGE",ht={encoding_name:"UTF-8",documenttype_id:5},mt={name:"LoadDocumentForm",components:{DxPopup:me["DxPopup"],DxToolbarItem:me["DxToolbarItem"],DxButton:ve.a,PopupTitleTemplate:Ce["a"],DxSelectBox:rt.a,DxFileUploader:ct.a},props:{visible:Boolean,popupContainer:null,parentId:Number,accept:String},data:function(){return{documentOptions:ut({},ht),encodingNames:[],applyButtonDisabled:!0,documentTypesListVisible:!1,uploadUrl:"https://files-service.rusgis.com/uploadFile"}},methods:{onShown:function(){this.loadEncodings(),this.$emit("shown")},onHidden:function(){this.documentOptions=ut({},ht),this.$refs.fileUploader.instance.reset(),this.$emit("hidden")},loadEncodings:function(){var e=this;this.encodingNames.length||Object(he["c"])("getData",{_config_dataset:pt}).then((function(t){e.encodingNames=t}))},onFileUploaderValueChanged:function(e){this.applyButtonDisabled=!e.value.length},uploadFile:function(){var e=this;this.applyButtonDisabled=!0,this.$refs.fileUploader.instance._uploadStrategy._createFormData=function(t,n){return e.createFormData(t,n)},this.$refs.fileUploader.instance.upload()},createFormData:function(e,t){var n=this.$store.getters["session/userData"].userId,i=new FormData,o="",a="",s=t.name.lastIndexOf(".");-1!==s?(o=t.name.substring(0,s),a=t.name.substring(s+1)):(o=t.name,a="");var r={_config_dataset:ft,_config_user_id:n,name:o,extension:a,parent_id:this.parentId,is_import:!0,documenttype_id:this.documentOptions.documenttype_id,encoding_name:this.documentOptions.encoding_name};return i.append(e,t),i.append("userid",n),i.append("param",JSON.stringify(r)),i},onUploaded:function(){this.applyButtonDisabled=!1,this.$emit("apply")}}},gt=mt,yt=(n("5b43"),Object(j["a"])(gt,ot,at,!1,null,null,null)),vt=yt.exports;function bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _t(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bt(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ct="BASE.DSDOCUMENTOMSYTREE",xt={name:"DocumentsList",components:{DxDataGrid:je["DxDataGrid"],DxSearchPanel:je["DxSearchPanel"],DxSelection:je["DxSelection"],DxColumnChooser:je["DxColumnChooser"],DxColumnFixing:je["DxColumnFixing"],DxPager:je["DxPager"],DxRemoteOperations:je["DxRemoteOperations"],DxPaging:je["DxPaging"],DxColumn:je["DxColumn"],UserAvatarWithNameCellTemplate:it["a"],LoadDocumentForm:vt},props:{parentId:Number,popupContainer:null,accept:String},data:function(){return{loadDocumentFormVisible:!1,selectedRowKeys:[],dataSource:null,selectFirstRow:!1}},watch:{parentId:function(){this.selectFirstRow=!0,this.refreshData()}},methods:{refreshData:function(){this.dataSource?this.dataSource.reload():this.initDataSource()},initDataSource:function(){var e=this;this.dataSource=new nt["a"]({store:new tt["a"]({key:"id",load:function(t){if(!e.parentId)return Promise.resolve({data:[],totalCount:0});var n={parent_id:e.parentId,_config_serverside:!0,orderby:t.sort,_config_dataset:Ct,limit:t.take,offset:t.skip,where:t.filter};return e.accept&&(n.fileextension=e.accept.split(", ").map((function(e){return'"'.concat(e.replace(".",""),'"')})).join(",")),Object(he["c"])("getData",n).then((function(e){return t.requireTotalCount?Object(he["c"])("getData",_t(_t({},n),{},{_config_is_count:!0})).then((function(t){return{data:e.data,totalCount:t.totalCount}})):{data:e.data,totalCount:t.skip+t.take}}))}})})},onContentReady:function(){if(this.selectFirstRow){var e=this.dataSource.items();this.selectRow(e[0]),this.selectFirstRow=!1}},selectRow:function(e){var t=(e||{}).id;this.$emit("selectionChanged",e||{}),this.selectedRowKeys=t?[t]:[]},onToolbarPreparing:function(e){var t=this,n=e.toolbarOptions,i=[{widget:"dxButton",location:"before",name:"refresh",options:{focusStateEnabled:!1,icon:"refresh",hint:"Обновить",onClick:function(){t.refreshData()}}},{widget:"dxButton",location:"before",name:"insert",options:{focusStateEnabled:!1,hint:"Загрузить данные",icon:"plus",type:"default",onClick:function(){t.loadDocumentFormVisible=!0}}},{widget:"dxButton",location:"before",name:"delete",options:{focusStateEnabled:!1,hint:"Удалить",icon:"trash",type:"danger",onClick:function(){t.deleteDocument()}}}],o=n.items;o.push.apply(o,i)},onFileUploaded:function(){this.loadDocumentFormVisible=!1,this.refreshData()},deleteDocument:function(){var e=this,t=this.selectedRowKeys[0];(t||0===t)&&(this.$refs.dataGrid.instance.beginCustomLoading(),Object(he["c"])("deleteData",{_config_dataset:Ct,id:t}).then((function(){e.selectFirstRow=!0,e.dataSource.reload()})).finally((function(){return e.$refs.dataGrid.instance.endCustomLoading()})))}}},Ot=xt,It=(n("c029"),Object(j["a"])(Ot,Qe,et,!1,null,null,null)),St=It.exports,Lt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"document-attributes-list"},[n("DxDataGrid",{ref:"dataGrid",staticClass:"data-grid",attrs:{dataSource:e.dataSource,allowColumnResizing:!0,allowColumnReordering:!0,importExcel:!1,height:"100%",width:"100%",columnResizingMode:"widget",columnAutoWidth:!1,hoverStateEnabled:!0,rowAlternationEnabled:!0,showColumnLines:!1},on:{toolbarPreparing:e.onToolbarPreparing},scopedSlots:e._u([{key:"epsg",fn:function(){return[n("div",{staticClass:"document-attributes-list__field"},[n("div",{staticClass:"document-attributes-list__label"},[e._v("EPSG")]),n("div",{staticClass:"document-attributes-list__value"},[n("DxNumberBox",{attrs:{value:e.epsg}},[n("DxTextBoxButton",{attrs:{locate:"after",name:"epsg"}},[n("DxButtonOptions",{attrs:{focusStateEnabled:!1,icon:"dx-icon dx-icon-more",hint:"Выбрать систему координат",onClick:e.openEpsgList}})],1)],1)],1)])]},proxy:!0}])},[n("DxExport",{attrs:{enabled:!0}}),n("DxSearchPanel",{attrs:{visible:!0}}),n("DxGrouping",{attrs:{autoExpandAll:!1}}),n("DxGroupPanel",{attrs:{visible:!1}}),n("DxColumnChooser",{attrs:{enabled:!0}}),n("DxColumnFixing",{attrs:{enabled:!0}}),n("DxPager",{attrs:{infoText:"Страница {0} из {1} • Всего {2} элементов",showInfo:!0}}),n("DxColumn",{attrs:{dataType:"number",dataField:"id",caption:"ID",width:60,visible:!1}}),n("DxColumn",{attrs:{dataType:"string",dataField:"fieldtype_name",caption:"Тип данных",visibleIndex:200}}),n("DxColumn",{attrs:{dataType:"string",dataField:"name",caption:"Название",visibleIndex:100}}),n("DxColumn",{attrs:{dataType:"string",dataField:"caption",caption:"Заголовок",visibleIndex:110}})],1),n("EpsgList",{attrs:{visible:e.epsgListVisible,popupContainer:e.popupContainer},on:{shown:function(t){e.epsgListVisible=!0},hidden:function(t){e.epsgListVisible=!1},apply:e.setEpsg}})],1)},Dt=[],Pt=n("6819"),Et="PAGES.DSPAGE_FIELD.GETDATA",wt={name:"DocumentAttributesList",components:{DxDataGrid:je["DxDataGrid"],DxExport:je["DxExport"],DxSearchPanel:je["DxSearchPanel"],DxGrouping:je["DxGrouping"],DxGroupPanel:je["DxGroupPanel"],DxColumnChooser:je["DxColumnChooser"],DxColumnFixing:je["DxColumnFixing"],DxPager:je["DxPager"],DxColumn:je["DxColumn"],DxNumberBox:De["DxNumberBox"],DxTextBoxButton:De["DxButton"],DxButtonOptions:De["DxOptions"],EpsgList:Pt["a"]},props:{guidLink:String,epsg:Number,popupContainer:null},data:function(){return{dataSource:[],epsgListVisible:!1}},watch:{guidLink:function(){this.refreshData()}},methods:{refreshData:function(){var e=this;this.guidLink?(this.$refs.dataGrid.instance.beginCustomLoading(),Object(he["c"])("getData",{_config_dataset:Et,guid_link:this.guidLink}).then((function(t){e.dataSource=t})).finally((function(){return e.$refs.dataGrid.instance.endCustomLoading()}))):this.dataSource=[]},onToolbarPreparing:function(e){var t=this,n=e.toolbarOptions,i=n.items,o=[{widget:"dxButton",location:"before",name:"refresh",options:{focusStateEnabled:!1,hint:"Обновить",icon:"refresh",onClick:function(){t.refreshData()}}},{location:"after",name:"epsg",template:"epsg"}];i.splice.apply(i,[0,0].concat(o))},openEpsgList:function(){this.epsgListVisible=!0},setEpsg:function(e){this.$emit("setEpsg",e)}}},Tt=wt,jt=(n("ee9f"),Object(j["a"])(Tt,Lt,Dt,!1,null,null,null)),kt=jt.exports;function Ft(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Bt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ft(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ft(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Mt=500,At="BASE.DSDOCUMENTOMSYTREE",Rt={name:"DocumentsListPopup",props:{visible:Boolean,popupContainer:null,accept:String},components:{DxPopup:me["DxPopup"],PopupTitleTemplate:Ce["a"],DxPopupToolbarItem:me["DxToolbarItem"],DxButton:ve.a,DxTreeView:ze.a,DxToolbar:He["DxToolbar"],DxToolbarItem:He["DxItem"],DxLoadPanel:be["DxLoadPanel"],DxLoadPanelPosition:be["DxPosition"],DxTextBox:O.a,DirectoryForm:Xe,DocumentsList:St,DocumentAttributesList:kt},data:function(){return{selectedDocument:{},directoriesDataSource:[],loadPanelVisible:!1,searchString:"",searchTimeoutId:null,directoryFormVisible:!1,directoryNameForSave:"",clickCount:0,clickTarget:0,lastClickTime:null,isDblClick:!1}},computed:{selectedDirectory:function(){return this.directoriesDataSource.find((function(e){return e.selected}))||null},visibleDirectoriesDataSource:function(){var e=this;return this.directoriesDataSource.filter((function(t){return t.caption.toUpperCase().includes(e.searchString.toUpperCase())}))}},methods:{onShown:function(){this.directoriesDataSource.length||this.refreshDirectoriesList(),this.$emit("shown")},refreshDirectoriesList:function(){var e=this;this.loadPanelVisible=!0,Object(he["c"])("getData",{_config_dataset:At}).then((function(t){e.directoriesDataSource=t.map((function(e,t){return Bt(Bt({},e),{},{selected:!t})}))})).finally((function(){return e.loadPanelVisible=!1}))},onSearch:function(e){var t=this;this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.timeoutId=setTimeout((function(){t.searchString=e.component.option("value")}),1e3)},openDirectoryForm:function(){this.directoryNameForSave="",this.directoryFormVisible=!0},saveDirectory:function(e){var t=this;this.directoryFormVisible=!1,this.loadPanelVisible=!0;var n="insertData",i={_config_dataset:At,name:e,documenttype_id:0};this.directoryNameForSave?(n="updateData",i=Bt(Bt({},this.selectedDirectory),i)):this.selectedDirectory&&(i.parent_id=this.selectedDirectory.id),Object(he["c"])(n,i).then((function(e){t.directoriesDataSource=t.directoriesDataSource.filter((function(t){return t.id!==e[0].id})),t.directoriesDataSource.push(Bt(Bt({},e[0]),{},{selected:!0}))})).finally((function(){return t.loadPanelVisible=!1}))},itemClick:function(e){var t=this;this.detectDblClick(e.itemData)&&(window.setTimeout((function(){t.isDblClick=!0,e.component.selectItem(e.itemData.id)}),100),this.directoryNameForSave=e.itemData.name,this.directoryFormVisible=!0)},detectDblClick:function(e){var t=this,n=!1;if(this.clickCount?this.clickTarget===e.id?this.clickCount++:this.resetDblClickData():(this.clickCount=1,this.clickTarget=e.id),1===this.clickCount)this.lastClickTime=(new Date).getTime(),window.setTimeout((function(){t.resetDblClickData()}),Mt);else if(2===this.clickCount&&this.clickTarget===e.id){var i=(new Date).getTime();i-this.lastClickTime<Mt+50&&(n=!0),this.resetDblClickData()}return n},resetDblClickData:function(){this.clickCount=0,this.clickTarget=0,this.lastClickTime=null},deleteDirectory:function(){var e=this;this.selectedDirectory&&(this.selectedDirectory.id||0===this.selectedDirectory.id)&&(this.loadPanelVisible=!0,Object(he["c"])("deleteData",{_config_dataset:At,id:this.selectedDirectory.id}).then((function(){e.directoriesDataSource=e.directoriesDataSource.filter((function(t){return t.id!==e.selectedDirectory.id}))})).finally((function(){return e.loadPanelVisible=!1})))},apply:function(){this.$emit("apply",this.selectedDocument),this.$emit("hidden")},setEpsg:function(e){var t=this;Object(he["c"])("updateData",Bt(Bt({_config_dataset:At},this.selectedDocument),{},{epsg:e.srid})).then((function(){t.selectedDocument.epsg=e.srid}))}}},Vt=Rt,Gt=(n("7539"),Object(j["a"])(Vt,$e,Ne,!1,null,null,null)),$t=Gt.exports,Nt=n("520c"),Ut={name:"GisVectorLayerForm",components:{DxScrollView:b.a,DxTextBox:x["DxTextBox"],DxTextBoxButton:x["DxButton"],DxButtonOptions:x["DxOptions"],DxTextArea:Le.a,DxButton:ve.a,DxNumberBox:Pe.a,DxValidator:Ee["DxValidator"],DataSetsList:Ge,DocumentList:$t,DxRequiredRule:Ee["DxRequiredRule"]},props:{formValues:Object,popupContainer:null,loadData:Boolean,isNew:Boolean},data:function(){return{dataSetsListVisible:!1,documentListVisible:!1}},methods:{showDataSetList:function(){this.dataSetsListVisible=!0},showDocumentList:function(){this.documentListVisible=!0},removeDataSet:function(){this.onValueChanged({dataset_code:null})},removeDocument:function(){this.onValueChanged({document_name:null,document_id:null,guid_link:null})},emitDownloadDocument:function(){this.$emit("downloadDocument")},editGeomTypes:function(e){var t=Object(Ie["a"])(this.formValues.geomtypes);t.includes(e)?t=t.filter((function(t){return t!==e})):t.push(e),t.length||(t=[e]),this.onValueChanged({geomtypes:t})},onValueChanged:function(e){this.$emit("changed",e)},validateForm:function(){var e=qe["a"].getGroupConfig("vectorLayerForm");if(e){var t=e.validate();return t.isValid}return!0},clearLayer:function(){var e=this,t=Object(Nt["c"])({showTitle:!1,messageHtml:'<div style="font-size:16px;">Удалить все объекты слоя?</div>',buttons:[{text:"Да",type:"danger",onClick:function(){e.$emit("clearLayer")}},{text:"Нет"}]});t.show()}}},zt=Ut,Ht=(n("30a0"),Object(j["a"])(zt,xe,Oe,!1,null,null,null)),Wt=Ht.exports,Kt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-vector-layer-fields-list"},[n("DxDataGrid",{ref:"dataGrid",staticClass:"data-grid",attrs:{showColumnLines:!1,hoverStateEnabled:!0,height:"auto",rowAlternationEnabled:!0,allowColumnResizing:!0,allowColumnReordering:!0,keyExpr:"id",selectedRowKeys:e.selectedRowKeys,dataSource:e.visibleFields},on:{selectionChanged:function(t){return e.selectRow(t.selectedRowsData[0])},rowDblClick:e.onRowDblClick,toolbarPreparing:e.onToolbarPreparing},scopedSlots:e._u([{key:"isKeyCellTemplate",fn:function(e){var t=e.data;return[n("div",{attrs:{title:t.value?"Поле является ключом":""}},[n("i",{staticClass:"core core-key",style:{color:t.value?" #ffc21a":"transparent"}})])]}},{key:"refreshButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,hint:"Обновить",icon:"refresh"},on:{click:function(t){return e.refreshList(!0)}}})]},proxy:!0},{key:"insertButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,visible:e.editFields,hint:"Добавить запись",icon:"plus",type:"default"},on:{click:e.openNewFieldForm}})]},proxy:!0},{key:"deleteButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,visible:e.editFields,hint:"Удалить запись (переводит запись в корзину, данные физически не удаляются)",icon:"trash",type:"danger"},on:{click:function(t){return e.deleteField(e.selectedItem.id)}}})]},proxy:!0},{key:"geocodeButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,visible:e.editFields,hint:"Геокодировать адрес",icon:"fa fa-map-pin",disabled:!e.selectedItem||"text"!==e.selectedItem.fieldtype_name},on:{click:function(t){e.geoCodeFormVisible=!0}}})]},proxy:!0},{key:"reverseButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,visible:e.editFields,hint:"Получить адрес",icon:"core core-revert-geocode"},on:{click:function(t){e.reverseGeoCodeFormVisible=!0}}})]},proxy:!0},{key:"wktButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,visible:e.editFields,hint:"Преобразовать в геометрию",icon:"core core-198_convert",disabled:!e.selectedItem||!["text","json","double precision"].includes(e.selectedItem.fieldtype_name)},on:{click:function(t){e.wktGeoCodeFormVisible=!0}}})]},proxy:!0},{key:"cadButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,visible:e.editFields,hint:"Геокодирование по кадастру",icon:"core core-into-multi-poly",disabled:!e.selectedItem||"text"!==e.selectedItem.fieldtype_name},on:{click:function(t){e.cadGeoCodeFormVisible=!0}}})]},proxy:!0}])},[n("DxExport",{attrs:{enabled:!0}}),n("DxSearchPanel",{attrs:{visible:!0}}),n("DxSelection",{attrs:{mode:"single"}}),n("DxColumnChooser",{attrs:{enabled:!0}}),n("DxColumnFixing",{attrs:{enabled:!0}}),n("DxPager",{attrs:{infoText:"Страница {0} из {1} • Всего {2} элементов",showInfo:!0}}),n("DxPaging",{attrs:{pageSize:10}}),n("DxGrouping",{attrs:{autoExpandAll:!1}}),n("DxColumn",{attrs:{dataType:"number",dataField:"id",caption:"ID",visible:!1,width:60}}),n("DxColumn",{attrs:{dataType:"string",dataField:"fieldtype_name",caption:"Тип данных"}}),n("DxColumn",{attrs:{dataType:"string",dataField:"name",caption:"Название"}}),n("DxColumn",{attrs:{dataType:"string",dataField:"caption",caption:"Заголовок"}}),n("DxColumn",{attrs:{dataType:"boolean",dataField:"is_key",caption:"Ключ",cellTemplate:"isKeyCellTemplate",width:60}})],1),n("GisVectorLayerFieldForm",e._b({attrs:{layerComponentId:e.layerComponentId,popupContainer:e.popupContainer},on:{shown:function(t){e.fieldFormOptions.visible=!0},hidden:function(t){e.fieldFormOptions.visible=!1},apply:e.fieldFormSaved}},"GisVectorLayerFieldForm",e.fieldFormOptions,!1)),n("GeoCodeForm",{attrs:{visible:e.geoCodeFormVisible,popupContainer:e.popupContainer,addressFieldId:e.selectedItem?e.selectedItem.id:null,fields:e.visibleFields},on:{shown:function(t){e.geoCodeFormVisible=!0},hidden:function(t){e.geoCodeFormVisible=!1},apply:function(t){return e.geoCode(Object.assign({},t,{is_reverse:!1}))}}}),n("ReverseGeoCodeForm",{attrs:{visible:e.reverseGeoCodeFormVisible,popupContainer:e.popupContainer,addressFields:e.textFields},on:{shown:function(t){e.reverseGeoCodeFormVisible=!0},hidden:function(t){e.reverseGeoCodeFormVisible=!1},apply:function(t){return e.geoCode(Object.assign({},t,{is_reverse:!0}))}}}),n("WktGeoCodeForm",{attrs:{visible:e.wktGeoCodeFormVisible,popupContainer:e.popupContainer},on:{shown:function(t){e.wktGeoCodeFormVisible=!0},hidden:function(t){e.wktGeoCodeFormVisible=!1},apply:e.getGeom}}),n("CadGeoCodeForm",{attrs:{visible:e.cadGeoCodeFormVisible,popupContainer:e.popupContainer,fields:e.textFields,fieldId:e.selectedItem?e.selectedItem.id:null},on:{shown:function(t){e.cadGeoCodeFormVisible=!0},hidden:function(t){e.cadGeoCodeFormVisible=!1},apply:e.getGeomFromGkn}})],1)},qt=[],Jt=(n("20d6"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"gis-vector-layer-field-form",attrs:{width:500,height:"auto",visible:e.visible,container:e.popupContainer,shading:!1},on:{shown:e.onShown,closeClick:function(t){return e.$emit("hidden")}},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:e.isNew?"Добавить столбец":"Редактировать столбец",showCloseButton:!0},on:{closeClick:function(t){return e.$emit("hidden")}}})]},proxy:!0},{key:"content",fn:function(){return[n("div",{staticClass:"gis-vector-layer-field-form__content"},[n("DxToolbar",{scopedSlots:e._u([{key:"saveButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,hint:"Сохранить запись",disabled:!e.isEditing||e.isLoading,icon:"save",template:e.isLoading?"loadIndicatorContent":"content",type:"success"},on:{click:e.saveForm},scopedSlots:e._u([{key:"loadIndicatorContent",fn:function(){return[n("div",[n("DxLoadIndicator",{staticClass:"gis-vector-layer-field-form__load-indicator",attrs:{visible:!0}})],1)]},proxy:!0}])})]},proxy:!0},{key:"revertButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,hint:"Отменить изменения",disabled:!e.isEditing||e.isLoading,icon:"revert"},on:{click:e.revertForm}})]},proxy:!0}])},[n("DxToolbarItem",{attrs:{location:"before",name:"save",template:"saveButton"}}),n("DxToolbarItem",{attrs:{location:"before",name:"revert",template:"revertButton"}})],1),n("div",{staticClass:"gis-vector-layer-field-form__form"},[e.isNew?e._e():n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("ID")]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{attrs:{readOnly:!0},model:{value:e.fieldOptions.id,callback:function(t){e.$set(e.fieldOptions,"id",t)},expression:"fieldOptions.id"}})],1)]),n("div",{staticClass:"gis-vector-layer-field-form__group"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Название "),n("span",{staticClass:"gis-vector-layer-form__required"},[e._v("*")])]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{on:{valueChanged:e.onValueChanged},model:{value:e.fieldOptions.name,callback:function(t){e.$set(e.fieldOptions,"name",t)},expression:"fieldOptions.name"}},[n("DxValidator",{attrs:{validationGroup:"fieldForm"}},[n("DxRequiredRule",{attrs:{type:"required",message:"Поле обязательно для заполнения"}})],1)],1)],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Ключ")]),n("div",{staticClass:"dx-field-value"},[n("DxCheckBox",{on:{valueChanged:e.onValueChanged},model:{value:e.fieldOptions.is_key,callback:function(t){e.$set(e.fieldOptions,"is_key",t)},expression:"fieldOptions.is_key"}})],1)])]),n("div",{staticClass:"gis-vector-layer-field-form__group"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Заголовок "),n("span",{staticClass:"gis-vector-layer-form__required"},[e._v("*")])]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{on:{valueChanged:e.onValueChanged},model:{value:e.fieldOptions.caption,callback:function(t){e.$set(e.fieldOptions,"caption",t)},expression:"fieldOptions.caption"}},[n("DxValidator",{attrs:{validationGroup:"fieldForm"}},[n("DxRequiredRule",{attrs:{type:"required",message:"Поле обязательно для заполнения"}})],1)],1)],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("В таблице")]),n("div",{staticClass:"dx-field-value"},[n("DxCheckBox",{on:{valueChanged:e.onValueChanged},model:{value:e.fieldOptions.is_visibletable,callback:function(t){e.$set(e.fieldOptions,"is_visibletable",t)},expression:"fieldOptions.is_visibletable"}})],1)])]),n("div",{staticClass:"gis-vector-layer-field-form__group"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Позиция "),n("span",{staticClass:"gis-vector-layer-form__required"},[e._v("*")])]),n("div",{staticClass:"dx-field-value"},[n("DxNumberBox",{on:{valueChanged:e.onValueChanged},model:{value:e.fieldOptions.pos,callback:function(t){e.$set(e.fieldOptions,"pos",t)},expression:"fieldOptions.pos"}},[n("DxValidator",{attrs:{validationGroup:"fieldForm"}},[n("DxRequiredRule",{attrs:{type:"required",message:"Поле обязательно для заполнения"}})],1)],1)],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("В карточке")]),n("div",{staticClass:"dx-field-value"},[n("DxCheckBox",{on:{valueChanged:e.onValueChanged},model:{value:e.fieldOptions.is_visiblecard,callback:function(t){e.$set(e.fieldOptions,"is_visiblecard",t)},expression:"fieldOptions.is_visiblecard"}})],1)])]),n("div",{staticClass:"gis-vector-layer-field-form__group"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Тип данных "),n("span",{staticClass:"gis-vector-layer-form__required"},[e._v("*")])]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{valueExpr:"id",displayExpr:"name",dataSource:e.fieldTypes},on:{valueChanged:e.onValueChanged},model:{value:e.fieldOptions.fieldtype_id,callback:function(t){e.$set(e.fieldOptions,"fieldtype_id",t)},expression:"fieldOptions.fieldtype_id"}},[n("DxValidator",{attrs:{validationGroup:"fieldForm"}},[n("DxRequiredRule",{attrs:{type:"required",message:"Поле обязательно для заполнения"}})],1)],1)],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("В фильтре")]),n("div",{staticClass:"dx-field-value"},[n("DxCheckBox",{on:{valueChanged:e.onValueChanged},model:{value:e.fieldOptions.is_visiblefilter,callback:function(t){e.$set(e.fieldOptions,"is_visiblefilter",t)},expression:"fieldOptions.is_visiblefilter"}})],1)])]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Описание")]),n("div",{staticClass:"dx-field-value"},[n("DxTextArea",{on:{valueChanged:e.onValueChanged},model:{value:e.fieldOptions.comments,callback:function(t){e.$set(e.fieldOptions,"comments",t)},expression:"fieldOptions.comments"}})],1)])])],1)]},proxy:!0}])})}),Zt=[],Yt=n("ee80"),Xt=n.n(Yt),Qt=n("a045");function en(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function tn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?en(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):en(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var nn={name:null,caption:null,pos:null,is_key:!1,is_visiblecard:!1,is_visiblefilter:!1,fieldtype_id:null,comments:null},on={name:"GisVectorLayerFieldForm",components:{DxPopup:ge.a,DxValidator:Ee["DxValidator"],DxRequiredRule:Ee["DxRequiredRule"],DxTextBox:O.a,DxNumberBox:Pe.a,DxSelectBox:rt.a,DxCheckBox:Xt.a,DxTextArea:Le.a,DxToolbar:He["DxToolbar"],DxToolbarItem:He["DxItem"],DxButton:ve.a,DxLoadIndicator:f.a,PopupTitleTemplate:Ce["a"]},props:{visible:Boolean,popupContainer:null,isNew:Boolean,fieldValues:Object,layerComponentId:String},data:function(){return{fieldOptions:tn({},nn),fieldTypes:[],isEditing:!1,isLoading:!1}},mounted:function(){var e=this;Object(he["c"])("getData",{_config_dataset:"CONNECTIONS.DSFIELDTYPE"}).then((function(t){e.fieldTypes=t}))},methods:tn(tn({},Object(u["b"])("config",{updateDataField:ce["Q"],refreshFieldLayer:ce["A"]})),{},{onShown:function(){this.fieldValues?this.fieldOptions=tn({},this.fieldValues):this.fieldOptions=tn({},nn),this.onValueChanged(),this.$emit("shown")},onValueChanged:function(){this.isEditing=!Object(Qt["b"])(this.fieldOptions,this.fieldValues||nn)},revertForm:function(){this.isNew?this.fieldOptions=tn({},nn):this.fieldOptions=tn({},this.fieldValues)},saveForm:function(){var e=this,t=qe["a"].getGroupConfig("fieldForm");if(t){var n=t.validate();if(!n.isValid)return}this.isLoading=!0,this.updateDataField(tn({layerComponentId:this.layerComponentId},this.fieldOptions)).then((function(t){return e.refreshFieldLayer({layerComponentId:e.layerComponentId}).then((function(){return e.$emit("apply",t)}))})).finally((function(){e.isLoading=!1}))}})},an=on,sn=(n("dcb0"),Object(j["a"])(an,Jt,Zt,!1,null,null,null)),rn=sn.exports,ln=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"geo-code-form",attrs:{width:600,height:"auto",visible:e.visible,container:e.popupContainer,shading:!1},on:{shown:e.onShown,hidden:function(t){return e.$emit("hidden")}},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:"Получить геометрию",showCloseButton:!0},on:{closeClick:function(t){return e.$emit("hidden")}}})]},proxy:!0},{key:"applyButton",fn:function(){return[n("DxButton",{attrs:{text:"Применить",type:"success"},on:{click:e.apply}})]},proxy:!0}])},[n("div",{staticClass:"geo-code-form__form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Адрес")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{valueExpr:"id",displayExpr:"name",dataSource:e.addressFields},model:{value:e.address,callback:function(t){e.address=t},expression:"address"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Широта")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{valueExpr:"id",displayExpr:"name",dataSource:e.coordFields,clearButton:!0},model:{value:e.lat,callback:function(t){e.lat=t},expression:"lat"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Долгота")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{valueExpr:"id",displayExpr:"name",dataSource:e.coordFields,clearButton:!0},model:{value:e.lon,callback:function(t){e.lon=t},expression:"lon"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("GeoJson")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{valueExpr:"id",displayExpr:"name",dataSource:e.geojsonFields,clearButton:!0},model:{value:e.geojson,callback:function(t){e.geojson=t},expression:"geojson"}})],1)])]),n("DxToolbarItem",{attrs:{toolbar:"bottom",location:"center",template:"applyButton"}})],1)},cn=[],dn=4,un=5,pn=6,fn={name:"GeoCodeForm",components:{DxPopup:me["DxPopup"],PopupTitleTemplate:Ce["a"],DxSelectBox:rt.a,DxButton:ve.a,DxToolbarItem:me["DxToolbarItem"]},props:{visible:Boolean,popupContainer:null,addressFieldId:Number,fields:Array},data:function(){return{address:this.addressFieldId||null,lat:null,lon:null,geojson:null}},computed:{addressFields:function(){return this.fields.filter((function(e){return e.fieldtype_id===pn}))},coordFields:function(){return this.fields.filter((function(e){return e.fieldtype_id===dn}))},geojsonFields:function(){return this.fields.filter((function(e){return e.fieldtype_id===un}))}},watch:{addressFieldId:function(){this.address=this.addressFieldId}},methods:{onShown:function(){this.lat=null,this.lon=null,this.geojson=null,this.$emit("shown")},apply:function(){var e=this,t={};["address","lat","lon","geojson"].forEach((function(n){e[n]&&(t[n]=e[n])})),this.$emit("apply",t),this.$emit("hidden")}}},hn=fn,mn=(n("99444"),Object(j["a"])(hn,ln,cn,!1,null,null,null)),gn=mn.exports,yn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"reverse-geo-code-form",attrs:{width:600,height:"auto",visible:e.visible,container:e.popupContainer,shading:!1},on:{shown:e.onShown,hidden:function(t){return e.$emit("hidden")}},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:"Получить адрес",showCloseButton:!0},on:{closeClick:function(t){return e.$emit("hidden")}}})]},proxy:!0},{key:"applyButton",fn:function(){return[n("DxButton",{attrs:{text:"Применить",type:"success"},on:{click:e.apply}})]},proxy:!0}])},[n("div",{staticClass:"reverse-geo-code-form__form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Адрес")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{valueExpr:"id",displayExpr:"name",dataSource:e.addressFields},model:{value:e.address,callback:function(t){e.address=t},expression:"address"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("EPSG")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{value:e.epsgName}},[n("DxTextBoxButton",{attrs:{locate:"after",name:"add"}},[n("DxButtonOptions",{attrs:{focusStateEnabled:!1,icon:"dx-icon dx-icon-more",hint:"Выбрать систему координат",onClick:e.openEpsgList}})],1)],1)],1)]),n("EpsgList",{attrs:{visible:e.epsgListVisible,popupContainer:e.popupContainer},on:{shown:function(t){e.epsgListVisible=!0},hidden:function(t){e.epsgListVisible=!1},apply:e.setEpsg}})],1),n("DxToolbarItem",{attrs:{toolbar:"bottom",location:"center",template:"applyButton"}})],1)},vn=[],bn={name:"ReverseGeoCodeForm",components:{DxPopup:me["DxPopup"],PopupTitleTemplate:Ce["a"],DxSelectBox:rt.a,DxTextBox:x["DxTextBox"],DxTextBoxButton:x["DxButton"],DxButtonOptions:x["DxOptions"],DxButton:ve.a,DxToolbarItem:me["DxToolbarItem"],EpsgList:Pt["a"]},props:{visible:Boolean,popupContainer:null,addressFields:Array},data:function(){return{epsg:4326,epsgName:"EPSG: 4326",address:(this.addressFields[0]||{}).id||null,epsgListVisible:!1}},methods:{onShown:function(){this.epsg=4326,this.epsgName="EPSG: 4326",this.address=(this.addressFields[0]||{}).id||null,this.$emit("shown")},openEpsgList:function(){this.epsgListVisible=!0},setEpsg:function(e){this.epsg=e.srid,this.epsgName="".concat(e.auth_name,": ").concat(e.srid)},apply:function(){this.$emit("apply",{epsg:this.epsg,address:this.address}),this.$emit("hidden")}}},_n=bn,Cn=(n("c92a"),Object(j["a"])(_n,yn,vn,!1,null,null,null)),xn=Cn.exports,On=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"wkt-geo-code-form",attrs:{width:600,height:"auto",visible:e.visible,container:e.popupContainer,shading:!1},on:{shown:e.onShown,hidden:function(t){return e.$emit("hidden")}},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:"Получить геометрию из WKT",showCloseButton:!0},on:{closeClick:function(t){return e.$emit("hidden")}}})]},proxy:!0},{key:"applyButton",fn:function(){return[n("DxButton",{attrs:{text:"Применить",type:"success"},on:{click:e.apply}})]},proxy:!0}])},[n("div",{staticClass:"wkt-geo-code-form__form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("EPSG")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{value:e.epsgName}},[n("DxTextBoxButton",{attrs:{locate:"after",name:"add"}},[n("DxButtonOptions",{attrs:{focusStateEnabled:!1,icon:"dx-icon dx-icon-more",hint:"Выбрать систему координат",onClick:e.openEpsgList}})],1)],1)],1)]),n("EpsgList",{attrs:{visible:e.epsgListVisible,popupContainer:e.popupContainer},on:{shown:function(t){e.epsgListVisible=!0},hidden:function(t){e.epsgListVisible=!1},apply:e.setEpsg}})],1),n("DxToolbarItem",{attrs:{toolbar:"bottom",location:"center",template:"applyButton"}})],1)},In=[],Sn={name:"WktGeoCodeForm",components:{DxPopup:me["DxPopup"],PopupTitleTemplate:Ce["a"],DxTextBox:x["DxTextBox"],DxTextBoxButton:x["DxButton"],DxButtonOptions:x["DxOptions"],DxButton:ve.a,DxToolbarItem:me["DxToolbarItem"],EpsgList:Pt["a"]},props:{visible:Boolean,popupContainer:null},data:function(){return{epsg:4326,epsgName:"EPSG: 4326",epsgListVisible:!1}},methods:{onShown:function(){this.epsg=4326,this.epsgName="EPSG: 4326",this.$emit("shown")},openEpsgList:function(){this.epsgListVisible=!0},setEpsg:function(e){this.epsg=e.srid,this.epsgName="".concat(e.auth_name,": ").concat(e.srid)},apply:function(){this.$emit("apply",{epsg:this.epsg}),this.$emit("hidden")}}},Ln=Sn,Dn=(n("3882"),Object(j["a"])(Ln,On,In,!1,null,null,null)),Pn=Dn.exports,En=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"cad-geo-code-form",attrs:{width:600,height:"auto",visible:e.visible,container:e.popupContainer,shading:!1},on:{shown:e.onShown,hidden:function(t){return e.$emit("hidden")}},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:"Получить геометрию",showCloseButton:!0},on:{closeClick:function(t){return e.$emit("hidden")}}})]},proxy:!0},{key:"applyButton",fn:function(){return[n("DxButton",{attrs:{text:"Применить",type:"success"},on:{click:e.apply}})]},proxy:!0}])},[n("div",{staticClass:"cad-geo-code-form__form"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Тип")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{valueExpr:"id",displayExpr:"name",dataSource:e.types},model:{value:e.gkn,callback:function(t){e.gkn=t},expression:"gkn"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Атрибут")]),n("div",{staticClass:"dx-field-value"},[n("DxSelectBox",{attrs:{valueExpr:"id",displayExpr:"name",dataSource:e.fields},model:{value:e.targetField,callback:function(t){e.targetField=t},expression:"targetField"}})],1)])]),n("DxToolbarItem",{attrs:{toolbar:"bottom",location:"center",template:"applyButton"}})],1)},wn=[],Tn={name:"CadGeoCodeForm",components:{DxPopup:me["DxPopup"],PopupTitleTemplate:Ce["a"],DxSelectBox:rt.a,DxButton:ve.a,DxToolbarItem:me["DxToolbarItem"]},props:{visible:Boolean,popupContainer:null,fieldId:Number,fields:Array},data:function(){return{targetField:this.fieldId||null,gkn:1,types:[{id:1,name:"По КН"},{id:2,name:"По адресу"}]}},watch:{fieldId:function(){this.targetField=this.fieldId}},methods:{onShown:function(){this.gkn=1,this.targetField=this.fieldId||null,this.$emit("shown")},apply:function(){this.$emit("apply",{var:this.targetField,gkn:this.gkn}),this.$emit("hidden")}}},jn=Tn,kn=(n("80b2"),Object(j["a"])(jn,En,wn,!1,null,null,null)),Fn=kn.exports;function Bn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bn(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var An="CONNECTIONS.DSGEOCODE",Rn="CONNECTIONS.PRGETGEOM",Vn="CONNECTIONS.PRGETGEOMFROMGKN",Gn={name:"GisVectorLayerFieldsList",props:{layerComponentId:String,gisComponentId:String,popupContainer:null,editFields:Boolean},components:{DxDataGrid:je["DxDataGrid"],DxExport:je["DxExport"],DxSearchPanel:je["DxSearchPanel"],DxSelection:je["DxSelection"],DxColumnChooser:je["DxColumnChooser"],DxColumnFixing:je["DxColumnFixing"],DxPager:je["DxPager"],DxPaging:je["DxPaging"],DxGrouping:je["DxGrouping"],DxColumn:je["DxColumn"],GisVectorLayerFieldForm:rn,GeoCodeForm:gn,ReverseGeoCodeForm:xn,WktGeoCodeForm:Pn,CadGeoCodeForm:Fn,DxButton:ve.a},data:function(){return{fields:[],selectedItem:null,fieldFormOptions:{visible:!1,isNew:!0,fieldValues:null},geoCodeFormVisible:!1,reverseGeoCodeFormVisible:!1,wktGeoCodeFormVisible:!1,cadGeoCodeFormVisible:!1}},computed:Mn(Mn({},Object(u["c"])("config",{getDataSetName:pe["m"]})),{},{visibleFields:function(){return this.fields.filter((function(e){return e.is_cardlayer}))},textFields:function(){return this.visibleFields.filter((function(e){return"text"===e.fieldtype_name}))},dataSetName:function(){return this.getDataSetName(this.layerComponentId)},selectedRowKeys:function(){return this.selectedItem?[this.selectedItem.id]:[]}}),mounted:function(){var e=this;this.layerComponentId&&this.refreshList(!1).then((function(t){e.selectRow(t[0])}))},methods:Mn(Mn({},Object(u["b"])("config",{loadDataFields:ce["r"],deleteDataField:ce["i"],refreshFieldLayer:ce["A"],updateCardAndTable:ce["P"]})),{},{onRowDblClick:function(e){this.editFields&&(this.fieldFormOptions.isNew=!1,this.fieldFormOptions.visible=!0,this.fieldFormOptions.fieldValues=e.data)},refreshList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.$refs.dataGrid.instance.beginCustomLoading(),this.loadDataFields({layerComponentId:this.layerComponentId,gisComponentId:this.gisComponentId,refresh:t}).then((function(t){return e.fields=t,t})).finally((function(){return e.$refs.dataGrid.instance.endCustomLoading()}))},fieldFormSaved:function(e){this.refreshList(!1),this.selectRow(e),this.updateCardAndTable({layerComponentId:this.layerComponentId}),this.fieldFormOptions.visible=!1},selectRow:function(e){var t=(e||{}).id||null,n=this.$refs.dataGrid.instance.getVisibleRows().map((function(e){return e.key}));this.selectedItem=e||null,!t&&0!==t||n.includes(t)||this.$refs.dataGrid.instance.navigateToRow(t)},openNewFieldForm:function(){this.fieldFormOptions.isNew=!0,this.fieldFormOptions.visible=!0,this.fieldFormOptions.fieldValues=null},deleteField:function(e){var t=this;this.$refs.dataGrid.instance.beginCustomLoading();var n=this.visibleFields.findIndex((function(t){return t.id===e}));this.deleteDataField({layerComponentId:this.layerComponentId,dataFieldId:e}).then((function(){return t.refreshFieldLayer({layerComponentId:t.layerComponentId})})).then((function(){return t.refreshList(!1)})).then((function(){return n>t.visibleFields.length-1&&(n=t.visibleFields.length-1),n<0&&(n=0),t.selectRow(t.visibleFields[n]),t.updateCardAndTable({layerComponentId:t.layerComponentId})})).finally((function(){return t.$refs.dataGrid.instance.endCustomLoading()}))},geoCode:function(e){var t=this;this.$refs.dataGrid.instance.beginCustomLoading();var n=Mn({_config_dataset:An,dataset_code:this.dataSetName},e);Object(he["c"])("getData",n).finally((function(){return t.$refs.dataGrid.instance.endCustomLoading()}))},getGeom:function(e){var t=this;this.$refs.dataGrid.instance.beginCustomLoading();var n=Mn({_config_dataset:Rn,dataset_code:this.dataSetName,wkt:this.selectedItem.id},e);Object(he["c"])("getData",n).finally((function(){return t.$refs.dataGrid.instance.endCustomLoading()}))},getGeomFromGkn:function(e){var t=this;this.$refs.dataGrid.instance.beginCustomLoading();var n=Mn({_config_dataset:Vn,dataset_code:this.dataSetName},e);Object(he["c"])("getData",n).finally((function(){return t.$refs.dataGrid.instance.endCustomLoading()}))},onToolbarPreparing:function(e){var t=e.toolbarOptions,n=t.items,i=[{template:"refreshButton",location:"before",name:"refresh"},{template:"insertButton",location:"before",name:"insert"},{template:"deleteButton",location:"before",name:"delete"},{template:"geocodeButton",location:"before",name:"geocode"},{template:"reverseButton",location:"before",name:"reverse"},{template:"wktButton",location:"before",name:"wkt"},{template:"cadButton",location:"before",name:"cad"}];n.push.apply(n,i)}})},$n=Gn,Nn=(n("7cb4"),Object(j["a"])($n,Kt,qt,!1,null,null,null)),Un=Nn.exports,zn=n("c1dc"),Hn=n("4000");function Wn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Kn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wn(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qn="CONFIG.DSCOMPONENT",Jn="CONFIG.DSCOMPONENT_DOWNLOAD_DOCUMENT",Zn="CONFIG.DSCOMPONENT_GENERATE",Yn="CONNECTIONS.PRTRUNCATELAYER",Xn=["mapboxLayers","text","url","geomtypes","bounds"],Qn={id:null,caption:"Новый слой",componenttype_id:160,copyright:null,comments:null,geomtypes:["Point"],layer_count:null,document_name:null,document_id:null,guid_link:null,dataset_code:null,prop:{cssStyle:{},editorOptions:{text:"",type:"vector"}}},ei={name:"GisVectorLayerPopup",components:{AccessFormTemplate:Hn["a"],DxPopup:me["DxPopup"],DxToolbarItem:me["DxToolbarItem"],DxButton:ve.a,DxLoadPanel:be["DxLoadPanel"],DxLoadPanelPosition:be["DxPosition"],PopupTitleTemplate:Ce["a"],GisVectorLayerForm:Wt,GisVectorLayerFieldsList:Un,CardTabsBase:zn["a"]},props:{gisComponentId:String,popupContainer:null},data:function(){return{selectedTabIndex:0,loadPanelVisible:!1,layerOptions:Kn({},Qn),dataSetName:null}},computed:Kn(Kn(Kn({},Object(u["c"])("config",{getOptions:ue["c"],getRights:pe["G"]})),Object(u["c"])("session",{userData:"userData"})),{},{layerComponentId:function(){return this.getOptions(this.gisComponentId).editingOptionsLayerComponentId||null},visible:function(){return this.layerComponentId&&("vector"===this.layerComponentId||"vector"===this.getOptions(this.layerComponentId).type)},isNew:function(){return!this.layerComponentId||"vector"===this.layerComponentId},layerRights:function(){return this.isNew?{loadData:!0,editFields:!0,editAccess:!0}:this.getRights(this.layerComponentId)},userId:function(){var e=this.userData||{},t=e.userId||"500322";return t?+t:null},cardTabs:function(){var e=[{title:"Общие",template:"common"}];return this.isNew||(e.push({title:"Колонки",template:"fields"}),this.layerRights.editAccess&&e.push({title:"Доступ",template:"access"})),e}}),watch:{layerComponentId:function(){var e=this;this.visible&&(this.loadPanelVisible=!0,this.loadLayerOptions().finally((function(){e.loadPanelVisible=!1})))}},methods:Kn(Kn(Kn({},Object(u["d"])("config",{setOptions:de["a"]})),Object(u["b"])("config",{loadLayerComponent:le["l"],updateLayerOptions:ce["R"],repaintLayer:ce["C"]})),{},{onFormHidden:function(){this.selectedTabIndex=0,this.setOptions({componentId:this.gisComponentId,optionName:"editingOptionsLayerComponentId",optionValue:null})},loadLayerOptions:function(){var e=this;return this.isNew?(this.dataSetName=null,this.layerOptions=Kn({},Qn),Promise.resolve()):Object(he["c"])("getData",{_config_dataset:qn,id:this.layerComponentId}).then((function(t){e.layerOptions=Kn({},t[0]||Qn),e.dataSetName=e.layerOptions.connection_dataset_code||null,e.layerOptions.geomtypes||(e.layerOptions.geomtypes=["Point","Line","Polygon"])}))},apply:function(){var e=this;if(!this.layerOptions.caption){this.$refs.layerForm||(this.selectedTabIndex=0);var t=this.$refs.layerForm.validateForm();if(!t)return}this.loadPanelVisible=!0;var n={parent_id:this.gisComponentId,_config_dataset:qn};Object.entries(this.layerOptions).forEach((function(e){var t=Object(re["a"])(e,2),i=t[0],o=t[1];null!==o&&(n[i]=o)})),n.prop.editorOptions.text=n.caption;var i="insertData";n.hasOwnProperty("id")&&(i="updateData"),Object(he["c"])(i,n).then((function(t){var n=t[0]||{};if("insertData"===i)return e.insertLayer(n);var o={};return Xn.forEach((function(e){n.prop.editorOptions.hasOwnProperty(e)&&(o[e]=n.prop.editorOptions[e])})),e.updateLayerOptions({layerComponentId:n.id.toString(),options:o})})).then((function(){return e.loadLayerOptions()})).finally((function(){e.loadPanelVisible=!1}))},downloadDocument:function(){var e=this;return this.loadPanelVisible=!0,this.insertLayer(this.layerOptions).finally((function(){e.loadPanelVisible=!1}))},clearLayer:function(){var e=this;this.loadPanelVisible=!0;var t={_config_dataset:Yn,connection_dataset_code:this.dataSetName,_config_user_id:this.userId};Object(he["c"])("getData",t).then((function(){e.repaintLayer({componentId:e.layerComponentId})})).finally((function(){e.loadPanelVisible=!1}))},insertLayer:function(e){var t=this;return this.dataSetName=e.connection_dataset_code||null,Promise.resolve(e).then((function(e){if(t.dataSetName){var n={_config_dataset:Jn,is_new:!0,connection_dataset_code:t.dataSetName,component_id:e.id};return null!==t.layerOptions.document_id&&(n.document_id=t.layerOptions.document_id,n.guid_link=t.layerOptions.guid_link),Object(he["c"])("getData",n).then((function(){return e}))}return Promise.resolve(e)})).then((function(e){if(t.dataSetName){var n={_config_dataset:Zn,connection_dataset_code:t.dataSetName,component_id:e.id};return Object(he["c"])("getData",n).then((function(){return e}))}return Promise.resolve(e)})).then((function(e){return t.loadLayerComponent({gisComponentId:t.gisComponentId,layerComponentId:e.id.toString()})})).then((function(e){return t.setOptions({componentId:t.gisComponentId,optionName:"editingOptionsLayerComponentId",optionValue:e}),fe["a"].updateSession({dataset:t.dataSetName})}))}})},ti=ei,ni=(n("63d5"),Object(j["a"])(ti,ae,se,!1,null,null,null)),ii=ni.exports,oi=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"gis-folder-popup",attrs:{visible:e.visible,container:e.popupContainer,shading:!1,resizeEnabled:!0,animation:null,width:500,height:"auto",maxHeight:"80%",minHeight:350},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:e.isNew?"Создать папку":"Редактировать папку",showCloseButton:!0},on:{closeClick:e.onFormHidden}})]},proxy:!0},{key:"content",fn:function(){return[n("div",{staticClass:"gis-folder-popup__content"},[n("CardTabsBase",{staticClass:"gis-folder-popup__card-tabs",attrs:{items:e.cardTabs,selectedIndex:e.selectedTabIndex},on:{selectionChanged:function(t){e.selectedTabIndex=t}},scopedSlots:e._u([{key:"common",fn:function(){return[n("GisFolderForm",{ref:"layerForm",attrs:{formValues:e.layerOptions,popupContainer:e.popupContainer},on:{changed:function(t){e.layerOptions=Object.assign({},e.layerOptions,t)}}})]},proxy:!0},{key:"access",fn:function(){return[n("AccessFormTemplate",{attrs:{creatorId:null,componentTypeId:161,componentId:e.layerComponentId,creatorVisible:!0}})]},proxy:!0}])}),n("DxLoadPanel",{attrs:{visible:e.loadPanelVisible,container:".gis-folder-popup__content"}},[n("DxLoadPanelPosition",{attrs:{my:"center",at:"center",of:".gis-folder__content"}})],1)],1)]},proxy:!0},{key:"applyButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,text:e.isNew?"Создать":"Сохранить",type:"success"},on:{click:e.apply}})]},proxy:!0}])},[n("DxToolbarItem",{attrs:{toolbar:"bottom",location:"center",template:"applyButton"}})],1)},ai=[],si=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-folder-form"},[n("DxScrollView",[n("div",{staticClass:"gis-folder-form__wrapper"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Название "),n("span",{staticClass:"gis-folder-form__required"},[e._v("*")])]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{value:e.formValues.text},on:{valueChanged:function(t){return e.onValueChanged({text:t.value})}}},[n("DxValidator",{attrs:{validationGroup:"folderForm"}},[n("DxRequiredRule",{attrs:{type:"required",message:"Поле обязательно для заполнения"}})],1)],1)],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Описание")]),n("div",{staticClass:"dx-field-value"},[n("DxTextArea",{attrs:{value:e.formValues.comments,placeholder:"Описание папки",height:60}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Цвет")]),n("div",{staticClass:"dx-field-value"},[n("DxColorBox",{staticClass:"gis-folder-form__color-box",attrs:{value:e.formValues.iconColor},on:{valueChanged:function(t){return e.onValueChanged({iconColor:t.value})},opened:e.selectBoxOpened}})],1)])])])],1)},ri=[],li=n("9576"),ci=n.n(li),di=n("5c46"),ui={name:"GisFolderForm",mixins:[di["a"]],components:{DxScrollView:b.a,DxTextBox:O.a,DxTextArea:Le.a,DxColorBox:ci.a,DxValidator:Ee["DxValidator"],DxRequiredRule:Ee["DxRequiredRule"]},props:{formValues:Object},methods:{onValueChanged:function(e){this.$emit("changed",e)},validateForm:function(){var e=qe["a"].getGroupConfig("folderForm");if(e){var t=e.validate();return t.isValid}return!0}}},pi=ui,fi=(n("4d04"),Object(j["a"])(pi,si,ri,!1,null,null,null)),hi=fi.exports;function mi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function gi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mi(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var yi="CONFIG.DSCOMPONENTS",vi=["text","iconColor"],bi={text:"Новая папка",iconCss:"core core-092-folder",iconColor:"#ecc849"},_i={name:"GisFolderPopup",components:{AccessFormTemplate:Hn["a"],DxPopup:me["DxPopup"],DxToolbarItem:me["DxToolbarItem"],DxButton:ve.a,DxLoadPanel:be["DxLoadPanel"],DxLoadPanelPosition:be["DxPosition"],PopupTitleTemplate:Ce["a"],CardTabsBase:zn["a"],GisFolderForm:hi},props:{gisComponentId:String,popupContainer:null},data:function(){return{selectedTabIndex:0,loadPanelVisible:!1,layerOptions:gi({},bi)}},computed:gi(gi({},Object(u["c"])("config",{getOptions:ue["c"],getItem:ue["b"],getRights:pe["G"],lastItemPos:"lastItemPos"})),{},{layerComponentId:function(){return this.getOptions(this.gisComponentId).editingOptionsLayerComponentId||null},visible:function(){return this.layerComponentId&&("folder"===this.layerComponentId||this.getOptions(this.layerComponentId).group)},isNew:function(){return!this.layerComponentId||"folder"===this.layerComponentId},parentComponentId:function(){return this.isNew?null:this.getItem(this.layerComponentId).parentComponentId},editAccess:function(){return!this.isNew&&this.getRights(this.layerComponentId).editAccess},cardTabs:function(){var e=[{title:"Общие",template:"common"}];return this.editAccess&&e.push({title:"Доступ",template:"access"}),e}}),watch:{layerComponentId:function(){var e=this;this.visible&&(this.loadPanelVisible=!0,this.loadLayerOptions().finally((function(){e.loadPanelVisible=!1})))}},methods:gi(gi(gi({},Object(u["d"])("config",{setOptions:de["a"]})),Object(u["b"])("config",{loadLayerComponent:le["l"],updateLayerOptions:ce["R"]})),{},{onFormHidden:function(){this.selectedTabIndex=0,this.setOptions({componentId:this.gisComponentId,optionName:"editingOptionsLayerComponentId",optionValue:null})},loadLayerOptions:function(){var e=this;return this.isNew?(this.layerOptions=gi({},bi),Promise.resolve()):Object(he["c"])("getData",{_config_dataset:yi,id:this.layerComponentId}).then((function(t){e.layerOptions=Ci(t)}))},apply:function(){var e=this;if(!this.layerOptions.text){this.$refs.layerForm||(this.selectedTabIndex=0);var t=this.$refs.layerForm.validateForm();if(!t)return}this.loadPanelVisible=!0;var n={id:this.layerComponentId,parent_id:this.parentComponentId||this.gisComponentId,_config_dataset:yi,componenttype_id:161,caption:this.layerOptions.text},i={cssStyle:{},editorOptions:{}};Object.entries(this.layerOptions).forEach((function(e){var t=Object(re["a"])(e,2),n=t[0],o=t[1];null!==o&&(i.editorOptions[n]=o)})),n.prop=i;var o="updateData";this.isNew&&(o="insertData",n.pos=(this.lastItemPos(this.gisComponentId)||0)+100,delete n.id),Object(he["c"])(o,n).then((function(t){var n=t[0]||{};if("insertData"===o)return e.loadLayerComponent({gisComponentId:e.gisComponentId,layerComponentId:n.id.toString()});var i={},a=Ci(t);return vi.forEach((function(e){a.hasOwnProperty(e)&&(i[e]=a[e])})),e.updateLayerOptions({layerComponentId:n.id.toString(),options:i})})).then((function(t){return e.setOptions({componentId:e.gisComponentId,optionName:"editingOptionsLayerComponentId",optionValue:t}),e.loadLayerOptions()})).finally((function(){e.loadPanelVisible=!1}))}})};function Ci(e){var t=e[0]||{},n=t.prop?JSON.parse(t.prop):{};return gi({},n.editorOptions||bi)}var xi=_i,Oi=(n("d965"),Object(j["a"])(xi,oi,ai,!1,null,null,null)),Ii=Oi.exports,Si=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"gis-raster-layer-popup",attrs:{visible:e.visible,container:e.popupContainer,shading:!1,resizeEnabled:!0,animation:null,width:500,height:"auto",maxHeight:"80%",minHeight:275},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:e.isNew?"Создать растровый слой":"Редактировать растровый слой",showCloseButton:!0},on:{closeClick:e.onFormHidden}})]},proxy:!0},{key:"content",fn:function(){return[n("div",{staticClass:"gis-raster-layer-popup__content"},[n("CardTabsBase",{staticClass:"gis-raster-layer-popup__card-tabs",attrs:{items:e.cardTabs,selectedIndex:e.selectedTabIndex},on:{selectionChanged:function(t){e.selectedTabIndex=t}},scopedSlots:e._u([{key:"common",fn:function(){return[n("GisRasterLayerForm",{ref:"layerForm",attrs:{formValues:Object.assign({},e.layerOptions,{result:e.result}),popupContainer:e.popupContainer},on:{changed:function(t){e.layerOptions=Object.assign({},e.layerOptions,t)}}})]},proxy:!0},{key:"access",fn:function(){return[n("AccessFormTemplate",{attrs:{creatorId:e.layerOptions.creator_id,componentTypeId:e.layerOptions.componenttype_id,componentId:e.layerOptions.id,creatorVisible:!0}})]},proxy:!0}])}),n("DxLoadPanel",{attrs:{visible:e.loadPanelVisible,container:".gis-raster-layer-popup__content"}},[n("DxLoadPanelPosition",{attrs:{my:"center",at:"center",of:".gis-raster-layer-popup__content"}})],1)],1)]},proxy:!0},{key:"applyButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,text:e.isNew?"Создать слой":"Сохранить",type:"success"},on:{click:e.apply}})]},proxy:!0}])},[n("DxToolbarItem",{attrs:{toolbar:"bottom",location:"center",template:"applyButton",visible:!e.selectedTabIndex}})],1)},Li=[],Di=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-raster-layer-form"},[n("DxScrollView",[n("div",{staticClass:"gis-raster-layer-form__wrapper"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Заголовок "),n("span",{staticClass:"gis-raster-layer-form__required"},[e._v("*")])]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{value:e.formValues.caption},on:{valueChanged:function(t){return e.onValueChanged({caption:t.value})}}},[n("DxValidator",{attrs:{validationGroup:"rasterLayerForm"}},[n("DxRequiredRule",{attrs:{type:"required",message:"Поле обязательно для заполнения"}})],1)],1)],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Копирайт")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{value:e.formValues.copyright},on:{valueChanged:function(t){return e.onValueChanged({copyright:t.value})}}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Описание")]),n("div",{staticClass:"dx-field-value"},[n("DxTextArea",{attrs:{value:e.formValues.comments,placeholder:"Описание слоя"},on:{valueChanged:function(t){return e.onValueChanged({comments:t.value})}}})],1)]),e.formValues.id?e._e():n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Данные "),n("span",{staticClass:"gis-raster-layer-form__required"},[e._v("*")])]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{value:e.formValues.document_name}},[n("DxValidator",{attrs:{validationGroup:"rasterLayerForm"}},[n("DxRequiredRule",{attrs:{type:"required",message:"Поле обязательно для заполнения"}})],1),n("DxTextBoxButton",{attrs:{location:"after",name:"remove"}},[n("DxButtonOptions",{attrs:{focusStateEnabled:!1,visible:!!e.formValues.document_name,icon:"dx-icon dx-icon-close",hint:"Удалить данные",onClick:e.removeDocument}})],1),n("DxTextBoxButton",{attrs:{location:"remove",name:"add"}},[n("DxButtonOptions",{attrs:{focusStateEnabled:!1,icon:"dx-icon dx-icon-more",hint:"Выбрать данные",onClick:e.showDocumentList}})],1)],1)],1)]),e.formValues.result?n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Результат")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{value:e.formValues.result,readOnly:!0}})],1)]):e._e(),e.formValues.bounds?n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Границы")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{attrs:{value:e.formValues.bounds.toString(),readOnly:!0}})],1)]):e._e()])]),n("DocumentList",{attrs:{visible:e.documentListVisible,popupContainer:e.popupContainer,accept:".tif, .tiff"},on:{shown:function(t){e.documentListVisible=!0},hidden:function(t){e.documentListVisible=!1},apply:function(t){return e.onValueChanged({document_name:t.name,document_id:t.id,guid_link:t.guid})}}})],1)},Pi=[],Ei={name:"GisRasterLayerForm",components:{DxScrollView:b.a,DxTextBox:x["DxTextBox"],DxTextBoxButton:x["DxButton"],DxButtonOptions:x["DxOptions"],DxValidator:Ee["DxValidator"],DxRequiredRule:Ee["DxRequiredRule"],DxTextArea:Le.a,DocumentList:$t},props:{formValues:Object,popupContainer:null},data:function(){return{documentListVisible:!1}},methods:{onValueChanged:function(e){this.$emit("changed",e)},showDocumentList:function(){this.documentListVisible=!0},removeDocument:function(){this.onValueChanged({document_name:null,document_id:null,guid_link:null})},validateForm:function(){var e=qe["a"].getGroupConfig("rasterLayerForm");if(e){var t=e.validate();return t.isValid}return!0}}},wi=Ei,Ti=(n("8cb6"),Object(j["a"])(wi,Di,Pi,!1,null,null,null)),ji=Ti.exports;function ki(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Fi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ki(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ki(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Bi={bounds:null,caption:"Новый слой",componenttype_id:160,copyright:null,comments:null,document_name:null,document_id:null,guid_link:null,name:null,prop:{editorOptions:{bbox:"{bbox-epsg-3857}",enabled:!0,format:"image/png",layers:"",srs:"EPSG:3857",tileSize:4096,transparent:!0,type:"wms",version:"1.1.0",visible:!0,wmsUrl:Object({NODE_ENV:"production",VUE_APP_API_FILES_SERVICE:"https://files-service.rusgis.com/apiFiles",VUE_APP_API_SERVICE:"https://api.rusgis.com/api",VUE_APP_DATASET_SERVICE:"https://ds.rusgis.com/dataset",VUE_APP_DOWNLOAD_FILE_SERVICE:"https://files-service.rusgis.com/downloadFile",VUE_APP_GET_PORTRAIT_IMAGE_SERVICE:"https://files-service.rusgis.com/getPortraitImage",VUE_APP_INNER_TILE_SERVICES:"/tms,http://89.108.84.38:8101/tms,https://composite.rusgis.com",VUE_APP_JS_API:"true",VUE_APP_PROXY_SERVICE:"https://proxy.rusgis.com/proxy",VUE_APP_SHOW_DESIGNER_SERVICE:"https://reports.rusgis.com/showDesigner",VUE_APP_SHOW_REPORT_SERVICE:"https://reports.rusgis.com/showReport",VUE_APP_UPLOAD_FILE_SERVICE:"https://files-service.rusgis.com/uploadFile",VUE_APP_USER_ID:"500322",BASE_URL:"/"}).VUE_APP_RASTER_WMS_URL,raster:!0}}},Mi="CONFIG.DSCOMPONENT",Ai="GIS.PR_GEOTIFF_PUBLIC",Ri=["text"],Vi={name:"GisRasterLayerPopup",components:{AccessFormTemplate:Hn["a"],DxPopup:me["DxPopup"],DxToolbarItem:me["DxToolbarItem"],DxButton:ve.a,PopupTitleTemplate:Ce["a"],DxLoadPanel:be["DxLoadPanel"],DxLoadPanelPosition:be["DxPosition"],CardTabsBase:zn["a"],GisRasterLayerForm:ji},props:{gisComponentId:String,popupContainer:null},data:function(){return{selectedTabIndex:0,loadPanelVisible:!1,layerOptions:Fi({},Bi),result:null}},computed:Fi(Fi({},Object(u["c"])("config",{getOptions:ue["c"],getRights:pe["G"]})),{},{layerComponentId:function(){return this.getOptions(this.gisComponentId).editingOptionsLayerComponentId||null},visible:function(){return this.layerComponentId&&("raster"===this.layerComponentId||this.getOptions(this.layerComponentId).raster)},isNew:function(){return!this.layerComponentId||"raster"===this.layerComponentId},editAccess:function(){return!this.isNew&&this.getRights(this.layerComponentId).editAccess},cardTabs:function(){var e=[{title:"Общие",template:"common"}];return this.editAccess&&e.push({title:"Доступ",template:"access"}),e}}),watch:{layerComponentId:function(e,t){var n=this;this.visible&&"raster"!==t&&(this.result=null,this.loadPanelVisible=!0,this.loadLayerOptions().finally((function(){n.loadPanelVisible=!1})))}},methods:Fi(Fi(Fi({},Object(u["d"])("config",{setOptions:de["a"]})),Object(u["b"])("config",{loadLayerComponent:le["l"],updateLayerOptions:ce["R"]})),{},{onFormHidden:function(){this.selectedTabIndex=0,this.setOptions({componentId:this.gisComponentId,optionName:"editingOptionsLayerComponentId",optionValue:null})},loadLayerOptions:function(){var e=this;return this.isNew?(this.layerOptions=Fi({},Bi),Promise.resolve()):Object(he["c"])("getData",{_config_dataset:Mi,id:this.layerComponentId}).then((function(t){e.layerOptions=Fi({},t[0]||Bi)}))},apply:function(){var e=this,t=this.$refs.layerForm.validateForm();if(t){this.loadPanelVisible=!0;var n=null;n=this.isNew?this.publicGeotiff().then((function(){return e.saveLayerOptions()})):this.saveLayerOptions(),n.finally((function(){e.loadPanelVisible=!1}))}},publicGeotiff:function(){var e=this,t={_config_dataset:Ai,guid_link:this.layerOptions.guid_link,caption:this.layerOptions.caption};return Object(he["c"])("getData",t).then((function(t){var n=t[0]||{};return e.layerOptions.name=n.r_name,e.layerOptions.bounds=n.r_bounds,e.result=n.r_result,n}))},saveLayerOptions:function(){var e=this,t={parent_id:this.gisComponentId,_config_dataset:Mi};Object.entries(this.layerOptions).forEach((function(e){var n=Object(re["a"])(e,2),i=n[0],o=n[1];null!==o&&(t[i]=o)})),t.prop.editorOptions.text=t.caption;var n="insertData";return t.hasOwnProperty("id")&&(n="updateData"),Object(he["c"])(n,t).then((function(t){var i=t[0]||{};if(e.layerOptions.id=i.id.toString(),e.layerOptions.prop.editorOptions=Fi({},i.prop.editorOptions),"insertData"===n)return e.loadLayerComponent({gisComponentId:e.gisComponentId,layerComponentId:i.id.toString()}).then((function(){e.setOptions({componentId:e.gisComponentId,optionName:"editingOptionsLayerComponentId",optionValue:i.id.toString()})}));var o={};return Ri.forEach((function(e){i.prop.editorOptions.hasOwnProperty(e)&&(o[e]=i.prop.editorOptions[e])})),e.updateLayerOptions({layerComponentId:i.id.toString(),options:o})}))}})},Gi=Vi,$i=(n("9e3b"),Object(j["a"])(Gi,Si,Li,!1,null,null,null)),Ni=$i.exports,Ui=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"gis-open-layer-popup",attrs:{width:880,height:600,visible:e.visible,container:e.popupContainer,shading:!1,resizeEnabled:!0},on:{shown:e.onShown,hidden:function(t){return e.$emit("hidden")}},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:"Открыть слой",showCloseButton:!0},on:{closeClick:function(t){return e.$emit("hidden")}}})]},proxy:!0},{key:"content",fn:function(){return[n("div",{staticClass:"gis-open-layer-popup__content"},[n("DxDataGrid",{ref:"dataGrid",staticClass:"data-grid",attrs:{allowColumnResizing:!0,dataSource:e.dataSource,allowColumnReordering:!0,hoverStateEnabled:!0,height:"100%",width:"100%",columnResizingMode:"widget",rowAlternationEnabled:!0,showColumnLines:!1,keyExpr:"id"},on:{selectionChanged:function(t){e.selectedLayerId=t.selectedRowKeys[0]},toolbarPreparing:e.onToolbarPreparing}},[n("DxExport",{attrs:{ignoreExcelErrors:!0,excelWrapTextEnabled:!0,enabled:!0,excelFilterEnabled:!0,allowExportSelectedData:!0}}),n("DxSearchPanel",{attrs:{visible:!0}}),n("DxSelection",{attrs:{mode:"single"}}),n("DxColumnChooser",{attrs:{enabled:!0}}),n("DxColumnFixing",{attrs:{enabled:!0}}),n("DxPager",{attrs:{infoText:"Страница {0} из {1} • Всего {2} элементов",showInfo:!0}}),n("DxFilterRow",{attrs:{visible:!0}}),n("DxColumn",{attrs:{dataType:"number",dataField:"id",caption:"ID",width:60}}),n("DxColumn",{attrs:{dataType:"string",dataField:"parent_name",caption:"В составе",width:300}}),n("DxColumn",{attrs:{dataType:"string",dataField:"caption",caption:"Наименование"}}),n("DxColumn",{attrs:{dataType:"string",dataField:"type",caption:"",groupIndex:0}})],1)],1)]},proxy:!0},{key:"toolbarButton",fn:function(){return[n("DxButton",{attrs:{focusStateEnabled:!1,text:"Открыть",icon:"check",type:"success",template:e.loading?"loadIndicatorContentTemplate":"content",disabled:!e.selectedLayerId},on:{click:e.apply},scopedSlots:e._u([{key:"loadIndicatorContentTemplate",fn:function(e){var t=e.data;return[n("LoadIndicatorContent",{attrs:{options:t}})]}}])})]},proxy:!0}])},[n("DxToolbarItem",{attrs:{toolbar:"bottom",location:"center",template:"toolbarButton"}})],1)},zi=[],Hi=n("6907");function Wi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ki(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wi(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qi="CONFIG.PRGETLAYERS",Ji="CONFIG.PRCLONECOMPONENT",Zi={name:"GisOpenLayerPopup",props:{gisComponentId:String,visible:Boolean,popupContainer:null},components:{DxPopup:me["DxPopup"],PopupTitleTemplate:Ce["a"],DxToolbarItem:me["DxToolbarItem"],DxDataGrid:je["DxDataGrid"],DxExport:je["DxExport"],DxSearchPanel:je["DxSearchPanel"],DxSelection:je["DxSelection"],DxColumnChooser:je["DxColumnChooser"],DxColumnFixing:je["DxColumnFixing"],DxPager:je["DxPager"],DxFilterRow:je["DxFilterRow"],DxColumn:je["DxColumn"],DxButton:ve.a,LoadIndicatorContent:Hi["a"]},data:function(){return{dataSource:[],selectedLayerId:null,loading:!1}},computed:Ki({},Object(u["c"])("config",{lastItemPos:"lastItemPos"})),methods:Ki(Ki({},Object(u["b"])("config",{loadLayerComponent:le["l"]})),{},{onShown:function(){this.refreshData(),this.$emit("shown")},refreshData:function(){var e=this;this.$refs.dataGrid.instance.beginCustomLoading(),Object(he["c"])("getData",{_config_dataset:qi,componenttype_id:160,url:window.location.toString()}).then((function(t){e.dataSource=t})).finally((function(){return e.$refs.dataGrid.instance.endCustomLoading()}))},onToolbarPreparing:function(e){var t=this,n=e.toolbarOptions,i=n.items,o={widget:"dxButton",location:"before",name:"refresh",options:{focusStateEnabled:!1,hint:"Обновить",icon:"refresh",onClick:function(){t.refreshGrid()}}};i.splice(0,0,o)},apply:function(){var e=this;this.loading=!0;var t={component_id:this.selectedLayerId,pos:this.lastItemPos(this.gisComponentId)+100,parent_component_id:this.gisComponentId,_config_dataset:Ji};Object(he["c"])("getData",t).then((function(t){var n=t[0].r_component_id;return e.loadLayerComponent({gisComponentId:e.gisComponentId,layerComponentId:n})})).then((function(){e.$emit("hidden")})).finally((function(){e.loading=!1}))}})},Yi=Zi,Xi=Object(j["a"])(Yi,Ui,zi,!1,null,null,null),Qi=Xi.exports,eo=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-filter-panel"},[n("div",{staticClass:"gis-filter-panel__toolbar"},[n("div",{staticClass:"gis-filter-panel__name"},[e._v("\n      "+e._s("Фильтр "+e.name)+"\n    ")]),n("div",{staticClass:"gis-filter-panel__button-panel"},[n("div",{staticClass:"gis-filter-panel__button",attrs:{title:"Закрыть"},on:{click:e.closeButtonClick}},[n("i",{staticClass:"core core-057-close"})])])]),e._t("default")],2)},to=[],no={name:"GisFilterPanel",props:{name:String},methods:{closeButtonClick:function(){this.$emit("closeButtonClick")}}},io=no,oo=(n("e5cd"),Object(j["a"])(io,eo,to,!1,null,null,null)),ao=oo.exports,so=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-custom-table-panel",class:{"gis-custom-table-panel_expanded":!e.collapsed}},[n("div",{staticClass:"gis-custom-table-panel__header"},[e._m(0),n("div",{staticClass:"gis-custom-table-panel__title"},[e._v("\n      "+e._s("Таблица: "+e.layerName)+"\n    ")]),n("div",{staticClass:"gis-custom-table-panel__toolbar-wrapper"},[e.totalCount&&null!==e.filteredCount?n("div",{staticClass:"gis-custom-table-panel__count"},[e.loadCount?e._e():n("span",[e._v(e._s(e.filteredCount.toLocaleString()))]),n("DxLoadIndicator",{staticClass:"gis-custom-table-panel__loading",attrs:{visible:e.loadCount}}),n("span",{staticClass:"gis-custom-table-panel__total-count"},[e._v("из "+e._s(e.totalCount.toLocaleString()))])],1):e._e(),n("div",{staticClass:"gis-custom-table-panel__header-toolbar"},[n("div",{staticClass:"gis-custom-table-panel__toolbar-group"},[n("GisFilterPanelButton",{attrs:{title:e.collapsed?"Развернуть панель":"Свернуть панель",iconCss:e.collapsedIcon},on:{click:function(t){e.collapsed=!e.collapsed}}}),n("GisFilterPanelButton",{attrs:{title:"Закрыть",iconCss:"core core-057-close"},on:{click:e.closeButtonClick}})],1)])])]),e.collapsed?e._e():n("div",{staticClass:"gis-custom-table-panel__content"},[e.contentLoading?n("DxLoadPanel",{attrs:{visible:!0}}):e._e(),e._l(e.contentItems,(function(e,t){return n("ContainerItem",{key:t,attrs:{cssStyle:e.cssStyle,componentId:e.componentId,componentType:e.componentType}})}))],2)])},ro=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-custom-table-panel__icon"},[n("i",{staticClass:"fas fa-table"})])}],lo=n("7a47"),co=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-filter-panel-button",attrs:{title:e.title},on:{click:function(t){return e.$emit("click")}}},[n("i",{class:e.iconCss})])},uo=[],po={name:"GisFilterPanelButton",props:{title:String,iconCss:[String,Object]}},fo=po,ho=(n("d661"),Object(j["a"])(fo,co,uo,!1,null,null,null)),mo=ho.exports,go=n("b1a2");function yo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function vo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yo(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var bo={name:"GisCustomTablePanel",components:{GisFilterPanelButton:mo,DxLoadIndicator:f.a,DxLoadPanel:_e.a,ContainerItem:r["a"]},props:{layerComponentId:String,popupContainer:null},data:function(){return{selectedTabIndex:0,collapsed:!1,filteredCount:null,totalCount:null,loadCount:!1,loadedFields:{},contentLoading:!1}},computed:vo(vo({},Object(u["c"])("config",{getLayerOptions:pe["E"],getTableComponentId:pe["K"]})),{},{layerOptions:function(){return this.getLayerOptions(this.layerComponentId)},tableComponentId:function(){return this.getTableComponentId(this.layerComponentId)},tableComponentOptions:function(){return this.getLayerOptions(this.tableComponentId)},items:function(){var e=this;return(this.tableComponentOptions.items||[]).map((function(t){return e.$store.getters["config/getItem"](t)})).filter((function(e){return e})).sort((function(e,t){return(e.componentPos||0)-(t.componentPos||0)}))},visibleItems:function(){var e=this;return this.items.filter((function(t){var n=t&&(e.$store.getters["config/getItem"](t.parentFormId)||{}).options||{},i=n.isNew&&(t||{}).hideWhenCreate;return t&&!i&&!go["i"].includes(t.componentType)}))},contentItems:function(){return this.visibleItems.filter((function(e){return!e.toolbar}))},parentGisId:function(){return this.layerOptions.parentGisId},layerName:function(){return this.layerOptions.text},collapsedIcon:function(){return{core:!0,"core-116-arrow-down":this.collapsed,"core-114-arrow-top":!this.collapsed}}}),watch:{layerComponentId:{handler:function(){var e=this;this.callTablePopupFormReadyEventAction({layerComponentId:this.layerComponentId}).then((function(){e.callFilterValueChangedEventAction({layerComponentId:e.layerComponentId})}))},immediate:!0}},methods:vo(vo(vo({},Object(u["d"])("config",{setTablePanelLayerComponentId:lo["K"]})),Object(u["b"])("config",{gisLayerLoadDataCount:ce["q"],gisLayerLoadTotalDataCount:ce["y"],loadDataFields:ce["r"],loadFilterPanelTabOptions:le["h"],callFilterValueChangedEventAction:ce["c"],callTablePopupFormReadyEventAction:ce["d"]})),{},{closeButtonClick:function(){this.setTablePanelLayerComponentId({gisComponentId:this.parentGisId,layerComponentId:null})},loadDataCount:function(){var e=this;return this.loadCount=!0,this.gisLayerLoadDataCount({layerComponentId:this.layerComponentId}).then((function(t){e.filteredCount=t})).finally((function(){e.loadCount=!1}))},loadTotalDataCount:function(){var e=this;this.gisLayerLoadTotalDataCount({layerComponentId:this.layerComponentId}).then((function(t){e.totalCount=t}))}})},_o=bo,Co=(n("b88a"),Object(j["a"])(_o,so,ro,!1,null,null,null)),xo=Co.exports,Oo=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.cssClass},[n("div",{staticClass:"gis-custom-filter-panel__wrapper"},[n("div",{staticClass:"gis-custom-filter-panel__header"},[e._m(0),n("div",{staticClass:"gis-custom-filter-panel__title"},[e._v("\n        "+e._s("Слой: "+e.layerName)+"\n      ")]),n("div",{class:e.tagsListClass},e._l(e.tags,(function(t,i){return n("GisCustomFilterTag",{key:i,staticClass:"gis-custom-filter-panel__tag",attrs:{name:t.name,label:t.label,layerComponentId:t.layerComponentId,caption:t.caption,icon:t.icon},on:{delete:function(n){return e.filterFieldValueChanged({layerComponentId:t.layerComponentId,fieldName:t.name,filterValue:null})},click:e.handleTagClick}})})),1),n("div",{staticClass:"gis-custom-filter-panel__toolbar-wrapper"},[e.tags.length?n("GisFilterPanelButton",{attrs:{title:e.tagListExpanded?"Свернуть список тегов":"Развернуть список тегов",iconCss:"fa fa-ellipsis-h"},on:{click:function(t){e.tagListExpanded=!e.tagListExpanded}}}):e._e(),null!==e.totalCount?n("div",{staticClass:"gis-custom-filter-panel__count"},[e.loading?e._e():n("span",[e._v(e._s(e.filteredCount.toLocaleString()))]),n("DxLoadIndicator",{staticClass:"gis-custom-filter-panel__loading",attrs:{visible:e.loading}}),n("span",{staticClass:"gis-custom-filter-panel__total-count"},[e._v("из "+e._s(e.totalCount.toLocaleString()))])],1):e._e(),n("DxTextBox",{staticClass:"gis-custom-filter-panel__search-text-box",attrs:{value:e.tabSearchValue,width:160,placeholder:"Поиск...",showClearButton:!0,valueChangeEvent:"input"},on:{valueChanged:e.tabSearchTextBoxValueChanged}}),n("div",{staticClass:"gis-custom-filter-panel__header-toolbar"},[n("div",{staticClass:"gis-custom-filter-panel__toolbar-group"},[e.isTableButtonVisible(e.layerComponentId)?n("GisFilterPanelButton",{attrs:{title:"Таблица слоя",iconCss:"fas fa-table"},on:{click:e.handleLayerTable}}):e._e()],1),n("div",{staticClass:"gis-custom-filter-panel__toolbar-group"},[n("DxButton",{attrs:{text:"Применить",type:"success"},on:{click:e.applyFilter}}),n("DxButton",{staticClass:"gis-custom-filter-panel__clear-filter-button",attrs:{text:"Очистить",hint:"Очистить фильтр"},on:{click:e.onFilterClear}}),n("GisFilterPanelButton",{attrs:{title:"Сохранить фильтр",iconCss:"core core-016-save"},on:{click:function(t){e.saveFilterPanelVisible=!0}}}),n("GisFilterPanelButton",{attrs:{title:"Выбрать фильтр из списка",iconCss:"core core-189_list"},on:{click:function(t){e.filterListPopupVisible=!0}}})],1),n("div",{staticClass:"gis-custom-filter-panel__toolbar-group"},[n("GisFilterPanelButton",{attrs:{title:e.collapsed?"Развернуть панель":"Свернуть панель",iconCss:e.collapsedIcon},on:{click:function(t){e.collapsed=!e.collapsed}}}),n("GisFilterPanelButton",{attrs:{title:"Закрыть",iconCss:"core core-057-close"},on:{click:e.closeButtonClick}})],1)])],1)]),n("div",{staticClass:"gis-custom-filter-panel__content"},[n("GisCustomFilterPanelTabs",{ref:"tabs",staticClass:"gis-custom-filter-panel__tabs",attrs:{tabOptions:e.tabOptions,selectedTabLayerComponentId:e.selectedTabLayerComponentId},on:{tabClick:e.handleTabClick}}),e.layerComponentId&&!e.fieldsLoading?n("DxScrollView",{staticClass:"gis-custom-filter-panel__scroll-view"},[n("div",{staticClass:"gis-custom-filter-panel__fields-list"},[e.layerComponentId!==e.selectedTabLayerComponentId?[n("GisFilterSwitchField",{staticClass:"gis-custom-filter-panel__field-item",attrs:{value:e.filterFieldValues.on},on:{valueChanged:e.layerFilterOnChange}}),n("GisFilterIntersectField",{staticClass:"gis-custom-filter-panel__field-item",attrs:{value:e.filterFieldValues.selectMode},on:{valueChanged:e.layerFilterIntersectChange}}),n("GisFilterBufferSizeField",{staticClass:"gis-custom-filter-panel__field-item",attrs:{value:e.filterFieldValues.bufferSize},on:{valueChanged:e.layerFilterBufferSizeChange}})]:e._e(),e._l(e.filterFieldOptions,(function(t){return n("GisCustomFilterField",{key:t.name,ref:t.name+"_field",refInFor:!0,staticClass:"gis-custom-filter-panel__field-item",attrs:{fieldOptions:t,fieldValue:e.filterFieldValues.fieldValues[t.name],popupContainer:e.popupContainer},on:{valueChanged:function(t){return e.filterFieldValueChanged(Object.assign({},{layerComponentId:e.selectedTabLayerComponentId},t))},displayValueChanged:function(t){return e.filterDisplayValueChanged(Object.assign({},{layerComponentId:e.selectedTabLayerComponentId},t))}}})}))],2)]):e._e()],1)]),n("SaveFilterPanel",{attrs:{visible:e.saveFilterPanelVisible,layerName:e.layerName,popupContainer:e.popupContainer},on:{shown:function(t){e.saveFilterPanelVisible=!0},hidden:function(t){e.saveFilterPanelVisible=!1},saveFilter:e.onSaveFilter}}),n("GisFilterListPopup",{attrs:{title:"Выбор фильтра",visible:e.filterListPopupVisible,layerComponentId:e.layerComponentId,popupContainer:e.popupContainer},on:{shown:function(t){e.filterListPopupVisible=!0},hidden:function(t){e.filterListPopupVisible=!1},applyClick:e.filterListApplyClick}})],1)},Io=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-custom-filter-panel__icon"},[n("i",{staticClass:"fas fa-filter"})])}],So=(n("8615"),n("d6fe")),Lo=n("e3b7"),Do=n("81a7"),Po=n("057c"),Eo=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-custom-filter-field"},[n("div",{staticClass:"gis-custom-filter-field__label",attrs:{title:e.fieldOptions.caption}},[e._v("\n    "+e._s(e.fieldOptions.caption)+"\n  ")]),n(e.FILTER_FIELDS_TYPES_MAP[e.fieldOptions.type],e._b({ref:"field",tag:"component",attrs:{filterValue:e.fieldValue.value},on:{valueChanged:function(t){return e.$emit("valueChanged",t)},displayValueChanged:function(t){return e.$emit("displayValueChanged",t)}}},"component",Object.assign({},e.fieldOptions,e.fieldValue),!1))],1)},wo=[],To=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxTextBox",{ref:"fieldEditor",staticClass:"gis-filter-text-field",attrs:{value:e.value,placeholder:e.caption},on:{valueChanged:e.onValueChanged}})},jo=[],ko="contains",Fo={name:"GisFilterTextField",components:{DxTextBox:O.a},props:{name:String,caption:String,filterValue:Array},computed:{value:function(){return this.filterValue?this.filterValue[2]:null}},methods:{onValueChanged:function(e){var t=e.value;t!==this.value&&this.$emit("valueChanged",{fieldName:this.name,filterValue:t?[this.name,ko,t]:null})},focus:function(){this.$refs.fieldEditor.instance.focus()}}},Bo=Fo,Mo=(n("b96f"),Object(j["a"])(Bo,To,jo,!1,null,null,null)),Ao=Mo.exports,Ro=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-filter-number-field"},[n("DxNumberBox",{ref:"fromFieldEditor",staticClass:"gis-filter-number-field__field",attrs:{value:e.valueFrom,placeholder:"от"},on:{valueChanged:e.onFromValueChanged}}),n("DxNumberBox",{ref:"toFieldEditor",staticClass:"gis-filter-number-field__field",attrs:{value:e.valueTo,placeholder:"до"},on:{valueChanged:e.onToValueChanged}})],1)},Vo=[],Go=">=",$o="<=",No={props:{name:String,filterValue:Array},computed:{valueFrom:function(){return Uo(this.filterValue,Go)},valueTo:function(){return Uo(this.filterValue,$o)}},methods:{onFromValueChanged:function(e){var t=e.value;t!==this.valueFrom&&this.$emit("valueChanged",{fieldName:this.name,filterValue:this.getFilterValue(t,this.valueTo)})},onToValueChanged:function(e){var t=e.value;t!==this.valueTo&&this.$emit("valueChanged",{fieldName:this.name,filterValue:this.getFilterValue(this.valueFrom,t)})},getFilterValue:function(e,t){var n=null,i=null;return(e||0===e)&&(n=[this.name,Go,e]),(t||0===t)&&(i=[this.name,$o,t]),n&&i?[n,i]:n||i},focus:function(){null===this.valueTo||null!==this.valueFrom?this.$refs.fromFieldEditor.instance.focus():this.$refs.toFieldEditor.instance.focus()}}};function Uo(e,t){var n=e;return n?(2===n.length&&(n=n.find((function(e){return e.includes(t)}))),n&&n.includes(t)?n[2]:null):null}var zo={name:"GisFilterNumberField",mixins:[No],components:{DxNumberBox:Pe.a}},Ho=zo,Wo=(n("5846"),Object(j["a"])(Ho,Ro,Vo,!1,null,null,null)),Ko=Wo.exports,qo=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-filter-date-field"},[n("DxDateBox",{ref:"fromFieldEditor",staticClass:"gis-filter-date-field__field",attrs:{value:e.valueFrom,dateSerializationFormat:"yyyy-MM-dd",placeholder:"c"},on:{valueChanged:e.onFromValueChanged,opened:e.selectBoxOpened}}),n("DxDateBox",{ref:"toFieldEditor",staticClass:"gis-filter-date-field__field",attrs:{value:e.valueTo,dateSerializationFormat:"yyyy-MM-dd",placeholder:"по"},on:{valueChanged:e.onToValueChanged,opened:e.selectBoxOpened}})],1)},Jo=[],Zo=n("e96d"),Yo=n.n(Zo),Xo={name:"GisFilterDateField",mixins:[No,di["a"]],components:{DxDateBox:Yo.a}},Qo=Xo,ea=(n("a690"),Object(j["a"])(Qo,qo,Jo,!1,null,null,null)),ta=ea.exports,na=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxSelectBox",{ref:"fieldEditor",staticClass:"gis-filter-boolean-field",attrs:{value:e.value,dataSource:e.dataSource,valueExpr:"value",displayExpr:"name",showClearButton:!0,placeholder:e.caption},on:{valueChanged:e.onValueChanged,opened:e.selectBoxOpened}})},ia=[],oa="=",aa={name:"GisFilterBooleanField",mixins:[di["a"]],components:{DxSelectBox:rt.a},props:{name:String,caption:String,filterValue:Array,popupContainer:null},data:function(){return{dataSource:[{name:"Да",value:!0},{name:"Нет",value:!1}]}},computed:{value:function(){return null===this.filterValue?null:this.filterValue[2]}},methods:{onValueChanged:function(e){var t=e.value;t!==this.value&&this.$emit("valueChanged",{fieldName:this.name,filterValue:null!==t?[this.name,oa,t]:null})},focus:function(){this.$refs.fieldEditor.instance.focus()}}},sa=aa,ra=(n("beda"),Object(j["a"])(sa,na,ia,!1,null,null,null)),la=ra.exports,ca=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxLookup",{ref:"fieldEditor",staticClass:"gis-filter-dictionary-field",attrs:{dataSource:e.dataSource,valueExpr:"key",displayExpr:"name",value:e.value,placeholder:e.caption,width:"100%",showClearButton:!0},on:{valueChanged:e.onItemClick,opened:e.selectBoxOpened},scopedSlots:e._u([{key:"itemTemplate",fn:function(t){var i=t.data;return[n("span",{attrs:{title:i.name}},[e._v(e._s(i.name))])]}}])})},da=[],ua="=",pa={name:"GisFilterDictionaryField",mixins:[di["a"]],components:{DxLookup:Fe.a},props:{name:String,caption:String,filterValue:Array,dataSet:String,joinFieldName:String,joinFieldKey:String},data:function(){var e=this;return{dataSource:new tt["a"]({key:"key",loadMode:"processed",load:function(t){if(t.take&&void 0!==t.skip){var n={_config_dataset:e.dataSet,_config_serverside:!0,limit:t.take,offset:t.skip,orderby:{selector:e.joinFieldName,desc:!1},mode:"paging"};return t.searchValue&&(n.where=[e.joinFieldName,t.searchOperation,t.searchValue]),Object(he["c"])("getData",n).then((function(t){return t.data.map((function(t){return{name:t[e.joinFieldName],key:t[e.joinFieldKey]}}))}))}},byKey:function(t){var n=Object(s["a"])({_config_dataset:e.dataSet},e.joinFieldKey,t);return Object(he["c"])("getData",n).then((function(t){return e.$emit("displayValueChanged",{fieldName:e.name,displayValue:t[0][e.joinFieldName]}),{name:t[0][e.joinFieldName],key:t[0][e.joinFieldKey]}}))}})}},computed:{value:function(){return this.filterValue?this.filterValue[2]:null}},methods:{onItemClick:function(e){var t=e.value,n=e.component,i=n.instance().option("selectedItem"),o=null;i&&(o=i.name),this.$emit("displayValueChanged",{fieldName:this.name,displayValue:o}),t!==this.value&&this.$emit("valueChanged",{fieldName:this.name,filterValue:null!==t?[this.name,ua,t]:null})},focus:function(){this.$refs.fieldEditor.instance.focus()}}},fa=pa,ha=(n("e5aa"),Object(j["a"])(fa,ca,da,!1,null,null,null)),ma=ha.exports,ga={text:"GisFilterTextField","varchar(256)":"GisFilterTextField",bigint:"GisFilterNumberField",integer:"GisFilterNumberField",numeric:"GisFilterNumberField","double precision":"GisFilterNumberField","timestamp without time zone":"GisFilterDateField",timestamp:"GisFilterDateField",boolean:"GisFilterBooleanField",dictionary:"GisFilterDictionaryField",_config_select_mode:"GisFilterIntersectField",_config_buffer_size:"GisFilterBufferSizeField"},ya={name:"GisCustomFilterField",props:{fieldOptions:Object,fieldValue:Object},components:{GisFilterTextField:Ao,GisFilterNumberField:Ko,GisFilterDateField:ta,GisFilterBooleanField:la,GisFilterDictionaryField:ma},data:function(){return{FILTER_FIELDS_TYPES_MAP:ga}},methods:{setFocus:function(){this.$refs.field.focus()}}},va=ya,ba=(n("38b2"),Object(j["a"])(va,Eo,wo,!1,null,null,null)),_a=ba.exports,Ca=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-custom-filter-tag",attrs:{title:e.caption},on:{click:function(t){return e.$emit("click",{fieldName:e.name,layerComponentId:e.layerComponentId})}}},[n("i",{staticClass:"gis-custom-filter-tag__layer-icon core",class:e.icon}),n("span",{staticClass:"gis-custom-filter-tag__label"},[e._v(e._s(e.label))]),n("span",{staticClass:"gis-custom-filter-tag__icon",on:{click:function(t){return e.$emit("delete",{fieldName:e.name,layerComponentId:e.layerComponentId})}}},[n("i",{staticClass:"fa fa-times"})])])},xa=[],Oa={name:"GisCustomFilterTag",props:{label:String,name:String,caption:String,layerComponentId:String,icon:String}},Ia=Oa,Sa=(n("5443"),Object(j["a"])(Ia,Ca,xa,!1,null,null,null)),La=Sa.exports,Da=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-custom-filter-panel-tabs"},[e.prevButtonVisible?n("div",{staticClass:"gis-custom-filter-panel-tabs__nav-button",on:{click:e.prevButtonClick}},[n("i",{staticClass:"core core-115-arrow-left"})]):e._e(),n("DxScrollView",{ref:"scrollView",staticClass:"gis-custom-filter-panel-tabs__scroll",attrs:{direction:"horizontal",showScrollbar:"never",scrollByThumb:!1},on:{scroll:e.onScroll}},[n("div",{ref:"scrollContent",staticClass:"gis-custom-filter-panel-tabs__scroll-content"},[e._l(e.tabOptions,(function(t,i){return n("div",{staticClass:"gis-custom-filter-panel-tabs__tab",class:{"gis-custom-filter-panel-tabs__tab_selected":t.layerComponentId===e.selectedTabLayerComponentId},on:{click:function(n){return n.stopPropagation(),e.$emit("tabClick",t)}}},[e._v("\n        "+e._s(t.caption)+"\n      ")])})),n("div",{staticClass:"gis-custom-filter-panel-tabs__empty-space"})],2)]),e.nextButtonVisible?n("div",{staticClass:"gis-custom-filter-panel-tabs__nav-button",on:{click:e.nextButtonClick}},[n("i",{staticClass:"core core-117-arrow-right"})]):e._e()],1)},Pa=[],Ea=150,wa={name:"GisCustomFilterPanelTabs",components:{DxScrollView:b.a},props:{tabOptions:Array,selectedTabLayerComponentId:null},data:function(){return{prevButtonVisible:!1,nextButtonVisible:!0,scrollOffsetLeft:0}},watch:{names:function(){var e=this;this.$refs.scrollView&&this.$nextTick((function(){e.$refs.scrollView.instance.update(),e.prevButtonVisible=!1,e.nextButtonVisible=e.$refs.scrollContent.offsetWidth>e.$refs.scrollView.instance.clientWidth()}))}},methods:{prevButtonClick:function(){this.$refs.scrollView.instance.scrollBy(-Ea)},nextButtonClick:function(){this.$refs.scrollView.instance.scrollBy(Ea)},onScroll:function(e){var t=e.reachedLeft,n=e.reachedRight,i=e.scrollOffset;this.prevButtonVisible=!t,this.scrollOffsetLeft!==Math.floor(i.left)&&(this.nextButtonVisible=!n,this.scrollOffsetLeft=Math.floor(i.left))},scrollToSelected:function(){var e=this,t=this.$el.querySelector(".gis-custom-filter-panel-tabs__tab_selected");t&&(this.$refs.scrollView.instance.scrollToElement(t),this.$nextTick((function(){e.$refs.scrollView.instance.scrollToElement(t)})))}}},Ta=wa,ja=(n("37de"),Object(j["a"])(Ta,Da,Pa,!1,null,null,null)),ka=ja.exports,Fa=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-filter-switch-field"},[n("div",{staticClass:"gis-filter-switch-field__label"},[e._v("\n     \n  ")]),n("DxSwitch",{attrs:{width:"100%",height:"26px",switchedOffText:"Не используется",switchedOnText:"Используется",activeStateEnabled:!1,focusStateEnabled:!1,value:e.value},on:{valueChanged:function(t){return e.$emit("valueChanged",t.value)}}})],1)},Ba=[],Ma=n("9953"),Aa=n.n(Ma),Ra={name:"GisFilterSwitchField",components:{DxSwitch:Aa.a},props:{value:Boolean}},Va=Ra,Ga=(n("bcab"),Object(j["a"])(Va,Fa,Ba,!1,null,null,null)),$a=Ga.exports,Na=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-filter-intersect-field"},[n("div",{staticClass:"gis-filter-intersect-field__label"},[e._v("\n    Пересечение\n  ")]),n("DxSelectBox",{ref:"fieldEditor",staticClass:"gis-filter-intersect-field",attrs:{dataSource:e.dataSource,valueExpr:"value",displayExpr:"caption",placeholder:"Пересечение",width:"100%",value:e.value},on:{valueChanged:function(t){return e.$emit("valueChanged",t.value)},opened:e.selectBoxOpened}})],1)},Ua=[],za={name:"GisFilterIntersectField",mixins:[di["a"]],components:{DxSelectBox:rt.a},props:{value:null},data:function(){return{dataSource:[{caption:"Пересечение",value:"intersect"},{caption:"Включение",value:"contains"}]}},methods:{focus:function(){this.$refs.fieldEditor.instance.focus()}}},Ha=za,Wa=(n("44d3"),Object(j["a"])(Ha,Na,Ua,!1,null,null,null)),Ka=Wa.exports,qa=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-filter-buffer-size-field"},[n("div",{staticClass:"gis-filter-buffer-size-field__label"},[e._v("\n    Буферная зона, м\n  ")]),n("DxNumberBox",{ref:"fieldEditor",attrs:{placeholder:"Буферная зона, м",value:e.value},on:{valueChanged:function(t){return e.$emit("valueChanged",t.value)}}})],1)},Ja=[],Za={name:"GisFilterBufferSizeField",components:{DxNumberBox:Pe.a},props:{value:null},methods:{focus:function(){this.$refs.fieldEditor.instance.focus()}}},Ya=Za,Xa=(n("1091"),Object(j["a"])(Ya,qa,Ja,!1,null,null,null)),Qa=Xa.exports;function es(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ts(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?es(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):es(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ns="gis-custom-filter-panel",is={name:"GisCustomFilterPanel",components:{GisCustomFilterField:_a,GisFilterPanelButton:mo,GisFilterListPopup:Do["a"],SaveFilterPanel:Po["a"],GisCustomFilterTag:La,DxScrollView:b.a,DxLoadIndicator:f.a,GisCustomFilterPanelTabs:ka,DxButton:ve.a,DxTextBox:O.a,GisFilterSwitchField:$a,GisFilterIntersectField:Ka,GisFilterBufferSizeField:Qa},props:{layerComponentId:String,popupContainer:null},data:function(){return{selectedTabLayerComponentId:null,tabSearchValue:"",collapsed:!1,filteredCount:null,totalCount:null,loading:!1,filterListPopupVisible:!1,saveFilterPanelVisible:!1,tagListExpanded:!0,filterFieldOptions:{},filterFieldValues:{},fieldsLoading:!1}},computed:ts(ts({},Object(u["c"])("config",{getLayerOptions:pe["E"],getFilterPanelTabOptions:Lo["o"],getFilterFieldOptions:pe["q"],isTableButtonVisible:pe["hb"]})),{},{tags:function(){var e=this,t=[];return this.layerOptions.filterFieldValues?(Object.entries(this.layerOptions.filterFieldValues).forEach((function(n){var i=Object(re["a"])(n,2),o=i[0],a=i[1];if(a){var s=e.getLayerOptions(o),r=s.text;Object.values(a.fieldValues).forEach((function(e){e.label&&t.push({name:e.name,label:e.label,layerComponentId:o,caption:"".concat(r,": ").concat(e.caption," ").concat(e.label),icon:null})})),a.on&&t.push({name:"on",label:"".concat(r),layerComponentId:o,caption:"".concat(r,": ").concat("intersect"===a.selectMode?"Пересечение":"contains"===a.selectMode?"Включение":"intersect_contains"===a.selectMode?"Не определено":""),icon:"core-layer-icon"})}})),t):t},layerOptions:function(){return this.getLayerOptions(this.layerComponentId)},parentGisId:function(){return this.layerOptions.parentGisId},layerName:function(){return this.layerOptions.text},cssClass:function(){var e;return e={},Object(s["a"])(e,ns,!0),Object(s["a"])(e,"".concat(ns,"_collapsed"),this.collapsed),e},collapsedIcon:function(){return{core:!0,"core-116-arrow-down":this.collapsed,"core-114-arrow-top":!this.collapsed}},tagsListClass:function(){return{"gis-custom-filter-panel__tags-list":!0,"gis-custom-filter-panel__tags-list_collapsed":!this.tagListExpanded}},tabOptions:function(){return this.getFilterPanelTabOptions(this.parentGisId,this.tabSearchValue)}}),watch:{layerComponentId:{handler:function(){var e=this;this.loadTotalDataCount(),this.loadDataCount(),this.tabSearchValue="",this.loadFilterPanelTabOptions({gisComponentId:this.parentGisId}).then((function(){e.selectedTabLayerComponentId=e.layerComponentId}))},immediate:!0},selectedTabLayerComponentId:function(){var e=this;if(!this.selectedTabLayerComponentId)return this.filterFieldOptions={},void(this.filterFieldValues={});this.fieldsLoading=!0,this.loadFilterFieldOptions({layerComponentId:this.selectedTabLayerComponentId,gisComponentId:this.parentGisId}).then((function(t){e.initFilterFieldValues({layerComponentId:e.layerComponentId,filterLayerComponentId:e.selectedTabLayerComponentId}),e.filterFieldOptions=t,e.filterFieldValues=e.layerOptions.filterFieldValues[e.selectedTabLayerComponentId]})).catch((function(){})).finally((function(){e.fieldsLoading=!1}))}},methods:ts(ts(ts({},Object(u["d"])("config",{setFilterPanelLayerComponentId:lo["m"],setTablePanelLayerComponentId:lo["K"],initFilterFieldValues:So["i"],setFilterFieldValue:So["z"],setFilterFieldDisplayValue:So["y"],clearFilterFieldValues:So["e"],setFilterFieldValues:So["A"],setFilterFieldValueOption:So["B"]})),Object(u["b"])("config",{gisLayerLoadDataCount:ce["q"],gisLayerLoadTotalDataCount:ce["y"],loadFilterFieldOptions:ce["u"],saveFilter:ce["E"],loadFilterPanelTabOptions:le["h"],gisLayerApplyFilter:ce["a"],callFilterValueChangedEventAction:ce["c"]})),{},{closeButtonClick:function(){this.setFilterPanelLayerComponentId({gisComponentId:this.parentGisId,layerComponentId:null})},loadDataCount:function(){var e=this;return this.loading=!0,this.gisLayerLoadDataCount({layerComponentId:this.layerComponentId}).then((function(t){e.filteredCount=null===t?0:t})).finally((function(){e.loading=!1}))},loadTotalDataCount:function(){var e=this;this.gisLayerLoadTotalDataCount({layerComponentId:this.layerComponentId}).then((function(t){e.totalCount=t}))},filterFieldValueChanged:function(e){var t=e.layerComponentId,n=e.fieldName,i=e.filterValue;this.setFilterFieldValue({layerComponentId:this.layerComponentId,filterLayerComponentId:t,fieldName:n,value:i}),"on"===n&&(this.setFilterFieldValueOption({layerComponentId:this.layerComponentId,filterLayerComponentId:this.selectedTabLayerComponentId,fieldName:"on",value:!1}),this.setFilterFieldValueOption({layerComponentId:this.layerComponentId,filterLayerComponentId:this.selectedTabLayerComponentId,fieldName:"selectMode",value:"intersect_contains"}))},filterDisplayValueChanged:function(e){var t=e.layerComponentId,n=e.fieldName,i=e.displayValue;this.setFilterFieldDisplayValue({layerComponentId:this.layerComponentId,filterLayerComponentId:t,fieldName:n,displayValue:i})},handleTagClick:function(e){var t=this,n=e.layerComponentId,i=e.fieldName;this.selectedTabLayerComponentId!==n&&this.tabOptions.find((function(e){return e.layerComponentId===n}))&&(this.selectedTabLayerComponentId=n,this.$nextTick((function(){t.$refs.tabs.scrollToSelected()}))),"on"!=i&&this.$nextTick((function(){t.$refs["".concat(i,"_field")][0].setFocus(i)}))},onFilterClear:function(){this.clearFilterFieldValues({layerComponentId:this.layerComponentId}),this.applyFilter()},onSaveFilter:function(e){var t=this;this.saveFilter({layerComponentId:this.layerComponentId,filterName:e}).then((function(){t.saveFilterPanelVisible=!1}))},filterListApplyClick:function(e){var t=JSON.parse(e.body.replace(/\\"/g,'"'));Array.isArray(t)||this.setFilterFieldValues({layerComponentId:this.layerComponentId,filterFieldValues:t}),this.filterListPopupVisible=!1,this.applyFilter()},applyFilter:function(){var e=this;this.loading=!0,this.filterFieldValues=this.layerOptions.filterFieldValues[this.selectedTabLayerComponentId],this.gisLayerApplyFilter({layerComponentId:this.layerComponentId}).catch((function(){})).then((function(){return e.loadDataCount()})).then((function(){e.callFilterValueChangedEventAction({layerComponentId:e.layerComponentId})})).finally((function(){e.loading=!1}))},tabSearchTextBoxValueChanged:function(e){var t=this,n=e.value;this.searchTextBoxTimeoutId&&window.clearTimeout(this.searchTextBoxTimeoutId),this.searchTextBoxTimeoutId=setTimeout((function(){t.tabSearchValue=n,t.tabOptions.length>0?t.selectedTabLayerComponentId=t.tabOptions[0].layerComponentId:t.selectedTabLayerComponentId=null}),1e3)},handleLayerTable:function(){this.setTablePanelLayerComponentId({gisComponentId:this.parentGisId,layerComponentId:this.layerComponentId})},handleTabClick:function(e){if(!e)return this.filterFieldOptions={},void(this.filterFieldValues={});this.selectedTabLayerComponentId=e.layerComponentId},layerFilterOnChange:function(e){this.setFilterFieldValueOption({layerComponentId:this.layerComponentId,filterLayerComponentId:this.selectedTabLayerComponentId,fieldName:"on",value:e})},layerFilterIntersectChange:function(e){this.setFilterFieldValueOption({layerComponentId:this.layerComponentId,filterLayerComponentId:this.selectedTabLayerComponentId,fieldName:"selectMode",value:e})},layerFilterBufferSizeChange:function(e){this.setFilterFieldValueOption({layerComponentId:this.layerComponentId,filterLayerComponentId:this.selectedTabLayerComponentId,fieldName:"bufferSize",value:e})}})},os=is,as=(n("f2eb"),Object(j["a"])(os,Oo,Io,!1,null,null,null)),ss=as.exports,rs=n("104d"),ls=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-timiline-slider"},[n("DxButton",{staticClass:"gis-timiline-slider__year-month-button",attrs:{text:e.buttonText},on:{click:e.yearMonthButtonClick}}),n("div",{staticClass:"gis-timiline-slider__timeline"},[n("div",{staticClass:"gis-timiline-slider__slider"},[n("DxSlider",{attrs:{min:e.sliderMin,max:e.sliderMax,value:e.sliderValue,step:e.$options.SLIDER_STEP},on:{valueChanged:e.sliderValueChanged}},[n("DxTooltip",{attrs:{enabled:!0,showMode:"always",format:e.sliderTooltipFormat}})],1)],1),n("GisTimelineChart",{staticClass:"gis-timiline-slider__timeline-chart",attrs:{month:e.selectedMonth,year:e.selectedYear}})],1),n("DxPopover",{ref:"popover"},[n("DxCalendar",{attrs:{minZoomLevel:"year",zoomLevel:"year",maxZoomLevel:"year"},on:{valueChanged:e.calendarValueChanged}})],1)],1)},cs=[],ds=n("a013"),us=n.n(ds),ps=n("86e0"),fs=n.n(ps),hs=n("8473"),ms=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxChart",{attrs:{dataSource:e.chartData,resolveLabelOverlapping:"none"}},[n("DxLegend",{attrs:{visible:!1}}),n("DxCommonAxisSettings",{attrs:{visible:!1}},[n("DxTick",{attrs:{visible:!1}}),n("DxMinorTick",{attrs:{visible:!1}}),n("DxGrid",{attrs:{visible:!1}})],1),n("DxValueAxis",{attrs:{visible:!1}},[n("DxTick",{attrs:{visible:!1}}),n("DxMinorTick",{attrs:{visible:!1}}),n("DxGrid",{attrs:{visible:!1}}),n("DxLabel",{attrs:{visible:!1}})],1),n("DxCommonSeriesSettings",{attrs:{type:"line",argumentField:"key",valueField:"value",hoverMode:"onlyPoint"}}),n("DxSeries",{attrs:{color:"transparent"}},[n("DxLabel",{attrs:{visible:!0,customizeText:e.labelText,backgroundColor:"transparent"}},[n("DxFont",{attrs:{color:"#072833",weight:600}})],1),n("DxPoint",{attrs:{size:16,visible:!1}})],1),n("DxArgumentAxis",{attrs:{argumentType:"datetime"}})],1)},gs=[],ys=n("5660"),vs={name:"GisTimeline",components:{DxLegend:ys["DxLegend"],DxChart:ys["DxChart"],DxCommonAxisSettings:ys["DxCommonAxisSettings"],DxTick:ys["DxTick"],DxMinorTick:ys["DxMinorTick"],DxGrid:ys["DxGrid"],DxCommonSeriesSettings:ys["DxCommonSeriesSettings"],DxArgumentAxis:ys["DxArgumentAxis"],DxValueAxis:ys["DxValueAxis"],DxSeries:ys["DxSeries"],DxLabel:ys["DxLabel"],DxFont:ys["DxFont"],DxPoint:ys["DxPoint"]},props:{year:Number,month:Number},computed:{chartData:function(){for(var e=[],t=Object(hs["b"])(this.year,this.month),n=1;n<=t;++n)e.push({key:new Date(this.year,this.month-1,n).toString(),value:0});return e}},methods:{labelText:function(e){var t=e.argument,n=t.getDate();return n}}},bs=vs,_s=Object(j["a"])(bs,ms,gs,!1,null,null,null),Cs=_s.exports;function xs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Os(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xs(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Is={name:"GisTimilineSlider",SLIDER_STEP:864e5,components:{DxButton:ve.a,DxPopover:m.a,DxCalendar:fs.a,DxSlider:us.a,DxTooltip:ds["DxTooltip"],GisTimelineChart:Cs},props:{gisComponentId:String},computed:Os(Os({},Object(u["c"])("config",{gisGetSelectedDate:Lo["C"]})),{},{selectedDate:function(){return this.gisGetSelectedDate(this.gisComponentId)||new Date},selectedMonth:function(){return this.selectedDate.getMonth()},sliderValue:function(){return this.selectedDate.getTime()},selectedYear:function(){return this.selectedDate.getFullYear()},sliderMin:function(){return new Date(this.selectedYear,this.selectedMonth,1).getTime()},sliderMax:function(){return new Date(this.selectedYear,this.selectedMonth,Object(hs["b"])(this.selectedYear,this.selectedMonth)).getTime()},buttonText:function(){return"".concat(hs["a"][this.selectedMonth]," ").concat(this.selectedYear)}}),mounted:function(){this.changeValue(this.selectedDate)},methods:Os(Os({},Object(u["d"])("config",{gisSetSelectedDate:lo["F"]})),{},{sliderValueChanged:function(e){var t=this;this.timeout&&window.clearTimeout(this.timeout),this.timeout=window.setTimeout((function(){t.changeValue(new Date(e.value)),t.timeout=null}),300)},sliderTooltipFormat:function(e){var t=new Date(e),n=t.getDate(),i=t.getMonth()+1;return"".concat(n<10?"0".concat(n):n,".").concat(i<10?"0".concat(i):i)},yearMonthButtonClick:function(e){var t=e.element;this.$refs.popover.instance.show(t)},calendarValueChanged:function(e){var t=e.value;this.$refs.popover&&this.$refs.popover.instance.hide(),this.changeValue(t)},changeValue:function(e){this.setGisSelectedValue(e),this.gisSetSelectedDate({gisComponentId:this.gisComponentId,selectedDate:e})},setGisSelectedValue:function(e){this.$store.dispatch("config/setItemFields",{componentId:this.gisComponentId,fields:[{name:"selectedData.timelineValue",value:Object(hs["c"])(e)}]})}})},Ss=Is,Ls=(n("fc1a"),Object(j["a"])(Ss,ls,cs,!1,null,null,null)),Ds=Ls.exports,Ps=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-overlay-container"},e._l(e.items,(function(e,t){return n("ContainerItem",{key:t,staticClass:"gis-overlay-container__item",attrs:{componentId:e.componentId,componentType:e.componentType,cssStyle:e.cssStyle}})})),1)},Es=[];function ws(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ts(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ws(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ws(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var js={name:"GisOverlayContainer",props:{itemsConfigs:Array},components:{ContainerItem:r["a"]},computed:Ts(Ts({},Object(u["c"])("config",{getOptions:ue["c"]})),{},{items:function(){var e=this;return this.itemsConfigs.map((function(t){var n=e.getOptions(t.componentId);return Ts(Ts({},t),{},{cssStyle:Ts(Ts({display:!1===n.visible?"none":"block",position:"absolute"},e.getOverlayItemPosition(n)),t.cssStyle||{})})}))}}),methods:{getOverlayItemPosition:function(e){var t=e.position||{},n={};return Object.entries(t).forEach((function(e){var t=Object(re["a"])(e,2),i=t[0],o=t[1];n[i]="number"!==typeof o?o:"".concat(o,"px")})),n}}},ks=js,Fs=(n("8167"),Object(j["a"])(ks,Ps,Es,!1,null,null,null)),Bs=Fs.exports,Ms=(n("ac4d"),n("8a81"),n("5df3"),n("1c4c"),n("15fd")),As=n("d4ec"),Rs=n("bee2"),Vs=n("595b"),Gs=n("f2e7"),$s=n("8bf1"),Ns=n("dd50"),Us=n("5a3e");function zs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Hs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zs(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ws(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Ks(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function Ks(e,t){if(e){if("string"===typeof e)return qs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qs(e,t):void 0}}function qs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var Js=["match",["geometry-type"],["Polygon","MultiPolygon"],!0,!1],Zs=["match",["geometry-type"],["LineString","MultiLineString","Polygon","MultiPolygon"],!0,!1],Ys=["match",["geometry-type"],["Point","MultiPoint"],!0,!1],Xs=function(){function e(t){Object(As["a"])(this,e),Object(s["a"])(this,"id",null),Object(s["a"])(this,"pos",null),Object(s["a"])(this,"visible",!1),Object(s["a"])(this,"textVisible",!0),Object(s["a"])(this,"layerType",null),Object(s["a"])(this,"layerCaption",""),Object(s["a"])(this,"tileSourceId",null),Object(s["a"])(this,"geojsonSourceId",null),Object(s["a"])(this,"mapbox",null),Object(s["a"])(this,"geojsonSourceConfig",null),Object(s["a"])(this,"tileSourceConfig",null),Object(s["a"])(this,"mapboxLayerConfigs",[]),Object(s["a"])(this,"mapboxLayerSelectionConfigs",[]),Object(s["a"])(this,"tileEditLayerConfigs",[]),Object(s["a"])(this,"geojsonData",{type:"FeatureCollection",features:[]}),Object(s["a"])(this,"geojsonDataDict",{}),Object(s["a"])(this,"keyField","id"),Object(s["a"])(this,"selectedIds",[]),Object(s["a"])(this,"editingIds",[]),Object(s["a"])(this,"excludeSelectedFeatures",!1),Object(s["a"])(this,"selectionBelow",!1),Object(s["a"])(this,"dataFields",[]),Object(s["a"])(this,"beforeLayerId",null),Object(s["a"])(this,"onSelectionGeoJsonChanged",null),Object(s["a"])(this,"onSelectionFeatureRightClick",null),Object(s["a"])(this,"specialSortLayer","specialSortLayer"),Object(s["a"])(this,"bounds",null),Object(s["a"])(this,"onDataRefreshed",null),Object(s["a"])(this,"historyLength",void 0),Object(s["a"])(this,"historyIndex",-1),Object(s["a"])(this,"savedHistoryIndex",0),Object(s["a"])(this,"operationHistory",[]),Object(s["a"])(this,"addedIds",[]),Object(s["a"])(this,"editedIds",{}),Object(s["a"])(this,"deletedIds",[]),Object(s["a"])(this,"permanentDeletedIds",[]),Object(s["a"])(this,"onHistoryIndexChanged",null),Object(s["a"])(this,"onFeatureUndo",null),Object(s["a"])(this,"onFeatureRedo",null),Object(s["a"])(this,"selectionFilter",null),Object(s["a"])(this,"filterValue",null),Object(s["a"])(this,"where",null);var n=t.options.type;this.layerType=n,this.layerCaption=t.options.text,this.id=t.componentId,this.pos=t.componentPos,this.visible=t.options.visible,this.bounds=t.options.bounds||null,this.where=t.options.where||this._getWhereFromUrl(t.options.url),this.excludeSelectedFeatures=t.options.excludeSelectedFeatures||!1,this.selectionBelow=t.options.selectionBelow||!1,this.tileSourceId="".concat(this.id,"_tile"),this.geojsonSourceId="".concat(this.id,"_geojson"),this.keyField=t.options.keyField||this.keyField,this.specialSortLayer=t.specialSortLayer||this.specialSortLayer,this.historyLength=t.historyLength||this.historyLength,$s["a"][n]||Gs["c"][n]?(this.setMapboxSourceConfigs(t),this.setMapboxLayerConfigs(t),!1!==t.selectionLayer&&this.setMapboxSelectionLayerConfigs(t)):window.console.warn("Неизвестный тип слоя",n),this.onSelectionGeoJsonChanged=t.onSelectionGeoJsonChanged||null,this.onSelectionFeatureRightClick=t.onSelectionFeatureRightClick||null,this.onDataRefreshed=t.onDataRefreshed||null,this.onHistoryIndexChanged=t.onHistoryIndexChanged||null,this.onFeatureUndo=t.onFeatureUndo||null,this.onFeatureRedo=t.onFeatureRedo||null}return Object(Rs["a"])(e,[{key:"setMapboxSourceConfigs",value:function(e){this.geojsonSourceConfig=$s["a"].geojson(e),this.tileSourceConfig=$s["a"][this.layerType](e)}},{key:"setMapboxLayerConfigs",value:function(e,t){var n={};if(t){var i,o=Ws(this.mapboxLayerConfigs);try{for(o.s();!(i=o.n()).done;){var a=i.value;n[a.id]=a.visible}}catch(d){o.e(d)}finally{o.f()}}var s=Gs["c"][this.layerType](e);if(t){var r,l=Ws(s);try{for(l.s();!(r=l.n()).done;){var c=r.value;c.visible=n[c.id]}}catch(d){l.e(d)}finally{l.f()}}this.mapboxLayerConfigs=s,"vector"===this.layerType&&this._setTileEditLayerConfigs(e)}},{key:"setMapboxSelectionLayerConfigs",value:function(e){var t=this,n=[];if(e.options.selectionMapboxLayers)n=e.options.selectionMapboxLayers;else{var i={type:"fill",layout:{},paint:e.defaultSelectionFillPaint,filter:Js},o={type:"line",layout:{},paint:e.defaultSelectionLinePaint,filter:Zs},a={type:"circle",layout:{},paint:e.defaultSelectionCirclePaint,filter:Ys};n=[i,o,a]}if(this.mapboxLayerSelectionConfigs=n.map((function(n,i){var o,a=n.geometry?["all",["in",["geometry-type"],["literal",n.geometry]]]:null;o=n.filter&&a?["all",n.filter,a]:n.filter||a||["all"];var s=Hs(Hs({},n),{},{source:"vector"===t.layerType?t.tileSourceId:t.geojsonSourceId,id:"".concat(t.id,"_selection_").concat(i),filter:o});return"vector"!==t.layerType||n["source-layer"]||(s["source-layer"]=e.options.sourceLayer||t.mapboxLayerConfigs[0]["source-layer"]),s})),"vector"===this.layerType){var s,r=this.mapboxLayerSelectionConfigs.map((function(e){var n=Hs(Hs({},e),{},{source:t.geojsonSourceId,id:"".concat(e.id,"_edit")});return delete n["source-layer"],n}));(s=this.mapboxLayerSelectionConfigs).splice.apply(s,[0,0].concat(Object(Ie["a"])(r)))}}},{key:"addTo",value:function(e){var t=this;(this.tileSourceConfig||this.geojsonSourceConfig)&&(this.mapbox=e,["geojson","vector","wfs"].includes(this.layerType)&&this.mapbox.addSource(this.geojsonSourceId,Hs(Hs({},this.geojsonSourceConfig),{},{data:this.geojsonData})),["geojson","wfs"].includes(this.layerType)||this.mapbox.addSource(this.tileSourceId,this.tileSourceConfig),this._initSpecialSortLayer(),this.visible&&(this.mapboxLayerConfigs.filter((function(e){return"chart"!==e.type})).forEach((function(e){t.mapbox.addLayer(e,t.specialSortLayer)})),this.tileEditLayerConfigs.filter((function(e){return"chart"!==e.type})).forEach((function(e){t.mapbox.addLayer(e,t.specialSortLayer)})),this.select([])),this.mapboxLayerSelectionConfigs.forEach((function(e){t.mapbox.on("contextmenu",e.id,(function(n){t.selectionContextMenu(e.id,n)}))})))}},{key:"remove",value:function(){this.removeLayers(),this.removeSources()}},{key:"removeLayers",value:function(){var e=this;this.mapbox&&(this.mapboxLayerConfigs.forEach((function(t){e.mapbox.getLayer(t.id)&&e.mapbox.removeLayer(t.id)})),this.tileEditLayerConfigs.forEach((function(t){e.mapbox.getLayer(t.id)&&e.mapbox.removeLayer(t.id)})),this._hideSelectionLayers())}},{key:"removeSources",value:function(){this.mapbox&&(this.mapbox.getSource(this.tileSourceId)&&this.mapbox.removeSource(this.tileSourceId,this.tileSourceConfig),this.mapbox.getSource(this.geojsonSourceId)&&this.mapbox.removeSource(this.geojsonSourceId,this.geojsonSourceConfig))}},{key:"setTextVisibility",value:function(e){this.mapbox&&(this.textVisible=e,this._setTextConfigsVisibility(this.visible&&e),"vector"===this.layerType&&this._updateEditLayer())}},{key:"setStyleRuleVisibility",value:function(e,t){var n,i=[].concat(Object(Ie["a"])(this.mapboxLayerConfigs),Object(Ie["a"])(this.tileEditLayerConfigs)).filter((function(t){return t.name===e||t["source-layer"]===e})),o=Ws(i);try{for(o.s();!(n=o.n()).done;){var a=n.value;if(a.visible=t,!this.mapbox)return;var s=!!this.mapbox.getLayer(a.id);t&&!s?this.mapbox.addLayer(a,this.specialSortLayer):!t&&s&&this.mapbox.removeLayer(a.id)}}catch(r){o.e(r)}finally{o.f()}"vector"===this.layerType&&this._updateEditLayer()}},{key:"setVisibility",value:function(e){var t=this;if(this.mapbox){this.visible=e;var n=this.specialSortLayer;this.visible&&(n=this._beforeLayerId()),[].concat(Object(Ie["a"])(this.mapboxLayerConfigs),Object(Ie["a"])(this.tileEditLayerConfigs)).filter((function(e){return"chart"!==e.type})).forEach((function(i){var o=!!t.mapbox.getLayer(i.id);i.visible=e,t.visible&&!o?t.mapbox.addLayer(i,n):!t.visible&&o&&t.mapbox.removeLayer(i.id)})),this._setTextConfigsVisibility(this.textVisible&&e),this._hideSelectionLayers(),"vector"===this.layerType&&this._updateEditLayer()}}},{key:"setPos",value:function(e){var t=this;this.pos=e,[].concat(Object(Ie["a"])(this.mapboxLayerConfigs),Object(Ie["a"])(this.tileEditLayerConfigs)).forEach((function(n){n.metadata&&(n.metadata.pos=e,t.mapbox&&t.mapbox.getLayer(n.id)&&(t.mapbox.getLayer(n.id).metadata.pos=e))}))}},{key:"getLayerIds",value:function(){var e=this,t=[].concat(Object(Ie["a"])(this.mapboxLayerConfigs),Object(Ie["a"])(this.tileEditLayerConfigs)).map((function(e){return e.id})).filter((function(t){return e.mapbox&&e.mapbox.getLayer(t)}));return this.excludeSelectedFeatures&&this.mapboxLayerSelectionConfigs.forEach((function(n){e.mapbox&&e.mapbox.getLayer(n.id)&&t.push(n.id)})),t}},{key:"getLayerIdsForRule",value:function(e){var t=this,n=[].concat(Object(Ie["a"])(this.mapboxLayerConfigs),Object(Ie["a"])(this.tileEditLayerConfigs)).filter((function(n){return t.mapbox&&t.mapbox.getLayer(n.id)&&n.name===e})).map((function(e){return e.id}));return n}},{key:"getSlectionLayerIds",value:function(){return this.mapboxLayerSelectionConfigs.map((function(e){return e.id}))}},{key:"move",value:function(e){var t=this;this.mapbox&&this.visible&&[].concat(Object(Ie["a"])(this.mapboxLayerConfigs),Object(Ie["a"])(this.tileEditLayerConfigs)).forEach((function(n){e?t.mapbox.moveLayer(n.id):t.mapbox.moveLayer(n.id,t.specialSortLayer)}))}},{key:"moveSelectionLayers",value:function(){var e=this;this.mapbox&&this.mapboxLayerSelectionConfigs.forEach((function(t){e.mapbox.getLayer(t.id)&&e.mapbox.moveLayer(t.id)}))}},{key:"selectByFeatureProperties",value:function(e){var t=this;this.select(e.map((function(e){return e[t.keyField]})))}},{key:"select",value:function(e,t){var n=this;if(this.selectedIds=e,t||this._triggerSelectionGeoJsonChanged(),this.mapbox&&this.visible){this.excludeSelectedFeatures&&(this.selectionFilter=["all"].concat(Object(Ie["a"])(this.selectedIds.map((function(e){return["!=",["get",n.keyField],+e||e]})))),"vector"===this.layerType&&(this.selectionFilter=[].concat(Object(Ie["a"])(this.selectionFilter),Object(Ie["a"])(this.permanentDeletedIds.map((function(e){return["!=",["get",n.keyField],+e||e]}))))),this.tileEditLayerConfigs.forEach((function(e){if(n.mapbox.getLayer(e.id)){var t=["all",n.selectionFilter,e.filter];n.mapbox.setFilter(e.id,t)}})),this.mapboxLayerConfigs.forEach((function(e){if(n.mapbox.getLayer(e.id)){var t=["all",n.selectionFilter,e.filter];n.mapbox.setFilter(e.id,t)}}))),this.mapbox.getSource(this.geojsonSourceId)||this.mapbox.addSource(this.geojsonSourceId,Hs(Hs({},this.geojsonSourceConfig),{},{data:this.geojsonData})),this._showSelectionLayers();try{this.mapboxLayerSelectionConfigs.forEach((function(e){var t=n.selectedIds;"vector"===n.layerType&&e.source===n.tileSourceId&&(t=n.selectedIds.filter((function(e){return!n.geojsonDataDict.hasOwnProperty(e)}))),n.mapbox.setFilter(e.id,n._getCombinedFilter(t,e))}))}catch(i){}}}},{key:"getSelectedIds",value:function(){return this.selectedIds}},{key:"getSelectedFeatures",value:function(){var e=this,t=[];return this.selectedIds.forEach((function(n){e.geojsonDataDict.hasOwnProperty(n)&&t.push(e.geojsonDataDict[n])})),t}},{key:"setGeoJsonData",value:function(e,t,n){var i=this;(n||t&&"vector"!==this.layerType)&&(this.geojsonDataDict={}),e&&Array.isArray(e.features)&&e.features.forEach((function(e){var t=e.id||e.properties[i.keyField];t||(t=(new Ns["a"]).toString(),e.id=t),e.properties[i.keyField]||(e.properties[i.keyField]=e.id);var n=i.getEditedFeatureInfo(t);n?"deleted"!==n.type&&(i.geojsonDataDict[t]=n.feature):i.geojsonDataDict[t]=e})),this.refreshGeoJsonData()}},{key:"refreshGeoJsonData",value:function(){var e=this;this.geojsonData.features=Object.keys(this.geojsonDataDict).filter((function(t){return!e.editingIds.includes(t)&&!e.deletedIds.includes(t)})).map((function(t){return e.geojsonDataDict[t]}));var t={features:this.editingIds.map((function(t){return e.geojsonDataDict[t]})),type:"FeatureCollection"};if(this.onDataRefreshed&&this.onDataRefreshed({visibleFeatures:this.geojsonData,editingFeatures:t}),this.mapbox){var n=this.mapbox.getSource(this.geojsonSourceId);n&&(n.setData(this.geojsonData),"vector"===this.layerType&&this._updateEditLayer())}}},{key:"moveMapToFeatures",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.15,i=this._getFeaturesFromDict(e);if(0!==i.length){var o={type:"FeatureCollection",features:i};if(this.mapbox)if(t){var a=Vs["center"](o);this.mapbox.jumpTo({zoom:t,center:a.geometry.coordinates,animate:!1})}else{var s=Vs["buffer"](o,n),r=Vs["bbox"](s);this.mapbox.fitBounds(r,{animate:!1})}}}},{key:"moveMapToLayer",value:function(){var e=!1;return this.bounds?(this.mapbox.fitBounds(this.bounds,{animate:!1,padding:50}),e=!0):["geojson","wfs"].includes(this.layerType)&&(this.moveMapToGeoJson(),e=!0),e}},{key:"moveMapToGeoJson",value:function(){var e=Vs["bbox"]({type:"FeatureCollection",features:this.geojsonData.features.filter((function(e){return e.geometry}))});this.mapbox.fitBounds(e,{animate:!1,padding:50})}},{key:"setBounds",value:function(e){this.bounds=e}},{key:"setSelectionLayersVisible",value:function(e){e?this._showSelectionLayers():this._hideSelectionLayers()}},{key:"getGeoJsonData",value:function(){return this.geojsonData}},{key:"getSelectedGeoJsonData",value:function(){var e=this;return this.geojsonData?{type:"FeatureCollection",features:this.geojsonData.features.filter((function(t){return e.selectedIds.includes(t.id)}))}:null}},{key:"setEditingIds",value:function(e){this.editingIds=e.map((function(e){return e.toString()}))}},{key:"selectionContextMenu",value:function(e,t){var n=t.point,i=5,o=[[n.x-i,n.y-i],[n.x+i,n.y+i]],a=this.mapbox.queryRenderedFeatures(o,{layers:[e]});this.onSelectionFeatureRightClick&&a[0]&&this.onSelectionFeatureRightClick(Hs(Hs({},t),{},{layerId:this.id,featureProperties:a[0].properties}))}},{key:"addFeatures",value:function(e){var t=this,n={features:[]};e.forEach((function(e){var i=e.id||e.properties[t.keyField];e.properties[t.keyField]||(e.properties[t.keyField]=e.id),t._addEssentialProperties(e),t._addToAddedIds(i),n.features.push(e),t.geojsonDataDict[i]=e})),this._saveOperationToHistory({type:"add",data:n}),this.refreshGeoJsonData()}},{key:"addFeaturesNoHistory",value:function(e){var t=this;e.forEach((function(e){var n=e.id||e.properties[t.keyField];t.geojsonDataDict[n]=e})),this.refreshGeoJsonData()}},{key:"deleteFeatures",value:function(e){var t=this,n=[];return e.forEach((function(e){var i=e.id;t.geojsonDataDict.hasOwnProperty(i)&&(n.push(t.geojsonDataDict[i]),t._addToDeletedIds(i),delete t.geojsonDataDict[i])})),this._saveOperationToHistory({type:"delete",data:{features:n}}),this.refreshGeoJsonData(),n}},{key:"deleteFeaturesNoHistory",value:function(e){var t=this;e.forEach((function(e){var n=e.id;t.geojsonDataDict.hasOwnProperty(n)&&delete t.geojsonDataDict[n]})),this.refreshGeoJsonData()}},{key:"editFeatures",value:function(e){var t=this,n={features:[]};e.forEach((function(e){var i=e.id||e.properties[t.keyField],o={},a={};Object(Qt["a"])(t.geojsonDataDict[i],o),Object(Qt["a"])(e,a),n.features.push({oldFeature:o,newFeature:a}),t._addToEditedIds(i,!1),t.geojsonDataDict[i]=e})),this._saveOperationToHistory({type:"edit",data:n}),this.refreshGeoJsonData()}},{key:"getEditedFeatureInfo",value:function(e){for(var t=this,n=null,i=null,o=this.historyIndex;o>=0&&!n;o--)"edit"===this.operationHistory[o].type?(i=this.operationHistory[o].data.features.find((function(n){return n.newFeature.properties[t.keyField]===e})),i&&(n={type:"edited",feature:i.newFeature})):"add"===this.operationHistory[o].type?(i=this.operationHistory[o].data.features.find((function(n){return n.properties[t.keyField]===e})),i&&(n={type:"added",feature:i})):"delete"===this.operationHistory[o].type&&(i=this.operationHistory[o].data.features.find((function(n){return n.properties[t.keyField]===e})),i&&(n={type:"deleted",feature:i}));return n}},{key:"undo",value:function(){var e=this;if(!(this.historyIndex<0)){var t=this.operationHistory[this.historyIndex];switch(t.type){case"add":t.data.features.forEach((function(n){delete e.geojsonDataDict[n.id],e._addToDeletedIds(n.id),e._triggerFeatureUndo(t.type,n)}));break;case"delete":t.data.features.forEach((function(n){e.geojsonDataDict[n.id]=n,e._addToAddedIds(n.id),e._triggerFeatureUndo(t.type,n)}));break;case"edit":t.data.features.forEach((function(n){var i=n.oldFeature,o=n.newFeature;e.geojsonDataDict[o.id]=i,e._addToEditedIds(o.id,!0),e._triggerFeatureUndo(t.type,i)}));break}this.historyIndex--,this.refreshGeoJsonData(),this.triggerHistoryIndexChanged(),this.select(this.selectedIds)}}},{key:"redo",value:function(){var e=this;if(this.historyIndex!==this.operationHistory.length-1){this.historyIndex++;var t=this.operationHistory[this.historyIndex];switch(t.type){case"add":t.data.features.forEach((function(n){e.geojsonDataDict[n.id]=n,e._addToAddedIds(n.id),e._triggerFeatureRedo(t.type,n)}));break;case"delete":t.data.features.forEach((function(n){delete e.geojsonDataDict[n.id],e._addToDeletedIds(n.id),e._triggerFeatureRedo(t.type,n)}));break;case"edit":t.data.features.forEach((function(n){var i=n.oldFeature,o=n.newFeature;e.geojsonDataDict[i.id]=o,e._addToEditedIds(i.id,!1),e._triggerFeatureRedo(t.type,o)}));break}this.refreshGeoJsonData(),this.triggerHistoryIndexChanged(),this.select(this.selectedIds)}}},{key:"triggerHistoryIndexChanged",value:function(){this.onHistoryIndexChanged&&this.onHistoryIndexChanged({first:-1===this.historyIndex,last:this.historyIndex===this.operationHistory.length-1})}},{key:"_addToAddedIds",value:function(e){var t=this.deletedIds.indexOf(e);if(-1!==t)this.deletedIds.splice(t,1);else{var n=this.addedIds.indexOf(e);n<0&&this.addedIds.push(e)}}},{key:"_addToDeletedIds",value:function(e){var t=this.addedIds.indexOf(e);-1!==t?this.addedIds.splice(t,1):(this.editedIds.hasOwnProperty(e)&&delete this.editedIds[e],this.deletedIds.includes(e)||this.deletedIds.push(e),this.permanentDeletedIds.includes(e)||this.permanentDeletedIds.push(e))}},{key:"_addToEditedIds",value:function(e,t){this.addedIds.includes(e)||(this.editedIds[e]||(this.editedIds[e]=0),t?this.editedIds[e]--:this.editedIds[e]++,this.editedIds[e]||delete this.editedIds[e])}},{key:"hasChanges",value:function(){return 0!==this.addedIds.length||0!==this.deletedIds.length||0!==Object.keys(this.editedIds).length}},{key:"getChanges",value:function(){return{added:this.addedIds,deleted:this.deletedIds,edited:Object.keys(this.editedIds)}}},{key:"clearChanges",value:function(){this.addedIds=[],this.deletedIds=[],this.editedIds=[]}},{key:"removeChange",value:function(e){var t=this.addedIds.indexOf(e);t>=0&&this.addedIds.splice(t,1),t=this.deletedIds.indexOf(e),t>=0&&this.deletedIds.splice(t,1),this.editedIds.hasOwnProperty(e)&&delete this.editedIds[e]}},{key:"replaceChangeKey",value:function(e,t,n){var i=this.addedIds.indexOf(e);i>=0&&this.addedIds.splice(i,1,t),i=this.deletedIds.indexOf(e),i>=0&&(this.deletedIds.splice(i,1,t),this.permanentDeletedIds.splice(i,1,t)),i=this.permanentDeletedIds.indexOf(e),i>=0&&this.permanentDeletedIds.splice(i,1,t),this.editedIds.hasOwnProperty(e)&&(this.editedIds[t]=this.editedIds[e],delete this.editedIds[e]),this.geojsonDataDict[e]&&(this.geojsonDataDict[t]=this.geojsonDataDict[e],this.geojsonDataDict[t].properties=Hs({},n),delete this.geojsonDataDict[e]);var o,a=Ws(this.operationHistory);try{for(a.s();!(o=a.n()).done;){var s,r=o.value,l=Ws(r.data.features);try{for(l.s();!(s=l.n()).done;){var c=s.value;this.replaceFeatureIds(c,e,t,n),c.oldFeature&&this.replaceFeatureIds(c.oldFeature,e,t,n),c.newFeature&&this.replaceFeatureIds(c.newFeature,e,t,n)}}catch(d){l.e(d)}finally{l.f()}}}catch(d){a.e(d)}finally{a.f()}}},{key:"replaceFeatureIds",value:function(e,t,n,i){e.id===t&&(e.id=n,e.properties=Hs({},i))}},{key:"_addEssentialProperties",value:function(e){var t,n=[],i=Ws(this.mapboxLayerConfigs);try{for(i.s();!(t=i.n()).done;){var o=t.value;o.filter&&o.filter[0]&&(n=n.concat(Us["a"].getUsedAttributes(o.filter,this.dataFields)))}}catch(l){i.e(l)}finally{i.f()}var a,s=Ws(n);try{for(s.s();!(a=s.n()).done;){var r=a.value;void 0===e.properties[r.name]&&(e.properties[r.name]=Us["a"].getDefaultFieldValue(r))}}catch(l){s.e(l)}finally{s.f()}}},{key:"getFeaturesByIds",value:function(e){var t=this,n=[];return e.forEach((function(e){var i=t.geojsonDataDict[e];i&&n.push(i)})),n}},{key:"_saveOperationToHistory",value:function(e){this.operationHistory.splice(this.historyIndex+1,this.operationHistory.length,e);while(this.historyLength>=0&&this.operationHistory.length>this.historyLength)this.operationHistory.shift();this.historyIndex=this.operationHistory.length-1,this.triggerHistoryIndexChanged()}},{key:"changeFilter",value:function(e){var t=this,n=e.layerOptions,i=Object(Ms["a"])(e,["layerOptions"]);if(this.filterValue=i,n&&"vector"===this.layerType&&this.mapbox){var o=n.url,a="";Object.keys(i||{}).forEach((function(e){var s=i[e];s&&("where"===e&&(Array.isArray(t.where)&&t.where.length&&(s=Array.isArray(s)&&s.length>0?[t.where,"and",s]:t.where),o=t._excludeWhereFromUrl(n.url)),a+="&".concat(e,"=").concat(JSON.stringify(s)))})),o="".concat(o).concat(a);var s={componentId:this.id,options:Hs(Hs({},n),{},{url:o})};this.remove(),this.setMapboxSourceConfigs(s),this.setMapboxLayerConfigs(s,!0),this.addTo(this.mapbox)}}},{key:"_getCombinedFilter",value:function(e,t){return["all",this._getIdsFilter(e),t.filter||["all"]]}},{key:"_getIdsFilter",value:function(e){var t=this;return["any"].concat(Object(Ie["a"])(e.map((function(e){return["==",["get",t.keyField],e]}))))}},{key:"_showSelectionLayers",value:function(){var e=this;if(this.mapbox){var t=null;this.selectionBelow&&(t=this.mapboxLayerConfigs[0].id),this.mapboxLayerSelectionConfigs.forEach((function(n){var i=!!e.mapbox.getLayer(n.id);i||e.mapbox.addLayer(n,t)}))}}},{key:"_hideSelectionLayers",value:function(){var e=this;this.mapboxLayerSelectionConfigs.forEach((function(t){var n=!!e.mapbox.getLayer(t.id);n&&e.mapbox.removeLayer(t.id)}))}},{key:"_triggerSelectionGeoJsonChanged",value:function(){this.onSelectionGeoJsonChanged&&this.onSelectionGeoJsonChanged({layerComponentId:this.id,features:this._getFeaturesFromDict(this.selectedIds)})}},{key:"_getFeaturesFromDict",value:function(e){return Object.entries(this.geojsonDataDict).filter((function(t){var n=Object(re["a"])(t,2),i=n[0],o=n[1];if(e.map((function(e){return e.toString()})).includes(i))return o})).map((function(e){return e[1]}))}},{key:"_initSpecialSortLayer",value:function(){this.mapbox&&!this.mapbox.getLayer(this.specialSortLayer)&&this.mapbox.addLayer({id:this.specialSortLayer,type:"fill",source:{type:"geojson",data:null}})}},{key:"_triggerFeatureUndo",value:function(e,t){this.onFeatureUndo&&this.onFeatureUndo({operationType:e,operationFeature:t})}},{key:"_triggerFeatureRedo",value:function(e,t){this.onFeatureRedo&&this.onFeatureRedo({operationType:e,operationFeature:t})}},{key:"_setTextConfigsVisibility",value:function(e){var t=this;[].concat(Object(Ie["a"])(this.mapboxLayerConfigs),Object(Ie["a"])(this.tileEditLayerConfigs)).filter((function(e){return"symbol"===e.type&&e.layout["text-field"]})).forEach((function(n){var i=!!t.mapbox.getLayer(n.id);e&&!i?t.mapbox.addLayer(n,t.specialSortLayer):!e&&i&&t.mapbox.removeLayer(n.id)}))}},{key:"_setTileEditLayerConfigs",value:function(e){var t=this;this.tileEditLayerConfigs=Gs["c"].geojson(e).map((function(e){var n=Hs(Hs({},e),{},{id:"".concat(e.id,"_edit"),source:t.geojsonSourceId});return delete n["source-layer"],n}))}},{key:"_getVectorHiddenFilter",value:function(){var e=this,t=Object.keys(this.geojsonDataDict).map((function(e){return+e||e}));return t=[].concat(Object(Ie["a"])(t),Object(Ie["a"])(this.permanentDeletedIds.map((function(e){return+e||e})))),["all"].concat(Object(Ie["a"])(t.map((function(t){return["!=",["get",e.keyField],t]}))))}},{key:"_updateEditLayer",value:function(){var e=this,t=this._getVectorHiddenFilter();this.mapboxLayerConfigs.forEach((function(n){if(e.mapbox.getLayer(n.id)){var i=["all",t,n.filter,e.selectionFilter||["all"]];e.mapbox.setFilter(n.id,i)}})),this.mapboxLayerSelectionConfigs.forEach((function(t){e.mapbox.getLayer(t.id)&&(t.id.includes("edit")?e.mapbox.setFilter(t.id,e._getCombinedFilter(e.selectedIds,t)):e.mapbox.removeLayer(t.id))}))}},{key:"_beforeLayerId",value:function(){var e=this,t=this.mapbox.getStyle().layers,n=t.findIndex((function(t){return t.id===e.specialSortLayer})),i=t.slice(0,n).filter((function(e){return e.metadata&&e.metadata.pos})),o=i.find((function(t){return t.metadata.pos>e.pos}));return o?o.id:this.specialSortLayer}},{key:"_getWhereFromUrl",value:function(e){if(!e||!e.includes("?")||"vector"!==this.layerType)return null;var t=null;return e.substr(e.lastIndexOf("?")+1).split("&").forEach((function(e){if(e.includes("where")){var n=e.substr(e.indexOf("=")+1);t=JSON.parse(decodeURIComponent(n))}})),t}},{key:"_excludeWhereFromUrl",value:function(e){if(!e||!e.includes("where")||"vector"!==this.layerType)return e;var t=e.substr(0,e.lastIndexOf("?")),n=e.substr(e.lastIndexOf("?")+1).split("&");return"".concat(t,"?").concat(n.filter((function(e){return!e.includes("where")})).join("&"))}}]),e}();function Qs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function er(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qs(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var tr={data:function(){return{filterPanelVisible:!1,filterPanelLayerName:"",contextMenuItems:[{iconCss:"core core-052-attr-panel",text:"Карточка объекта",methods:"handleOpenCardClick"},{iconCss:"core core-071-download",text:"Экспорт выбранных объектов",methods:"exportSelectedFeatures"}],customFilterPos:{}}},mixins:[l["a"]],components:{ContainerItem:r["a"],GisLegendAlternative:H,GisRoundContextMenuItem:ie,GisRoundContextMenu:Y,GisAddServicePopup:oe["a"],GisVectorLayerPopup:ii,GisFolderPopup:Ii,GisRasterLayerPopup:Ni,GisOpenLayerPopup:Qi,GisFilterPanel:ao,GisCustomTablePanel:xo,GisCustomFilterPanel:ss,SimpleInvisibleComponentContainer:rs["a"],GisTimelineSlider:Ds,GisOverlayContainer:Bs},computed:{topLeftPanelItems:function(){return this.itemConfigs.filter((function(e){return"topLeft"===e.panel})).sort((function(e,t){return(e.componentPos||0)-(t.componentPos||0)}))},topRightPanelItems:function(){return this.itemConfigs.filter((function(e){return"topRight"===e.panel})).sort((function(e,t){return(e.componentPos||0)-(t.componentPos||0)}))},overlayPanelItems:function(){return this.itemConfigs.filter((function(e){return"overlay"===e.panel})).sort((function(e,t){return(e.componentPos||0)-(t.componentPos||0)}))},legendClassList:function(){return{"gis-alternative__legend":!0,"gis-alternative__legend_shown":this.legendVisible}},spaceImageryPanelClassList:function(){return{"gis-alternative__space-imagery-panel":!0,"gis-alternative__space-imagery-panel_shown":this.spaceImageryPanelVisible}},filterPanelClassList:function(){return{"gis-alternative__filter-panel":!0,"gis-alternative__filter-panel_shown":this.filterPanelVisible}},addStylesContentMenu:function(){var e=er({},this.featureContextMenuPosition);return 0!==e.left&&(e.left=e.left.replace(/[^.0-9]/gim,"")),0!==e.top&&(e.top=e.top.replace(/[^.0-9]/gim,"")),"left: ".concat(e.left-47,"px; top: ").concat(e.top-47,"px;")},tablePanelLayerComponentId:function(){return this.getTablePanelLayerComponentId(this.componentId)},filterPanelLayerComponentId:function(){return this.getFilterPanelLayerComponentId(this.componentId)}},methods:{onLayerChanged:function(e){var t=this.legendLayers[e.componentId],n=this.getLayerSavedOptions(e.componentId);e.options.visible=n.hasOwnProperty("visible")?n.visible:e.options.visible||!1,e.options.textVisible=n.hasOwnProperty("textVisible")?n.textVisible:e.options.textVisible||!1,t.mapboxMapLayer.remove(),t.mapboxMapLayer=new Xs(er({defaultSelectionFillPaint:this.defaultSelectionFillPaint,defaultSelectionLinePaint:this.defaultSelectionLinePaint,defaultSelectionCirclePaint:this.defaultSelectionCirclePaint,specialSortLayer:"legendSpecialSortLayer"},e)),t.mapboxMapLayer.addTo(this.mapbox),t.mapboxMapLayer.setVisibility(t.visible),this.sortLayers()},selectItem:function(e){switch(e){case"handleOpenCardClick":this.handleOpenCardClick();break;case"exportSelectedFeatures":this.exportSelectedFeatures();break}},toggleLegend:function(){this.legendVisible=!this.legendVisible},toggleSpaceImagery:function(){this.spaceImageryPanelVisible=!this.spaceImageryPanelVisible},simulateMouseEvent:function(e){var t=this.$el.querySelector(".mapboxgl-canvas"),n=new MouseEvent(e.type,e);-1!==e.type.indexOf("wheel")&&(n=new WheelEvent(e.type,e)),t.dispatchEvent(n)},deleteEmptyProperties:function(e){for(var t in e)""===e[t]||null===e[t]||void 0===e[t]?delete e[t]:"object"===Object(a["a"])(e[t])&&this.deleteEmptyProperties(e[t])}}},nr=tr,ir=(n("7bbd"),Object(j["a"])(nr,i,o,!1,null,null,null));t["default"]=ir.exports},b2e5:function(e,t,n){},b3d1:function(e,t,n){},b436:function(e,t,n){"use strict";var i=n("c38c"),o=n.n(i);o.a},b468:function(e,t,n){},b4a2:function(e,t,n){"use strict";var i=n("39d6"),o=n.n(i);o.a},b64a:function(e,t,n){},b68a:function(e,t,n){"use strict";var i=n("2717"),o=n.n(i);o.a},b6eb:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-add-tile-layer"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Как базовая карта")]),n("div",{staticClass:"dx-field-value"},[n("DxCheckBox",{on:{valueChanged:function(t){return e.$emit("change",e.layersSettings)}},model:{value:e.layersSettings.baseMap,callback:function(t){e.$set(e.layersSettings,"baseMap",t)},expression:"layersSettings.baseMap"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("URL-адрес")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{on:{valueChanged:function(t){return e.$emit("change",e.layersSettings)}},model:{value:e.layersSettings.url,callback:function(t){e.$set(e.layersSettings,"url",t)},expression:"layersSettings.url"}})],1)]),n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label"},[e._v("Поддомены")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{on:{valueChanged:function(t){return e.$emit("change",e.layersSettings)}},model:{value:e.layersSettings.subdomains,callback:function(t){e.$set(e.layersSettings,"subdomains",t)},expression:"layersSettings.subdomains"}})],1)])])},o=[],a=(n("8e6e"),n("ac6a"),n("cadf"),n("456d"),n("ade3")),s=n("e614"),r=n.n(s),l=n("ee80"),c=n.n(l);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p={baseMap:!1,url:"",subdomains:""},f={name:"GisAddTileLayer",components:{DxTextBox:r.a,DxCheckBox:c.a},data:function(){return{layersSettings:u({},p)}},mounted:function(){this.$emit("change",this.layersSettings)}},h=f,m=(n("b0d10"),n("2877")),g=Object(m["a"])(h,i,o,!1,null,null,null);t["a"]=g.exports},b70e:function(e,t,n){},b7d6:function(e,t,n){"use strict";var i=n("e1bb"),o=n.n(i);o.a},b88a:function(e,t,n){"use strict";var i=n("8036"),o=n.n(i);o.a},b905:function(e,t,n){"use strict";var i=n("746d"),o=n.n(i);o.a},b93b:function(e,t,n){"use strict";n("ac6a");var i=n("750b"),o=n("8bc1"),a=n("c22f"),s=n("3831"),r=n("e3b7"),l=n("68b0"),c=n("7a47"),d=n("eec1"),u=n("d6fe"),p=n("9841"),f="core core-082-visible",h="core core-081-no-visible",m="core core-193_halfeye";function g(e,t){e.dxScrollView&&e.selectedId===e.componentId&&e.dxScrollView.scrollToElement(t)}t["a"]=function(e,t){var y=Object(i["e"])(null),v=Object(i["a"])((function(){var n=t.getters["config/".concat(a["b"])](e.componentId);return n.componentPos||0})),b=Object(i["a"])((function(){return t.getters["config/".concat(d["E"])](e.componentId)})),_=Object(i["a"])((function(){return t.getters["config/".concat(a["c"])](b.value.parentGisId)})),C=Object(i["a"])((function(){return _.value.images||[]})),x=Object(i["a"])((function(){return!_.value.hideLayerEnable})),O=Object(i["a"])((function(){return!!b.value.textVisibleShow})),I=Object(i["a"])((function(){if(t.getters["session/userIsGuest"])return!1;var e=!_.value.hideLayerEdit&&!b.value.group&&"pkk"!==b.value.type&&"wms"!==b.value.type;return e=e&&_.value.rights.editLayerObjects,e})),S=Object(i["a"])((function(){return t.getters["config/".concat(d["k"])](e.componentId,!0).filter((function(e){return t.getters["config/".concat(d["Y"])](e)||t.getters["config/".concat(d["X"])](e)||t.getters["config/".concat(d["Z"])](e)}))})),L=Object(i["a"])((function(){return t.getters["config/".concat(d["x"])](e.componentId)})),D=Object(i["a"])((function(){return t.getters["config/".concat(d["w"])](e.componentId)})),P=Object(i["a"])((function(){return L.value.length>1||L.value[0]&&!1===L.value[0].wmsSingleRule})),E=Object(i["a"])((function(){if("Публичная кадастровая карта"===b.value.text)return n("0551");if(1===L.value.length){var e=L.value[0];return e.iconUrl&&void 0===e.wmsSingleRule||!0===e.wmsSingleRule?e.iconUrl:!1===e.wmsSingleRule?null:Object(o["a"])(e.mapboxLayerConfigs,_.value.images)}return b.value.iconUrl?b.value.iconUrl:null}));function w(n){b.value.group&&t.dispatch("config/".concat(p["I"]),{layerComponentId:e.componentId,expanded:n})}function T(){t.dispatch("config/".concat(s["b"]),{componentId:e.componentId,optionName:"styleListExpanded",optionValue:!b.value.styleListExpanded})}Object(i["f"])((function(){return(b.value.mapboxLayers||[]).reduce((function(e,t){if(!t||!t.layout)return e;var n=t.layout["icon-image"];return n&&e.push(n),e}),[])}),(function(e){e.forEach((function(e){t.dispatch("config/".concat(l["k"]),{gisComponentId:b.value.parentGisId,imageName:e}).then((function(n){if(!n)throw{msg:"Нет данных изображения"};return t.dispatch("config/".concat(l["j"]),{gisComponentId:b.value.parentGisId,imageName:e,imageUrl:n.url})})).then((function(n){t.commit("config/".concat(c["a"]),{gisComponentId:b.value.parentGisId,imageName:e,image:n})}))}))})),Object(i["f"])((function(){return!!b.value.group&&t.getters["config/".concat(r["s"])](b.value.parentGisId)}),(function(n){n&&t.getters["config/".concat(d["X"])](e.componentId)&&w(!0)}));var j=Object(i["a"])((function(){var t=_.value.activeLegendLayerComponentId||null;return e.componentId===t}));function k(){t.dispatch("config/".concat(l["s"]),{gisComponentId:b.value.parentGisId,layerComponentId:e.componentId})}function F(){var n=_.value.rights.editLayer;n&&t.dispatch("config/".concat(s["b"]),{componentId:b.value.parentGisId,optionName:"editingOptionsLayerComponentId",optionValue:e.componentId})}var B=Object(i["a"])((function(){var n=t.getters["config/".concat(r["l"])](b.value.parentGisId);return e.componentId===n}));function M(){t.dispatch("config/".concat(l["t"]),{gisComponentId:b.value.parentGisId,layerComponentId:_.value.editingLayerComponentId===e.componentId?null:e.componentId})}var A=Object(i["a"])((function(){return!(!b.value.group||!b.value.multiple)||!!b.value.visibleShow})),R=Object(i["a"])((function(){return t.getters["config/".concat(d["kb"])](e.componentId)})),V=Object(i["a"])((function(){return t.getters["config/".concat(d["W"])](e.componentId)}));function G(){t.dispatch("config/".concat(p["N"]),{componentId:e.componentId,visible:!(R.value||V.value)})}function $(){t.dispatch("config/".concat(p["H"]),{componentId:e.componentId,enable:!b.value.enable})}function N(){t.dispatch("config/".concat(p["M"]),{componentId:e.componentId,textVisible:!b.value.textVisible})}var U=Object(i["a"])((function(){return _.value.popupMenuLayerComponentId===e.componentId}));function z(n){t.dispatch("config/".concat(l["x"]),{gisComponentId:b.value.parentGisId,layerComponentId:U.value?null:e.componentId,targetElement:U.value?null:n.target})}var H=Object(i["a"])((function(){return R.value?f:V.value?m:h})),W=Object(i["a"])((function(){return b.value.group?R.value||V.value?"Скрыть вложенные слои":"Показать вложенные слои":R.value||V.value?"Скрыть слой":"Показать слой"}));function K(){}function q(){}Object(i["c"])((function(){g(e,y.value),"pkk"===b.value.type||"arcgis"===b.value.type?t.dispatch("config/".concat(p["m"]),{layerComponentId:e.componentId}):"wms"===b.value.type&&t.dispatch("config/".concat(p["z"]),{layerComponentId:e.componentId}).then((function(){}))})),Object(i["d"])((function(){g(e,y.value)}));var J=Object(i["e"])(!1);function Z(n){if(J.value=!1,"wms"===b.value.type||1===D.value.length){var i=n.target;i.naturalWidth!==i.naturalHeight&&t.commit("config/".concat(u["F"]),{layerComponentId:e.componentId,legendStyleItemId:D.value[0],propertyName:"wmsSingleRule",propertyValue:!1})}}function Y(){b.value.type}function X(){t.commit("config/".concat(u["F"]),{layerComponentId:e.componentId,legendStyleItemId:D.value[0],propertyName:"iconUrl",propertyValue:"".concat(L.value[0].initialUrl,"&time=").concat(Date.now())}),J.value=!1}return{componentPos:v,layerOptions:b,active:j,editing:B,editClick:M,toggleVisible:G,showVisibleButton:A,visible:R,halfVisible:V,toggleEnable:$,toggleTextVisible:N,visibleButtonIconCss:H,showEnableButton:x,showTextButton:O,showEditButton:I,moreButtonClick:z,moreButtonActive:U,legendStyleItemIds:D,showLegendStyleItems:P,visibleButtonText:W,iconUrl:E,iconLoaded:Z,handleIconError:Y,iconError:J,reloadIcon:X,textRef:y,items:S,handleLegendIconEnter:K,handleLegendIconLeave:q,toggleExpandClick:w,toggleStyleList:T,contentClick:k,contentDblClick:F,images:C}}},b96f:function(e,t,n){"use strict";var i=n("98dc"),o=n.n(i);o.a},ba33:function(e,t,n){},ba75:function(e,t,n){},bb40:function(e,t,n){"use strict";var i=n("06a8"),o=n.n(i);o.a},bb94:function(e,t,n){},bbfd:function(e,t,n){"use strict";n("8e6e"),n("ac6a"),n("cadf"),n("456d"),n("097d");var i=n("ade3"),o=n("2f62"),a=n("b432"),s=n("e3b7"),r=n("68b0"),l=n("eec1"),c=n("9841"),d=n("520c");function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f=400,h=300,m=["Удаление слоев","Вы действительно хотите удалить слой "," и его дочерние элементы"];t["a"]={props:{gisComponentId:null},data:function(){return{tooltipUrl:null,addLayerMenuVisible:!1,addLayerPopupVisible:!1,clickCount:0,clickTarget:0,lastClickTime:null,legendItemsBySearch:this.legendItems,deleteProcess:!1}},computed:p(p({},Object(o["c"])("config",{getGisOptions:s["z"],getActiveLegendLayerComponentId:s["d"],getPopupMenuLayerComponentId:s["A"],getLegendLayerIds:s["r"],isLegendLayersAllVisible:s["M"],isLegendLayersSomeVisible:s["N"],getLegendLayerSearchValue:s["s"],isAllowDropBetweenGroup:s["L"],getLayerOptions:l["E"],getLegendPanelLayerIds:s["t"]})),{},{items:function(){return this.getLegendPanelLayerIds(this.gisComponentId)},activeLegendLayerComponentId:function(){return this.getActiveLegendLayerComponentId(this.gisComponentId)},legendLayersAllVisible:function(){return this.isLegendLayersAllVisible(this.gisComponentId)},legendLayersSomeVisible:function(){return this.isLegendLayersSomeVisible(this.gisComponentId)},legendLayersVisibleIconCss:function(){return this.legendLayersAllVisible?a["h"]:this.legendLayersSomeVisible?a["b"]:a["d"]},popupMenuLayerComponentId:function(){return this.getPopupMenuLayerComponentId(this.gisComponentId)},popupMenuLayerTargetElement:function(){return this.getGisOptions(this.gisComponentId).popupMenuLayerTargetElement||null},legendLayerSearchValue:function(){return this.getLegendLayerSearchValue(this.gisComponentId)},allowDropBetweenGroup:function(){return this.isAllowDropBetweenGroup(this.gisComponentId)}}),watch:{legendItems:function(){this.legendItemsBySearch=this.legendItems}},mounted:function(){this.setAddLayerPosition(this.$refs.addLayerMenuRef.instance,this.$refs.addLayerButtonRef.$el)},methods:p(p({},Object(o["b"])("config",{setPopupMenuLayerComponent:r["x"],setLegendLayerSearchValue:r["u"],loadLayerComponentsBySearch:r["m"],setLegendLayersVisible:r["v"],deleteLayerComponent:r["d"],setExpanded:c["I"]})),{},{onLayerMenuOutsideClick:function(e){return this.$refs.dxPopoverLegendItemPanel.instance.content().contains(e.target)||this.hideLayerPopupMenu(),!1},handleLegendPanelButtonClick:function(e){var t=e.value,n=e.active;if(this.popupMenuLayerComponentId){var i={buttonName:t,buttonActive:n,layerComponentId:this.popupMenuLayerComponentId,outputHidePopupMenu:void 0};i.outputHidePopupMenu&&this.hideLayerPopupMenu()}},hideLayerPopupMenu:function(){this.setPopupMenuLayerComponent({gisComponentId:this.gisComponentId,layerComponentId:null,targetElement:null})},handleLegendPopoverClose:function(){},handleLegendIconEnter:function(e){this.tooltipUrl=e.url,this.$refs.iconTooltipRef.instance.show(e.target)},handleLegendIconLeave:function(){this.$refs.iconTooltipRef.instance.hide(),this.tooltipUrl=null},handleSearchLayerItem:function(e){this.$emit("searchLayerItem",{layerComponentId:this.popupMenuLayerComponentId,value:e.value})},handleSelectSearchItem:function(e){this.$emit("selectSearchItem",{layerComponentId:this.popupMenuLayerComponentId,param:{id:e.featureId}})},handleCreateBufferZone:function(e){this.$emit("createBufferZone",{layerComponentId:this.popupMenuLayerComponentId,bufferValues:e.bufferValues})},tooltipImageLoaded:function(e){var t,n,i=e.target,o=i.parentElement,a=i.naturalWidth,s=i.naturalHeight,r=a/f,l=s/h,c=a/s;r>1||l>1?r>l?(t=f,n=t/c):(n=h,t=n*c):(t=a,n=s),o.style.width="".concat(t,"px"),o.style.height="".concat(n,"px")},toggleAddLayerMenu:function(){this.useAddLayerMenu?this.addLayerMenuVisible=!this.addLayerMenuVisible:this.addLayerPopupVisible=!0},onAddLayerClick:function(e){this.toggleAddLayerMenu(),this.$emit("addLayerClick",e)},setAddLayerPosition:function(e,t){var n={at:"right top",my:"left top",of:t};e.option("position",n)},detectDblClick:function(e){var t=this,n=!1;if(this.clickCount?this.clickTarget===e.id?this.clickCount++:this.resetDblClickData():(this.clickCount=1,this.clickTarget=e.id),1===this.clickCount)this.lastClickTime=(new Date).getTime(),window.setTimeout((function(){t.resetDblClickData()}),a["a"]);else if(2===this.clickCount&&this.clickTarget===e.id){var i=(new Date).getTime();i-this.lastClickTime<a["a"]+50&&(n=!0),this.resetDblClickData()}return n},resetDblClickData:function(){this.clickCount=0,this.clickTarget=0,this.lastClickTime=null},handleLayerAdd:function(e){this.addLayerPopupVisible=!1,this.$emit("layerAdd",e)},handleDragMove:function(e,t){var n=e.toIndex,i=e.component.element().querySelectorAll(t),o=i[n],a=o.getAttribute("data-id"),s=this.getLayerOptions(a),r=document.querySelector(".dx-sortable-placeholder");r&&(e.dropInsideItem&&!s.group?r.style.visibility="hidden":r.style.visibility="")},handleDragEnd:function(e,t){var n=e.toIndex,i=e.component.element().querySelectorAll(t),o=i[n],a=o.getAttribute("data-id"),s=this.getLayerOptions(a);e.cancel=e.dropInsideItem&&!s.group},handleReorder:function(e,t){var n=e.fromIndex,i=e.toIndex,o=e.component.element().querySelectorAll(t),a=e.dropInsideItem,s=o[n],r=s.dataset.id,l=s.dataset.parentId,c=o[i],d=c.getAttribute("data-id"),u=this.getLayerOptions(d);e.dropInsideItem&&u.group&&this.setExpanded({layerComponentId:d,expanded:!0});var p={componentId:r,oldParentId:l,changeConstructor:!1,changeLoaded:!1};if(a)p.newParentId=c.dataset.id||null;else{p.newParentId=c.dataset.parentId!==c.dataset.id?c.dataset.parentId:r;var f=parseInt(c.dataset.pos);if(n<i){if(c===c.parentElement.lastChild)p.componentPos=f-100;else if(c.nextSibling){var h=c.nextSibling,m=parseInt(h.dataset.pos);p.componentPos=Math.round((f+m)/2)}}else if(c===c.parentElement.firstChild)p.componentPos=f+100;else if(c.previousSibling){var g=c.previousSibling,y=parseInt(g.dataset.pos);p.componentPos=Math.round((f+y)/2)}}(this.allowDropBetweenGroup||p.oldParentId===p.newParentId)&&this.$store.dispatch("config/setComponentParent",p)},searchTextBoxValueChanged:function(e){var t=this,n=e.value;this.searchTextBoxTimeoutId&&window.clearTimeout(this.searchTextBoxTimeoutId),this.searchTextBoxTimeoutId=setTimeout((function(){t.loadLayerComponentsBySearch({gisComponentId:t.gisComponentId,searchValue:n}).then((function(){t.setLegendLayerSearchValue({componentId:t.gisComponentId,legendLayerSearchValue:n})}))}),1e3)},legendLayersAllVisibleActiveChange:function(){this.setLegendLayersVisible({componentId:this.gisComponentId,legendLayersVisible:!(this.legendLayersSomeVisible||this.legendLayersAllVisible)})},deleteLayerButtonClick:function(){var e=this,t=this.getLayerOptions(this.activeLegendLayerComponentId),n=m[1]+t.text+(t.group?m[2]:"")+"?",i=Object(d["c"])({title:m[0],messageHtml:'<div style="font-size:16px;padding: 0 40px;">'.concat(n,"</div>"),buttons:[{text:"Да",type:"success",onClick:function(){e.deleteProcess=!0,e.deleteLayerComponent({gisComponentId:e.gisComponentId,layerComponentId:e.activeLegendLayerComponentId}).finally((function(){e.deleteProcess=!1}))}},{text:"Нет"}]});i.show()},onScroll:function(){this.hideLayerPopupMenu()}})}},bc56:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r}));n("ac6a"),n("cadf"),n("456d");var i=n("53ca"),o=(n("6762"),n("2fdb"),["and","or"]),a=function e(t,n){var i=t,a=n.map((function(e){return e.dataField}));if(Array.isArray(t)){if(3===t.length&&"string"===typeof t[0])return a.includes(t[0])?t:null;if(i=i.map((function(t){return e(t,n)})).filter((function(e){return null!==e})),o.includes(i[0])&&i.splice(0,1),o.includes(i[i.length-1])&&i.splice(-1,1),1===i.length)return i[0]}return i},s=[null,void 0,""];function r(e){for(var t in e)"object"!==Object(i["a"])(e[t])||Array.isArray(e[t])||s.includes(e[t])?(s.includes(e[t])||Array.isArray(e[t])&&!e[t].length)&&delete e[t]:Object.keys(e[t]).length?r(e[t]):delete e[t]}},bcab:function(e,t,n){"use strict";var i=n("b468"),o=n.n(i);o.a},beda:function(e,t,n){"use strict";var i=n("3b72"),o=n.n(i);o.a},c01e:function(e,t,n){"use strict";var i=n("5ab5"),o=n.n(i);o.a},c029:function(e,t,n){"use strict";var i=n("d176"),o=n.n(i);o.a},c107:function(e,t,n){},c1b9:function(e,t,n){},c1d2:function(e,t,n){"use strict";var i=n("99442"),o=n.n(i);o.a},c273:function(e,t,n){},c291:function(e,t,n){"use strict";var i=n("16a9"),o=n.n(i);o.a},c32c:function(e,t,n){"use strict";var i=n("214d"),o=n.n(i);o.a},c38c:function(e,t,n){},c523:function(e,t,n){},c634:function(e,t,n){},c639:function(e,t,n){"use strict";var i=n("2aef"),o=n.n(i);o.a},c643:function(e,t,n){"use strict";var i=n("8372"),o=n.n(i);o.a},c684:function(e,t,n){},c7db:function(e,t,n){},c87a:function(e,t,n){"use strict";var i=n("1368"),o=n.n(i);o.a},c8a1:function(e,t,n){},c92a:function(e,t,n){"use strict";var i=n("94fe"),o=n.n(i);o.a},c955:function(e,t,n){},ca0e:function(e,t,n){},cab6:function(e,t,n){"use strict";var i=n("c523"),o=n.n(i);o.a},cb6e:function(e,t,n){},cc18:function(e,t,n){},cd62:function(e,t,n){},cd98:function(e,t,n){},cf6b:function(e,t,n){"use strict";var i=n("2f59"),o=n.n(i);o.a},cfbd:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"style-list-popup",attrs:{animation:null,visible:e.visible,shading:!1,resizeEnabled:!0,title:e.title,position:e.popupPosition,width:547,height:520,container:e.popupContainer,contentTemplate:"content"},on:{showing:e.loadData,shown:function(t){return e.$emit("shown")},hidden:e.onHidden},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:e.title,showCloseButton:!0},on:{closeClick:function(t){return e.$emit("hidden")}}})]},proxy:!0},{key:"content",fn:function(){return[n("div",{staticClass:"style-list-popup__content"},[n("div",{staticClass:"style-list-popup__toolbar"},[n("DxTextBox",{staticClass:"style-list-popup__search",attrs:{mode:"search",valueChangeEvent:"input",placeholder:"Поиск..."},on:{input:e.onSearch},model:{value:e.searchStr,callback:function(t){e.searchStr=t},expression:"searchStr"}}),e.filterByGeometryVisible?n("DxButton",{attrs:{text:e.filterByGeom?"Все стили":"Стили только для этого слоя",stylingMode:"text",type:"success"},on:{click:e.filterDataByGeom}}):e._e(),n("DxButton",{staticClass:"style-list-popup__delete",attrs:{icon:"trash",type:"danger",disabled:!e.selectedItem,hint:"Удалить выбранный стиль"},on:{click:e.onDelete}})],1),n("div",{staticClass:"style-list-popup__list"},[n("DxScrollView",{ref:"scrollView",attrs:{bounceEnabled:!1,onReachBottom:e.onReachBottom}},[e.dataSource.length||!e.isAllLoaded?n("div",{staticClass:"style-list-popup__list-inner"},e._l(e.dataSource,(function(t){return n("div",{staticClass:"style-list-popup__item",class:{"style-list-popup__item_selected":e.selectedItem&&e.selectedItem.id===t.id},attrs:{title:t.name},on:{click:function(n){e.selectedItem=t},dblclick:e.apply}},[n("div",{staticClass:"style-list-popup__title"},[e._v("\n                "+e._s(t.name)+"\n              ")]),t.url?n("div",{staticClass:"style-list-popup__img",style:{backgroundImage:"url("+t.url+"&_config_dataset=PAGES.DSPAGE)"}}):n("i",{staticClass:"core core-206_palette"})])})),0):n("div",{staticClass:"style-list-popup__no-data"},[e._v("\n            Нет данных для отображения\n          ")])])],1)])]},proxy:!0}])})},o=[],a=(n("ac6a"),n("2909")),s=(n("6762"),n("2fdb"),n("c5f6"),n("d736")),r=n.n(s),l=n("25aa"),c=n("5a1f"),d=n.n(c),u=n("e614"),p=n.n(u),f=n("6191"),h=n.n(f),m=n("bf8c"),g="CONFIG.DSSTYLE",y=["Polygon","Line","Point"],v={name:"StyleListPopup",components:{DxPopup:r.a,PopupTitleTemplate:l["a"],DxScrollView:d.a,DxTextBox:p.a,DxButton:h.a},props:{visible:Boolean,styleType:Number,title:String,geomTypes:{type:Array,default:function(){return[]}},popupContainer:null},data:function(){return{dataSource:[],selectedItem:null,timeoutId:null,filterByGeom:!0,searchStr:"",limit:20,offset:0,isAllLoaded:!1}},computed:{popupPosition:function(){return{at:"top",my:"top",offset:"0, 36",of:this.popupContainer}},filterByGeometryVisible:function(){var e=this;return this.geomTypes&&!y.every((function(t){return e.geomTypes.includes(t)}))}},methods:{onReachBottom:function(e){if(this.isAllLoaded)return e.component.release(),void e.component.option("onReachBottom",null);this.loadData().then((function(){e.component.release()}))},onHidden:function(){this.dataSource=[],this.filterByGeom=!0,this.searchStr="",this.offset=0,this.$emit("hidden")},onSearch:function(){var e=this;this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.timeoutId=setTimeout((function(){e.offset=0,e.loadData()}),1e3)},loadData:function(){var e=this;this.offset||(this.dataSource=[],this.isAllLoaded=!1,this.$refs.scrollView.instance.option("onReachBottom",this.onReachBottom));var t={_config_dataset:g,styletype_id:this.styleType,_config_serverside:!0,limit:this.limit,offset:this.offset},n=this.getFilter();return n&&(t.where=n),Object(m["c"])("getData",t).then((function(t){var n,i=t.data;((!i||!Array.isArray(i)||i.length<e.limit)&&(e.isAllLoaded=!0,e.$refs.scrollView.instance.option("onReachBottom",null)),Array.isArray(i))&&((n=e.dataSource).push.apply(n,Object(a["a"])(i)),e.offset+=i.length);return i}))},getFilter:function(){var e=null;if(this.filterByGeometryVisible&&this.filterByGeom&&(e=b(this.geomTypes)),this.searchStr){var t=["name","contains",this.searchStr];e?e.push("and",t):e=t}return e},apply:function(){this.$emit("apply",this.selectedItem.body)},filterDataByGeom:function(){this.searchStr="",this.filterByGeom=!this.filterByGeom,this.offset=0,this.loadData()},onDelete:function(){var e=this,t=this.selectedItem.id;Object(m["c"])("deleteData",{_config_dataset:g,id:t}).then((function(){e.selectedItem=null,e.dataSource=e.dataSource.filter((function(e){return e.id!==t}));var n={_config_dataset:g,styletype_id:e.styleType,_config_serverside:!0,limit:1,offset:e.offset-1},i=e.getFilter();return i&&(n.where=i),Object(m["c"])("getData",n).then((function(t){var n,i=t.data;i&&i.length?(n=e.dataSource).push.apply(n,Object(a["a"])(i)):(e.isAllLoaded=!0,e.$refs.scrollView.instance.option("onReachBottom",null));return i}))}))}}};function b(e){var t=y.filter((function(t){return!e.includes(t)})),n=[];return t.forEach((function(e,t){t&&n.push("and"),n.push(["geomtypes","notcontains",e])})),n}var _=v,C=(n("daa3"),n("2877")),x=Object(C["a"])(_,i,o,!1,null,null,null);t["a"]=x.exports},d08a:function(e,t,n){"use strict";var i=n("0531"),o=n.n(i);o.a},d0ab:function(e,t,n){},d176:function(e,t,n){},d206:function(e,t,n){"use strict";var i=n("6657"),o=n.n(i);o.a},d32a:function(e,t,n){"use strict";var i=n("a445"),o=n.n(i);o.a},d34a:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxPopup",{staticClass:"save-style-form",attrs:{animation:null,visible:e.visible,shading:!1,resizeEnabled:!0,title:e.title,width:400,height:"auto",toolbarItems:e.toolbarItems,container:e.popupContainer},on:{showing:function(t){e.styleName=e.name},shown:function(t){return e.$emit("shown")},hidden:function(t){return e.$emit("hidden")}},scopedSlots:e._u([{key:"titleTemplate",fn:function(){return[n("PopupTitleTemplate",{attrs:{text:e.title,showCloseButton:!0},on:{closeClick:function(t){return e.$emit("hidden")}}})]},proxy:!0}])},[n("div",{staticClass:"save-style-form__content"},[n("div",{staticClass:"dx-field"},[n("div",{staticClass:"dx-field-label",attrs:{title:"Наименование"}},[e._v("\n        Наименование\n      ")]),n("div",{staticClass:"dx-field-value"},[n("DxTextBox",{staticClass:"gis-line-style-form__color-box",model:{value:e.styleName,callback:function(t){e.styleName=t},expression:"styleName"}})],1)])])])},o=[],a=(n("7f7f"),n("c5f6"),n("d736")),s=n.n(a),r=n("25aa"),l=n("e614"),c=n.n(l),d=n("bf8c"),u={name:"SaveStyleForm",components:{DxPopup:s.a,DxTextBox:c.a,PopupTitleTemplate:r["a"]},props:{visible:Boolean,title:String,name:String,styleBody:Object,styleType:Number,popupContainer:null},data:function(){var e=this;return{styleName:this.name,toolbarItems:[{toolbar:"bottom",location:"center",widget:"dxButton",options:{text:"Сохранить",type:"success",onClick:function(){e.apply()}}},{toolbar:"bottom",location:"center",widget:"dxButton",options:{text:"Отменить",onClick:function(){e.$emit("hidden")}}}]}},methods:{apply:function(){var e=this,t=this.styleBody.geomTypes?this.styleBody.geomTypes.join(","):null;Object(d["c"])("insertData",{_config_dataset:"CONFIG.DSSTYLE",body:JSON.stringify(this.styleBody),styletype_id:this.styleType,name:this.styleName,geomtypes:t}).then((function(t){e.$emit("apply",t)}))}}},p=u,f=(n("f854"),n("2877")),h=Object(f["a"])(p,i,o,!1,null,null,null);t["a"]=h.exports},d3cd:function(e,t,n){},d3e5:function(e,t,n){},d400:function(e,t,n){"use strict";var i=n("2909"),o=(n("097d"),n("6762"),n("2fdb"),n("4f34")),a=n.n(o),s=n("cbd3"),r=n("b432"),l=n("595b"),c=[-180,-90,360,90];t["a"]={components:{DxLoadIndicator:a.a},data:function(){return{authorizationFormVisible:!1,url:null,extents:{},loading:!1,layers:[],login:null,password:null}},methods:{onListItemClick:function(e){var t=e.component.instance().isItemSelected(e.itemIndex);t?e.component.instance().unselectItem(e.itemIndex):e.component.instance().selectItem(e.itemIndex),this.getExtents(e.itemData.id);var n=e.element.querySelector(".item-extent");n&&n.classList.remove("item-extent"),e.itemElement.classList.add("item-extent")},calcHeight:function(e){var t=e.element.offsetHeight>400?400:e.element.offsetHeight;e.component.option("height",t)},getExtents:function(e){this.extents[e]?this.$emit("changeExtents",this.extents[e]):Object(s["a"])({message:"Координаты сервиса отсутствуют",width:"auto"},"warning",3e3)},getCapabilities:function(e){var t=this;this.loading=!0,this.layers=[];var n="?";n=-1!==this.url.indexOf("?")?"&":"?";var i="".concat(this.url).concat(n).concat(e),o={mode:"cors",method:"GET",headers:{"Content-Type":"application/json;charset=utf-8"}};this.login&&this.password&&(o.headers.Authorization="Basic "+btoa("".concat(this.login,":").concat(this.password)));var a=i;r["c"].every((function(e){return!i.includes(e)}))&&(a="".concat("https://proxy.rusgis.com/proxy","?url=").concat(i)),fetch(a,o).then((function(e){if(!e.ok)throw e;return e.text()})).then((function(e){t.parseXML(e)})).catch((function(e){if(401===e.status)return t.authorizationFormVisible=!0,void Object(s["a"])({message:"Неверный логин или пароль",width:"auto"},"error",3e3);Object(s["a"])({message:"Получение информации о сервисе недоступно",width:"auto"},"error",3e3)})).finally((function(){t.loading=!1}))},selectLayer:function(e){var t=e.component.instance().option("selectedItemKeys");this.layersOptions.bounds=this.getBounds(t),this.emitChanges()},formatExtent:function(e){return e.map((function(e){return e.map((function(e,t){var n=+e;return t>0?n<-90?-90:n>90?90:n:n}))}))},getBounds:function(e){var t=this,n=e.map((function(e){if(t.extents[e]){var n=t.extents[e].flat();return l["bboxPolygon"](n)}return null})).filter((function(e){return e}));if(!n.length)return c;var o=l["union"].apply(l,Object(i["a"])(n));return l["bbox"](o)},extentToWGS:function(e){var t=l["bboxPolygon"](e.flat()),n=l["toWgs84"](t),i=l["bbox"](n);return[[i[0],i[1]],[i[2],i[3]]]},authorizationDataChange:function(e){this.login=e.login,this.password=e.password,this.emitChanges()}}}},d43c:function(e,t,n){},d45b:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"gis-buffer-zone-panel"},[n("DxNumberBox",{staticClass:"gis-buffer-zone-panel__number-box",attrs:{step:1,format:"# м",showSpinButtons:!0},on:{valueChanged:function(t){return e.$emit("zoneChanged",t.value)}},model:{value:e.bufferZoneValues.zoneValue,callback:function(t){e.$set(e.bufferZoneValues,"zoneValue",t)},expression:"bufferZoneValues.zoneValue"}}),e.showRounded?n("div",{staticClass:"gis-buffer-zone-panel__wrapper"},[n("div",{staticClass:"gis-buffer-zone-panel__label"},[e._v("Сглаживание")]),n("DxCheckBox",{on:{valueChanged:function(t){return e.$emit("roundedChanged",t.value)}},model:{value:e.bufferZoneValues.roundedValue,callback:function(t){e.$set(e.bufferZoneValues,"roundedValue",t)},expression:"bufferZoneValues.roundedValue"}})],1):e._e(),e.showUnion?n("div",{staticClass:"gis-buffer-zone-panel__wrapper"},[n("div",{staticClass:"gis-buffer-zone-panel__label"},[e._v("Объединение")]),n("DxCheckBox",{on:{valueChanged:function(t){return e.$emit("unionChanged",t.value)}},model:{value:e.bufferZoneValues.unionValue,callback:function(t){e.$set(e.bufferZoneValues,"unionValue",t)},expression:"bufferZoneValues.unionValue"}})],1):e._e()],1),this.showUnion&&this.showSide?n("div",{staticClass:"gis-buffer-buttons"},[n("DxButton",{staticClass:"gis-legend-item-panel__buffer-button",attrs:{text:"Построить по всем объектам слоя",stylingMode:"text",type:"success"},on:{click:function(t){return e.handleCreateBufferZone(Object.assign({},e.bufferZoneValues,{mode:"all"}))}}}),n("DxButton",{staticClass:"gis-legend-item-panel__buffer-button",attrs:{text:"Построить по выбранным объектам слоя",stylingMode:"text",type:"success",disabled:e.hasSelectedIds},on:{click:function(t){return e.handleCreateBufferZone(Object.assign({},e.bufferZoneValues,{mode:"selected"}))}}})],1):e._e()])},o=[],a=(n("8e6e"),n("ac6a"),n("cadf"),n("456d"),n("ade3")),s=n("2f62"),r=n("7ea3"),l=n.n(r),c=n("ee80"),d=n.n(c),u=n("6191"),p=n.n(u),f=n("5c46"),h=n("eec1"),m=n("d6fe"),g=n("fe56"),y=n("9841"),v=n("68b0"),b=n("4787");function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x={mixins:[f["a"]],components:{DxNumberBox:l.a,DxCheckBox:d.a,DxButton:p.a},props:{layerComponentId:String,gisComponentId:String,showRounded:{type:Boolean,default:!1},showUnion:{type:Boolean,default:!0},showSide:{type:Boolean,default:!0}},data:function(){return{bufferZoneValues:{zoneValue:10,roundedValue:!1,unionValue:!1,sideValue:!1,endcapValue:!1}}},computed:C(C({},Object(s["c"])("config",{getLayerOptions:h["E"],getLayerSelectedIds:h["H"]})),{},{layerOptions:function(){return this.getLayerOptions(this.layerComponentId)},hasSelectedIds:function(){return!this.getLayerSelectedIds(this.layerComponentId).length}}),watch:{showRounded:{handler:function(){this.bufferZoneValues.endcapValue=!this.showRounded},immediate:!0}},methods:C(C(C({},Object(s["d"])("config",{setLayerLoading:m["H"],setOptions:g["a"]})),Object(s["b"])("config",{createBufferZones:y["g"],loadLayerComponent:v["l"]})),{},{handleCreateBufferZone:function(e){var t=this;this.setLayerLoading({componentId:this.layerComponentId,value:!0}),this.createBufferZones({layerComponentId:this.layerOptions.layerComponentId,dataSetComponentId:this.layerOptions.dataSetComponentId,bufferZoneValues:e}).then((function(e){return t.loadLayerComponent({gisComponentId:t.gisComponentId,layerComponentId:e})})).then((function(e){return t.setLayerLoading({componentId:t.layerComponentId,value:!1}),t.setOptions({componentId:t.gisComponentId,optionName:"editingOptionsLayerComponentId",optionValue:e}),b["a"].updateSession()}))}})},O=x,I=(n("1842"),n("2877")),S=Object(I["a"])(O,i,o,!1,null,null,null);t["a"]=S.exports},d576:function(e,t,n){},d599:function(e,t,n){"use strict";var i=n("98c6"),o=n.n(i);o.a},d661:function(e,t,n){"use strict";var i=n("486a"),o=n.n(i);o.a},d6ef:function(e,t,n){"use strict";var i=n("b1c1"),o=n.n(i);o.a},d711:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxDrawer",{ref:"drawer",staticClass:"gis",attrs:{opened:!1,shading:!1,closeOnOutsideClick:!1,openedStateMode:"shrink"},scopedSlots:e._u([{key:"template",fn:function(){return[e.showLegend?n("GisLegend",{staticClass:"gis__legend",attrs:{legendItems:e.legendItemsFlat,images:e.images,visibleProcess:e.visibleProcess,popoverContainer:e.popoverContainer,useAddLayerMenu:e.options.useAddLayerMenu},on:{layerAdd:e.handleLayerAdd,addLayerClick:e.onAddLayerClick,createBufferZone:e.createLayerBufferZone}}):e._e()]},proxy:!0}])},[n("div",{staticClass:"gis__drawer-content"},[e.showToolbar?n("GisToolbar",{staticClass:"gis__toolbar",attrs:{legendBottonActove:e.legendVisible,spaceImageButtonActive:e.spaceImageryPanelVisible,buttonDisabled:e.toolbarButtonsDisabled,visibleTools:e.visibleTools,leftButtonItems:e.leftButtonItems,rightButtonItems:e.rightButtonItems,buttonValues:e.toolbarValues,activeMouseTool:e.selectedMouseTool,geocodePoint:e.geocodePoint,pasteButtonMessage:e.pasteButtonMessage,allAddresses:e.allAddresses,validateLatLng:e.validateLatLng},on:{handleMarker:e.handleMarker,handleMarkerPopup:e.handleMarkerPopup,handleRemoveMarker:e.handleRemoveMarker,handleRemovePoint:e.handleRemovePoint,handleRemoveAddresses:e.handleRemoveAddresses,handleCoordinatesChanged:e.handleCoordinatesChanged,buttonValueChanged:function(t){e.toolbarValues[t.name]=t.value},buttonClick:e.handleToolbarButtonClick,buttonActiveStateChanged:e.handleToolbarButtonActiveStateChanged,useIdentificationRequestTool:e.useIdentificationRequestTool,resetIdentification:e.resetIdentification}}):e._e(),n("div",{ref:"mapContainer",staticClass:"gis__map-container"},[e.isYandexBaseMap?n("div",{ref:"yandexMap",staticClass:"gis__yandex-map"}):e._e(),n("GisScalePanel",{staticClass:"gis__scale-panel",attrs:{scale:e.scale,coordinates:e.coordinates}}),n("div",{directives:[{name:"show",rawName:"v-show",value:e.layersListVisible.baseTextMapListVisible,expression:"layersListVisible.baseTextMapListVisible"}],ref:"baseTextMapList",staticClass:"gis__base-map-list text-map"},[n("DxScrollView",[n("GisBaseMapList",{attrs:{items:e.baseTextMapListItems},on:{itemClick:function(t){return e.handleBaseMapListItemClick(t,!0)}}})],1)],1),n("GisBaseMapButton",{staticClass:"gis__base-map-button text-map",attrs:{caption:e.getBaseMapCaption(e.baseTextMapListSelectedItem,e.$options.TEXT_MAP_NAME),iconUrl:e.baseTextMapListSelectedItem.iconUrl||null},nativeOn:{click:function(t){return e.handleBaseMapButtonClick("baseTextMapListVisible",e.$refs.baseTextMapList)}}}),n("div",{directives:[{name:"show",rawName:"v-show",value:e.layersListVisible.baseMapListVisible,expression:"layersListVisible.baseMapListVisible"}],ref:"baseMapList",staticClass:"gis__base-map-list"},[n("DxScrollView",[n("GisBaseMapList",{attrs:{items:e.baseMapListItems},on:{itemClick:function(t){return e.handleBaseMapListItemClick(t,!1)}}})],1)],1),n("GisBaseMapButton",{staticClass:"gis__base-map-button",attrs:{caption:e.getBaseMapCaption(e.baseMapListSelectedItem,e.$options.BASE_MAP_NAME),iconUrl:e.baseMapListSelectedItem.iconUrl||null},nativeOn:{click:function(t){return e.handleBaseMapButtonClick("baseMapListVisible",e.$refs.baseMapList)}}}),n("GisContextMenu",{directives:[{name:"show",rawName:"v-show",value:e.showFeatureContextMenu,expression:"showFeatureContextMenu"}],staticClass:"gis__context-menu",style:e.featureContextMenuPosition},[n("GisContextMenuItem",{attrs:{text:"Карточка объекта"},nativeOn:{click:function(t){return e.handleOpenCardClick(t)}}}),e._l(e.contextMenuConstructorItems,(function(t,i){return n("GisContextMenuItem",e._b({key:i,nativeOn:{click:function(n){return e.handleContextMenuItemClick(t.componentId)}}},"GisContextMenuItem",t.options,!1))}))],2),n("GisLayerList",{attrs:{layers:e.layerConfigsFlat,mapbox:e.mapbox},on:{featureSelecting:e.selectByFeatureId,dataRefreshing:e.onLayerDataRefreshing}}),n("GisPopupEditLayerStyle",{attrs:{layerConfig:e.editLayerConfig,visible:e.editLayerStylePopupVisible,popupContainer:e.popoverContainer},on:{shown:function(t){e.editLayerStylePopupVisible=!0},hidden:e.handlerLayerStyleCancel,apply:e.handlerLayerStyleEdit}}),e.showCoordinatesEditor?n("GisCoordinatesEditor",{ref:"coordinatesEditor",attrs:{gisModule:this,editFeature:e.coordEditorFeature,geometryTypes:e.editGeomTypes,popupContainer:e.popoverContainer},on:{close:e.onCoordinatesEditorClose,change:e.onGeometryCoordinatesChange}}):e._e(),n("GisReportList",{attrs:{visible:e.reportListVisible,reportGroupId:e.reportGroupId},on:{shown:function(t){e.reportListVisible=!0},hidden:e.hideReportList,apply:e.handleSnapshotForReport}}),e.reportFeatureProperties?n("GisPopupSelectSnapshot",{attrs:{featureGuid:e.reportFeatureProperties?e.reportFeatureProperties.guid||"":null,visible:e.getSnapshotFromPage,snapshotDataSetName:e.options.snapshotDataSetName},on:{shown:function(t){e.getSnapshotFromPage=!0},hidden:e.hidePopupSelectSnapshot,apply:e.selectSnapshotFromPage}}):e._e(),n("GisDocumentsSnapshot",{attrs:{visible:e.snapshotVisible,snapshotButtonText:e.snapshotButtonText,imageLayersLoading:e.imageLayersLoading,getSnapshotFromPage:e.getSnapshotFromPage},on:{shown:function(t){e.snapshotVisible=!0},apply:e.createSnapshotButtonClick}}),e.snapshotVisible?n("SnapshotDraw",{attrs:{gisModule:this,popupContainer:e.popoverContainer}}):e._e(),e.snapshotVisible?n("GisDocumentSnapshotPanel",{attrs:{panelStyle:e.topPanelStyle}}):e._e(),e.snapshotVisible?n("GisDocumentSnapshotPanel",{attrs:{panelStyle:e.rightPanelStyle}}):e._e(),e.snapshotVisible?n("GisReportImgPanel",{attrs:{docName:e.docName,featureGuid:e.reportFeatureProperties?e.reportFeatureProperties.guid||"":null,reportImageData:e.reportImageData,selectedIndex:e.selectedReportImageDataIndex,gisComponentId:e.componentId},on:{changeSelectedSnapshot:e.changeSelectedReportImage,apply:e.reportImagePanelApplyClick,hidden:e.hideDocumentsSnapshot}}):e._e(),e.snapshotVisible?n("GisDocumentSnapshotPanel",{attrs:{panelStyle:e.bottomPanelStyle}}):e._e(),e.snapshotVisible?n("GisDocumentSnapshotPanel",{attrs:{panelStyle:e.leftPanelStyle}}):e._e(),n("iframe",{style:{visibility:"hidden",display:"none"},attrs:{src:e.downloadLink}}),n("GisAddServicePopup",{attrs:{gisComponentId:e.componentId,visible:e.serviceFormVisible,popupContainer:e.popoverContainer},on:{shown:function(t){e.serviceFormVisible=!0},hidden:function(t){e.serviceFormVisible=!1}}}),n("DxLoadPanel",e._b({ref:"dxLoadPanel"},"DxLoadPanel",e.loadPanelOptions,!1))],1)],1)])},o=[],a=n("3ce8"),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("DxSortable",{attrs:{filter:".gis-legend-item__content",handle:".gis-legend-item__text",allowDropInsideItem:!1,allowReordering:!0,dropFeedbackMode:"indicate",height:"100%"},on:{reorder:e.onReorder}},[n("div",{staticClass:"gis-legend"},[n("div",{staticClass:"gis-legend__top-panel"},[n("DxTextBox",{staticClass:"gis-legend-alternative__search",attrs:{value:e.legendLayerSearchValue,mode:"search",valueChangeEvent:"input",placeholder:"Поиск..."},on:{valueChanged:e.searchTextBoxValueChanged}}),n("GisToolbarButtonGroup",[n("GisToolbarButton",{staticClass:"gis-legend__button",attrs:{disabled:!e.activeLegendLayerComponentId,loadIndicator:e.deleteProcess,iconCss:"core core-023-delete",text:"Удалить слой"},on:{click:function(t){return e.handlerCommonButton("delete")}}}),n("GisToolbarButton",{staticClass:"gis-legend__button",attrs:{loadIndicator:e.visibleProcess,iconCss:e.commonIconVisible,text:e.commonVisibleState||e.commonHalfVisible?"Скрыть все слои":"Показать все слои"},on:{click:function(t){return e.handlerCommonButton("visible")}}}),n("GisToolbarButton",{ref:"addLayerButtonRef",attrs:{iconCss:"fas fa-plus",text:"Добавить слой"},on:{click:e.toggleAddLayerMenu}})],1)],1),n("div",{staticClass:"gis-legend__tree"},[n("DxScrollView",{ref:"scrollView"},[n("div",e._l(e.items,(function(t){return n("GisLegendItem",{key:t.id,attrs:{legendItem:t,images:e.images,selectedId:null,parents:[],dxScrollView:null,level:0},on:{styleRuleChanged:function(n){return e.handleStyleRuleChanged(n,t)},legendIconEnter:e.handleLegendIconEnter,legendIconLeave:e.handleLegendIconLeave}})})),1),n("DxPopover",{ref:"dxPopoverLegendItemPanel",attrs:{visible:!!e.popupMenuLayerComponentId,position:"right",closeOnOutsideClick:e.onLayerMenuOutsideClick}},[n("GisLegendItemPanel",{staticClass:"gis-legend-item__panel",attrs:{layerComponentId:e.popupMenuLayerComponentId,opacity:e.layerOpacity,legendItemsSearch:e.legendItemsSearch,popoverContainer:e.popoverContainer},on:{buttonClick:e.handleLegendPanelButtonClick,createBufferZone:e.handleCreateBufferZone}})],1),n("DxTooltip",{ref:"iconTooltipRef",attrs:{deferRendering:!0},scopedSlots:e._u([{key:"content",fn:function(){return[n("div",{staticClass:"gis-legend-item__tooltip-content"},[e.tooltipUrl?n("img",{attrs:{src:e.tooltipUrl},on:{load:function(t){return e.tooltipImageLoaded(t)}}}):n("i",{class:e.legendItemCurrent&&e.legendItemCurrent.iconCss||"core core-091-layer",style:{color:e.legendItemCurrent&&e.legendItemCurrent.iconColor}})])]},proxy:!0}])})],1)],1),n("DxPopover",{ref:"addLayerMenuRef",attrs:{visible:e.addLayerMenuVisible,closeOnOutsideClick:!0,container:e.popoverContainer},on:{hidden:function(t){e.addLayerMenuVisible=!1},disposing:function(t){e.addLayerMenuVisible=!1}}},[n("GisAddLayerMenu",{on:{addLayerClick:e.onAddLayerClick}})],1),n("GisPopupAddLayer",{attrs:{visible:e.addLayerPopupVisible,popupContainer:e.popoverContainer},on:{shown:function(t){e.addLayerPopupVisible=!0},hidden:function(t){e.addLayerPopupVisible=!1},apply:e.handleLayerAdd}})],1)])},r=[],l=(n("551c"),n("4344")),c=n.n(l),d=n("adbc"),u=n.n(d),p=n("5a1f"),f=n.n(p),h=n("0342"),m=n.n(h),g=n("e614"),y=n.n(g),v=n("1d3c"),b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-legend-item",attrs:{"data-id":e.legendItem.id,"data-parent-id":e.legendItem.parentId,"data-pos":e.legendItem.pos,"data-parents":e.parents.join(",")}},[n("div",{staticClass:"gis-legend-item__content",class:{"gis-legend-item__content_active":e.legendItem.active},style:e.contentCssStyle,on:{click:function(t){return e.contentClick({item:t.item})}}},[n("div",{staticClass:"gis-legend-item__toggle",class:{"gis-legend-item__toggle_transparent":!e.items||0===e.items.length},on:{mouseenter:e.handleLegendIconEnter,mouseleave:e.handleLegendIconLeave,click:e.toggleExpandClick}},[n("i",{staticClass:"dx-icon",class:{"dx-icon-spinright":!e.localExpanded,"dx-icon-spindown":e.localExpanded}})]),n("div",{ref:"iconRef",staticClass:"gis-legend-item__icon"},[e.iconUrl?n("img",{attrs:{src:e.iconUrl}}):e.legendItem.iconCss?n("i",{class:e.localExpanded&&e.expandEnabled?e.legendItem.iconExpandedCss:e.legendItem.iconCss,style:{color:e.legendItem.iconColor}}):1!==e.legendItem.styleRules.length||e.hasRules?e.hasRules?n("div",{staticClass:"gis-legend-item__icon",class:{"gis-legend-item__icon-active":e.styleListExpanded},on:{click:e.toggleStyleList}},[n("i",{staticClass:"core core-extern-layer",style:{color:e.legendItem.iconColor}})]):n("i",{staticClass:"core core-091-layer",style:{color:e.legendItem.iconColor}}):n("div",{staticClass:"gis-legend-item__canvas"},[n("canvas",{ref:"canvasRef"})])]),n("div",{ref:"textRef",staticClass:"gis-legend-item__text",attrs:{title:e.legendItem.text}},[e._v("\n      "+e._s(e.legendItem.text)+"\n    ")]),n("div",{staticClass:"gis-legend-item__buttons"},[e.legendItem.loading?n("DxLoadIndicator",{staticClass:"gis-legend-item__load-indicator",attrs:{visible:!0}}):e._e(),e.legendItem.filterValue?n("div",{staticClass:"gis-legend-item__filter-indicator"},[e._m(0),n("div",{staticClass:"gis-legend-item__filter-indicator-line"})]):e._e(),!e.legendItem.editShow||e.items&&0!==e.items.length?e._e():n("GisLegendItemButton",{attrs:{active:e.legendItem.edit,iconCss:"core core-083-edit"},on:{activeChanged:function(t){return e.handleEditButtonActiveChanged("edit",t)}}}),e.legendItem.enableShow?n("GisLegendItemButton",{attrs:{active:e.legendItem.enable,iconCss:"core core-076-lock",activeIconCss:"core core-077-unlock"},on:{activeChanged:function(t){return e.handleButtonActiveChanged("enable",t)}}}):e._e(),e.legendItem.textVisibleShow?n("GisLegendItemButton",{attrs:{active:e.legendItem.textVisible,iconCss:"core core-054-text"},on:{activeChanged:function(t){return e.handleButtonActiveChanged("textVisible",t)}}}):e._e(),e.legendItem.multiple&&e.legendItem.visibleShow&&(!e.legendItem.styleRules||e.legendItem.styleRules.length<2)?n("GisLegendItemButton",{attrs:{active:e.legendItem.visible||e.legendItem.halfVisible,iconCss:"core core-081-no-visible",activeIconCss:e.iconVisible,text:e.legendItem.visibleButtonText},on:{activeChanged:function(t){return e.handleButtonActiveChanged("visible",t)}}}):e._e(),e.legendItem.styleRules&&e.legendItem.styleRules.length>1?n("GisLegendItemButton",{attrs:{active:e.legendItem.visible||e.styleRulesHalfVisible,iconCss:"core core-081-no-visible",activeIconCss:e.iconStyleRulesVisible,text:e.legendItem.visibleButtonText},on:{activeChanged:function(t){return e.handleButtonActiveChanged("visible",t)}}}):e._e(),n("GisLegendItemButton",{ref:"buttonMoreRef",style:{visibility:e.legendItem.group?"hidden":"visible"},attrs:{active:e.legendItem.more,iconCss:"core core-074-3dots"},on:{activeChanged:function(t){return e.handleButtonActiveChanged("more",t)}}})],1)]),[e.hasRules&&e.styleListExpanded?n("div",{staticClass:"gis-legend-item__style-list"},e._l(e.legendItem.styleRules,(function(t){return n("GisLegendStyleItem",{key:t.id,style:e.styleItemCssStyle,attrs:{styleRule:t,images:e.images,expanded:!1,rightShift:!0},on:{visibilityChange:function(n){return e.handleVisibilityChanged(n,t)}}})})),1):e._e()],[e.items&&e.items.length>0&&e.localExpanded&&e.expandEnabled?n("div",{staticClass:"gis-legend-item__children"},e._l(e.items,(function(t){return n("GisLegendItem",{key:t.id,attrs:{legendItem:t,selectedId:null,parents:[],dxScrollView:e.dxScrollView,level:e.level+1},on:{buttonActiveChanged:function(n){return e.handleChildButtonActiveChanged(n,t)},click:function(n){return e.contentClick({item:n.item||t})},createBufferZone:function(n){return e.$emit("createBufferZone",{item:n.item||t,bufferValues:n.bufferValues})},styleRuleChanged:function(n){return e.handleChildVisibilityChanged(n,t)}}})})),1):e._e()]],2)},_=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-legend-item__filter-indicator-icon"},[n("i",{staticClass:"fas fa-filter"})])}],C=(n("8e6e"),n("ac6a"),n("cadf"),n("456d"),n("ade3")),x=(n("c5f6"),n("4f34")),O=n.n(x),I=n("1a37"),S=n("3281"),L=n("b93b"),D=n("b432");function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){Object(C["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var w={name:"GisLegendItem",components:{DxLoadIndicator:O.a,GisLegendItemButton:I["a"],GisLegendStyleItem:S["a"]},props:{selectedId:String,dxScrollView:null,legendItem:Object,parents:Array,images:Array,level:Number},computed:{iconVisible:function(){return this.legendItem.halfVisible?D["g"][0]:D["g"][2]},iconStyleRulesVisible:function(){return this.styleRulesHalfVisible?D["g"][0]:this.legendItem.visible?D["g"][2]:D["g"][1]},visibleRules:function(){return this.legendItem.styleRules.filter((function(e){return e.options.visible}))},styleRulesHalfVisible:function(){return!!this.visibleRules.length&&this.visibleRules.length!==this.legendItem.styleRules.length},visibleButtonText:function(){return this.group?this.legendItem.visible||this.legendItem.halfVisible?"Скрыть вложенные слои":"Показать вложенные слои":this.legendItem.visible?"Скрыть слой":"Показать слой"},hasRules:function(){return this.legendItem.styleRules.length>1||1===this.legendItem.styleRules.length&&this.legendItem.styleRules[0].options.items},contentCssStyle:function(){return{paddingLeft:"".concat(12+10*this.level,"px")}},styleItemCssStyle:function(){return{paddingLeft:"".concat(12+10*(this.level+1),"px")}}},setup:function(e,t){var n=t.emit,i=Object(L["a"])(e,n),o=i.localExpanded,a=i.expandEnabled,s=i.styleListExpanded,r=i.iconUrl,l=i.tooltipIconUrl,c=i.iconRef,d=i.canvasRef,u=i.textRef,p=i.buttonMoreRef,f=i.items,h=i.handleLegendIconEnter,m=i.handleLegendIconLeave,g=i.handleLegendPanelButtonClick,y=i.handleButtonActiveChanged,v=i.toggleExpandClick,b=i.toggleStyleList,_=i.contentClick,C=i.handleChildButtonActiveChanged,x=i.handleEditButtonActiveChanged;return{localExpanded:o,expandEnabled:a,styleListExpanded:s,iconUrl:r,tooltipIconUrl:l,iconRef:c,canvasRef:d,textRef:u,buttonMoreRef:p,items:f,handleLegendIconEnter:h,handleLegendIconLeave:m,handleLegendPanelButtonClick:g,handleButtonActiveChanged:y,toggleExpandClick:v,toggleStyleList:b,contentClick:_,handleChildButtonActiveChanged:C,handleEditButtonActiveChanged:x}},methods:{handleChildVisibilityChanged:function(e,t){this.$emit("styleRuleChanged",E(E({},e),{},{legendItem:t}))},handleVisibilityChanged:function(e,t){t.options.visible=e,this.$emit("styleRuleChanged",{styleRule:t}),this.visibleRules.length===this.legendItem.styleRules.length?this.handleButtonActiveChanged("visible",!0):this.visibleRules.length||this.handleButtonActiveChanged("visible",!1)}}},T=w,j=(n("f81b"),n("2877")),k=Object(j["a"])(T,b,_,!1,null,null,null),F=k.exports,B=n("bbfd"),M=n("df21"),A=n("5ef3"),R=n("62b3"),V=n("84a9"),G=".gis-legend-item",$={name:"GisLegend",mixins:[B["a"]],components:{DxTooltip:c.a,DxPopover:u.a,DxScrollView:f.a,DxSortable:m.a,DxTextBox:y.a,GisLegendItemPanel:v["a"],GisLegendItem:F,GisAddLayerMenu:M["a"],GisPopupAddLayer:A["a"],GisToolbarButton:R["a"],GisToolbarButtonGroup:V["a"]},props:{options:Object,useAddLayerMenu:Boolean,legendItems:Array,legendItemsSearch:Promise,images:Array,visibleProcess:Boolean,popoverContainer:null},data:function(){return{lastEditId:null,timeout:null,lastComponent:{},hoverField:{element:null,img:"",defaultVisible:!1}}},computed:{commonIconVisible:function(){return this.commonVisibleState?D["g"][2]:this.commonHalfVisible?D["g"][0]:D["g"][1]}},methods:{onReorder:function(e){this.handleReorder(e,G)},handlerCommonButton:function(e){switch(e){case"visible":this.$emit("visibleButtonClick",{buttonActive:!this.commonVisibleState&&!this.commonHalfVisible,legendItems:this.items});break;case"delete":this.deleteLayerButtonClick();break}}}},N=$,U=(n("6391"),Object(j["a"])(N,s,r,!1,null,"55f813db",null)),z=U.exports,H=n("36ac"),W=n("5bba"),K=n.n(W),q={mixins:[a["a"]],components:{GisLegend:z,GisAddServicePopup:H["a"],DxLoadPanel:K.a},data:function(){return{serviceFormVisible:!1}},methods:{toggleLegend:function(){var e=this;this.$refs.drawer.instance.toggle().then((function(){e.mapbox.resize()}))}}},J=q,Z=(n("a420"),Object(j["a"])(J,i,o,!1,null,null,null));t["default"]=Z.exports},d79c:function(e,t,n){"use strict";var i=n("ba33"),o=n.n(i);o.a},d7c4:function(e,t,n){},d831:function(e,t,n){},d855:function(e,t,n){"use strict";var i=n("0d41"),o=n.n(i);o.a},d965:function(e,t,n){"use strict";var i=n("c273"),o=n.n(i);o.a},d989:function(e,t,n){},daa3:function(e,t,n){"use strict";var i=n("fad3"),o=n.n(i);o.a},db56:function(e,t,n){},db83:function(e,t,n){"use strict";var i=n("1f58"),o=n.n(i);o.a},dbaa:function(e,t,n){},dbf2:function(e,t,n){"use strict";var i=n("15a1"),o=n.n(i);o.a},dcb0:function(e,t,n){"use strict";var i=n("a783"),o=n.n(i);o.a},df21:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-add-layer-menu"},e._l(e.menuItemOptions,(function(t,i){return n("GisAddLayerMenuItem",{key:i,staticClass:"gis-add-layer-menu__item",attrs:{item:t},on:{itemClick:e.onItemClick}})})),1)},o=[],a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gis-add-layer-menu-item",on:{click:function(t){return t.stopPropagation(),e.handleClick(t)}}},[n("i",{staticClass:"gis-add-layer-menu-item__icon",class:e.item.iconCss}),n("div",{staticClass:"gis-add-layer-menu-item__title",domProps:{innerHTML:e._s(e.item.title)}})])},s=[],r={name:"GisAddLayerMenuItem",props:{item:{type:Object,default:function(){return{}}}},methods:{handleClick:function(){this.$emit("itemClick",this.item.event)}}},l=r,c=(n("6a49"),n("2877")),d=Object(c["a"])(l,a,s,!1,null,null,null),u=d.exports,p=[{iconCss:"core core-092-folder",title:"Создать<br />папку",event:"onAddFolderClick"},{iconCss:"core core-inside-layer",title:"Открыть<br />слой",event:"onOpenLayerClick"},{iconCss:"core core-034-add-poly-2",title:"Создать векторный слой",event:"onAddVectorLayerClick"},{iconCss:"core core-raster",title:"Создать растровый слой",event:"onAddRasterLayerClick"},{iconCss:"core core-extern-layer",title:"Подключить сервис",event:"onAddServiceClick"}],f={name:"GisAddLayerMenu",components:{GisAddLayerMenuItem:u},data:function(){return{menuItemOptions:p}},methods:{onItemClick:function(e){this.$emit("addLayerClick",e)}}},h=f,m=(n("9161"),Object(c["a"])(h,i,o,!1,null,null,null));t["a"]=m.exports},df23:function(e,t,n){},e021:function(e,t,n){},e06a:function(e,t,n){},e1bb:function(e,t,n){},e36d:function(e,t,n){"use strict";var i=n("98cc"),o=n.n(i);o.a},e36dc:function(e,t,n){"use strict";var i=n("24e6"),o=n.n(i);o.a},e3a8:function(e,t,n){"use strict";var i=n("d831"),o=n.n(i);o.a},e3b6:function(e,t,n){"use strict";var i=n("1d7a"),o=n.n(i);o.a},e481:function(e,t,n){"use strict";var i=n("0b1b"),o=n.n(i);o.a},e531:function(e,t,n){"use strict";var i=n("ca0e"),o=n.n(i);o.a},e5aa:function(e,t,n){"use strict";var i=n("b3d1"),o=n.n(i);o.a},e5cd:function(e,t,n){"use strict";var i=n("0c24"),o=n.n(i);o.a},e6a0:function(e,t,n){},e768:function(e,t,n){"use strict";var i=n("d3e5"),o=n.n(i);o.a},e7e8:function(e,t,n){},e836:function(e,t,n){},e8e2:function(e,t,n){},eb5c:function(e,t,n){"use strict";var i=n("c107"),o=n.n(i);o.a},eb66:function(e,t,n){},ec12:function(e,t,n){},ec1d:function(e,t,n){},ecb4:function(e,t,n){},ed15:function(e,t,n){},ed28:function(e,t,n){"use strict";var i=n("7c61"),o=n.n(i);o.a},ee23:function(e,t,n){"use strict";var i=n("63ed"),o=n.n(i);o.a},ee30:function(e,t,n){"use strict";var i=n("44aa"),o=n.n(i);o.a},ee9f:function(e,t,n){"use strict";var i=n("9341"),o=n.n(i);o.a},eee4:function(e,t,n){"use strict";var i=n("9cb5"),o=n.n(i);o.a},efe2:function(e,t,n){},f02f:function(e,t,n){},f1a5:function(e,t,n){"use strict";var i=n("f02f"),o=n.n(i);o.a},f2e6:function(e,t,n){},f2eb:function(e,t,n){"use strict";var i=n("f2e6"),o=n.n(i);o.a},f5a6:function(e,t,n){},f81b:function(e,t,n){"use strict";var i=n("fa4b"),o=n.n(i);o.a},f854:function(e,t,n){"use strict";var i=n("13e9"),o=n.n(i);o.a},f892:function(e,t,n){"use strict";var i=n("ed15"),o=n.n(i);o.a},f8aa:function(e,t,n){},f948:function(e,t,n){"use strict";var i=n("db56"),o=n.n(i);o.a},fa4b:function(e,t,n){},fa83:function(e,t,n){},fad3:function(e,t,n){},fc1a:function(e,t,n){"use strict";var i=n("b64a"),o=n.n(i);o.a},fcc6:function(e,t,n){},feff:function(e,t,n){},ff59:function(e,t,n){}}]);